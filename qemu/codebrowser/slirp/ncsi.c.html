<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ncsi.c source code [codebrowser/slirp/ncsi.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="ncsi_rsp_handler "/>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/slirp/ncsi.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>codebrowser</a>/<a href='./'>slirp</a>/<a href='ncsi.c.html'>ncsi.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * NC-SI (Network Controller Sideband Interface) "echo" model</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright (C) 2016 IBM Corp.</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * This code is licensed under the GPL version 2 or later. See the</i></td></tr>
<tr><th id="7">7</th><td><i> * COPYING file in the top-level directory.</i></td></tr>
<tr><th id="8">8</th><td><i> */</i></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../include/qemu/osdep.h.html">"qemu/osdep.h"</a></u></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="slirp.h.html">"slirp.h"</a></u></td></tr>
<tr><th id="11">11</th><td></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="ncsi-pkt.h.html">"ncsi-pkt.h"</a></u></td></tr>
<tr><th id="13">13</th><td></td></tr>
<tr><th id="14">14</th><td><i  data-doc="ncsi_rsp_handler_gc">/* Get Capabilities */</i></td></tr>
<tr><th id="15">15</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="ncsi_rsp_handler_gc" title='ncsi_rsp_handler_gc' data-type='int ncsi_rsp_handler_gc(struct ncsi_rsp_pkt_hdr * rnh)' data-ref="ncsi_rsp_handler_gc">ncsi_rsp_handler_gc</dfn>(<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr" title='ncsi_rsp_pkt_hdr' data-ref="ncsi_rsp_pkt_hdr">ncsi_rsp_pkt_hdr</a> *<dfn class="local col1 decl" id="1rnh" title='rnh' data-type='struct ncsi_rsp_pkt_hdr *' data-ref="1rnh">rnh</dfn>)</td></tr>
<tr><th id="16">16</th><td>{</td></tr>
<tr><th id="17">17</th><td>    <b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt" title='ncsi_rsp_gc_pkt' data-ref="ncsi_rsp_gc_pkt">ncsi_rsp_gc_pkt</a> *<dfn class="local col2 decl" id="2rsp" title='rsp' data-type='struct ncsi_rsp_gc_pkt *' data-ref="2rsp">rsp</dfn> = (<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt" title='ncsi_rsp_gc_pkt' data-ref="ncsi_rsp_gc_pkt">ncsi_rsp_gc_pkt</a> *) <a class="local col1 ref" href="#1rnh" title='rnh' data-ref="1rnh">rnh</a>;</td></tr>
<tr><th id="18">18</th><td></td></tr>
<tr><th id="19">19</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::cap" title='ncsi_rsp_gc_pkt::cap' data-ref="ncsi_rsp_gc_pkt::cap">cap</a> = <a class="ref" href="../../include/netinet/in.h.html#htonl" title='htonl' data-ref="htonl">htonl</a>(~<var>0</var>);</td></tr>
<tr><th id="20">20</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::bc_cap" title='ncsi_rsp_gc_pkt::bc_cap' data-ref="ncsi_rsp_gc_pkt::bc_cap">bc_cap</a> = <a class="ref" href="../../include/netinet/in.h.html#htonl" title='htonl' data-ref="htonl">htonl</a>(~<var>0</var>);</td></tr>
<tr><th id="21">21</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::mc_cap" title='ncsi_rsp_gc_pkt::mc_cap' data-ref="ncsi_rsp_gc_pkt::mc_cap">mc_cap</a> = <a class="ref" href="../../include/netinet/in.h.html#htonl" title='htonl' data-ref="htonl">htonl</a>(~<var>0</var>);</td></tr>
<tr><th id="22">22</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::buf_cap" title='ncsi_rsp_gc_pkt::buf_cap' data-ref="ncsi_rsp_gc_pkt::buf_cap">buf_cap</a> = <a class="ref" href="../../include/netinet/in.h.html#htonl" title='htonl' data-ref="htonl">htonl</a>(~<var>0</var>);</td></tr>
<tr><th id="23">23</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::aen_cap" title='ncsi_rsp_gc_pkt::aen_cap' data-ref="ncsi_rsp_gc_pkt::aen_cap">aen_cap</a> = <a class="ref" href="../../include/netinet/in.h.html#htonl" title='htonl' data-ref="htonl">htonl</a>(~<var>0</var>);</td></tr>
<tr><th id="24">24</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::vlan_mode" title='ncsi_rsp_gc_pkt::vlan_mode' data-ref="ncsi_rsp_gc_pkt::vlan_mode">vlan_mode</a> = <var>0xff</var>;</td></tr>
<tr><th id="25">25</th><td>    <a class="local col2 ref" href="#2rsp" title='rsp' data-ref="2rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gc_pkt::uc_cnt" title='ncsi_rsp_gc_pkt::uc_cnt' data-ref="ncsi_rsp_gc_pkt::uc_cnt">uc_cnt</a> = <var>2</var>;</td></tr>
<tr><th id="26">26</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="27">27</th><td>}</td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><i  data-doc="ncsi_rsp_handler_gls">/* Get Link status */</i></td></tr>
<tr><th id="30">30</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="ncsi_rsp_handler_gls" title='ncsi_rsp_handler_gls' data-type='int ncsi_rsp_handler_gls(struct ncsi_rsp_pkt_hdr * rnh)' data-ref="ncsi_rsp_handler_gls">ncsi_rsp_handler_gls</dfn>(<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr" title='ncsi_rsp_pkt_hdr' data-ref="ncsi_rsp_pkt_hdr">ncsi_rsp_pkt_hdr</a> *<dfn class="local col3 decl" id="3rnh" title='rnh' data-type='struct ncsi_rsp_pkt_hdr *' data-ref="3rnh">rnh</dfn>)</td></tr>
<tr><th id="31">31</th><td>{</td></tr>
<tr><th id="32">32</th><td>    <b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_gls_pkt" title='ncsi_rsp_gls_pkt' data-ref="ncsi_rsp_gls_pkt">ncsi_rsp_gls_pkt</a> *<dfn class="local col4 decl" id="4rsp" title='rsp' data-type='struct ncsi_rsp_gls_pkt *' data-ref="4rsp">rsp</dfn> = (<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_gls_pkt" title='ncsi_rsp_gls_pkt' data-ref="ncsi_rsp_gls_pkt">ncsi_rsp_gls_pkt</a> *) <a class="local col3 ref" href="#3rnh" title='rnh' data-ref="3rnh">rnh</a>;</td></tr>
<tr><th id="33">33</th><td></td></tr>
<tr><th id="34">34</th><td>    <a class="local col4 ref" href="#4rsp" title='rsp' data-ref="4rsp">rsp</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_gls_pkt::status" title='ncsi_rsp_gls_pkt::status' data-ref="ncsi_rsp_gls_pkt::status">status</a> = <a class="ref" href="../../include/netinet/in.h.html#htonl" title='htonl' data-ref="htonl">htonl</a>(<var>0x1</var>);</td></tr>
<tr><th id="35">35</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="36">36</th><td>}</td></tr>
<tr><th id="37">37</th><td></td></tr>
<tr><th id="38">38</th><td><em>static</em> <em>const</em> <b>struct</b> <dfn class="type def" id="ncsi_rsp_handler" title='ncsi_rsp_handler' data-ref="ncsi_rsp_handler"><a class="type" href="#ncsi_rsp_handler" title='ncsi_rsp_handler' data-ref="ncsi_rsp_handler">ncsi_rsp_handler</a></dfn> {</td></tr>
<tr><th id="39">39</th><td>        <em>unsigned</em> <em>char</em>   <dfn class="tu decl" id="ncsi_rsp_handler::type" title='ncsi_rsp_handler::type' data-type='unsigned char' data-ref="ncsi_rsp_handler::type">type</dfn>;</td></tr>
<tr><th id="40">40</th><td>        <em>int</em>             <dfn class="tu decl" id="ncsi_rsp_handler::payload" title='ncsi_rsp_handler::payload' data-type='int' data-ref="ncsi_rsp_handler::payload">payload</dfn>;</td></tr>
<tr><th id="41">41</th><td>        <em>int</em>             (*<dfn class="tu decl" id="ncsi_rsp_handler::handler" title='ncsi_rsp_handler::handler' data-type='int (*)(struct ncsi_rsp_pkt_hdr *)' data-ref="ncsi_rsp_handler::handler">handler</dfn>)(<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr" title='ncsi_rsp_pkt_hdr' data-ref="ncsi_rsp_pkt_hdr">ncsi_rsp_pkt_hdr</a> *<dfn class="local col5 decl" id="5rnh" title='rnh' data-type='struct ncsi_rsp_pkt_hdr *' data-ref="5rnh">rnh</dfn>);</td></tr>
<tr><th id="42">42</th><td>} <dfn class="tu decl def" id="ncsi_rsp_handlers" title='ncsi_rsp_handlers' data-type='const struct ncsi_rsp_handler [30]' data-ref="ncsi_rsp_handlers">ncsi_rsp_handlers</dfn>[] = {</td></tr>
<tr><th id="43">43</th><td>        { <a class="macro" href="ncsi-pkt.h.html#369" title="(0x00 + 0x80)" data-ref="_M/NCSI_PKT_RSP_CIS">NCSI_PKT_RSP_CIS</a>,     <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="44">44</th><td>        { <a class="macro" href="ncsi-pkt.h.html#370" title="(0x01 + 0x80)" data-ref="_M/NCSI_PKT_RSP_SP">NCSI_PKT_RSP_SP</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="45">45</th><td>        { <a class="macro" href="ncsi-pkt.h.html#371" title="(0x02 + 0x80)" data-ref="_M/NCSI_PKT_RSP_DP">NCSI_PKT_RSP_DP</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="46">46</th><td>        { <a class="macro" href="ncsi-pkt.h.html#372" title="(0x03 + 0x80)" data-ref="_M/NCSI_PKT_RSP_EC">NCSI_PKT_RSP_EC</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="47">47</th><td>        { <a class="macro" href="ncsi-pkt.h.html#373" title="(0x04 + 0x80)" data-ref="_M/NCSI_PKT_RSP_DC">NCSI_PKT_RSP_DC</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="48">48</th><td>        { <a class="macro" href="ncsi-pkt.h.html#374" title="(0x05 + 0x80)" data-ref="_M/NCSI_PKT_RSP_RC">NCSI_PKT_RSP_RC</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="49">49</th><td>        { <a class="macro" href="ncsi-pkt.h.html#375" title="(0x06 + 0x80)" data-ref="_M/NCSI_PKT_RSP_ECNT">NCSI_PKT_RSP_ECNT</a>,    <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="50">50</th><td>        { <a class="macro" href="ncsi-pkt.h.html#376" title="(0x07 + 0x80)" data-ref="_M/NCSI_PKT_RSP_DCNT">NCSI_PKT_RSP_DCNT</a>,    <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="51">51</th><td>        { <a class="macro" href="ncsi-pkt.h.html#377" title="(0x08 + 0x80)" data-ref="_M/NCSI_PKT_RSP_AE">NCSI_PKT_RSP_AE</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="52">52</th><td>        { <a class="macro" href="ncsi-pkt.h.html#378" title="(0x09 + 0x80)" data-ref="_M/NCSI_PKT_RSP_SL">NCSI_PKT_RSP_SL</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="53">53</th><td>        { <a class="macro" href="ncsi-pkt.h.html#379" title="(0x0a + 0x80)" data-ref="_M/NCSI_PKT_RSP_GLS">NCSI_PKT_RSP_GLS</a>,    <var>16</var>, <a class="tu ref" href="#ncsi_rsp_handler_gls" title='ncsi_rsp_handler_gls' data-use='r' data-ref="ncsi_rsp_handler_gls">ncsi_rsp_handler_gls</a> },</td></tr>
<tr><th id="54">54</th><td>        { <a class="macro" href="ncsi-pkt.h.html#380" title="(0x0b + 0x80)" data-ref="_M/NCSI_PKT_RSP_SVF">NCSI_PKT_RSP_SVF</a>,     <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="55">55</th><td>        { <a class="macro" href="ncsi-pkt.h.html#381" title="(0x0c + 0x80)" data-ref="_M/NCSI_PKT_RSP_EV">NCSI_PKT_RSP_EV</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="56">56</th><td>        { <a class="macro" href="ncsi-pkt.h.html#382" title="(0x0d + 0x80)" data-ref="_M/NCSI_PKT_RSP_DV">NCSI_PKT_RSP_DV</a>,      <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="57">57</th><td>        { <a class="macro" href="ncsi-pkt.h.html#383" title="(0x0e + 0x80)" data-ref="_M/NCSI_PKT_RSP_SMA">NCSI_PKT_RSP_SMA</a>,     <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="58">58</th><td>        { <a class="macro" href="ncsi-pkt.h.html#384" title="(0x10 + 0x80)" data-ref="_M/NCSI_PKT_RSP_EBF">NCSI_PKT_RSP_EBF</a>,     <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="59">59</th><td>        { <a class="macro" href="ncsi-pkt.h.html#385" title="(0x11 + 0x80)" data-ref="_M/NCSI_PKT_RSP_DBF">NCSI_PKT_RSP_DBF</a>,     <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="60">60</th><td>        { <a class="macro" href="ncsi-pkt.h.html#386" title="(0x12 + 0x80)" data-ref="_M/NCSI_PKT_RSP_EGMF">NCSI_PKT_RSP_EGMF</a>,    <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="61">61</th><td>        { <a class="macro" href="ncsi-pkt.h.html#387" title="(0x13 + 0x80)" data-ref="_M/NCSI_PKT_RSP_DGMF">NCSI_PKT_RSP_DGMF</a>,    <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="62">62</th><td>        { <a class="macro" href="ncsi-pkt.h.html#388" title="(0x14 + 0x80)" data-ref="_M/NCSI_PKT_RSP_SNFC">NCSI_PKT_RSP_SNFC</a>,    <var>4</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="63">63</th><td>        { <a class="macro" href="ncsi-pkt.h.html#389" title="(0x15 + 0x80)" data-ref="_M/NCSI_PKT_RSP_GVI">NCSI_PKT_RSP_GVI</a>,    <var>36</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="64">64</th><td>        { <a class="macro" href="ncsi-pkt.h.html#390" title="(0x16 + 0x80)" data-ref="_M/NCSI_PKT_RSP_GC">NCSI_PKT_RSP_GC</a>,     <var>32</var>, <a class="tu ref" href="#ncsi_rsp_handler_gc" title='ncsi_rsp_handler_gc' data-use='r' data-ref="ncsi_rsp_handler_gc">ncsi_rsp_handler_gc</a> },</td></tr>
<tr><th id="65">65</th><td>        { <a class="macro" href="ncsi-pkt.h.html#391" title="(0x17 + 0x80)" data-ref="_M/NCSI_PKT_RSP_GP">NCSI_PKT_RSP_GP</a>,     -<var>1</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="66">66</th><td>        { <a class="macro" href="ncsi-pkt.h.html#392" title="(0x18 + 0x80)" data-ref="_M/NCSI_PKT_RSP_GCPS">NCSI_PKT_RSP_GCPS</a>,  <var>172</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="67">67</th><td>        { <a class="macro" href="ncsi-pkt.h.html#393" title="(0x19 + 0x80)" data-ref="_M/NCSI_PKT_RSP_GNS">NCSI_PKT_RSP_GNS</a>,   <var>172</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="68">68</th><td>        { <a class="macro" href="ncsi-pkt.h.html#394" title="(0x1a + 0x80)" data-ref="_M/NCSI_PKT_RSP_GNPTS">NCSI_PKT_RSP_GNPTS</a>, <var>172</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="69">69</th><td>        { <a class="macro" href="ncsi-pkt.h.html#395" title="(0x1b + 0x80)" data-ref="_M/NCSI_PKT_RSP_GPS">NCSI_PKT_RSP_GPS</a>,     <var>8</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="70">70</th><td>        { <a class="macro" href="ncsi-pkt.h.html#396" title="(0x50 + 0x80)" data-ref="_M/NCSI_PKT_RSP_OEM">NCSI_PKT_RSP_OEM</a>,     <var>0</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="71">71</th><td>        { <a class="macro" href="ncsi-pkt.h.html#397" title="(0x51 + 0x80)" data-ref="_M/NCSI_PKT_RSP_PLDM">NCSI_PKT_RSP_PLDM</a>,    <var>0</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> },</td></tr>
<tr><th id="72">72</th><td>        { <a class="macro" href="ncsi-pkt.h.html#398" title="(0x52 + 0x80)" data-ref="_M/NCSI_PKT_RSP_GPUUID">NCSI_PKT_RSP_GPUUID</a>, <var>20</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> }</td></tr>
<tr><th id="73">73</th><td>};</td></tr>
<tr><th id="74">74</th><td></td></tr>
<tr><th id="75">75</th><td><i>/*</i></td></tr>
<tr><th id="76">76</th><td><i> * packet format : ncsi header + payload + checksum</i></td></tr>
<tr><th id="77">77</th><td><i> */</i></td></tr>
<tr><th id="78">78</th><td><u>#define <dfn class="macro" id="_M/NCSI_MAX_PAYLOAD" data-ref="_M/NCSI_MAX_PAYLOAD">NCSI_MAX_PAYLOAD</dfn> 172</u></td></tr>
<tr><th id="79">79</th><td><u>#define <dfn class="macro" id="_M/NCSI_MAX_LEN" data-ref="_M/NCSI_MAX_LEN">NCSI_MAX_LEN</dfn>     (sizeof(struct <a class="type" href="ncsi-pkt.h.html#ncsi_pkt_hdr" title='ncsi_pkt_hdr' data-ref="ncsi_pkt_hdr">ncsi_pkt_hdr</a>) + NCSI_MAX_PAYLOAD + 4)</u></td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><em>void</em> <dfn class="decl def" id="ncsi_input" title='ncsi_input' data-ref="ncsi_input">ncsi_input</dfn>(<a class="typedef" href="libslirp.h.html#Slirp" title='Slirp' data-type='struct Slirp' data-ref="Slirp">Slirp</a> *<dfn class="local col6 decl" id="6slirp" title='slirp' data-type='Slirp *' data-ref="6slirp">slirp</dfn>, <em>const</em> <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col7 decl" id="7pkt" title='pkt' data-type='const uint8_t *' data-ref="7pkt">pkt</dfn>, <em>int</em> <dfn class="local col8 decl" id="8pkt_len" title='pkt_len' data-type='int' data-ref="8pkt_len">pkt_len</dfn>)</td></tr>
<tr><th id="82">82</th><td>{</td></tr>
<tr><th id="83">83</th><td>    <b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_pkt_hdr" title='ncsi_pkt_hdr' data-ref="ncsi_pkt_hdr">ncsi_pkt_hdr</a> *<dfn class="local col9 decl" id="9nh" title='nh' data-type='struct ncsi_pkt_hdr *' data-ref="9nh">nh</dfn> = (<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_pkt_hdr" title='ncsi_pkt_hdr' data-ref="ncsi_pkt_hdr">ncsi_pkt_hdr</a> *)(<a class="local col7 ref" href="#7pkt" title='pkt' data-ref="7pkt">pkt</a> + <a class="macro" href="../include/net/eth.h.html#33" title="14" data-ref="_M/ETH_HLEN">ETH_HLEN</a>);</td></tr>
<tr><th id="84">84</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> <dfn class="local col0 decl" id="10ncsi_reply" title='ncsi_reply' data-type='uint8_t [206]' data-ref="10ncsi_reply">ncsi_reply</dfn>[<a class="macro" href="../include/net/eth.h.html#33" title="14" data-ref="_M/ETH_HLEN">ETH_HLEN</a> + <a class="macro" href="#79" title="(sizeof(struct ncsi_pkt_hdr) + 172 + 4)" data-ref="_M/NCSI_MAX_LEN">NCSI_MAX_LEN</a>];</td></tr>
<tr><th id="85">85</th><td>    <b>struct</b> <a class="type" href="slirp.h.html#ethhdr" title='ethhdr' data-ref="ethhdr">ethhdr</a> *<dfn class="local col1 decl" id="11reh" title='reh' data-type='struct ethhdr *' data-ref="11reh">reh</dfn> = (<b>struct</b> <a class="type" href="slirp.h.html#ethhdr" title='ethhdr' data-ref="ethhdr">ethhdr</a> *)<a class="local col0 ref" href="#10ncsi_reply" title='ncsi_reply' data-ref="10ncsi_reply">ncsi_reply</a>;</td></tr>
<tr><th id="86">86</th><td>    <b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr" title='ncsi_rsp_pkt_hdr' data-ref="ncsi_rsp_pkt_hdr">ncsi_rsp_pkt_hdr</a> *<dfn class="local col2 decl" id="12rnh" title='rnh' data-type='struct ncsi_rsp_pkt_hdr *' data-ref="12rnh">rnh</dfn> = (<b>struct</b> <a class="type" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr" title='ncsi_rsp_pkt_hdr' data-ref="ncsi_rsp_pkt_hdr">ncsi_rsp_pkt_hdr</a> *)</td></tr>
<tr><th id="87">87</th><td>        (<a class="local col0 ref" href="#10ncsi_reply" title='ncsi_reply' data-ref="10ncsi_reply">ncsi_reply</a> + <a class="macro" href="../include/net/eth.h.html#33" title="14" data-ref="_M/ETH_HLEN">ETH_HLEN</a>);</td></tr>
<tr><th id="88">88</th><td>    <em>const</em> <b>struct</b> <a class="type" href="#ncsi_rsp_handler" title='ncsi_rsp_handler' data-ref="ncsi_rsp_handler">ncsi_rsp_handler</a> *<dfn class="local col3 decl" id="13handler" title='handler' data-type='const struct ncsi_rsp_handler *' data-ref="13handler">handler</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="89">89</th><td>    <em>int</em> <dfn class="local col4 decl" id="14i" title='i' data-type='int' data-ref="14i">i</dfn>;</td></tr>
<tr><th id="90">90</th><td></td></tr>
<tr><th id="91">91</th><td>    <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col0 ref" href="#10ncsi_reply" title='ncsi_reply' data-ref="10ncsi_reply">ncsi_reply</a>, <var>0</var>, <b>sizeof</b>(<a class="local col0 ref" href="#10ncsi_reply" title='ncsi_reply' data-ref="10ncsi_reply">ncsi_reply</a>));</td></tr>
<tr><th id="92">92</th><td></td></tr>
<tr><th id="93">93</th><td>    <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col1 ref" href="#11reh" title='reh' data-ref="11reh">reh</a>-&gt;<a class="ref" href="slirp.h.html#ethhdr::h_dest" title='ethhdr::h_dest' data-ref="ethhdr::h_dest">h_dest</a>, <var>0xff</var>, <a class="macro" href="../include/net/eth.h.html#32" title="6" data-ref="_M/ETH_ALEN">ETH_ALEN</a>);</td></tr>
<tr><th id="94">94</th><td>    <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col1 ref" href="#11reh" title='reh' data-ref="11reh">reh</a>-&gt;<a class="ref" href="slirp.h.html#ethhdr::h_source" title='ethhdr::h_source' data-ref="ethhdr::h_source">h_source</a>, <var>0xff</var>, <a class="macro" href="../include/net/eth.h.html#32" title="6" data-ref="_M/ETH_ALEN">ETH_ALEN</a>);</td></tr>
<tr><th id="95">95</th><td>    <a class="local col1 ref" href="#11reh" title='reh' data-ref="11reh">reh</a>-&gt;<a class="ref" href="slirp.h.html#ethhdr::h_proto" title='ethhdr::h_proto' data-ref="ethhdr::h_proto">h_proto</a> = <a class="ref" href="../../include/netinet/in.h.html#htons" title='htons' data-ref="htons">htons</a>(<a class="macro" href="../include/net/eth.h.html#212" title="(0x88f8)" data-ref="_M/ETH_P_NCSI">ETH_P_NCSI</a>);</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td>    <b>for</b> (<a class="local col4 ref" href="#14i" title='i' data-ref="14i">i</a> = <var>0</var>; <a class="local col4 ref" href="#14i" title='i' data-ref="14i">i</a> &lt; <a class="macro" href="../include/qemu/osdep.h.html#208" title="((sizeof(ncsi_rsp_handlers) / sizeof((ncsi_rsp_handlers)[0])) + (sizeof(struct { int:(!(!__builtin_types_compatible_p(typeof(ncsi_rsp_handlers), typeof(&amp;(ncsi_rsp_handlers)[0])))) ? -1 : 1; }) - sizeof(struct { int:(!(!__builtin_types_compatible_p(typeof(ncsi_rsp_handlers), typeof(&amp;(ncsi_rsp_handlers)[0])))) ? -1 : 1; })))" data-ref="_M/ARRAY_SIZE">ARRAY_SIZE</a>(<a class="tu ref" href="#ncsi_rsp_handlers" title='ncsi_rsp_handlers' data-use='r' data-ref="ncsi_rsp_handlers">ncsi_rsp_handlers</a>); <a class="local col4 ref" href="#14i" title='i' data-ref="14i">i</a>++) {</td></tr>
<tr><th id="98">98</th><td>        <b>if</b> (<a class="tu ref" href="#ncsi_rsp_handlers" title='ncsi_rsp_handlers' data-use='m' data-ref="ncsi_rsp_handlers">ncsi_rsp_handlers</a>[<a class="local col4 ref" href="#14i" title='i' data-ref="14i">i</a>].<a class="tu ref" href="#ncsi_rsp_handler::type" title='ncsi_rsp_handler::type' data-use='r' data-ref="ncsi_rsp_handler::type">type</a> == <a class="local col9 ref" href="#9nh" title='nh' data-ref="9nh">nh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::type" title='ncsi_pkt_hdr::type' data-ref="ncsi_pkt_hdr::type">type</a> + <var>0x80</var>) {</td></tr>
<tr><th id="99">99</th><td>            <a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a> = &amp;<a class="tu ref" href="#ncsi_rsp_handlers" title='ncsi_rsp_handlers' data-use='a' data-ref="ncsi_rsp_handlers">ncsi_rsp_handlers</a>[<a class="local col4 ref" href="#14i" title='i' data-ref="14i">i</a>];</td></tr>
<tr><th id="100">100</th><td>            <b>break</b>;</td></tr>
<tr><th id="101">101</th><td>        }</td></tr>
<tr><th id="102">102</th><td>    }</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td>    <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::mc_id" title='ncsi_pkt_hdr::mc_id' data-ref="ncsi_pkt_hdr::mc_id">mc_id</a>      = <a class="local col9 ref" href="#9nh" title='nh' data-ref="9nh">nh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::mc_id" title='ncsi_pkt_hdr::mc_id' data-ref="ncsi_pkt_hdr::mc_id">mc_id</a>;</td></tr>
<tr><th id="105">105</th><td>    <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::revision" title='ncsi_pkt_hdr::revision' data-ref="ncsi_pkt_hdr::revision">revision</a>   = <a class="macro" href="ncsi-pkt.h.html#334" title="0x01" data-ref="_M/NCSI_PKT_REVISION">NCSI_PKT_REVISION</a>;</td></tr>
<tr><th id="106">106</th><td>    <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::id" title='ncsi_pkt_hdr::id' data-ref="ncsi_pkt_hdr::id">id</a>         = <a class="local col9 ref" href="#9nh" title='nh' data-ref="9nh">nh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::id" title='ncsi_pkt_hdr::id' data-ref="ncsi_pkt_hdr::id">id</a>;</td></tr>
<tr><th id="107">107</th><td>    <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::type" title='ncsi_pkt_hdr::type' data-ref="ncsi_pkt_hdr::type">type</a>       = <a class="local col9 ref" href="#9nh" title='nh' data-ref="9nh">nh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::type" title='ncsi_pkt_hdr::type' data-ref="ncsi_pkt_hdr::type">type</a> + <var>0x80</var>;</td></tr>
<tr><th id="108">108</th><td>    <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::channel" title='ncsi_pkt_hdr::channel' data-ref="ncsi_pkt_hdr::channel">channel</a>    = <a class="local col9 ref" href="#9nh" title='nh' data-ref="9nh">nh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::channel" title='ncsi_pkt_hdr::channel' data-ref="ncsi_pkt_hdr::channel">channel</a>;</td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td>    <b>if</b> (<a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a>) {</td></tr>
<tr><th id="111">111</th><td>        <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::length" title='ncsi_pkt_hdr::length' data-ref="ncsi_pkt_hdr::length">length</a> = <a class="ref" href="../../include/netinet/in.h.html#htons" title='htons' data-ref="htons">htons</a>(<a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a>-&gt;<a class="tu ref" href="#ncsi_rsp_handler::payload" title='ncsi_rsp_handler::payload' data-use='r' data-ref="ncsi_rsp_handler::payload">payload</a>);</td></tr>
<tr><th id="112">112</th><td>        <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::code" title='ncsi_rsp_pkt_hdr::code' data-ref="ncsi_rsp_pkt_hdr::code">code</a>          = <a class="ref" href="../../include/netinet/in.h.html#htons" title='htons' data-ref="htons">htons</a>(<a class="macro" href="ncsi-pkt.h.html#401" title="0x0000" data-ref="_M/NCSI_PKT_RSP_C_COMPLETED">NCSI_PKT_RSP_C_COMPLETED</a>);</td></tr>
<tr><th id="113">113</th><td>        <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::reason" title='ncsi_rsp_pkt_hdr::reason' data-ref="ncsi_rsp_pkt_hdr::reason">reason</a>        = <a class="ref" href="../../include/netinet/in.h.html#htons" title='htons' data-ref="htons">htons</a>(<a class="macro" href="ncsi-pkt.h.html#405" title="0x0000" data-ref="_M/NCSI_PKT_RSP_R_NO_ERROR">NCSI_PKT_RSP_R_NO_ERROR</a>);</td></tr>
<tr><th id="114">114</th><td></td></tr>
<tr><th id="115">115</th><td>        <b>if</b> (<a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a>-&gt;<a class="tu ref" href="#ncsi_rsp_handler::handler" title='ncsi_rsp_handler::handler' data-use='r' data-ref="ncsi_rsp_handler::handler">handler</a>) {</td></tr>
<tr><th id="116">116</th><td>            <i>/* TODO: handle errors */</i></td></tr>
<tr><th id="117">117</th><td>            <a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a>-&gt;<a class="tu ref" href="#ncsi_rsp_handler::handler" title='ncsi_rsp_handler::handler' data-use='r' data-ref="ncsi_rsp_handler::handler">handler</a>(<a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>);</td></tr>
<tr><th id="118">118</th><td>        }</td></tr>
<tr><th id="119">119</th><td>    } <b>else</b> {</td></tr>
<tr><th id="120">120</th><td>        <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::common" title='ncsi_rsp_pkt_hdr::common' data-ref="ncsi_rsp_pkt_hdr::common">common</a>.<a class="ref" href="ncsi-pkt.h.html#ncsi_pkt_hdr::length" title='ncsi_pkt_hdr::length' data-ref="ncsi_pkt_hdr::length">length</a> = <var>0</var>;</td></tr>
<tr><th id="121">121</th><td>        <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::code" title='ncsi_rsp_pkt_hdr::code' data-ref="ncsi_rsp_pkt_hdr::code">code</a>          = <a class="ref" href="../../include/netinet/in.h.html#htons" title='htons' data-ref="htons">htons</a>(<a class="macro" href="ncsi-pkt.h.html#403" title="0x0002" data-ref="_M/NCSI_PKT_RSP_C_UNAVAILABLE">NCSI_PKT_RSP_C_UNAVAILABLE</a>);</td></tr>
<tr><th id="122">122</th><td>        <a class="local col2 ref" href="#12rnh" title='rnh' data-ref="12rnh">rnh</a>-&gt;<a class="ref" href="ncsi-pkt.h.html#ncsi_rsp_pkt_hdr::reason" title='ncsi_rsp_pkt_hdr::reason' data-ref="ncsi_rsp_pkt_hdr::reason">reason</a>        = <a class="ref" href="../../include/netinet/in.h.html#htons" title='htons' data-ref="htons">htons</a>(<a class="macro" href="ncsi-pkt.h.html#411" title="0x7fff" data-ref="_M/NCSI_PKT_RSP_R_UNKNOWN">NCSI_PKT_RSP_R_UNKNOWN</a>);</td></tr>
<tr><th id="123">123</th><td>    }</td></tr>
<tr><th id="124">124</th><td></td></tr>
<tr><th id="125">125</th><td>    <i>/* TODO: add a checksum at the end of the frame but the specs</i></td></tr>
<tr><th id="126">126</th><td><i>     * allows it to be zero */</i></td></tr>
<tr><th id="127">127</th><td></td></tr>
<tr><th id="128">128</th><td>    <a class="ref" href="libslirp.h.html#slirp_output" title='slirp_output' data-ref="slirp_output">slirp_output</a>(<a class="local col6 ref" href="#6slirp" title='slirp' data-ref="6slirp">slirp</a>-&gt;<a class="ref" href="slirp.h.html#Slirp::opaque" title='Slirp::opaque' data-ref="Slirp::opaque">opaque</a>, <a class="local col0 ref" href="#10ncsi_reply" title='ncsi_reply' data-ref="10ncsi_reply">ncsi_reply</a>, <a class="macro" href="../include/net/eth.h.html#33" title="14" data-ref="_M/ETH_HLEN">ETH_HLEN</a> + <b>sizeof</b>(*<a class="local col9 ref" href="#9nh" title='nh' data-ref="9nh">nh</a>) +</td></tr>
<tr><th id="129">129</th><td>                 (<a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a> ? <a class="local col3 ref" href="#13handler" title='handler' data-ref="13handler">handler</a>-&gt;<a class="tu ref" href="#ncsi_rsp_handler::payload" title='ncsi_rsp_handler::payload' data-use='r' data-ref="ncsi_rsp_handler::payload">payload</a> : <var>0</var>) + <var>4</var>);</td></tr>
<tr><th id="130">130</th><td>}</td></tr>
<tr><th id="131">131</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2017-Aug-28</em> from project codebrowser revision <em>v2.10.0-rc0-7-g6be37cc</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>

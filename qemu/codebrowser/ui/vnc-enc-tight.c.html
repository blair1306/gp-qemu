<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>vnc-enc-tight.c source code [codebrowser/ui/vnc-enc-tight.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="palette_cb_priv "/>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/ui/vnc-enc-tight.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>codebrowser</a>/<a href='./'>ui</a>/<a href='vnc-enc-tight.c.html'>vnc-enc-tight.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * QEMU VNC display driver: tight encoding</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * From libvncserver/libvncserver/tight.c</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright (C) 2000, 2001 Const Kaplinsky.  All Rights Reserved.</i></td></tr>
<tr><th id="6">6</th><td><i> * Copyright (C) 1999 AT&amp;T Laboratories Cambridge.  All Rights Reserved.</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * Copyright (C) 2010 Corentin Chary &lt;corentin.chary@gmail.com&gt;</i></td></tr>
<tr><th id="9">9</th><td><i> *</i></td></tr>
<tr><th id="10">10</th><td><i> * Permission is hereby granted, free of charge, to any person obtaining a copy</i></td></tr>
<tr><th id="11">11</th><td><i> * of this software and associated documentation files (the "Software"), to deal</i></td></tr>
<tr><th id="12">12</th><td><i> * in the Software without restriction, including without limitation the rights</i></td></tr>
<tr><th id="13">13</th><td><i> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</i></td></tr>
<tr><th id="14">14</th><td><i> * copies of the Software, and to permit persons to whom the Software is</i></td></tr>
<tr><th id="15">15</th><td><i> * furnished to do so, subject to the following conditions:</i></td></tr>
<tr><th id="16">16</th><td><i> *</i></td></tr>
<tr><th id="17">17</th><td><i> * The above copyright notice and this permission notice shall be included in</i></td></tr>
<tr><th id="18">18</th><td><i> * all copies or substantial portions of the Software.</i></td></tr>
<tr><th id="19">19</th><td><i> *</i></td></tr>
<tr><th id="20">20</th><td><i> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</i></td></tr>
<tr><th id="21">21</th><td><i> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</i></td></tr>
<tr><th id="22">22</th><td><i> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</i></td></tr>
<tr><th id="23">23</th><td><i> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</i></td></tr>
<tr><th id="24">24</th><td><i> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</i></td></tr>
<tr><th id="25">25</th><td><i> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</i></td></tr>
<tr><th id="26">26</th><td><i> * THE SOFTWARE.</i></td></tr>
<tr><th id="27">27</th><td><i> */</i></td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../include/qemu/osdep.h.html">"qemu/osdep.h"</a></u></td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><i>/* This needs to be before jpeglib.h line because of conflict with</i></td></tr>
<tr><th id="32">32</th><td><i>   INT32 definitions between jmorecfg.h (included by jpeglib.h) and</i></td></tr>
<tr><th id="33">33</th><td><i>   Win32 basetsd.h (included by windows.h). */</i></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../include/qemu-common.h.html">"qemu-common.h"</a></u></td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td><u>#<span data-ppcond="36">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="37">37</th><td><i>/* The following define is needed by pngconf.h. Otherwise it won't compile,</i></td></tr>
<tr><th id="38">38</th><td><i>   because setjmp.h was already included by qemu-common.h. */</i></td></tr>
<tr><th id="39">39</th><td><u>#define <dfn class="macro" id="_M/PNG_SKIP_SETJMP_CHECK" data-ref="_M/PNG_SKIP_SETJMP_CHECK">PNG_SKIP_SETJMP_CHECK</dfn></u></td></tr>
<tr><th id="40">40</th><td><u>#include <a href="../../include/libpng12/png.h.html">&lt;png.h&gt;</a></u></td></tr>
<tr><th id="41">41</th><td><u>#<span data-ppcond="36">endif</span></u></td></tr>
<tr><th id="42">42</th><td><u>#<span data-ppcond="42">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="43">43</th><td><u>#include &lt;jpeglib.h&gt;</u></td></tr>
<tr><th id="44">44</th><td><u>#<span data-ppcond="42">endif</span></u></td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td><u>#include <a href="../include/qemu/bswap.h.html">"qemu/bswap.h"</a></u></td></tr>
<tr><th id="47">47</th><td><u>#include <a href="vnc.h.html">"vnc.h"</a></u></td></tr>
<tr><th id="48">48</th><td><u>#include <a href="vnc-enc-tight.h.html">"vnc-enc-tight.h"</a></u></td></tr>
<tr><th id="49">49</th><td><u>#include <a href="vnc-palette.h.html">"vnc-palette.h"</a></u></td></tr>
<tr><th id="50">50</th><td></td></tr>
<tr><th id="51">51</th><td><i  data-doc="tight_conf">/* Compression level stuff. The following array contains various</i></td></tr>
<tr><th id="52">52</th><td><i  data-doc="tight_conf">   encoder parameters for each of 10 compression levels (0..9).</i></td></tr>
<tr><th id="53">53</th><td><i  data-doc="tight_conf">   Last three parameters correspond to JPEG quality levels (0..9). */</i></td></tr>
<tr><th id="54">54</th><td></td></tr>
<tr><th id="55">55</th><td><em>static</em> <em>const</em> <b>struct</b> {</td></tr>
<tr><th id="56">56</th><td>    <em>int</em> <dfn class="local col7 decl" id="557max_rect_size" title='max_rect_size' data-type='int' data-ref="557max_rect_size">max_rect_size</dfn>, <dfn class="local col8 decl" id="558max_rect_width" title='max_rect_width' data-type='int' data-ref="558max_rect_width">max_rect_width</dfn>;</td></tr>
<tr><th id="57">57</th><td>    <em>int</em> <dfn class="local col9 decl" id="559mono_min_rect_size" title='mono_min_rect_size' data-type='int' data-ref="559mono_min_rect_size">mono_min_rect_size</dfn>, <dfn class="local col0 decl" id="560gradient_min_rect_size" title='gradient_min_rect_size' data-type='int' data-ref="560gradient_min_rect_size">gradient_min_rect_size</dfn>;</td></tr>
<tr><th id="58">58</th><td>    <em>int</em> <dfn class="local col1 decl" id="561idx_zlib_level" title='idx_zlib_level' data-type='int' data-ref="561idx_zlib_level">idx_zlib_level</dfn>, <dfn class="local col2 decl" id="562mono_zlib_level" title='mono_zlib_level' data-type='int' data-ref="562mono_zlib_level">mono_zlib_level</dfn>, <dfn class="local col3 decl" id="563raw_zlib_level" title='raw_zlib_level' data-type='int' data-ref="563raw_zlib_level">raw_zlib_level</dfn>, <dfn class="local col4 decl" id="564gradient_zlib_level" title='gradient_zlib_level' data-type='int' data-ref="564gradient_zlib_level">gradient_zlib_level</dfn>;</td></tr>
<tr><th id="59">59</th><td>    <em>int</em> <dfn class="local col5 decl" id="565gradient_threshold" title='gradient_threshold' data-type='int' data-ref="565gradient_threshold">gradient_threshold</dfn>, <dfn class="local col6 decl" id="566gradient_threshold24" title='gradient_threshold24' data-type='int' data-ref="566gradient_threshold24">gradient_threshold24</dfn>;</td></tr>
<tr><th id="60">60</th><td>    <em>int</em> <dfn class="local col7 decl" id="567idx_max_colors_divisor" title='idx_max_colors_divisor' data-type='int' data-ref="567idx_max_colors_divisor">idx_max_colors_divisor</dfn>;</td></tr>
<tr><th id="61">61</th><td>    <em>int</em> <dfn class="local col8 decl" id="568jpeg_quality" title='jpeg_quality' data-type='int' data-ref="568jpeg_quality">jpeg_quality</dfn>, <dfn class="local col9 decl" id="569jpeg_threshold" title='jpeg_threshold' data-type='int' data-ref="569jpeg_threshold">jpeg_threshold</dfn>, <dfn class="local col0 decl" id="570jpeg_threshold24" title='jpeg_threshold24' data-type='int' data-ref="570jpeg_threshold24">jpeg_threshold24</dfn>;</td></tr>
<tr><th id="62">62</th><td>} <dfn class="tu decl def" id="tight_conf" title='tight_conf' data-type='const struct (anonymous struct at /home/jon/workspace/qemu/ui/vnc-enc-tight.c:55:14) [10]' data-ref="tight_conf">tight_conf</dfn>[] = {</td></tr>
<tr><th id="63">63</th><td>    {   <var>512</var>,   <var>32</var>,   <var>6</var>, <var>65536</var>, <var>0</var>, <var>0</var>, <var>0</var>, <var>0</var>,   <var>0</var>,   <var>0</var>,   <var>4</var>,  <var>5</var>, <var>10000</var>, <var>23000</var> },</td></tr>
<tr><th id="64">64</th><td>    {  <var>2048</var>,  <var>128</var>,   <var>6</var>, <var>65536</var>, <var>1</var>, <var>1</var>, <var>1</var>, <var>0</var>,   <var>0</var>,   <var>0</var>,   <var>8</var>, <var>10</var>,  <var>8000</var>, <var>18000</var> },</td></tr>
<tr><th id="65">65</th><td>    {  <var>6144</var>,  <var>256</var>,   <var>8</var>, <var>65536</var>, <var>3</var>, <var>3</var>, <var>2</var>, <var>0</var>,   <var>0</var>,   <var>0</var>,  <var>24</var>, <var>15</var>,  <var>6500</var>, <var>15000</var> },</td></tr>
<tr><th id="66">66</th><td>    { <var>10240</var>, <var>1024</var>,  <var>12</var>, <var>65536</var>, <var>5</var>, <var>5</var>, <var>3</var>, <var>0</var>,   <var>0</var>,   <var>0</var>,  <var>32</var>, <var>25</var>,  <var>5000</var>, <var>12000</var> },</td></tr>
<tr><th id="67">67</th><td>    { <var>16384</var>, <var>2048</var>,  <var>12</var>, <var>65536</var>, <var>6</var>, <var>6</var>, <var>4</var>, <var>0</var>,   <var>0</var>,   <var>0</var>,  <var>32</var>, <var>37</var>,  <var>4000</var>, <var>10000</var> },</td></tr>
<tr><th id="68">68</th><td>    { <var>32768</var>, <var>2048</var>,  <var>12</var>,  <var>4096</var>, <var>7</var>, <var>7</var>, <var>5</var>, <var>4</var>, <var>150</var>, <var>380</var>,  <var>32</var>, <var>50</var>,  <var>3000</var>,  <var>8000</var> },</td></tr>
<tr><th id="69">69</th><td>    { <var>65536</var>, <var>2048</var>,  <var>16</var>,  <var>4096</var>, <var>7</var>, <var>7</var>, <var>6</var>, <var>4</var>, <var>170</var>, <var>420</var>,  <var>48</var>, <var>60</var>,  <var>2000</var>,  <var>5000</var> },</td></tr>
<tr><th id="70">70</th><td>    { <var>65536</var>, <var>2048</var>,  <var>16</var>,  <var>4096</var>, <var>8</var>, <var>8</var>, <var>7</var>, <var>5</var>, <var>180</var>, <var>450</var>,  <var>64</var>, <var>70</var>,  <var>1000</var>,  <var>2500</var> },</td></tr>
<tr><th id="71">71</th><td>    { <var>65536</var>, <var>2048</var>,  <var>32</var>,  <var>8192</var>, <var>9</var>, <var>9</var>, <var>8</var>, <var>6</var>, <var>190</var>, <var>475</var>,  <var>64</var>, <var>75</var>,   <var>500</var>,  <var>1200</var> },</td></tr>
<tr><th id="72">72</th><td>    { <var>65536</var>, <var>2048</var>,  <var>32</var>,  <var>8192</var>, <var>9</var>, <var>9</var>, <var>9</var>, <var>6</var>, <var>200</var>, <var>500</var>,  <var>96</var>, <var>80</var>,   <var>200</var>,   <var>500</var> }</td></tr>
<tr><th id="73">73</th><td>};</td></tr>
<tr><th id="74">74</th><td></td></tr>
<tr><th id="75">75</th><td></td></tr>
<tr><th id="76">76</th><td><em>static</em> <em>int</em> <a class="tu decl" href="#tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-type='int tight_send_framebuffer_update(VncState * vs, int x, int y, int w, int h)' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</a>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col1 decl" id="571vs" title='vs' data-type='VncState *' data-ref="571vs">vs</dfn>, <em>int</em> <dfn class="local col2 decl" id="572x" title='x' data-type='int' data-ref="572x">x</dfn>, <em>int</em> <dfn class="local col3 decl" id="573y" title='y' data-type='int' data-ref="573y">y</dfn>,</td></tr>
<tr><th id="77">77</th><td>                                         <em>int</em> <dfn class="local col4 decl" id="574w" title='w' data-type='int' data-ref="574w">w</dfn>, <em>int</em> <dfn class="local col5 decl" id="575h" title='h' data-type='int' data-ref="575h">h</dfn>);</td></tr>
<tr><th id="78">78</th><td></td></tr>
<tr><th id="79">79</th><td><u>#<span data-ppcond="79">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="80">80</th><td><em>static</em> <em>const</em> <b>struct</b> {</td></tr>
<tr><th id="81">81</th><td>    <em>double</em> jpeg_freq_min;       <i>/* Don't send JPEG if the freq is bellow */</i></td></tr>
<tr><th id="82">82</th><td>    <em>double</em> jpeg_freq_threshold; <i>/* Always send JPEG if the freq is above */</i></td></tr>
<tr><th id="83">83</th><td>    <em>int</em> jpeg_idx;               <i>/* Allow indexed JPEG */</i></td></tr>
<tr><th id="84">84</th><td>    <em>int</em> jpeg_full;              <i>/* Allow full color JPEG */</i></td></tr>
<tr><th id="85">85</th><td>} tight_jpeg_conf[] = {</td></tr>
<tr><th id="86">86</th><td>    { <var>0</var>,   <var>8</var>,  <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="87">87</th><td>    { <var>0</var>,   <var>8</var>,  <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="88">88</th><td>    { <var>0</var>,   <var>8</var>,  <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="89">89</th><td>    { <var>0</var>,   <var>8</var>,  <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="90">90</th><td>    { <var>0</var>,   <var>10</var>, <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="91">91</th><td>    { <var>0.1</var>, <var>10</var>, <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="92">92</th><td>    { <var>0.2</var>, <var>10</var>, <var>1</var>, <var>1</var> },</td></tr>
<tr><th id="93">93</th><td>    { <var>0.3</var>, <var>12</var>, <var>0</var>, <var>0</var> },</td></tr>
<tr><th id="94">94</th><td>    { <var>0.4</var>, <var>14</var>, <var>0</var>, <var>0</var> },</td></tr>
<tr><th id="95">95</th><td>    { <var>0.5</var>, <var>16</var>, <var>0</var>, <var>0</var> },</td></tr>
<tr><th id="96">96</th><td>};</td></tr>
<tr><th id="97">97</th><td><u>#<span data-ppcond="79">endif</span></u></td></tr>
<tr><th id="98">98</th><td></td></tr>
<tr><th id="99">99</th><td><u>#<span data-ppcond="99">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="100">100</th><td><em>static</em> <em>const</em> <b>struct</b> {</td></tr>
<tr><th id="101">101</th><td>    <em>int</em> <dfn class="local col6 decl" id="576png_zlib_level" title='png_zlib_level' data-type='int' data-ref="576png_zlib_level">png_zlib_level</dfn>, <dfn class="local col7 decl" id="577png_filters" title='png_filters' data-type='int' data-ref="577png_filters">png_filters</dfn>;</td></tr>
<tr><th id="102">102</th><td>} <dfn class="tu decl def" id="tight_png_conf" title='tight_png_conf' data-type='const struct (anonymous struct at /home/jon/workspace/qemu/ui/vnc-enc-tight.c:100:14) [10]' data-ref="tight_png_conf">tight_png_conf</dfn>[] = {</td></tr>
<tr><th id="103">103</th><td>    { <var>0</var>, <a class="macro" href="../../include/libpng12/png.h.html#1725" title="0x00" data-ref="_M/PNG_NO_FILTERS">PNG_NO_FILTERS</a> },</td></tr>
<tr><th id="104">104</th><td>    { <var>1</var>, <a class="macro" href="../../include/libpng12/png.h.html#1725" title="0x00" data-ref="_M/PNG_NO_FILTERS">PNG_NO_FILTERS</a> },</td></tr>
<tr><th id="105">105</th><td>    { <var>2</var>, <a class="macro" href="../../include/libpng12/png.h.html#1725" title="0x00" data-ref="_M/PNG_NO_FILTERS">PNG_NO_FILTERS</a> },</td></tr>
<tr><th id="106">106</th><td>    { <var>3</var>, <a class="macro" href="../../include/libpng12/png.h.html#1725" title="0x00" data-ref="_M/PNG_NO_FILTERS">PNG_NO_FILTERS</a> },</td></tr>
<tr><th id="107">107</th><td>    { <var>4</var>, <a class="macro" href="../../include/libpng12/png.h.html#1725" title="0x00" data-ref="_M/PNG_NO_FILTERS">PNG_NO_FILTERS</a> },</td></tr>
<tr><th id="108">108</th><td>    { <var>5</var>, <a class="macro" href="../../include/libpng12/png.h.html#1731" title="(0x08 | 0x10 | 0x20 | 0x40 | 0x80)" data-ref="_M/PNG_ALL_FILTERS">PNG_ALL_FILTERS</a> },</td></tr>
<tr><th id="109">109</th><td>    { <var>6</var>, <a class="macro" href="../../include/libpng12/png.h.html#1731" title="(0x08 | 0x10 | 0x20 | 0x40 | 0x80)" data-ref="_M/PNG_ALL_FILTERS">PNG_ALL_FILTERS</a> },</td></tr>
<tr><th id="110">110</th><td>    { <var>7</var>, <a class="macro" href="../../include/libpng12/png.h.html#1731" title="(0x08 | 0x10 | 0x20 | 0x40 | 0x80)" data-ref="_M/PNG_ALL_FILTERS">PNG_ALL_FILTERS</a> },</td></tr>
<tr><th id="111">111</th><td>    { <var>8</var>, <a class="macro" href="../../include/libpng12/png.h.html#1731" title="(0x08 | 0x10 | 0x20 | 0x40 | 0x80)" data-ref="_M/PNG_ALL_FILTERS">PNG_ALL_FILTERS</a> },</td></tr>
<tr><th id="112">112</th><td>    { <var>9</var>, <a class="macro" href="../../include/libpng12/png.h.html#1731" title="(0x08 | 0x10 | 0x20 | 0x40 | 0x80)" data-ref="_M/PNG_ALL_FILTERS">PNG_ALL_FILTERS</a> },</td></tr>
<tr><th id="113">113</th><td>};</td></tr>
<tr><th id="114">114</th><td></td></tr>
<tr><th id="115">115</th><td><em>static</em> <em>int</em> <a class="tu decl" href="#send_png_rect" title='send_png_rect' data-type='int send_png_rect(VncState * vs, int x, int y, int w, int h, VncPalette * palette)' data-ref="send_png_rect">send_png_rect</a>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col8 decl" id="578vs" title='vs' data-type='VncState *' data-ref="578vs">vs</dfn>, <em>int</em> <dfn class="local col9 decl" id="579x" title='x' data-type='int' data-ref="579x">x</dfn>, <em>int</em> <dfn class="local col0 decl" id="580y" title='y' data-type='int' data-ref="580y">y</dfn>, <em>int</em> <dfn class="local col1 decl" id="581w" title='w' data-type='int' data-ref="581w">w</dfn>, <em>int</em> <dfn class="local col2 decl" id="582h" title='h' data-type='int' data-ref="582h">h</dfn>,</td></tr>
<tr><th id="116">116</th><td>                         <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col3 decl" id="583palette" title='palette' data-type='VncPalette *' data-ref="583palette">palette</dfn>);</td></tr>
<tr><th id="117">117</th><td></td></tr>
<tr><th id="118">118</th><td><em>static</em> <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="tu decl def" id="tight_can_send_png_rect" title='tight_can_send_png_rect' data-type='_Bool tight_can_send_png_rect(VncState * vs, int w, int h)' data-ref="tight_can_send_png_rect">tight_can_send_png_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col4 decl" id="584vs" title='vs' data-type='VncState *' data-ref="584vs">vs</dfn>, <em>int</em> <dfn class="local col5 decl" id="585w" title='w' data-type='int' data-ref="585w">w</dfn>, <em>int</em> <dfn class="local col6 decl" id="586h" title='h' data-type='int' data-ref="586h">h</dfn>)</td></tr>
<tr><th id="119">119</th><td>{</td></tr>
<tr><th id="120">120</th><td>    <b>if</b> (<a class="local col4 ref" href="#584vs" title='vs' data-ref="584vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::type" title='VncTight::type' data-ref="VncTight::type">type</a> != <a class="macro" href="vnc.h.html#391" title="0xFFFFFEFC" data-ref="_M/VNC_ENCODING_TIGHT_PNG">VNC_ENCODING_TIGHT_PNG</a>) {</td></tr>
<tr><th id="121">121</th><td>        <b>return</b> <span class="macro" title="0" data-ref="_M/false">false</span>;</td></tr>
<tr><th id="122">122</th><td>    }</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>    <b>if</b> (<a class="ref" href="../include/ui/console.h.html#surface_bytes_per_pixel" title='surface_bytes_per_pixel' data-ref="surface_bytes_per_pixel">surface_bytes_per_pixel</a>(<a class="local col4 ref" href="#584vs" title='vs' data-ref="584vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::vd" title='VncState::vd' data-ref="VncState::vd">vd</a>-&gt;<a class="ref" href="vnc.h.html#VncDisplay::ds" title='VncDisplay::ds' data-ref="VncDisplay::ds">ds</a>) == <var>1</var> ||</td></tr>
<tr><th id="125">125</th><td>        <a class="local col4 ref" href="#584vs" title='vs' data-ref="584vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>1</var>) {</td></tr>
<tr><th id="126">126</th><td>        <b>return</b> <span class="macro" title="0" data-ref="_M/false">false</span>;</td></tr>
<tr><th id="127">127</th><td>    }</td></tr>
<tr><th id="128">128</th><td></td></tr>
<tr><th id="129">129</th><td>    <b>return</b> <span class="macro" title="1" data-ref="_M/true">true</span>;</td></tr>
<tr><th id="130">130</th><td>}</td></tr>
<tr><th id="131">131</th><td><u>#<span data-ppcond="99">endif</span></u></td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td><i  data-doc="tight_detect_smooth_image24">/*</i></td></tr>
<tr><th id="134">134</th><td><i  data-doc="tight_detect_smooth_image24"> * Code to guess if given rectangle is suitable for smooth image</i></td></tr>
<tr><th id="135">135</th><td><i  data-doc="tight_detect_smooth_image24"> * compression (by applying "gradient" filter or JPEG coder).</i></td></tr>
<tr><th id="136">136</th><td><i  data-doc="tight_detect_smooth_image24"> */</i></td></tr>
<tr><th id="137">137</th><td></td></tr>
<tr><th id="138">138</th><td><em>static</em> <em>unsigned</em> <em>int</em></td></tr>
<tr><th id="139">139</th><td><dfn class="tu decl def" id="tight_detect_smooth_image24" title='tight_detect_smooth_image24' data-type='unsigned int tight_detect_smooth_image24(VncState * vs, int w, int h)' data-ref="tight_detect_smooth_image24">tight_detect_smooth_image24</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col7 decl" id="587vs" title='vs' data-type='VncState *' data-ref="587vs">vs</dfn>, <em>int</em> <dfn class="local col8 decl" id="588w" title='w' data-type='int' data-ref="588w">w</dfn>, <em>int</em> <dfn class="local col9 decl" id="589h" title='h' data-type='int' data-ref="589h">h</dfn>)</td></tr>
<tr><th id="140">140</th><td>{</td></tr>
<tr><th id="141">141</th><td>    <em>int</em> <dfn class="local col0 decl" id="590off" title='off' data-type='int' data-ref="590off">off</dfn>;</td></tr>
<tr><th id="142">142</th><td>    <em>int</em> <dfn class="local col1 decl" id="591x" title='x' data-type='int' data-ref="591x">x</dfn>, <dfn class="local col2 decl" id="592y" title='y' data-type='int' data-ref="592y">y</dfn>, <dfn class="local col3 decl" id="593d" title='d' data-type='int' data-ref="593d">d</dfn>, <dfn class="local col4 decl" id="594dx" title='dx' data-type='int' data-ref="594dx">dx</dfn>;</td></tr>
<tr><th id="143">143</th><td>    <em>unsigned</em> <em>int</em> <dfn class="local col5 decl" id="595c" title='c' data-type='unsigned int' data-ref="595c">c</dfn>;</td></tr>
<tr><th id="144">144</th><td>    <em>unsigned</em> <em>int</em> <dfn class="local col6 decl" id="596stats" title='stats' data-type='unsigned int [256]' data-ref="596stats">stats</dfn>[<var>256</var>];</td></tr>
<tr><th id="145">145</th><td>    <em>int</em> <dfn class="local col7 decl" id="597pixels" title='pixels' data-type='int' data-ref="597pixels">pixels</dfn> = <var>0</var>;</td></tr>
<tr><th id="146">146</th><td>    <em>int</em> <dfn class="local col8 decl" id="598pix" title='pix' data-type='int' data-ref="598pix">pix</dfn>, <dfn class="local col9 decl" id="599left" title='left' data-type='int [3]' data-ref="599left">left</dfn>[<var>3</var>];</td></tr>
<tr><th id="147">147</th><td>    <em>unsigned</em> <em>int</em> <dfn class="local col0 decl" id="600errors" title='errors' data-type='unsigned int' data-ref="600errors">errors</dfn>;</td></tr>
<tr><th id="148">148</th><td>    <em>unsigned</em> <em>char</em> *<dfn class="local col1 decl" id="601buf" title='buf' data-type='unsigned char *' data-ref="601buf">buf</dfn> = <a class="local col7 ref" href="#587vs" title='vs' data-ref="587vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>;</td></tr>
<tr><th id="149">149</th><td></td></tr>
<tr><th id="150">150</th><td>    <i>/*</i></td></tr>
<tr><th id="151">151</th><td><i>     * If client is big-endian, color samples begin from the second</i></td></tr>
<tr><th id="152">152</th><td><i>     * byte (offset 1) of a 32-bit pixel value.</i></td></tr>
<tr><th id="153">153</th><td><i>     */</i></td></tr>
<tr><th id="154">154</th><td>    <a class="local col0 ref" href="#590off" title='off' data-ref="590off">off</a> = <a class="local col7 ref" href="#587vs" title='vs' data-ref="587vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_be" title='VncState::client_be' data-ref="VncState::client_be">client_be</a>;</td></tr>
<tr><th id="155">155</th><td></td></tr>
<tr><th id="156">156</th><td>    <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>, <var>0</var>, <b>sizeof</b> (<a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>));</td></tr>
<tr><th id="157">157</th><td></td></tr>
<tr><th id="158">158</th><td>    <b>for</b> (<a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a> = <var>0</var>, <a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a> = <var>0</var>; <a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a> &lt; <a class="local col9 ref" href="#589h" title='h' data-ref="589h">h</a> &amp;&amp; <a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a> &lt; <a class="local col8 ref" href="#588w" title='w' data-ref="588w">w</a>;) {</td></tr>
<tr><th id="159">159</th><td>        <b>for</b> (<a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a> = <var>0</var>; <a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a> &lt; <a class="local col9 ref" href="#589h" title='h' data-ref="589h">h</a> - <a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a> &amp;&amp; <a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a> &lt; <a class="local col8 ref" href="#588w" title='w' data-ref="588w">w</a> - <a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a> - <a class="macro" href="vnc-enc-tight.h.html#179" title="7" data-ref="_M/VNC_TIGHT_DETECT_SUBROW_WIDTH">VNC_TIGHT_DETECT_SUBROW_WIDTH</a>;</td></tr>
<tr><th id="160">160</th><td>             <a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a>++) {</td></tr>
<tr><th id="161">161</th><td>            <b>for</b> (<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> = <var>0</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> &lt; <var>3</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>++) {</td></tr>
<tr><th id="162">162</th><td>                <a class="local col9 ref" href="#599left" title='left' data-ref="599left">left</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] = <a class="local col1 ref" href="#601buf" title='buf' data-ref="601buf">buf</a>[((<a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a>+<a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a>)*<a class="local col8 ref" href="#588w" title='w' data-ref="588w">w</a>+<a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a>+<a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a>)*<var>4</var>+<a class="local col0 ref" href="#590off" title='off' data-ref="590off">off</a>+<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] &amp; <var>0xFF</var>;</td></tr>
<tr><th id="163">163</th><td>            }</td></tr>
<tr><th id="164">164</th><td>            <b>for</b> (<a class="local col4 ref" href="#594dx" title='dx' data-ref="594dx">dx</a> = <var>1</var>; <a class="local col4 ref" href="#594dx" title='dx' data-ref="594dx">dx</a> &lt;= <a class="macro" href="vnc-enc-tight.h.html#179" title="7" data-ref="_M/VNC_TIGHT_DETECT_SUBROW_WIDTH">VNC_TIGHT_DETECT_SUBROW_WIDTH</a>; <a class="local col4 ref" href="#594dx" title='dx' data-ref="594dx">dx</a>++) {</td></tr>
<tr><th id="165">165</th><td>                <b>for</b> (<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> = <var>0</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> &lt; <var>3</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>++) {</td></tr>
<tr><th id="166">166</th><td>                    <a class="local col8 ref" href="#598pix" title='pix' data-ref="598pix">pix</a> = <a class="local col1 ref" href="#601buf" title='buf' data-ref="601buf">buf</a>[((<a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a>+<a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a>)*<a class="local col8 ref" href="#588w" title='w' data-ref="588w">w</a>+<a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a>+<a class="local col3 ref" href="#593d" title='d' data-ref="593d">d</a>+<a class="local col4 ref" href="#594dx" title='dx' data-ref="594dx">dx</a>)*<var>4</var>+<a class="local col0 ref" href="#590off" title='off' data-ref="590off">off</a>+<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] &amp; <var>0xFF</var>;</td></tr>
<tr><th id="167">167</th><td>                    <a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<a class="ref" href="../../include/stdlib.h.html#abs" title='abs' data-ref="abs">abs</a>(<a class="local col8 ref" href="#598pix" title='pix' data-ref="598pix">pix</a> - <a class="local col9 ref" href="#599left" title='left' data-ref="599left">left</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>])]++;</td></tr>
<tr><th id="168">168</th><td>                    <a class="local col9 ref" href="#599left" title='left' data-ref="599left">left</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] = <a class="local col8 ref" href="#598pix" title='pix' data-ref="598pix">pix</a>;</td></tr>
<tr><th id="169">169</th><td>                }</td></tr>
<tr><th id="170">170</th><td>                <a class="local col7 ref" href="#597pixels" title='pixels' data-ref="597pixels">pixels</a>++;</td></tr>
<tr><th id="171">171</th><td>            }</td></tr>
<tr><th id="172">172</th><td>        }</td></tr>
<tr><th id="173">173</th><td>        <b>if</b> (<a class="local col8 ref" href="#588w" title='w' data-ref="588w">w</a> &gt; <a class="local col9 ref" href="#589h" title='h' data-ref="589h">h</a>) {</td></tr>
<tr><th id="174">174</th><td>            <a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a> += <a class="local col9 ref" href="#589h" title='h' data-ref="589h">h</a>;</td></tr>
<tr><th id="175">175</th><td>            <a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a> = <var>0</var>;</td></tr>
<tr><th id="176">176</th><td>        } <b>else</b> {</td></tr>
<tr><th id="177">177</th><td>            <a class="local col1 ref" href="#591x" title='x' data-ref="591x">x</a> = <var>0</var>;</td></tr>
<tr><th id="178">178</th><td>            <a class="local col2 ref" href="#592y" title='y' data-ref="592y">y</a> += <a class="local col8 ref" href="#588w" title='w' data-ref="588w">w</a>;</td></tr>
<tr><th id="179">179</th><td>        }</td></tr>
<tr><th id="180">180</th><td>    }</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td>    <b>if</b> (<a class="local col7 ref" href="#597pixels" title='pixels' data-ref="597pixels">pixels</a> == <var>0</var>) {</td></tr>
<tr><th id="183">183</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="184">184</th><td>    }</td></tr>
<tr><th id="185">185</th><td></td></tr>
<tr><th id="186">186</th><td>    <i>/* 95% smooth or more ... */</i></td></tr>
<tr><th id="187">187</th><td>    <b>if</b> (<a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<var>0</var>] * <var>33</var> / <a class="local col7 ref" href="#597pixels" title='pixels' data-ref="597pixels">pixels</a> &gt;= <var>95</var>) {</td></tr>
<tr><th id="188">188</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="189">189</th><td>    }</td></tr>
<tr><th id="190">190</th><td></td></tr>
<tr><th id="191">191</th><td>    <a class="local col0 ref" href="#600errors" title='errors' data-ref="600errors">errors</a> = <var>0</var>;</td></tr>
<tr><th id="192">192</th><td>    <b>for</b> (<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> = <var>1</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> &lt; <var>8</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>++) {</td></tr>
<tr><th id="193">193</th><td>        <a class="local col0 ref" href="#600errors" title='errors' data-ref="600errors">errors</a> += <a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] * (<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> * <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>);</td></tr>
<tr><th id="194">194</th><td>        <b>if</b> (<a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] == <var>0</var> || <a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] &gt; <a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>-<var>1</var>] * <var>2</var>) {</td></tr>
<tr><th id="195">195</th><td>            <b>return</b> <var>0</var>;</td></tr>
<tr><th id="196">196</th><td>        }</td></tr>
<tr><th id="197">197</th><td>    }</td></tr>
<tr><th id="198">198</th><td>    <b>for</b> (; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> &lt; <var>256</var>; <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>++) {</td></tr>
<tr><th id="199">199</th><td>        <a class="local col0 ref" href="#600errors" title='errors' data-ref="600errors">errors</a> += <a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>] * (<a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a> * <a class="local col5 ref" href="#595c" title='c' data-ref="595c">c</a>);</td></tr>
<tr><th id="200">200</th><td>    }</td></tr>
<tr><th id="201">201</th><td>    <a class="local col0 ref" href="#600errors" title='errors' data-ref="600errors">errors</a> /= (<a class="local col7 ref" href="#597pixels" title='pixels' data-ref="597pixels">pixels</a> * <var>3</var> - <a class="local col6 ref" href="#596stats" title='stats' data-ref="596stats">stats</a>[<var>0</var>]);</td></tr>
<tr><th id="202">202</th><td></td></tr>
<tr><th id="203">203</th><td>    <b>return</b> <a class="local col0 ref" href="#600errors" title='errors' data-ref="600errors">errors</a>;</td></tr>
<tr><th id="204">204</th><td>}</td></tr>
<tr><th id="205">205</th><td></td></tr>
<tr><th id="206">206</th><td><u>#define <dfn class="macro" id="_M/DEFINE_DETECT_FUNCTION" data-ref="_M/DEFINE_DETECT_FUNCTION">DEFINE_DETECT_FUNCTION</dfn>(bpp)                                     \</u></td></tr>
<tr><th id="207">207</th><td><u>                                                                        \</u></td></tr>
<tr><th id="208">208</th><td><u>    static unsigned int                                                 \</u></td></tr>
<tr><th id="209">209</th><td><u>    tight_detect_smooth_image##bpp(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col2 decl" id="602vs" title='vs' data-type='VncState *' data-ref="602vs"><dfn class="local col1 decl" id="621vs" title='vs' data-type='VncState *' data-ref="621vs">vs</dfn></dfn>, int <dfn class="local col3 decl" id="603w" title='w' data-type='int' data-ref="603w"><dfn class="local col2 decl" id="622w" title='w' data-type='int' data-ref="622w">w</dfn></dfn>, int <dfn class="local col4 decl" id="604h" title='h' data-type='int' data-ref="604h"><dfn class="local col3 decl" id="623h" title='h' data-type='int' data-ref="623h">h</dfn></dfn>) {        \</u></td></tr>
<tr><th id="210">210</th><td><u>        bool <dfn class="local col5 decl" id="605endian" title='endian' data-type='_Bool' data-ref="605endian"><dfn class="local col4 decl" id="624endian" title='endian' data-type='_Bool' data-ref="624endian">endian</dfn></dfn>;                                                    \</u></td></tr>
<tr><th id="211">211</th><td><u>        uint##bpp##_t <dfn class="local col6 decl" id="606pix" title='pix' data-type='uint16_t' data-ref="606pix"><dfn class="local col5 decl" id="625pix" title='pix' data-type='uint32_t' data-ref="625pix">pix</dfn></dfn>;                                              \</u></td></tr>
<tr><th id="212">212</th><td><u>        int <dfn class="local col7 decl" id="607max" title='max' data-type='int [3]' data-ref="607max"><dfn class="local col6 decl" id="626max" title='max' data-type='int [3]' data-ref="626max">max</dfn></dfn>[3], <dfn class="local col8 decl" id="608shift" title='shift' data-type='int [3]' data-ref="608shift"><dfn class="local col7 decl" id="627shift" title='shift' data-type='int [3]' data-ref="627shift">shift</dfn></dfn>[3];                                           \</u></td></tr>
<tr><th id="213">213</th><td><u>        int <dfn class="local col9 decl" id="609x" title='x' data-type='int' data-ref="609x"><dfn class="local col8 decl" id="628x" title='x' data-type='int' data-ref="628x">x</dfn></dfn>, <dfn class="local col0 decl" id="610y" title='y' data-type='int' data-ref="610y"><dfn class="local col9 decl" id="629y" title='y' data-type='int' data-ref="629y">y</dfn></dfn>, <dfn class="local col1 decl" id="611d" title='d' data-type='int' data-ref="611d"><dfn class="local col0 decl" id="630d" title='d' data-type='int' data-ref="630d">d</dfn></dfn>, <dfn class="local col2 decl" id="612dx" title='dx' data-type='int' data-ref="612dx"><dfn class="local col1 decl" id="631dx" title='dx' data-type='int' data-ref="631dx">dx</dfn></dfn>;                                                \</u></td></tr>
<tr><th id="214">214</th><td><u>        unsigned int <dfn class="local col3 decl" id="613c" title='c' data-type='unsigned int' data-ref="613c"><dfn class="local col2 decl" id="632c" title='c' data-type='unsigned int' data-ref="632c">c</dfn></dfn>;                                                 \</u></td></tr>
<tr><th id="215">215</th><td><u>        unsigned int <dfn class="local col4 decl" id="614stats" title='stats' data-type='unsigned int [256]' data-ref="614stats"><dfn class="local col3 decl" id="633stats" title='stats' data-type='unsigned int [256]' data-ref="633stats">stats</dfn></dfn>[256];                                        \</u></td></tr>
<tr><th id="216">216</th><td><u>        int <dfn class="local col5 decl" id="615pixels" title='pixels' data-type='int' data-ref="615pixels"><dfn class="local col4 decl" id="634pixels" title='pixels' data-type='int' data-ref="634pixels">pixels</dfn></dfn> = 0;                                                 \</u></td></tr>
<tr><th id="217">217</th><td><u>        int <dfn class="local col6 decl" id="616sample" title='sample' data-type='int' data-ref="616sample"><dfn class="local col5 decl" id="635sample" title='sample' data-type='int' data-ref="635sample">sample</dfn></dfn>, <dfn class="local col7 decl" id="617sum" title='sum' data-type='int' data-ref="617sum"><dfn class="local col6 decl" id="636sum" title='sum' data-type='int' data-ref="636sum">sum</dfn></dfn>, <dfn class="local col8 decl" id="618left" title='left' data-type='int [3]' data-ref="618left"><dfn class="local col7 decl" id="637left" title='left' data-type='int [3]' data-ref="637left">left</dfn></dfn>[3];                                       \</u></td></tr>
<tr><th id="218">218</th><td><u>        unsigned int <dfn class="local col9 decl" id="619errors" title='errors' data-type='unsigned int' data-ref="619errors"><dfn class="local col8 decl" id="638errors" title='errors' data-type='unsigned int' data-ref="638errors">errors</dfn></dfn>;                                            \</u></td></tr>
<tr><th id="219">219</th><td><u>        unsigned char *<dfn class="local col0 decl" id="620buf" title='buf' data-type='unsigned char *' data-ref="620buf"><dfn class="local col9 decl" id="639buf" title='buf' data-type='unsigned char *' data-ref="639buf">buf</dfn></dfn> = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>;                    \</u></td></tr>
<tr><th id="220">220</th><td><u>                                                                        \</u></td></tr>
<tr><th id="221">221</th><td><u>        <a class="local col5 ref" href="#293" title='endian' data-ref="605endian"><a class="local col4 ref" href="#294" title='endian' data-ref="624endian">endian</a></a> = 0; /* FIXME */                                         \</u></td></tr>
<tr><th id="222">222</th><td><u>                                                                        \</u></td></tr>
<tr><th id="223">223</th><td><u>                                                                        \</u></td></tr>
<tr><th id="224">224</th><td><u>        <a class="local col7 ref" href="#293" title='max' data-ref="607max"><a class="local col6 ref" href="#294" title='max' data-ref="626max">max</a></a>[0] = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a>;                                  \</u></td></tr>
<tr><th id="225">225</th><td><u>        <a class="local col7 ref" href="#293" title='max' data-ref="607max"><a class="local col6 ref" href="#294" title='max' data-ref="626max">max</a></a>[1] = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a>;                                  \</u></td></tr>
<tr><th id="226">226</th><td><u>        <a class="local col7 ref" href="#293" title='max' data-ref="607max"><a class="local col6 ref" href="#294" title='max' data-ref="626max">max</a></a>[2] = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a>;                                  \</u></td></tr>
<tr><th id="227">227</th><td><u>        <a class="local col8 ref" href="#293" title='shift' data-ref="608shift"><a class="local col7 ref" href="#294" title='shift' data-ref="627shift">shift</a></a>[0] = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>;                              \</u></td></tr>
<tr><th id="228">228</th><td><u>        <a class="local col8 ref" href="#293" title='shift' data-ref="608shift"><a class="local col7 ref" href="#294" title='shift' data-ref="627shift">shift</a></a>[1] = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>;                              \</u></td></tr>
<tr><th id="229">229</th><td><u>        <a class="local col8 ref" href="#293" title='shift' data-ref="608shift"><a class="local col7 ref" href="#294" title='shift' data-ref="627shift">shift</a></a>[2] = <a class="local col2 ref" href="#293" title='vs' data-ref="602vs"><a class="local col1 ref" href="#294" title='vs' data-ref="621vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>;                              \</u></td></tr>
<tr><th id="230">230</th><td><u>                                                                        \</u></td></tr>
<tr><th id="231">231</th><td><u>        <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>, 0, sizeof(<a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>));                                \</u></td></tr>
<tr><th id="232">232</th><td><u>                                                                        \</u></td></tr>
<tr><th id="233">233</th><td><u>        <a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a> = 0, <a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a> = 0;                                                   \</u></td></tr>
<tr><th id="234">234</th><td><u>        while (<a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a> &lt; <a class="local col4 ref" href="#293" title='h' data-ref="604h"><a class="local col3 ref" href="#294" title='h' data-ref="623h">h</a></a> &amp;&amp; <a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a> &lt; <a class="local col3 ref" href="#293" title='w' data-ref="603w"><a class="local col2 ref" href="#294" title='w' data-ref="622w">w</a></a>) {                                        \</u></td></tr>
<tr><th id="235">235</th><td><u>            for (<a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a> = 0; <a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a> &lt; <a class="local col4 ref" href="#293" title='h' data-ref="604h"><a class="local col3 ref" href="#294" title='h' data-ref="623h">h</a></a> - <a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a> &amp;&amp;                                    \</u></td></tr>
<tr><th id="236">236</th><td><u>                     <a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a> &lt; <a class="local col3 ref" href="#293" title='w' data-ref="603w"><a class="local col2 ref" href="#294" title='w' data-ref="622w">w</a></a> - <a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a> - VNC_TIGHT_DETECT_SUBROW_WIDTH; <a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a>++) {  \</u></td></tr>
<tr><th id="237">237</th><td><u>                <a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a> = ((uint##bpp##_t *)<a class="local col0 ref" href="#293" title='buf' data-ref="620buf"><a class="local col9 ref" href="#294" title='buf' data-ref="639buf">buf</a></a>)[(<a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a>+<a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a>)*<a class="local col3 ref" href="#293" title='w' data-ref="603w"><a class="local col2 ref" href="#294" title='w' data-ref="622w">w</a></a>+<a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a>+<a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a>];              \</u></td></tr>
<tr><th id="238">238</th><td><u>                if (<a class="local col5 ref" href="#293" title='endian' data-ref="605endian"><a class="local col4 ref" href="#294" title='endian' data-ref="624endian">endian</a></a>) {                                           \</u></td></tr>
<tr><th id="239">239</th><td><u>                    <a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a> = bswap##bpp(<a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a>);                              \</u></td></tr>
<tr><th id="240">240</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="241">241</th><td><u>                for (<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> = 0; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> &lt; 3; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>++) {                               \</u></td></tr>
<tr><th id="242">242</th><td><u>                    <a class="local col8 ref" href="#293" title='left' data-ref="618left"><a class="local col7 ref" href="#294" title='left' data-ref="637left">left</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] = (int)(<a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a> &gt;&gt; <a class="local col8 ref" href="#293" title='shift' data-ref="608shift"><a class="local col7 ref" href="#294" title='shift' data-ref="627shift">shift</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] &amp; <a class="local col7 ref" href="#293" title='max' data-ref="607max"><a class="local col6 ref" href="#294" title='max' data-ref="626max">max</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>]);          \</u></td></tr>
<tr><th id="243">243</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="244">244</th><td><u>                for (<a class="local col2 ref" href="#293" title='dx' data-ref="612dx"><a class="local col1 ref" href="#294" title='dx' data-ref="631dx">dx</a></a> = 1; <a class="local col2 ref" href="#293" title='dx' data-ref="612dx"><a class="local col1 ref" href="#294" title='dx' data-ref="631dx">dx</a></a> &lt;= VNC_TIGHT_DETECT_SUBROW_WIDTH;       \</u></td></tr>
<tr><th id="245">245</th><td><u>                     <a class="local col2 ref" href="#293" title='dx' data-ref="612dx"><a class="local col1 ref" href="#294" title='dx' data-ref="631dx">dx</a></a>++) {                                            \</u></td></tr>
<tr><th id="246">246</th><td><u>                    <a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a> = ((uint##bpp##_t *)<a class="local col0 ref" href="#293" title='buf' data-ref="620buf"><a class="local col9 ref" href="#294" title='buf' data-ref="639buf">buf</a></a>)[(<a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a>+<a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a>)*<a class="local col3 ref" href="#293" title='w' data-ref="603w"><a class="local col2 ref" href="#294" title='w' data-ref="622w">w</a></a>+<a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a>+<a class="local col1 ref" href="#293" title='d' data-ref="611d"><a class="local col0 ref" href="#294" title='d' data-ref="630d">d</a></a>+<a class="local col2 ref" href="#293" title='dx' data-ref="612dx"><a class="local col1 ref" href="#294" title='dx' data-ref="631dx">dx</a></a>];       \</u></td></tr>
<tr><th id="247">247</th><td><u>                    if (<a class="local col5 ref" href="#293" title='endian' data-ref="605endian"><a class="local col4 ref" href="#294" title='endian' data-ref="624endian">endian</a></a>) {                                       \</u></td></tr>
<tr><th id="248">248</th><td><u>                        <a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a> = bswap##bpp(<a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a>);                          \</u></td></tr>
<tr><th id="249">249</th><td><u>                    }                                                   \</u></td></tr>
<tr><th id="250">250</th><td><u>                    <a class="local col7 ref" href="#293" title='sum' data-ref="617sum"><a class="local col6 ref" href="#294" title='sum' data-ref="636sum">sum</a></a> = 0;                                            \</u></td></tr>
<tr><th id="251">251</th><td><u>                    for (<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> = 0; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> &lt; 3; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>++) {                           \</u></td></tr>
<tr><th id="252">252</th><td><u>                        <a class="local col6 ref" href="#293" title='sample' data-ref="616sample"><a class="local col5 ref" href="#294" title='sample' data-ref="635sample">sample</a></a> = (int)(<a class="local col6 ref" href="#293" title='pix' data-ref="606pix"><a class="local col5 ref" href="#294" title='pix' data-ref="625pix">pix</a></a> &gt;&gt; <a class="local col8 ref" href="#293" title='shift' data-ref="608shift"><a class="local col7 ref" href="#294" title='shift' data-ref="627shift">shift</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] &amp; <a class="local col7 ref" href="#293" title='max' data-ref="607max"><a class="local col6 ref" href="#294" title='max' data-ref="626max">max</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>]);       \</u></td></tr>
<tr><th id="253">253</th><td><u>                        <a class="local col7 ref" href="#293" title='sum' data-ref="617sum"><a class="local col6 ref" href="#294" title='sum' data-ref="636sum">sum</a></a> += <a class="ref" href="../../include/stdlib.h.html#abs" title='abs' data-ref="abs">abs</a>(<a class="local col6 ref" href="#293" title='sample' data-ref="616sample"><a class="local col5 ref" href="#294" title='sample' data-ref="635sample">sample</a></a> - <a class="local col8 ref" href="#293" title='left' data-ref="618left"><a class="local col7 ref" href="#294" title='left' data-ref="637left">left</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>]);                   \</u></td></tr>
<tr><th id="254">254</th><td><u>                        <a class="local col8 ref" href="#293" title='left' data-ref="618left"><a class="local col7 ref" href="#294" title='left' data-ref="637left">left</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] = <a class="local col6 ref" href="#293" title='sample' data-ref="616sample"><a class="local col5 ref" href="#294" title='sample' data-ref="635sample">sample</a></a>;                               \</u></td></tr>
<tr><th id="255">255</th><td><u>                    }                                                   \</u></td></tr>
<tr><th id="256">256</th><td><u>                    if (<a class="local col7 ref" href="#293" title='sum' data-ref="617sum"><a class="local col6 ref" href="#294" title='sum' data-ref="636sum">sum</a></a> &gt; 255) {                                    \</u></td></tr>
<tr><th id="257">257</th><td><u>                        <a class="local col7 ref" href="#293" title='sum' data-ref="617sum"><a class="local col6 ref" href="#294" title='sum' data-ref="636sum">sum</a></a> = 255;                                      \</u></td></tr>
<tr><th id="258">258</th><td><u>                    }                                                   \</u></td></tr>
<tr><th id="259">259</th><td><u>                    <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[<a class="local col7 ref" href="#293" title='sum' data-ref="617sum"><a class="local col6 ref" href="#294" title='sum' data-ref="636sum">sum</a></a>]++;                                       \</u></td></tr>
<tr><th id="260">260</th><td><u>                    <a class="local col5 ref" href="#293" title='pixels' data-ref="615pixels"><a class="local col4 ref" href="#294" title='pixels' data-ref="634pixels">pixels</a></a>++;                                           \</u></td></tr>
<tr><th id="261">261</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="262">262</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="263">263</th><td><u>            if (<a class="local col3 ref" href="#293" title='w' data-ref="603w"><a class="local col2 ref" href="#294" title='w' data-ref="622w">w</a></a> &gt; <a class="local col4 ref" href="#293" title='h' data-ref="604h"><a class="local col3 ref" href="#294" title='h' data-ref="623h">h</a></a>) {                                                \</u></td></tr>
<tr><th id="264">264</th><td><u>                <a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a> += <a class="local col4 ref" href="#293" title='h' data-ref="604h"><a class="local col3 ref" href="#294" title='h' data-ref="623h">h</a></a>;                                                 \</u></td></tr>
<tr><th id="265">265</th><td><u>                <a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a> = 0;                                                  \</u></td></tr>
<tr><th id="266">266</th><td><u>            } else {                                                    \</u></td></tr>
<tr><th id="267">267</th><td><u>                <a class="local col9 ref" href="#293" title='x' data-ref="609x"><a class="local col8 ref" href="#294" title='x' data-ref="628x">x</a></a> = 0;                                                  \</u></td></tr>
<tr><th id="268">268</th><td><u>                <a class="local col0 ref" href="#293" title='y' data-ref="610y"><a class="local col9 ref" href="#294" title='y' data-ref="629y">y</a></a> += <a class="local col3 ref" href="#293" title='w' data-ref="603w"><a class="local col2 ref" href="#294" title='w' data-ref="622w">w</a></a>;                                                 \</u></td></tr>
<tr><th id="269">269</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="270">270</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="271">271</th><td><u>        if (<a class="local col5 ref" href="#293" title='pixels' data-ref="615pixels"><a class="local col4 ref" href="#294" title='pixels' data-ref="634pixels">pixels</a></a> == 0) {                                              \</u></td></tr>
<tr><th id="272">272</th><td><u>            return 0;                                                   \</u></td></tr>
<tr><th id="273">273</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="274">274</th><td><u>        if ((<a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[0] + <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[1]) * 100 / <a class="local col5 ref" href="#293" title='pixels' data-ref="615pixels"><a class="local col4 ref" href="#294" title='pixels' data-ref="634pixels">pixels</a></a> &gt;= 90) {               \</u></td></tr>
<tr><th id="275">275</th><td><u>            return 0;                                                   \</u></td></tr>
<tr><th id="276">276</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="277">277</th><td><u>                                                                        \</u></td></tr>
<tr><th id="278">278</th><td><u>        <a class="local col9 ref" href="#293" title='errors' data-ref="619errors"><a class="local col8 ref" href="#294" title='errors' data-ref="638errors">errors</a></a> = 0;                                                     \</u></td></tr>
<tr><th id="279">279</th><td><u>        for (<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> = 1; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> &lt; 8; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>++) {                                       \</u></td></tr>
<tr><th id="280">280</th><td><u>            <a class="local col9 ref" href="#293" title='errors' data-ref="619errors"><a class="local col8 ref" href="#294" title='errors' data-ref="638errors">errors</a></a> += <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] * (<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> * <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>);                               \</u></td></tr>
<tr><th id="281">281</th><td><u>            if (<a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] == 0 || <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] &gt; <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>-1] * 2) {           \</u></td></tr>
<tr><th id="282">282</th><td><u>                return 0;                                               \</u></td></tr>
<tr><th id="283">283</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="284">284</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="285">285</th><td><u>        for (; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> &lt; 256; <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>++) {                                          \</u></td></tr>
<tr><th id="286">286</th><td><u>            <a class="local col9 ref" href="#293" title='errors' data-ref="619errors"><a class="local col8 ref" href="#294" title='errors' data-ref="638errors">errors</a></a> += <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>] * (<a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a> * <a class="local col3 ref" href="#293" title='c' data-ref="613c"><a class="local col2 ref" href="#294" title='c' data-ref="632c">c</a></a>);                               \</u></td></tr>
<tr><th id="287">287</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="288">288</th><td><u>        <a class="local col9 ref" href="#293" title='errors' data-ref="619errors"><a class="local col8 ref" href="#294" title='errors' data-ref="638errors">errors</a></a> /= (<a class="local col5 ref" href="#293" title='pixels' data-ref="615pixels"><a class="local col4 ref" href="#294" title='pixels' data-ref="634pixels">pixels</a></a> - <a class="local col4 ref" href="#293" title='stats' data-ref="614stats"><a class="local col3 ref" href="#294" title='stats' data-ref="633stats">stats</a></a>[0]);                                  \</u></td></tr>
<tr><th id="289">289</th><td><u>                                                                        \</u></td></tr>
<tr><th id="290">290</th><td><u>        return <a class="local col9 ref" href="#293" title='errors' data-ref="619errors"><a class="local col8 ref" href="#294" title='errors' data-ref="638errors">errors</a></a>;                                                  \</u></td></tr>
<tr><th id="291">291</th><td><u>    }</u></td></tr>
<tr><th id="292">292</th><td></td></tr>
<tr><th id="293">293</th><td><a class="macro" href="#206" title="static unsigned int tight_detect_smooth_image16(VncState *vs, int w, int h) { _Bool endian; uint16_t pix; int max[3], shift[3]; int x, y, d, dx; unsigned int c; unsigned int stats[256]; int pixels = 0; int sample, sum, left[3]; unsigned int errors; unsigned char *buf = vs-&gt;tight.tight.buffer; endian = 0; max[0] = vs-&gt;client_pf.rmax; max[1] = vs-&gt;client_pf.gmax; max[2] = vs-&gt;client_pf.bmax; shift[0] = vs-&gt;client_pf.rshift; shift[1] = vs-&gt;client_pf.gshift; shift[2] = vs-&gt;client_pf.bshift; memset(stats, 0, sizeof(stats)); y = 0, x = 0; while (y &lt; h &amp;&amp; x &lt; w) { for (d = 0; d &lt; h - y &amp;&amp; d &lt; w - x - 7; d++) { pix = ((uint16_t *)buf)[(y+d)*w+x+d]; if (endian) { pix = bswap16(pix); } for (c = 0; c &lt; 3; c++) { left[c] = (int)(pix &gt;&gt; shift[c] &amp; max[c]); } for (dx = 1; dx &lt;= 7; dx++) { pix = ((uint16_t *)buf)[(y+d)*w+x+d+dx]; if (endian) { pix = bswap16(pix); } sum = 0; for (c = 0; c &lt; 3; c++) { sample = (int)(pix &gt;&gt; shift[c] &amp; max[c]); sum += abs(sample - left[c]); left[c] = sample; } if (sum &gt; 255) { sum = 255; } stats[sum]++; pixels++; } } if (w &gt; h) { x += h; y = 0; } else { x = 0; y += w; } } if (pixels == 0) { return 0; } if ((stats[0] + stats[1]) * 100 / pixels &gt;= 90) { return 0; } errors = 0; for (c = 1; c &lt; 8; c++) { errors += stats[c] * (c * c); if (stats[c] == 0 || stats[c] &gt; stats[c-1] * 2) { return 0; } } for (; c &lt; 256; c++) { errors += stats[c] * (c * c); } errors /= (pixels - stats[0]); return errors; }" data-ref="_M/DEFINE_DETECT_FUNCTION">DEFINE_DETECT_FUNCTION</a>(<var>16</var>)</td></tr>
<tr><th id="294">294</th><td><a class="macro" href="#206" title="static unsigned int tight_detect_smooth_image32(VncState *vs, int w, int h) { _Bool endian; uint32_t pix; int max[3], shift[3]; int x, y, d, dx; unsigned int c; unsigned int stats[256]; int pixels = 0; int sample, sum, left[3]; unsigned int errors; unsigned char *buf = vs-&gt;tight.tight.buffer; endian = 0; max[0] = vs-&gt;client_pf.rmax; max[1] = vs-&gt;client_pf.gmax; max[2] = vs-&gt;client_pf.bmax; shift[0] = vs-&gt;client_pf.rshift; shift[1] = vs-&gt;client_pf.gshift; shift[2] = vs-&gt;client_pf.bshift; memset(stats, 0, sizeof(stats)); y = 0, x = 0; while (y &lt; h &amp;&amp; x &lt; w) { for (d = 0; d &lt; h - y &amp;&amp; d &lt; w - x - 7; d++) { pix = ((uint32_t *)buf)[(y+d)*w+x+d]; if (endian) { pix = bswap32(pix); } for (c = 0; c &lt; 3; c++) { left[c] = (int)(pix &gt;&gt; shift[c] &amp; max[c]); } for (dx = 1; dx &lt;= 7; dx++) { pix = ((uint32_t *)buf)[(y+d)*w+x+d+dx]; if (endian) { pix = bswap32(pix); } sum = 0; for (c = 0; c &lt; 3; c++) { sample = (int)(pix &gt;&gt; shift[c] &amp; max[c]); sum += abs(sample - left[c]); left[c] = sample; } if (sum &gt; 255) { sum = 255; } stats[sum]++; pixels++; } } if (w &gt; h) { x += h; y = 0; } else { x = 0; y += w; } } if (pixels == 0) { return 0; } if ((stats[0] + stats[1]) * 100 / pixels &gt;= 90) { return 0; } errors = 0; for (c = 1; c &lt; 8; c++) { errors += stats[c] * (c * c); if (stats[c] == 0 || stats[c] &gt; stats[c-1] * 2) { return 0; } } for (; c &lt; 256; c++) { errors += stats[c] * (c * c); } errors /= (pixels - stats[0]); return errors; }" data-ref="_M/DEFINE_DETECT_FUNCTION">DEFINE_DETECT_FUNCTION</a>(<var>32</var>)</td></tr>
<tr><th id="295">295</th><td></td></tr>
<tr><th id="296">296</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="297">297</th><td><dfn class="tu decl def" id="tight_detect_smooth_image" title='tight_detect_smooth_image' data-type='int tight_detect_smooth_image(VncState * vs, int w, int h)' data-ref="tight_detect_smooth_image">tight_detect_smooth_image</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col0 decl" id="640vs" title='vs' data-type='VncState *' data-ref="640vs">vs</dfn>, <em>int</em> <dfn class="local col1 decl" id="641w" title='w' data-type='int' data-ref="641w">w</dfn>, <em>int</em> <dfn class="local col2 decl" id="642h" title='h' data-type='int' data-ref="642h">h</dfn>)</td></tr>
<tr><th id="298">298</th><td>{</td></tr>
<tr><th id="299">299</th><td>    <em>unsigned</em> <em>int</em> <dfn class="local col3 decl" id="643errors" title='errors' data-type='unsigned int' data-ref="643errors">errors</dfn>;</td></tr>
<tr><th id="300">300</th><td>    <em>int</em> <dfn class="local col4 decl" id="644compression" title='compression' data-type='int' data-ref="644compression">compression</dfn> = <a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>;</td></tr>
<tr><th id="301">301</th><td>    <em>int</em> <dfn class="local col5 decl" id="645quality" title='quality' data-type='int' data-ref="645quality">quality</dfn> = <a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::quality" title='VncTight::quality' data-ref="VncTight::quality">quality</a>;</td></tr>
<tr><th id="302">302</th><td></td></tr>
<tr><th id="303">303</th><td>    <b>if</b> (!<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::vd" title='VncState::vd' data-ref="VncState::vd">vd</a>-&gt;<a class="ref" href="vnc.h.html#VncDisplay::lossy" title='VncDisplay::lossy' data-ref="VncDisplay::lossy">lossy</a>) {</td></tr>
<tr><th id="304">304</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="305">305</th><td>    }</td></tr>
<tr><th id="306">306</th><td></td></tr>
<tr><th id="307">307</th><td>    <b>if</b> (<a class="ref" href="../include/ui/console.h.html#surface_bytes_per_pixel" title='surface_bytes_per_pixel' data-ref="surface_bytes_per_pixel">surface_bytes_per_pixel</a>(<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::vd" title='VncState::vd' data-ref="VncState::vd">vd</a>-&gt;<a class="ref" href="vnc.h.html#VncDisplay::ds" title='VncDisplay::ds' data-ref="VncDisplay::ds">ds</a>) == <var>1</var> ||</td></tr>
<tr><th id="308">308</th><td>        <a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>1</var> ||</td></tr>
<tr><th id="309">309</th><td>        <a class="local col1 ref" href="#641w" title='w' data-ref="641w">w</a> &lt; <a class="macro" href="vnc-enc-tight.h.html#180" title="8" data-ref="_M/VNC_TIGHT_DETECT_MIN_WIDTH">VNC_TIGHT_DETECT_MIN_WIDTH</a> || <a class="local col2 ref" href="#642h" title='h' data-ref="642h">h</a> &lt; <a class="macro" href="vnc-enc-tight.h.html#181" title="8" data-ref="_M/VNC_TIGHT_DETECT_MIN_HEIGHT">VNC_TIGHT_DETECT_MIN_HEIGHT</a>) {</td></tr>
<tr><th id="310">310</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="311">311</th><td>    }</td></tr>
<tr><th id="312">312</th><td></td></tr>
<tr><th id="313">313</th><td>    <b>if</b> (<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::quality" title='VncTight::quality' data-ref="VncTight::quality">quality</a> != (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a>)-<var>1</var>) {</td></tr>
<tr><th id="314">314</th><td>        <b>if</b> (<a class="local col1 ref" href="#641w" title='w' data-ref="641w">w</a> * <a class="local col2 ref" href="#642h" title='h' data-ref="642h">h</a> &lt; <a class="macro" href="vnc-enc-tight.h.html#178" title="4096" data-ref="_M/VNC_TIGHT_JPEG_MIN_RECT_SIZE">VNC_TIGHT_JPEG_MIN_RECT_SIZE</a>) {</td></tr>
<tr><th id="315">315</th><td>            <b>return</b> <var>0</var>;</td></tr>
<tr><th id="316">316</th><td>        }</td></tr>
<tr><th id="317">317</th><td>    } <b>else</b> {</td></tr>
<tr><th id="318">318</th><td>        <b>if</b> (<a class="local col1 ref" href="#641w" title='w' data-ref="641w">w</a> * <a class="local col2 ref" href="#642h" title='h' data-ref="642h">h</a> &lt; <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col4 ref" href="#644compression" title='compression' data-ref="644compression">compression</a>].<a class="local col0 ref" href="#560gradient_min_rect_size" title='gradient_min_rect_size' data-ref="560gradient_min_rect_size">gradient_min_rect_size</a>) {</td></tr>
<tr><th id="319">319</th><td>            <b>return</b> <var>0</var>;</td></tr>
<tr><th id="320">320</th><td>        }</td></tr>
<tr><th id="321">321</th><td>    }</td></tr>
<tr><th id="322">322</th><td></td></tr>
<tr><th id="323">323</th><td>    <b>if</b> (<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>4</var>) {</td></tr>
<tr><th id="324">324</th><td>        <b>if</b> (<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>) {</td></tr>
<tr><th id="325">325</th><td>            <a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> = <a class="tu ref" href="#tight_detect_smooth_image24" title='tight_detect_smooth_image24' data-use='c' data-ref="tight_detect_smooth_image24">tight_detect_smooth_image24</a>(<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>, <a class="local col1 ref" href="#641w" title='w' data-ref="641w">w</a>, <a class="local col2 ref" href="#642h" title='h' data-ref="642h">h</a>);</td></tr>
<tr><th id="326">326</th><td>            <b>if</b> (<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::quality" title='VncTight::quality' data-ref="VncTight::quality">quality</a> != (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a>)-<var>1</var>) {</td></tr>
<tr><th id="327">327</th><td>                <b>return</b> (<a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> &lt; <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col5 ref" href="#645quality" title='quality' data-ref="645quality">quality</a>].<a class="local col0 ref" href="#570jpeg_threshold24" title='jpeg_threshold24' data-ref="570jpeg_threshold24">jpeg_threshold24</a>);</td></tr>
<tr><th id="328">328</th><td>            }</td></tr>
<tr><th id="329">329</th><td>            <b>return</b> (<a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> &lt; <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col4 ref" href="#644compression" title='compression' data-ref="644compression">compression</a>].<a class="local col6 ref" href="#566gradient_threshold24" title='gradient_threshold24' data-ref="566gradient_threshold24">gradient_threshold24</a>);</td></tr>
<tr><th id="330">330</th><td>        } <b>else</b> {</td></tr>
<tr><th id="331">331</th><td>            <a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> = <a class="tu ref" href="#294" title='tight_detect_smooth_image32' data-use='c' data-ref="tight_detect_smooth_image32">tight_detect_smooth_image32</a>(<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>, <a class="local col1 ref" href="#641w" title='w' data-ref="641w">w</a>, <a class="local col2 ref" href="#642h" title='h' data-ref="642h">h</a>);</td></tr>
<tr><th id="332">332</th><td>        }</td></tr>
<tr><th id="333">333</th><td>    } <b>else</b> {</td></tr>
<tr><th id="334">334</th><td>        <a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> = <a class="tu ref" href="#293" title='tight_detect_smooth_image16' data-use='c' data-ref="tight_detect_smooth_image16">tight_detect_smooth_image16</a>(<a class="local col0 ref" href="#640vs" title='vs' data-ref="640vs">vs</a>, <a class="local col1 ref" href="#641w" title='w' data-ref="641w">w</a>, <a class="local col2 ref" href="#642h" title='h' data-ref="642h">h</a>);</td></tr>
<tr><th id="335">335</th><td>    }</td></tr>
<tr><th id="336">336</th><td>    <b>if</b> (<a class="local col5 ref" href="#645quality" title='quality' data-ref="645quality">quality</a> != (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a>)-<var>1</var>) {</td></tr>
<tr><th id="337">337</th><td>        <b>return</b> (<a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> &lt; <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col5 ref" href="#645quality" title='quality' data-ref="645quality">quality</a>].<a class="local col9 ref" href="#569jpeg_threshold" title='jpeg_threshold' data-ref="569jpeg_threshold">jpeg_threshold</a>);</td></tr>
<tr><th id="338">338</th><td>    }</td></tr>
<tr><th id="339">339</th><td>    <b>return</b> (<a class="local col3 ref" href="#643errors" title='errors' data-ref="643errors">errors</a> &lt; <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col4 ref" href="#644compression" title='compression' data-ref="644compression">compression</a>].<a class="local col5 ref" href="#565gradient_threshold" title='gradient_threshold' data-ref="565gradient_threshold">gradient_threshold</a>);</td></tr>
<tr><th id="340">340</th><td>}</td></tr>
<tr><th id="341">341</th><td></td></tr>
<tr><th id="342">342</th><td><i>/*</i></td></tr>
<tr><th id="343">343</th><td><i> * Code to determine how many different colors used in rectangle.</i></td></tr>
<tr><th id="344">344</th><td><i> */</i></td></tr>
<tr><th id="345">345</th><td><u>#define <dfn class="macro" id="_M/DEFINE_FILL_PALETTE_FUNCTION" data-ref="_M/DEFINE_FILL_PALETTE_FUNCTION">DEFINE_FILL_PALETTE_FUNCTION</dfn>(bpp)                               \</u></td></tr>
<tr><th id="346">346</th><td><u>                                                                        \</u></td></tr>
<tr><th id="347">347</th><td><u>    static int                                                          \</u></td></tr>
<tr><th id="348">348</th><td><u>    tight_fill_palette##bpp(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col6 decl" id="646vs" title='vs' data-type='VncState *' data-ref="646vs"><dfn class="local col1 decl" id="661vs" title='vs' data-type='VncState *' data-ref="661vs"><dfn class="local col6 decl" id="676vs" title='vs' data-type='VncState *' data-ref="676vs">vs</dfn></dfn></dfn>, int <dfn class="local col7 decl" id="647x" title='x' data-type='int' data-ref="647x"><dfn class="local col2 decl" id="662x" title='x' data-type='int' data-ref="662x"><dfn class="local col7 decl" id="677x" title='x' data-type='int' data-ref="677x">x</dfn></dfn></dfn>, int <dfn class="local col8 decl" id="648y" title='y' data-type='int' data-ref="648y"><dfn class="local col3 decl" id="663y" title='y' data-type='int' data-ref="663y"><dfn class="local col8 decl" id="678y" title='y' data-type='int' data-ref="678y">y</dfn></dfn></dfn>,                 \</u></td></tr>
<tr><th id="349">349</th><td><u>                            int <dfn class="local col9 decl" id="649max" title='max' data-type='int' data-ref="649max"><dfn class="local col4 decl" id="664max" title='max' data-type='int' data-ref="664max"><dfn class="local col9 decl" id="679max" title='max' data-type='int' data-ref="679max">max</dfn></dfn></dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col0 decl" id="650count" title='count' data-type='size_t' data-ref="650count"><dfn class="local col5 decl" id="665count" title='count' data-type='size_t' data-ref="665count"><dfn class="local col0 decl" id="680count" title='count' data-type='size_t' data-ref="680count">count</dfn></dfn></dfn>,                      \</u></td></tr>
<tr><th id="350">350</th><td><u>                            <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col1 decl" id="651bg" title='bg' data-type='uint32_t *' data-ref="651bg"><dfn class="local col6 decl" id="666bg" title='bg' data-type='uint32_t *' data-ref="666bg"><dfn class="local col1 decl" id="681bg" title='bg' data-type='uint32_t *' data-ref="681bg">bg</dfn></dfn></dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col2 decl" id="652fg" title='fg' data-type='uint32_t *' data-ref="652fg"><dfn class="local col7 decl" id="667fg" title='fg' data-type='uint32_t *' data-ref="667fg"><dfn class="local col2 decl" id="682fg" title='fg' data-type='uint32_t *' data-ref="682fg">fg</dfn></dfn></dfn>,                 \</u></td></tr>
<tr><th id="351">351</th><td><u>                            <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col3 decl" id="653palette" title='palette' data-type='VncPalette *' data-ref="653palette"><dfn class="local col8 decl" id="668palette" title='palette' data-type='VncPalette *' data-ref="668palette"><dfn class="local col3 decl" id="683palette" title='palette' data-type='VncPalette *' data-ref="683palette">palette</dfn></dfn></dfn>) {                      \</u></td></tr>
<tr><th id="352">352</th><td><u>        uint##bpp##_t *<dfn class="local col4 decl" id="654data" title='data' data-type='uint8_t *' data-ref="654data"><dfn class="local col9 decl" id="669data" title='data' data-type='uint16_t *' data-ref="669data"><dfn class="local col4 decl" id="684data" title='data' data-type='uint32_t *' data-ref="684data">data</dfn></dfn></dfn>;                                            \</u></td></tr>
<tr><th id="353">353</th><td><u>        uint##bpp##_t <dfn class="local col5 decl" id="655c0" title='c0' data-type='uint8_t' data-ref="655c0"><dfn class="local col0 decl" id="670c0" title='c0' data-type='uint16_t' data-ref="670c0"><dfn class="local col5 decl" id="685c0" title='c0' data-type='uint32_t' data-ref="685c0">c0</dfn></dfn></dfn>, <dfn class="local col6 decl" id="656c1" title='c1' data-type='uint8_t' data-ref="656c1"><dfn class="local col1 decl" id="671c1" title='c1' data-type='uint16_t' data-ref="671c1"><dfn class="local col6 decl" id="686c1" title='c1' data-type='uint32_t' data-ref="686c1">c1</dfn></dfn></dfn>, <dfn class="local col7 decl" id="657ci" title='ci' data-type='uint8_t' data-ref="657ci"><dfn class="local col2 decl" id="672ci" title='ci' data-type='uint16_t' data-ref="672ci"><dfn class="local col7 decl" id="687ci" title='ci' data-type='uint32_t' data-ref="687ci">ci</dfn></dfn></dfn>;                                       \</u></td></tr>
<tr><th id="354">354</th><td><u>        int <dfn class="local col8 decl" id="658i" title='i' data-type='int' data-ref="658i"><dfn class="local col3 decl" id="673i" title='i' data-type='int' data-ref="673i"><dfn class="local col8 decl" id="688i" title='i' data-type='int' data-ref="688i">i</dfn></dfn></dfn>, <dfn class="local col9 decl" id="659n0" title='n0' data-type='int' data-ref="659n0"><dfn class="local col4 decl" id="674n0" title='n0' data-type='int' data-ref="674n0"><dfn class="local col9 decl" id="689n0" title='n0' data-type='int' data-ref="689n0">n0</dfn></dfn></dfn>, <dfn class="local col0 decl" id="660n1" title='n1' data-type='int' data-ref="660n1"><dfn class="local col5 decl" id="675n1" title='n1' data-type='int' data-ref="675n1"><dfn class="local col0 decl" id="690n1" title='n1' data-type='int' data-ref="690n1">n1</dfn></dfn></dfn>;                                                  \</u></td></tr>
<tr><th id="355">355</th><td><u>                                                                        \</u></td></tr>
<tr><th id="356">356</th><td><u>        <a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a> = (uint##bpp##_t *)<a class="local col6 ref" href="#417" title='vs' data-ref="646vs"><a class="local col1 ref" href="#418" title='vs' data-ref="661vs"><a class="local col6 ref" href="#419" title='vs' data-ref="676vs">vs</a></a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>;                 \</u></td></tr>
<tr><th id="357">357</th><td><u>                                                                        \</u></td></tr>
<tr><th id="358">358</th><td><u>        <a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a> = <a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a>[0];                                                   \</u></td></tr>
<tr><th id="359">359</th><td><u>        <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a> = 1;                                                          \</u></td></tr>
<tr><th id="360">360</th><td><u>        while (<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a> &lt; <a class="local col0 ref" href="#417" title='count' data-ref="650count"><a class="local col5 ref" href="#418" title='count' data-ref="665count"><a class="local col0 ref" href="#419" title='count' data-ref="680count">count</a></a></a> &amp;&amp; <a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a>[<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>] == <a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a>)                              \</u></td></tr>
<tr><th id="361">361</th><td><u>            <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>++;                                                        \</u></td></tr>
<tr><th id="362">362</th><td><u>        if (<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a> &gt;= <a class="local col0 ref" href="#417" title='count' data-ref="650count"><a class="local col5 ref" href="#418" title='count' data-ref="665count"><a class="local col0 ref" href="#419" title='count' data-ref="680count">count</a></a></a>) {                                               \</u></td></tr>
<tr><th id="363">363</th><td><u>            *<a class="local col1 ref" href="#417" title='bg' data-ref="651bg"><a class="local col6 ref" href="#418" title='bg' data-ref="666bg"><a class="local col1 ref" href="#419" title='bg' data-ref="681bg">bg</a></a></a> = *<a class="local col2 ref" href="#417" title='fg' data-ref="652fg"><a class="local col7 ref" href="#418" title='fg' data-ref="667fg"><a class="local col2 ref" href="#419" title='fg' data-ref="682fg">fg</a></a></a> = <a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a>;                                             \</u></td></tr>
<tr><th id="364">364</th><td><u>            return 1;                                                   \</u></td></tr>
<tr><th id="365">365</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="366">366</th><td><u>                                                                        \</u></td></tr>
<tr><th id="367">367</th><td><u>        if (<a class="local col9 ref" href="#417" title='max' data-ref="649max"><a class="local col4 ref" href="#418" title='max' data-ref="664max"><a class="local col9 ref" href="#419" title='max' data-ref="679max">max</a></a></a> &lt; 2) {                                                  \</u></td></tr>
<tr><th id="368">368</th><td><u>            return 0;                                                   \</u></td></tr>
<tr><th id="369">369</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="370">370</th><td><u>                                                                        \</u></td></tr>
<tr><th id="371">371</th><td><u>        <a class="local col9 ref" href="#417" title='n0' data-ref="659n0"><a class="local col4 ref" href="#418" title='n0' data-ref="674n0"><a class="local col9 ref" href="#419" title='n0' data-ref="689n0">n0</a></a></a> = <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>;                                                         \</u></td></tr>
<tr><th id="372">372</th><td><u>        <a class="local col6 ref" href="#417" title='c1' data-ref="656c1"><a class="local col1 ref" href="#418" title='c1' data-ref="671c1"><a class="local col6 ref" href="#419" title='c1' data-ref="686c1">c1</a></a></a> = <a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a>[<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>];                                                   \</u></td></tr>
<tr><th id="373">373</th><td><u>        <a class="local col0 ref" href="#417" title='n1' data-ref="660n1"><a class="local col5 ref" href="#418" title='n1' data-ref="675n1"><a class="local col0 ref" href="#419" title='n1' data-ref="690n1">n1</a></a></a> = 0;                                                         \</u></td></tr>
<tr><th id="374">374</th><td><u>        for (<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>++; <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a> &lt; <a class="local col0 ref" href="#417" title='count' data-ref="650count"><a class="local col5 ref" href="#418" title='count' data-ref="665count"><a class="local col0 ref" href="#419" title='count' data-ref="680count">count</a></a></a>; <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>++) {                                     \</u></td></tr>
<tr><th id="375">375</th><td><u>            <a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a> = <a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a>[<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>];                                               \</u></td></tr>
<tr><th id="376">376</th><td><u>            if (<a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a> == <a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a>) {                                             \</u></td></tr>
<tr><th id="377">377</th><td><u>                <a class="local col9 ref" href="#417" title='n0' data-ref="659n0"><a class="local col4 ref" href="#418" title='n0' data-ref="674n0"><a class="local col9 ref" href="#419" title='n0' data-ref="689n0">n0</a></a></a>++;                                                   \</u></td></tr>
<tr><th id="378">378</th><td><u>            } else if (<a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a> == <a class="local col6 ref" href="#417" title='c1' data-ref="656c1"><a class="local col1 ref" href="#418" title='c1' data-ref="671c1"><a class="local col6 ref" href="#419" title='c1' data-ref="686c1">c1</a></a></a>) {                                      \</u></td></tr>
<tr><th id="379">379</th><td><u>                <a class="local col0 ref" href="#417" title='n1' data-ref="660n1"><a class="local col5 ref" href="#418" title='n1' data-ref="675n1"><a class="local col0 ref" href="#419" title='n1' data-ref="690n1">n1</a></a></a>++;                                                   \</u></td></tr>
<tr><th id="380">380</th><td><u>            } else                                                      \</u></td></tr>
<tr><th id="381">381</th><td><u>                break;                                                  \</u></td></tr>
<tr><th id="382">382</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="383">383</th><td><u>        if (<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a> &gt;= <a class="local col0 ref" href="#417" title='count' data-ref="650count"><a class="local col5 ref" href="#418" title='count' data-ref="665count"><a class="local col0 ref" href="#419" title='count' data-ref="680count">count</a></a></a>) {                                               \</u></td></tr>
<tr><th id="384">384</th><td><u>            if (<a class="local col9 ref" href="#417" title='n0' data-ref="659n0"><a class="local col4 ref" href="#418" title='n0' data-ref="674n0"><a class="local col9 ref" href="#419" title='n0' data-ref="689n0">n0</a></a></a> &gt; <a class="local col0 ref" href="#417" title='n1' data-ref="660n1"><a class="local col5 ref" href="#418" title='n1' data-ref="675n1"><a class="local col0 ref" href="#419" title='n1' data-ref="690n1">n1</a></a></a>) {                                              \</u></td></tr>
<tr><th id="385">385</th><td><u>                *<a class="local col1 ref" href="#417" title='bg' data-ref="651bg"><a class="local col6 ref" href="#418" title='bg' data-ref="666bg"><a class="local col1 ref" href="#419" title='bg' data-ref="681bg">bg</a></a></a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a>;                                     \</u></td></tr>
<tr><th id="386">386</th><td><u>                *<a class="local col2 ref" href="#417" title='fg' data-ref="652fg"><a class="local col7 ref" href="#418" title='fg' data-ref="667fg"><a class="local col2 ref" href="#419" title='fg' data-ref="682fg">fg</a></a></a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col6 ref" href="#417" title='c1' data-ref="656c1"><a class="local col1 ref" href="#418" title='c1' data-ref="671c1"><a class="local col6 ref" href="#419" title='c1' data-ref="686c1">c1</a></a></a>;                                     \</u></td></tr>
<tr><th id="387">387</th><td><u>            } else {                                                    \</u></td></tr>
<tr><th id="388">388</th><td><u>                *<a class="local col1 ref" href="#417" title='bg' data-ref="651bg"><a class="local col6 ref" href="#418" title='bg' data-ref="666bg"><a class="local col1 ref" href="#419" title='bg' data-ref="681bg">bg</a></a></a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col6 ref" href="#417" title='c1' data-ref="656c1"><a class="local col1 ref" href="#418" title='c1' data-ref="671c1"><a class="local col6 ref" href="#419" title='c1' data-ref="686c1">c1</a></a></a>;                                     \</u></td></tr>
<tr><th id="389">389</th><td><u>                *<a class="local col2 ref" href="#417" title='fg' data-ref="652fg"><a class="local col7 ref" href="#418" title='fg' data-ref="667fg"><a class="local col2 ref" href="#419" title='fg' data-ref="682fg">fg</a></a></a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a>;                                     \</u></td></tr>
<tr><th id="390">390</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="391">391</th><td><u>            return 2;                                                   \</u></td></tr>
<tr><th id="392">392</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="393">393</th><td><u>                                                                        \</u></td></tr>
<tr><th id="394">394</th><td><u>        if (<a class="local col9 ref" href="#417" title='max' data-ref="649max"><a class="local col4 ref" href="#418" title='max' data-ref="664max"><a class="local col9 ref" href="#419" title='max' data-ref="679max">max</a></a></a> == 2) {                                                 \</u></td></tr>
<tr><th id="395">395</th><td><u>            return 0;                                                   \</u></td></tr>
<tr><th id="396">396</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="397">397</th><td><u>                                                                        \</u></td></tr>
<tr><th id="398">398</th><td><u>        <a class="ref" href="vnc-palette.h.html#palette_init" title='palette_init' data-ref="palette_init">palette_init</a>(<a class="local col3 ref" href="#417" title='palette' data-ref="653palette"><a class="local col8 ref" href="#418" title='palette' data-ref="668palette"><a class="local col3 ref" href="#419" title='palette' data-ref="683palette">palette</a></a></a>, <a class="local col9 ref" href="#417" title='max' data-ref="649max"><a class="local col4 ref" href="#418" title='max' data-ref="664max"><a class="local col9 ref" href="#419" title='max' data-ref="679max">max</a></a></a>, bpp);                                \</u></td></tr>
<tr><th id="399">399</th><td><u>        <a class="ref" href="vnc-palette.h.html#palette_put" title='palette_put' data-ref="palette_put">palette_put</a>(<a class="local col3 ref" href="#417" title='palette' data-ref="653palette"><a class="local col8 ref" href="#418" title='palette' data-ref="668palette"><a class="local col3 ref" href="#419" title='palette' data-ref="683palette">palette</a></a></a>, <a class="local col5 ref" href="#417" title='c0' data-ref="655c0"><a class="local col0 ref" href="#418" title='c0' data-ref="670c0"><a class="local col5 ref" href="#419" title='c0' data-ref="685c0">c0</a></a></a>);                                       \</u></td></tr>
<tr><th id="400">400</th><td><u>        <a class="ref" href="vnc-palette.h.html#palette_put" title='palette_put' data-ref="palette_put">palette_put</a>(<a class="local col3 ref" href="#417" title='palette' data-ref="653palette"><a class="local col8 ref" href="#418" title='palette' data-ref="668palette"><a class="local col3 ref" href="#419" title='palette' data-ref="683palette">palette</a></a></a>, <a class="local col6 ref" href="#417" title='c1' data-ref="656c1"><a class="local col1 ref" href="#418" title='c1' data-ref="671c1"><a class="local col6 ref" href="#419" title='c1' data-ref="686c1">c1</a></a></a>);                                       \</u></td></tr>
<tr><th id="401">401</th><td><u>        <a class="ref" href="vnc-palette.h.html#palette_put" title='palette_put' data-ref="palette_put">palette_put</a>(<a class="local col3 ref" href="#417" title='palette' data-ref="653palette"><a class="local col8 ref" href="#418" title='palette' data-ref="668palette"><a class="local col3 ref" href="#419" title='palette' data-ref="683palette">palette</a></a></a>, <a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a>);                                       \</u></td></tr>
<tr><th id="402">402</th><td><u>                                                                        \</u></td></tr>
<tr><th id="403">403</th><td><u>        for (<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>++; <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a> &lt; <a class="local col0 ref" href="#417" title='count' data-ref="650count"><a class="local col5 ref" href="#418" title='count' data-ref="665count"><a class="local col0 ref" href="#419" title='count' data-ref="680count">count</a></a></a>; <a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>++) {                                     \</u></td></tr>
<tr><th id="404">404</th><td><u>            if (<a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a>[<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>] == <a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a>) {                                        \</u></td></tr>
<tr><th id="405">405</th><td><u>                continue;                                               \</u></td></tr>
<tr><th id="406">406</th><td><u>            } else {                                                    \</u></td></tr>
<tr><th id="407">407</th><td><u>                <a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a> = <a class="local col4 ref" href="#417" title='data' data-ref="654data"><a class="local col9 ref" href="#418" title='data' data-ref="669data"><a class="local col4 ref" href="#419" title='data' data-ref="684data">data</a></a></a>[<a class="local col8 ref" href="#417" title='i' data-ref="658i"><a class="local col3 ref" href="#418" title='i' data-ref="673i"><a class="local col8 ref" href="#419" title='i' data-ref="688i">i</a></a></a>];                                           \</u></td></tr>
<tr><th id="408">408</th><td><u>                if (!<a class="ref" href="vnc-palette.h.html#palette_put" title='palette_put' data-ref="palette_put">palette_put</a>(<a class="local col3 ref" href="#417" title='palette' data-ref="653palette"><a class="local col8 ref" href="#418" title='palette' data-ref="668palette"><a class="local col3 ref" href="#419" title='palette' data-ref="683palette">palette</a></a></a>, (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col7 ref" href="#417" title='ci' data-ref="657ci"><a class="local col2 ref" href="#418" title='ci' data-ref="672ci"><a class="local col7 ref" href="#419" title='ci' data-ref="687ci">ci</a></a></a>)) {              \</u></td></tr>
<tr><th id="409">409</th><td><u>                    return 0;                                           \</u></td></tr>
<tr><th id="410">410</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="411">411</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="412">412</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="413">413</th><td><u>                                                                        \</u></td></tr>
<tr><th id="414">414</th><td><u>        return <a class="ref" href="vnc-palette.h.html#palette_size" title='palette_size' data-ref="palette_size">palette_size</a>(<a class="local col3 ref" href="#417" title='palette' data-ref="653palette"><a class="local col8 ref" href="#418" title='palette' data-ref="668palette"><a class="local col3 ref" href="#419" title='palette' data-ref="683palette">palette</a></a></a>);                                   \</u></td></tr>
<tr><th id="415">415</th><td><u>    }</u></td></tr>
<tr><th id="416">416</th><td></td></tr>
<tr><th id="417">417</th><td><a class="macro" href="#345" title="static int tight_fill_palette8(VncState *vs, int x, int y, int max, size_t count, uint32_t *bg, uint32_t *fg, VncPalette *palette) { uint8_t *data; uint8_t c0, c1, ci; int i, n0, n1; data = (uint8_t *)vs-&gt;tight.tight.buffer; c0 = data[0]; i = 1; while (i &lt; count &amp;&amp; data[i] == c0) i++; if (i &gt;= count) { *bg = *fg = c0; return 1; } if (max &lt; 2) { return 0; } n0 = i; c1 = data[i]; n1 = 0; for (i++; i &lt; count; i++) { ci = data[i]; if (ci == c0) { n0++; } else if (ci == c1) { n1++; } else break; } if (i &gt;= count) { if (n0 &gt; n1) { *bg = (uint32_t)c0; *fg = (uint32_t)c1; } else { *bg = (uint32_t)c1; *fg = (uint32_t)c0; } return 2; } if (max == 2) { return 0; } palette_init(palette, max, 8); palette_put(palette, c0); palette_put(palette, c1); palette_put(palette, ci); for (i++; i &lt; count; i++) { if (data[i] == ci) { continue; } else { ci = data[i]; if (!palette_put(palette, (uint32_t)ci)) { return 0; } } } return palette_size(palette); }" data-ref="_M/DEFINE_FILL_PALETTE_FUNCTION">DEFINE_FILL_PALETTE_FUNCTION</a>(<var>8</var>)</td></tr>
<tr><th id="418">418</th><td><a class="macro" href="#345" title="static int tight_fill_palette16(VncState *vs, int x, int y, int max, size_t count, uint32_t *bg, uint32_t *fg, VncPalette *palette) { uint16_t *data; uint16_t c0, c1, ci; int i, n0, n1; data = (uint16_t *)vs-&gt;tight.tight.buffer; c0 = data[0]; i = 1; while (i &lt; count &amp;&amp; data[i] == c0) i++; if (i &gt;= count) { *bg = *fg = c0; return 1; } if (max &lt; 2) { return 0; } n0 = i; c1 = data[i]; n1 = 0; for (i++; i &lt; count; i++) { ci = data[i]; if (ci == c0) { n0++; } else if (ci == c1) { n1++; } else break; } if (i &gt;= count) { if (n0 &gt; n1) { *bg = (uint32_t)c0; *fg = (uint32_t)c1; } else { *bg = (uint32_t)c1; *fg = (uint32_t)c0; } return 2; } if (max == 2) { return 0; } palette_init(palette, max, 16); palette_put(palette, c0); palette_put(palette, c1); palette_put(palette, ci); for (i++; i &lt; count; i++) { if (data[i] == ci) { continue; } else { ci = data[i]; if (!palette_put(palette, (uint32_t)ci)) { return 0; } } } return palette_size(palette); }" data-ref="_M/DEFINE_FILL_PALETTE_FUNCTION">DEFINE_FILL_PALETTE_FUNCTION</a>(<var>16</var>)</td></tr>
<tr><th id="419">419</th><td><a class="macro" href="#345" title="static int tight_fill_palette32(VncState *vs, int x, int y, int max, size_t count, uint32_t *bg, uint32_t *fg, VncPalette *palette) { uint32_t *data; uint32_t c0, c1, ci; int i, n0, n1; data = (uint32_t *)vs-&gt;tight.tight.buffer; c0 = data[0]; i = 1; while (i &lt; count &amp;&amp; data[i] == c0) i++; if (i &gt;= count) { *bg = *fg = c0; return 1; } if (max &lt; 2) { return 0; } n0 = i; c1 = data[i]; n1 = 0; for (i++; i &lt; count; i++) { ci = data[i]; if (ci == c0) { n0++; } else if (ci == c1) { n1++; } else break; } if (i &gt;= count) { if (n0 &gt; n1) { *bg = (uint32_t)c0; *fg = (uint32_t)c1; } else { *bg = (uint32_t)c1; *fg = (uint32_t)c0; } return 2; } if (max == 2) { return 0; } palette_init(palette, max, 32); palette_put(palette, c0); palette_put(palette, c1); palette_put(palette, ci); for (i++; i &lt; count; i++) { if (data[i] == ci) { continue; } else { ci = data[i]; if (!palette_put(palette, (uint32_t)ci)) { return 0; } } } return palette_size(palette); }" data-ref="_M/DEFINE_FILL_PALETTE_FUNCTION">DEFINE_FILL_PALETTE_FUNCTION</a>(<var>32</var>)</td></tr>
<tr><th id="420">420</th><td></td></tr>
<tr><th id="421">421</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="tight_fill_palette" title='tight_fill_palette' data-type='int tight_fill_palette(VncState * vs, int x, int y, size_t count, uint32_t * bg, uint32_t * fg, VncPalette * palette)' data-ref="tight_fill_palette">tight_fill_palette</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col1 decl" id="691vs" title='vs' data-type='VncState *' data-ref="691vs">vs</dfn>, <em>int</em> <dfn class="local col2 decl" id="692x" title='x' data-type='int' data-ref="692x">x</dfn>, <em>int</em> <dfn class="local col3 decl" id="693y" title='y' data-type='int' data-ref="693y">y</dfn>,</td></tr>
<tr><th id="422">422</th><td>                              <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col4 decl" id="694count" title='count' data-type='size_t' data-ref="694count">count</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col5 decl" id="695bg" title='bg' data-type='uint32_t *' data-ref="695bg">bg</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col6 decl" id="696fg" title='fg' data-type='uint32_t *' data-ref="696fg">fg</dfn>,</td></tr>
<tr><th id="423">423</th><td>                              <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col7 decl" id="697palette" title='palette' data-type='VncPalette *' data-ref="697palette">palette</dfn>)</td></tr>
<tr><th id="424">424</th><td>{</td></tr>
<tr><th id="425">425</th><td>    <em>int</em> <dfn class="local col8 decl" id="698max" title='max' data-type='int' data-ref="698max">max</dfn>;</td></tr>
<tr><th id="426">426</th><td></td></tr>
<tr><th id="427">427</th><td>    <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a> = <a class="local col4 ref" href="#694count" title='count' data-ref="694count">count</a> / <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col1 ref" href="#691vs" title='vs' data-ref="691vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col7 ref" href="#567idx_max_colors_divisor" title='idx_max_colors_divisor' data-ref="567idx_max_colors_divisor">idx_max_colors_divisor</a>;</td></tr>
<tr><th id="428">428</th><td>    <b>if</b> (<a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a> &lt; <var>2</var> &amp;&amp;</td></tr>
<tr><th id="429">429</th><td>        <a class="local col4 ref" href="#694count" title='count' data-ref="694count">count</a> &gt;= <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col1 ref" href="#691vs" title='vs' data-ref="691vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col9 ref" href="#559mono_min_rect_size" title='mono_min_rect_size' data-ref="559mono_min_rect_size">mono_min_rect_size</a>) {</td></tr>
<tr><th id="430">430</th><td>        <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a> = <var>2</var>;</td></tr>
<tr><th id="431">431</th><td>    }</td></tr>
<tr><th id="432">432</th><td>    <b>if</b> (<a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a> &gt;= <var>256</var>) {</td></tr>
<tr><th id="433">433</th><td>        <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a> = <var>256</var>;</td></tr>
<tr><th id="434">434</th><td>    }</td></tr>
<tr><th id="435">435</th><td></td></tr>
<tr><th id="436">436</th><td>    <b>switch</b> (<a class="local col1 ref" href="#691vs" title='vs' data-ref="691vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a>) {</td></tr>
<tr><th id="437">437</th><td>    <b>case</b> <var>4</var>:</td></tr>
<tr><th id="438">438</th><td>        <b>return</b> <a class="tu ref" href="#419" title='tight_fill_palette32' data-use='c' data-ref="tight_fill_palette32">tight_fill_palette32</a>(<a class="local col1 ref" href="#691vs" title='vs' data-ref="691vs">vs</a>, <a class="local col2 ref" href="#692x" title='x' data-ref="692x">x</a>, <a class="local col3 ref" href="#693y" title='y' data-ref="693y">y</a>, <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a>, <a class="local col4 ref" href="#694count" title='count' data-ref="694count">count</a>, <a class="local col5 ref" href="#695bg" title='bg' data-ref="695bg">bg</a>, <a class="local col6 ref" href="#696fg" title='fg' data-ref="696fg">fg</a>, <a class="local col7 ref" href="#697palette" title='palette' data-ref="697palette">palette</a>);</td></tr>
<tr><th id="439">439</th><td>    <b>case</b> <var>2</var>:</td></tr>
<tr><th id="440">440</th><td>        <b>return</b> <a class="tu ref" href="#418" title='tight_fill_palette16' data-use='c' data-ref="tight_fill_palette16">tight_fill_palette16</a>(<a class="local col1 ref" href="#691vs" title='vs' data-ref="691vs">vs</a>, <a class="local col2 ref" href="#692x" title='x' data-ref="692x">x</a>, <a class="local col3 ref" href="#693y" title='y' data-ref="693y">y</a>, <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a>, <a class="local col4 ref" href="#694count" title='count' data-ref="694count">count</a>, <a class="local col5 ref" href="#695bg" title='bg' data-ref="695bg">bg</a>, <a class="local col6 ref" href="#696fg" title='fg' data-ref="696fg">fg</a>, <a class="local col7 ref" href="#697palette" title='palette' data-ref="697palette">palette</a>);</td></tr>
<tr><th id="441">441</th><td>    <b>default</b>:</td></tr>
<tr><th id="442">442</th><td>        <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a> = <var>2</var>;</td></tr>
<tr><th id="443">443</th><td>        <b>return</b> <a class="tu ref" href="#417" title='tight_fill_palette8' data-use='c' data-ref="tight_fill_palette8">tight_fill_palette8</a>(<a class="local col1 ref" href="#691vs" title='vs' data-ref="691vs">vs</a>, <a class="local col2 ref" href="#692x" title='x' data-ref="692x">x</a>, <a class="local col3 ref" href="#693y" title='y' data-ref="693y">y</a>, <a class="local col8 ref" href="#698max" title='max' data-ref="698max">max</a>, <a class="local col4 ref" href="#694count" title='count' data-ref="694count">count</a>, <a class="local col5 ref" href="#695bg" title='bg' data-ref="695bg">bg</a>, <a class="local col6 ref" href="#696fg" title='fg' data-ref="696fg">fg</a>, <a class="local col7 ref" href="#697palette" title='palette' data-ref="697palette">palette</a>);</td></tr>
<tr><th id="444">444</th><td>    }</td></tr>
<tr><th id="445">445</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="446">446</th><td>}</td></tr>
<tr><th id="447">447</th><td></td></tr>
<tr><th id="448">448</th><td><i>/*</i></td></tr>
<tr><th id="449">449</th><td><i> * Converting truecolor samples into palette indices.</i></td></tr>
<tr><th id="450">450</th><td><i> */</i></td></tr>
<tr><th id="451">451</th><td><u>#define <dfn class="macro" id="_M/DEFINE_IDX_ENCODE_FUNCTION" data-ref="_M/DEFINE_IDX_ENCODE_FUNCTION">DEFINE_IDX_ENCODE_FUNCTION</dfn>(bpp)                                 \</u></td></tr>
<tr><th id="452">452</th><td><u>                                                                        \</u></td></tr>
<tr><th id="453">453</th><td><u>    static void                                                         \</u></td></tr>
<tr><th id="454">454</th><td><u>    tight_encode_indexed_rect##bpp(<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col9 decl" id="699buf" title='buf' data-type='uint8_t *' data-ref="699buf"><dfn class="local col7 decl" id="707buf" title='buf' data-type='uint8_t *' data-ref="707buf">buf</dfn></dfn>, int <dfn class="local col0 decl" id="700count" title='count' data-type='int' data-ref="700count"><dfn class="local col8 decl" id="708count" title='count' data-type='int' data-ref="708count">count</dfn></dfn>,             \</u></td></tr>
<tr><th id="455">455</th><td><u>                                   <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col1 decl" id="701palette" title='palette' data-type='VncPalette *' data-ref="701palette"><dfn class="local col9 decl" id="709palette" title='palette' data-type='VncPalette *' data-ref="709palette">palette</dfn></dfn>) {               \</u></td></tr>
<tr><th id="456">456</th><td><u>        uint##bpp##_t *<dfn class="local col2 decl" id="702src" title='src' data-type='uint16_t *' data-ref="702src"><dfn class="local col0 decl" id="710src" title='src' data-type='uint32_t *' data-ref="710src">src</dfn></dfn>;                                             \</u></td></tr>
<tr><th id="457">457</th><td><u>        uint##bpp##_t <dfn class="local col3 decl" id="703rgb" title='rgb' data-type='uint16_t' data-ref="703rgb"><dfn class="local col1 decl" id="711rgb" title='rgb' data-type='uint32_t' data-ref="711rgb">rgb</dfn></dfn>;                                              \</u></td></tr>
<tr><th id="458">458</th><td><u>        int <dfn class="local col4 decl" id="704i" title='i' data-type='int' data-ref="704i"><dfn class="local col2 decl" id="712i" title='i' data-type='int' data-ref="712i">i</dfn></dfn>, <dfn class="local col5 decl" id="705rep" title='rep' data-type='int' data-ref="705rep"><dfn class="local col3 decl" id="713rep" title='rep' data-type='int' data-ref="713rep">rep</dfn></dfn>;                                                     \</u></td></tr>
<tr><th id="459">459</th><td><u>        <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> <dfn class="local col6 decl" id="706idx" title='idx' data-type='uint8_t' data-ref="706idx"><dfn class="local col4 decl" id="714idx" title='idx' data-type='uint8_t' data-ref="714idx">idx</dfn></dfn>;                                                    \</u></td></tr>
<tr><th id="460">460</th><td><u>                                                                        \</u></td></tr>
<tr><th id="461">461</th><td><u>        <a class="local col2 ref" href="#486" title='src' data-ref="702src"><a class="local col0 ref" href="#487" title='src' data-ref="710src">src</a></a> = (uint##bpp##_t *) <a class="local col9 ref" href="#486" title='buf' data-ref="699buf"><a class="local col7 ref" href="#487" title='buf' data-ref="707buf">buf</a></a>;                                    \</u></td></tr>
<tr><th id="462">462</th><td><u>                                                                        \</u></td></tr>
<tr><th id="463">463</th><td><u>        for (<a class="local col4 ref" href="#486" title='i' data-ref="704i"><a class="local col2 ref" href="#487" title='i' data-ref="712i">i</a></a> = 0; <a class="local col4 ref" href="#486" title='i' data-ref="704i"><a class="local col2 ref" href="#487" title='i' data-ref="712i">i</a></a> &lt; <a class="local col0 ref" href="#486" title='count' data-ref="700count"><a class="local col8 ref" href="#487" title='count' data-ref="708count">count</a></a>; ) {                                      \</u></td></tr>
<tr><th id="464">464</th><td><u>                                                                        \</u></td></tr>
<tr><th id="465">465</th><td><u>            <a class="local col3 ref" href="#486" title='rgb' data-ref="703rgb"><a class="local col1 ref" href="#487" title='rgb' data-ref="711rgb">rgb</a></a> = *<a class="local col2 ref" href="#486" title='src' data-ref="702src"><a class="local col0 ref" href="#487" title='src' data-ref="710src">src</a></a>++;                                               \</u></td></tr>
<tr><th id="466">466</th><td><u>            <a class="local col4 ref" href="#486" title='i' data-ref="704i"><a class="local col2 ref" href="#487" title='i' data-ref="712i">i</a></a>++;                                                        \</u></td></tr>
<tr><th id="467">467</th><td><u>            <a class="local col5 ref" href="#486" title='rep' data-ref="705rep"><a class="local col3 ref" href="#487" title='rep' data-ref="713rep">rep</a></a> = 0;                                                    \</u></td></tr>
<tr><th id="468">468</th><td><u>            while (<a class="local col4 ref" href="#486" title='i' data-ref="704i"><a class="local col2 ref" href="#487" title='i' data-ref="712i">i</a></a> &lt; <a class="local col0 ref" href="#486" title='count' data-ref="700count"><a class="local col8 ref" href="#487" title='count' data-ref="708count">count</a></a> &amp;&amp; *<a class="local col2 ref" href="#486" title='src' data-ref="702src"><a class="local col0 ref" href="#487" title='src' data-ref="710src">src</a></a> == <a class="local col3 ref" href="#486" title='rgb' data-ref="703rgb"><a class="local col1 ref" href="#487" title='rgb' data-ref="711rgb">rgb</a></a>) {                          \</u></td></tr>
<tr><th id="469">469</th><td><u>                <a class="local col5 ref" href="#486" title='rep' data-ref="705rep"><a class="local col3 ref" href="#487" title='rep' data-ref="713rep">rep</a></a>++, <a class="local col2 ref" href="#486" title='src' data-ref="702src"><a class="local col0 ref" href="#487" title='src' data-ref="710src">src</a></a>++, <a class="local col4 ref" href="#486" title='i' data-ref="704i"><a class="local col2 ref" href="#487" title='i' data-ref="712i">i</a></a>++;                                      \</u></td></tr>
<tr><th id="470">470</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="471">471</th><td><u>            <a class="local col6 ref" href="#486" title='idx' data-ref="706idx"><a class="local col4 ref" href="#487" title='idx' data-ref="714idx">idx</a></a> = <a class="ref" href="vnc-palette.h.html#palette_idx" title='palette_idx' data-ref="palette_idx">palette_idx</a>(<a class="local col1 ref" href="#486" title='palette' data-ref="701palette"><a class="local col9 ref" href="#487" title='palette' data-ref="709palette">palette</a></a>, <a class="local col3 ref" href="#486" title='rgb' data-ref="703rgb"><a class="local col1 ref" href="#487" title='rgb' data-ref="711rgb">rgb</a></a>);                            \</u></td></tr>
<tr><th id="472">472</th><td><u>            /*                                                          \</u></td></tr>
<tr><th id="473">473</th><td><u>             * Should never happen, but don't break everything          \</u></td></tr>
<tr><th id="474">474</th><td><u>             * if it does, use the first color instead                  \</u></td></tr>
<tr><th id="475">475</th><td><u>             */                                                         \</u></td></tr>
<tr><th id="476">476</th><td><u>            if (<a class="local col6 ref" href="#486" title='idx' data-ref="706idx"><a class="local col4 ref" href="#487" title='idx' data-ref="714idx">idx</a></a> == (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a>)-1) {                                   \</u></td></tr>
<tr><th id="477">477</th><td><u>                <a class="local col6 ref" href="#486" title='idx' data-ref="706idx"><a class="local col4 ref" href="#487" title='idx' data-ref="714idx">idx</a></a> = 0;                                                \</u></td></tr>
<tr><th id="478">478</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="479">479</th><td><u>            while (<a class="local col5 ref" href="#486" title='rep' data-ref="705rep"><a class="local col3 ref" href="#487" title='rep' data-ref="713rep">rep</a></a> &gt;= 0) {                                          \</u></td></tr>
<tr><th id="480">480</th><td><u>                *<a class="local col9 ref" href="#486" title='buf' data-ref="699buf"><a class="local col7 ref" href="#487" title='buf' data-ref="707buf">buf</a></a>++ = <a class="local col6 ref" href="#486" title='idx' data-ref="706idx"><a class="local col4 ref" href="#487" title='idx' data-ref="714idx">idx</a></a>;                                           \</u></td></tr>
<tr><th id="481">481</th><td><u>                <a class="local col5 ref" href="#486" title='rep' data-ref="705rep"><a class="local col3 ref" href="#487" title='rep' data-ref="713rep">rep</a></a>--;                                                  \</u></td></tr>
<tr><th id="482">482</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="483">483</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="484">484</th><td><u>    }</u></td></tr>
<tr><th id="485">485</th><td></td></tr>
<tr><th id="486">486</th><td><a class="macro" href="#451" title="static void tight_encode_indexed_rect16(uint8_t *buf, int count, VncPalette *palette) { uint16_t *src; uint16_t rgb; int i, rep; uint8_t idx; src = (uint16_t *) buf; for (i = 0; i &lt; count; ) { rgb = *src++; i++; rep = 0; while (i &lt; count &amp;&amp; *src == rgb) { rep++, src++, i++; } idx = palette_idx(palette, rgb); if (idx == (uint8_t)-1) { idx = 0; } while (rep &gt;= 0) { *buf++ = idx; rep--; } } }" data-ref="_M/DEFINE_IDX_ENCODE_FUNCTION">DEFINE_IDX_ENCODE_FUNCTION</a>(<var>16</var>)</td></tr>
<tr><th id="487">487</th><td><a class="macro" href="#451" title="static void tight_encode_indexed_rect32(uint8_t *buf, int count, VncPalette *palette) { uint32_t *src; uint32_t rgb; int i, rep; uint8_t idx; src = (uint32_t *) buf; for (i = 0; i &lt; count; ) { rgb = *src++; i++; rep = 0; while (i &lt; count &amp;&amp; *src == rgb) { rep++, src++, i++; } idx = palette_idx(palette, rgb); if (idx == (uint8_t)-1) { idx = 0; } while (rep &gt;= 0) { *buf++ = idx; rep--; } } }" data-ref="_M/DEFINE_IDX_ENCODE_FUNCTION">DEFINE_IDX_ENCODE_FUNCTION</a>(<var>32</var>)</td></tr>
<tr><th id="488">488</th><td></td></tr>
<tr><th id="489">489</th><td><u>#define <dfn class="macro" id="_M/DEFINE_MONO_ENCODE_FUNCTION" data-ref="_M/DEFINE_MONO_ENCODE_FUNCTION">DEFINE_MONO_ENCODE_FUNCTION</dfn>(bpp)                                \</u></td></tr>
<tr><th id="490">490</th><td><u>                                                                        \</u></td></tr>
<tr><th id="491">491</th><td><u>    static void                                                         \</u></td></tr>
<tr><th id="492">492</th><td><u>    tight_encode_mono_rect##bpp(<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col5 decl" id="715buf" title='buf' data-type='uint8_t *' data-ref="715buf"><dfn class="local col7 decl" id="727buf" title='buf' data-type='uint8_t *' data-ref="727buf"><dfn class="local col9 decl" id="739buf" title='buf' data-type='uint8_t *' data-ref="739buf">buf</dfn></dfn></dfn>, int <dfn class="local col6 decl" id="716w" title='w' data-type='int' data-ref="716w"><dfn class="local col8 decl" id="728w" title='w' data-type='int' data-ref="728w"><dfn class="local col0 decl" id="740w" title='w' data-type='int' data-ref="740w">w</dfn></dfn></dfn>, int <dfn class="local col7 decl" id="717h" title='h' data-type='int' data-ref="717h"><dfn class="local col9 decl" id="729h" title='h' data-type='int' data-ref="729h"><dfn class="local col1 decl" id="741h" title='h' data-type='int' data-ref="741h">h</dfn></dfn></dfn>,             \</u></td></tr>
<tr><th id="493">493</th><td><u>                                uint##bpp##_t <dfn class="local col8 decl" id="718bg" title='bg' data-type='uint8_t' data-ref="718bg"><dfn class="local col0 decl" id="730bg" title='bg' data-type='uint16_t' data-ref="730bg"><dfn class="local col2 decl" id="742bg" title='bg' data-type='uint32_t' data-ref="742bg">bg</dfn></dfn></dfn>, uint##bpp##_t <dfn class="local col9 decl" id="719fg" title='fg' data-type='uint8_t' data-ref="719fg"><dfn class="local col1 decl" id="731fg" title='fg' data-type='uint16_t' data-ref="731fg"><dfn class="local col3 decl" id="743fg" title='fg' data-type='uint32_t' data-ref="743fg">fg</dfn></dfn></dfn>) {   \</u></td></tr>
<tr><th id="494">494</th><td><u>        uint##bpp##_t *<dfn class="local col0 decl" id="720ptr" title='ptr' data-type='uint8_t *' data-ref="720ptr"><dfn class="local col2 decl" id="732ptr" title='ptr' data-type='uint16_t *' data-ref="732ptr"><dfn class="local col4 decl" id="744ptr" title='ptr' data-type='uint32_t *' data-ref="744ptr">ptr</dfn></dfn></dfn>;                                             \</u></td></tr>
<tr><th id="495">495</th><td><u>        unsigned int <dfn class="local col1 decl" id="721value" title='value' data-type='unsigned int' data-ref="721value"><dfn class="local col3 decl" id="733value" title='value' data-type='unsigned int' data-ref="733value"><dfn class="local col5 decl" id="745value" title='value' data-type='unsigned int' data-ref="745value">value</dfn></dfn></dfn>, <dfn class="local col2 decl" id="722mask" title='mask' data-type='unsigned int' data-ref="722mask"><dfn class="local col4 decl" id="734mask" title='mask' data-type='unsigned int' data-ref="734mask"><dfn class="local col6 decl" id="746mask" title='mask' data-type='unsigned int' data-ref="746mask">mask</dfn></dfn></dfn>;                                       \</u></td></tr>
<tr><th id="496">496</th><td><u>        int <dfn class="local col3 decl" id="723aligned_width" title='aligned_width' data-type='int' data-ref="723aligned_width"><dfn class="local col5 decl" id="735aligned_width" title='aligned_width' data-type='int' data-ref="735aligned_width"><dfn class="local col7 decl" id="747aligned_width" title='aligned_width' data-type='int' data-ref="747aligned_width">aligned_width</dfn></dfn></dfn>;                                              \</u></td></tr>
<tr><th id="497">497</th><td><u>        int <dfn class="local col4 decl" id="724x" title='x' data-type='int' data-ref="724x"><dfn class="local col6 decl" id="736x" title='x' data-type='int' data-ref="736x"><dfn class="local col8 decl" id="748x" title='x' data-type='int' data-ref="748x">x</dfn></dfn></dfn>, <dfn class="local col5 decl" id="725y" title='y' data-type='int' data-ref="725y"><dfn class="local col7 decl" id="737y" title='y' data-type='int' data-ref="737y"><dfn class="local col9 decl" id="749y" title='y' data-type='int' data-ref="749y">y</dfn></dfn></dfn>, <dfn class="local col6 decl" id="726bg_bits" title='bg_bits' data-type='int' data-ref="726bg_bits"><dfn class="local col8 decl" id="738bg_bits" title='bg_bits' data-type='int' data-ref="738bg_bits"><dfn class="local col0 decl" id="750bg_bits" title='bg_bits' data-type='int' data-ref="750bg_bits">bg_bits</dfn></dfn></dfn>;                                              \</u></td></tr>
<tr><th id="498">498</th><td><u>                                                                        \</u></td></tr>
<tr><th id="499">499</th><td><u>        <a class="local col0 ref" href="#540" title='ptr' data-ref="720ptr"><a class="local col2 ref" href="#541" title='ptr' data-ref="732ptr"><a class="local col4 ref" href="#542" title='ptr' data-ref="744ptr">ptr</a></a></a> = (uint##bpp##_t *) <a class="local col5 ref" href="#540" title='buf' data-ref="715buf"><a class="local col7 ref" href="#541" title='buf' data-ref="727buf"><a class="local col9 ref" href="#542" title='buf' data-ref="739buf">buf</a></a></a>;                                    \</u></td></tr>
<tr><th id="500">500</th><td><u>        <a class="local col3 ref" href="#540" title='aligned_width' data-ref="723aligned_width"><a class="local col5 ref" href="#541" title='aligned_width' data-ref="735aligned_width"><a class="local col7 ref" href="#542" title='aligned_width' data-ref="747aligned_width">aligned_width</a></a></a> = <a class="local col6 ref" href="#540" title='w' data-ref="716w"><a class="local col8 ref" href="#541" title='w' data-ref="728w"><a class="local col0 ref" href="#542" title='w' data-ref="740w">w</a></a></a> - <a class="local col6 ref" href="#540" title='w' data-ref="716w"><a class="local col8 ref" href="#541" title='w' data-ref="728w"><a class="local col0 ref" href="#542" title='w' data-ref="740w">w</a></a></a> % 8;                                      \</u></td></tr>
<tr><th id="501">501</th><td><u>                                                                        \</u></td></tr>
<tr><th id="502">502</th><td><u>        for (<a class="local col5 ref" href="#540" title='y' data-ref="725y"><a class="local col7 ref" href="#541" title='y' data-ref="737y"><a class="local col9 ref" href="#542" title='y' data-ref="749y">y</a></a></a> = 0; <a class="local col5 ref" href="#540" title='y' data-ref="725y"><a class="local col7 ref" href="#541" title='y' data-ref="737y"><a class="local col9 ref" href="#542" title='y' data-ref="749y">y</a></a></a> &lt; <a class="local col7 ref" href="#540" title='h' data-ref="717h"><a class="local col9 ref" href="#541" title='h' data-ref="729h"><a class="local col1 ref" href="#542" title='h' data-ref="741h">h</a></a></a>; <a class="local col5 ref" href="#540" title='y' data-ref="725y"><a class="local col7 ref" href="#541" title='y' data-ref="737y"><a class="local col9 ref" href="#542" title='y' data-ref="749y">y</a></a></a>++) {                                       \</u></td></tr>
<tr><th id="503">503</th><td><u>            for (<a class="local col4 ref" href="#540" title='x' data-ref="724x"><a class="local col6 ref" href="#541" title='x' data-ref="736x"><a class="local col8 ref" href="#542" title='x' data-ref="748x">x</a></a></a> = 0; <a class="local col4 ref" href="#540" title='x' data-ref="724x"><a class="local col6 ref" href="#541" title='x' data-ref="736x"><a class="local col8 ref" href="#542" title='x' data-ref="748x">x</a></a></a> &lt; <a class="local col3 ref" href="#540" title='aligned_width' data-ref="723aligned_width"><a class="local col5 ref" href="#541" title='aligned_width' data-ref="735aligned_width"><a class="local col7 ref" href="#542" title='aligned_width' data-ref="747aligned_width">aligned_width</a></a></a>; <a class="local col4 ref" href="#540" title='x' data-ref="724x"><a class="local col6 ref" href="#541" title='x' data-ref="736x"><a class="local col8 ref" href="#542" title='x' data-ref="748x">x</a></a></a> += 8) {                    \</u></td></tr>
<tr><th id="504">504</th><td><u>                for (<a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a> = 0; <a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a> &lt; 8; <a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a>++) {             \</u></td></tr>
<tr><th id="505">505</th><td><u>                    if (*<a class="local col0 ref" href="#540" title='ptr' data-ref="720ptr"><a class="local col2 ref" href="#541" title='ptr' data-ref="732ptr"><a class="local col4 ref" href="#542" title='ptr' data-ref="744ptr">ptr</a></a></a>++ != <a class="local col8 ref" href="#540" title='bg' data-ref="718bg"><a class="local col0 ref" href="#541" title='bg' data-ref="730bg"><a class="local col2 ref" href="#542" title='bg' data-ref="742bg">bg</a></a></a>) {                                 \</u></td></tr>
<tr><th id="506">506</th><td><u>                        break;                                          \</u></td></tr>
<tr><th id="507">507</th><td><u>                    }                                                   \</u></td></tr>
<tr><th id="508">508</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="509">509</th><td><u>                if (<a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a> == 8) {                                     \</u></td></tr>
<tr><th id="510">510</th><td><u>                    *<a class="local col5 ref" href="#540" title='buf' data-ref="715buf"><a class="local col7 ref" href="#541" title='buf' data-ref="727buf"><a class="local col9 ref" href="#542" title='buf' data-ref="739buf">buf</a></a></a>++ = 0;                                         \</u></td></tr>
<tr><th id="511">511</th><td><u>                    continue;                                           \</u></td></tr>
<tr><th id="512">512</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="513">513</th><td><u>                <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a> = 0x80 &gt;&gt; <a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a>;                                 \</u></td></tr>
<tr><th id="514">514</th><td><u>                <a class="local col1 ref" href="#540" title='value' data-ref="721value"><a class="local col3 ref" href="#541" title='value' data-ref="733value"><a class="local col5 ref" href="#542" title='value' data-ref="745value">value</a></a></a> = <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a>;                                           \</u></td></tr>
<tr><th id="515">515</th><td><u>                for (<a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a>++; <a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a> &lt; 8; <a class="local col6 ref" href="#540" title='bg_bits' data-ref="726bg_bits"><a class="local col8 ref" href="#541" title='bg_bits' data-ref="738bg_bits"><a class="local col0 ref" href="#542" title='bg_bits' data-ref="750bg_bits">bg_bits</a></a></a>++) {               \</u></td></tr>
<tr><th id="516">516</th><td><u>                    <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a> &gt;&gt;= 1;                                         \</u></td></tr>
<tr><th id="517">517</th><td><u>                    if (*<a class="local col0 ref" href="#540" title='ptr' data-ref="720ptr"><a class="local col2 ref" href="#541" title='ptr' data-ref="732ptr"><a class="local col4 ref" href="#542" title='ptr' data-ref="744ptr">ptr</a></a></a>++ != <a class="local col8 ref" href="#540" title='bg' data-ref="718bg"><a class="local col0 ref" href="#541" title='bg' data-ref="730bg"><a class="local col2 ref" href="#542" title='bg' data-ref="742bg">bg</a></a></a>) {                                 \</u></td></tr>
<tr><th id="518">518</th><td><u>                        <a class="local col1 ref" href="#540" title='value' data-ref="721value"><a class="local col3 ref" href="#541" title='value' data-ref="733value"><a class="local col5 ref" href="#542" title='value' data-ref="745value">value</a></a></a> |= <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a>;                                  \</u></td></tr>
<tr><th id="519">519</th><td><u>                    }                                                   \</u></td></tr>
<tr><th id="520">520</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="521">521</th><td><u>                *<a class="local col5 ref" href="#540" title='buf' data-ref="715buf"><a class="local col7 ref" href="#541" title='buf' data-ref="727buf"><a class="local col9 ref" href="#542" title='buf' data-ref="739buf">buf</a></a></a>++ = (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a>)<a class="local col1 ref" href="#540" title='value' data-ref="721value"><a class="local col3 ref" href="#541" title='value' data-ref="733value"><a class="local col5 ref" href="#542" title='value' data-ref="745value">value</a></a></a>;                                \</u></td></tr>
<tr><th id="522">522</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="523">523</th><td><u>                                                                        \</u></td></tr>
<tr><th id="524">524</th><td><u>            <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a> = 0x80;                                                \</u></td></tr>
<tr><th id="525">525</th><td><u>            <a class="local col1 ref" href="#540" title='value' data-ref="721value"><a class="local col3 ref" href="#541" title='value' data-ref="733value"><a class="local col5 ref" href="#542" title='value' data-ref="745value">value</a></a></a> = 0;                                                  \</u></td></tr>
<tr><th id="526">526</th><td><u>            if (<a class="local col4 ref" href="#540" title='x' data-ref="724x"><a class="local col6 ref" href="#541" title='x' data-ref="736x"><a class="local col8 ref" href="#542" title='x' data-ref="748x">x</a></a></a> &gt;= <a class="local col6 ref" href="#540" title='w' data-ref="716w"><a class="local col8 ref" href="#541" title='w' data-ref="728w"><a class="local col0 ref" href="#542" title='w' data-ref="740w">w</a></a></a>) {                                               \</u></td></tr>
<tr><th id="527">527</th><td><u>                continue;                                               \</u></td></tr>
<tr><th id="528">528</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="529">529</th><td><u>                                                                        \</u></td></tr>
<tr><th id="530">530</th><td><u>            for (; <a class="local col4 ref" href="#540" title='x' data-ref="724x"><a class="local col6 ref" href="#541" title='x' data-ref="736x"><a class="local col8 ref" href="#542" title='x' data-ref="748x">x</a></a></a> &lt; <a class="local col6 ref" href="#540" title='w' data-ref="716w"><a class="local col8 ref" href="#541" title='w' data-ref="728w"><a class="local col0 ref" href="#542" title='w' data-ref="740w">w</a></a></a>; <a class="local col4 ref" href="#540" title='x' data-ref="724x"><a class="local col6 ref" href="#541" title='x' data-ref="736x"><a class="local col8 ref" href="#542" title='x' data-ref="748x">x</a></a></a>++) {                                        \</u></td></tr>
<tr><th id="531">531</th><td><u>                if (*<a class="local col0 ref" href="#540" title='ptr' data-ref="720ptr"><a class="local col2 ref" href="#541" title='ptr' data-ref="732ptr"><a class="local col4 ref" href="#542" title='ptr' data-ref="744ptr">ptr</a></a></a>++ != <a class="local col8 ref" href="#540" title='bg' data-ref="718bg"><a class="local col0 ref" href="#541" title='bg' data-ref="730bg"><a class="local col2 ref" href="#542" title='bg' data-ref="742bg">bg</a></a></a>) {                                     \</u></td></tr>
<tr><th id="532">532</th><td><u>                    <a class="local col1 ref" href="#540" title='value' data-ref="721value"><a class="local col3 ref" href="#541" title='value' data-ref="733value"><a class="local col5 ref" href="#542" title='value' data-ref="745value">value</a></a></a> |= <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a>;                                      \</u></td></tr>
<tr><th id="533">533</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="534">534</th><td><u>                <a class="local col2 ref" href="#540" title='mask' data-ref="722mask"><a class="local col4 ref" href="#541" title='mask' data-ref="734mask"><a class="local col6 ref" href="#542" title='mask' data-ref="746mask">mask</a></a></a> &gt;&gt;= 1;                                             \</u></td></tr>
<tr><th id="535">535</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="536">536</th><td><u>            *<a class="local col5 ref" href="#540" title='buf' data-ref="715buf"><a class="local col7 ref" href="#541" title='buf' data-ref="727buf"><a class="local col9 ref" href="#542" title='buf' data-ref="739buf">buf</a></a></a>++ = (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a>)<a class="local col1 ref" href="#540" title='value' data-ref="721value"><a class="local col3 ref" href="#541" title='value' data-ref="733value"><a class="local col5 ref" href="#542" title='value' data-ref="745value">value</a></a></a>;                                    \</u></td></tr>
<tr><th id="537">537</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="538">538</th><td><u>    }</u></td></tr>
<tr><th id="539">539</th><td></td></tr>
<tr><th id="540">540</th><td><a class="macro" href="#489" title="static void tight_encode_mono_rect8(uint8_t *buf, int w, int h, uint8_t bg, uint8_t fg) { uint8_t *ptr; unsigned int value, mask; int aligned_width; int x, y, bg_bits; ptr = (uint8_t *) buf; aligned_width = w - w % 8; for (y = 0; y &lt; h; y++) { for (x = 0; x &lt; aligned_width; x += 8) { for (bg_bits = 0; bg_bits &lt; 8; bg_bits++) { if (*ptr++ != bg) { break; } } if (bg_bits == 8) { *buf++ = 0; continue; } mask = 0x80 &gt;&gt; bg_bits; value = mask; for (bg_bits++; bg_bits &lt; 8; bg_bits++) { mask &gt;&gt;= 1; if (*ptr++ != bg) { value |= mask; } } *buf++ = (uint8_t)value; } mask = 0x80; value = 0; if (x &gt;= w) { continue; } for (; x &lt; w; x++) { if (*ptr++ != bg) { value |= mask; } mask &gt;&gt;= 1; } *buf++ = (uint8_t)value; } }" data-ref="_M/DEFINE_MONO_ENCODE_FUNCTION">DEFINE_MONO_ENCODE_FUNCTION</a>(<var>8</var>)</td></tr>
<tr><th id="541">541</th><td><a class="macro" href="#489" title="static void tight_encode_mono_rect16(uint8_t *buf, int w, int h, uint16_t bg, uint16_t fg) { uint16_t *ptr; unsigned int value, mask; int aligned_width; int x, y, bg_bits; ptr = (uint16_t *) buf; aligned_width = w - w % 8; for (y = 0; y &lt; h; y++) { for (x = 0; x &lt; aligned_width; x += 8) { for (bg_bits = 0; bg_bits &lt; 8; bg_bits++) { if (*ptr++ != bg) { break; } } if (bg_bits == 8) { *buf++ = 0; continue; } mask = 0x80 &gt;&gt; bg_bits; value = mask; for (bg_bits++; bg_bits &lt; 8; bg_bits++) { mask &gt;&gt;= 1; if (*ptr++ != bg) { value |= mask; } } *buf++ = (uint8_t)value; } mask = 0x80; value = 0; if (x &gt;= w) { continue; } for (; x &lt; w; x++) { if (*ptr++ != bg) { value |= mask; } mask &gt;&gt;= 1; } *buf++ = (uint8_t)value; } }" data-ref="_M/DEFINE_MONO_ENCODE_FUNCTION">DEFINE_MONO_ENCODE_FUNCTION</a>(<var>16</var>)</td></tr>
<tr><th id="542">542</th><td><a class="macro" href="#489" title="static void tight_encode_mono_rect32(uint8_t *buf, int w, int h, uint32_t bg, uint32_t fg) { uint32_t *ptr; unsigned int value, mask; int aligned_width; int x, y, bg_bits; ptr = (uint32_t *) buf; aligned_width = w - w % 8; for (y = 0; y &lt; h; y++) { for (x = 0; x &lt; aligned_width; x += 8) { for (bg_bits = 0; bg_bits &lt; 8; bg_bits++) { if (*ptr++ != bg) { break; } } if (bg_bits == 8) { *buf++ = 0; continue; } mask = 0x80 &gt;&gt; bg_bits; value = mask; for (bg_bits++; bg_bits &lt; 8; bg_bits++) { mask &gt;&gt;= 1; if (*ptr++ != bg) { value |= mask; } } *buf++ = (uint8_t)value; } mask = 0x80; value = 0; if (x &gt;= w) { continue; } for (; x &lt; w; x++) { if (*ptr++ != bg) { value |= mask; } mask &gt;&gt;= 1; } *buf++ = (uint8_t)value; } }" data-ref="_M/DEFINE_MONO_ENCODE_FUNCTION">DEFINE_MONO_ENCODE_FUNCTION</a>(<var>32</var>)</td></tr>
<tr><th id="543">543</th><td></td></tr>
<tr><th id="544">544</th><td><i  data-doc="tight_filter_gradient24">/*</i></td></tr>
<tr><th id="545">545</th><td><i  data-doc="tight_filter_gradient24"> * ``Gradient'' filter for 24-bit color samples.</i></td></tr>
<tr><th id="546">546</th><td><i  data-doc="tight_filter_gradient24"> * Should be called only when redMax, greenMax and blueMax are 255.</i></td></tr>
<tr><th id="547">547</th><td><i  data-doc="tight_filter_gradient24"> * Color components assumed to be byte-aligned.</i></td></tr>
<tr><th id="548">548</th><td><i  data-doc="tight_filter_gradient24"> */</i></td></tr>
<tr><th id="549">549</th><td></td></tr>
<tr><th id="550">550</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="551">551</th><td><dfn class="tu decl def" id="tight_filter_gradient24" title='tight_filter_gradient24' data-type='void tight_filter_gradient24(VncState * vs, uint8_t * buf, int w, int h)' data-ref="tight_filter_gradient24">tight_filter_gradient24</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col1 decl" id="751vs" title='vs' data-type='VncState *' data-ref="751vs">vs</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col2 decl" id="752buf" title='buf' data-type='uint8_t *' data-ref="752buf">buf</dfn>, <em>int</em> <dfn class="local col3 decl" id="753w" title='w' data-type='int' data-ref="753w">w</dfn>, <em>int</em> <dfn class="local col4 decl" id="754h" title='h' data-type='int' data-ref="754h">h</dfn>)</td></tr>
<tr><th id="552">552</th><td>{</td></tr>
<tr><th id="553">553</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col5 decl" id="755buf32" title='buf32' data-type='uint32_t *' data-ref="755buf32">buf32</dfn>;</td></tr>
<tr><th id="554">554</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="756pix32" title='pix32' data-type='uint32_t' data-ref="756pix32">pix32</dfn>;</td></tr>
<tr><th id="555">555</th><td>    <em>int</em> <dfn class="local col7 decl" id="757shift" title='shift' data-type='int [3]' data-ref="757shift">shift</dfn>[<var>3</var>];</td></tr>
<tr><th id="556">556</th><td>    <em>int</em> *<dfn class="local col8 decl" id="758prev" title='prev' data-type='int *' data-ref="758prev">prev</dfn>;</td></tr>
<tr><th id="557">557</th><td>    <em>int</em> <dfn class="local col9 decl" id="759here" title='here' data-type='int [3]' data-ref="759here">here</dfn>[<var>3</var>], <dfn class="local col0 decl" id="760upper" title='upper' data-type='int [3]' data-ref="760upper">upper</dfn>[<var>3</var>], <dfn class="local col1 decl" id="761left" title='left' data-type='int [3]' data-ref="761left">left</dfn>[<var>3</var>], <dfn class="local col2 decl" id="762upperleft" title='upperleft' data-type='int [3]' data-ref="762upperleft">upperleft</dfn>[<var>3</var>];</td></tr>
<tr><th id="558">558</th><td>    <em>int</em> <dfn class="local col3 decl" id="763prediction" title='prediction' data-type='int' data-ref="763prediction">prediction</dfn>;</td></tr>
<tr><th id="559">559</th><td>    <em>int</em> <dfn class="local col4 decl" id="764x" title='x' data-type='int' data-ref="764x">x</dfn>, <dfn class="local col5 decl" id="765y" title='y' data-type='int' data-ref="765y">y</dfn>, <dfn class="local col6 decl" id="766c" title='c' data-type='int' data-ref="766c">c</dfn>;</td></tr>
<tr><th id="560">560</th><td></td></tr>
<tr><th id="561">561</th><td>    <a class="local col5 ref" href="#755buf32" title='buf32' data-ref="755buf32">buf32</a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *)<a class="local col2 ref" href="#752buf" title='buf' data-ref="752buf">buf</a>;</td></tr>
<tr><th id="562">562</th><td>    <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <var>0</var>, <a class="local col3 ref" href="#753w" title='w' data-ref="753w">w</a> * <var>3</var> * <b>sizeof</b>(<em>int</em>));</td></tr>
<tr><th id="563">563</th><td></td></tr>
<tr><th id="564">564</th><td>    <b>if</b> (<var>1</var> <i>/* FIXME */</i>) {</td></tr>
<tr><th id="565">565</th><td>        <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<var>0</var>] = <a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>;</td></tr>
<tr><th id="566">566</th><td>        <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<var>1</var>] = <a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>;</td></tr>
<tr><th id="567">567</th><td>        <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<var>2</var>] = <a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>;</td></tr>
<tr><th id="568">568</th><td>    } <b>else</b> {</td></tr>
<tr><th id="569">569</th><td>        <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<var>0</var>] = <var>24</var> - <a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>;</td></tr>
<tr><th id="570">570</th><td>        <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<var>1</var>] = <var>24</var> - <a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>;</td></tr>
<tr><th id="571">571</th><td>        <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<var>2</var>] = <var>24</var> - <a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>;</td></tr>
<tr><th id="572">572</th><td>    }</td></tr>
<tr><th id="573">573</th><td></td></tr>
<tr><th id="574">574</th><td>    <b>for</b> (<a class="local col5 ref" href="#765y" title='y' data-ref="765y">y</a> = <var>0</var>; <a class="local col5 ref" href="#765y" title='y' data-ref="765y">y</a> &lt; <a class="local col4 ref" href="#754h" title='h' data-ref="754h">h</a>; <a class="local col5 ref" href="#765y" title='y' data-ref="765y">y</a>++) {</td></tr>
<tr><th id="575">575</th><td>        <b>for</b> (<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a> = <var>0</var>; <a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a> &lt; <var>3</var>; <a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>++) {</td></tr>
<tr><th id="576">576</th><td>            <a class="local col0 ref" href="#760upper" title='upper' data-ref="760upper">upper</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] = <var>0</var>;</td></tr>
<tr><th id="577">577</th><td>            <a class="local col9 ref" href="#759here" title='here' data-ref="759here">here</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] = <var>0</var>;</td></tr>
<tr><th id="578">578</th><td>        }</td></tr>
<tr><th id="579">579</th><td>        <a class="local col8 ref" href="#758prev" title='prev' data-ref="758prev">prev</a> = (<em>int</em> *)<a class="local col1 ref" href="#751vs" title='vs' data-ref="751vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>;</td></tr>
<tr><th id="580">580</th><td>        <b>for</b> (<a class="local col4 ref" href="#764x" title='x' data-ref="764x">x</a> = <var>0</var>; <a class="local col4 ref" href="#764x" title='x' data-ref="764x">x</a> &lt; <a class="local col3 ref" href="#753w" title='w' data-ref="753w">w</a>; <a class="local col4 ref" href="#764x" title='x' data-ref="764x">x</a>++) {</td></tr>
<tr><th id="581">581</th><td>            <a class="local col6 ref" href="#756pix32" title='pix32' data-ref="756pix32">pix32</a> = *<a class="local col5 ref" href="#755buf32" title='buf32' data-ref="755buf32">buf32</a>++;</td></tr>
<tr><th id="582">582</th><td>            <b>for</b> (<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a> = <var>0</var>; <a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a> &lt; <var>3</var>; <a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>++) {</td></tr>
<tr><th id="583">583</th><td>                <a class="local col2 ref" href="#762upperleft" title='upperleft' data-ref="762upperleft">upperleft</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] = <a class="local col0 ref" href="#760upper" title='upper' data-ref="760upper">upper</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>];</td></tr>
<tr><th id="584">584</th><td>                <a class="local col1 ref" href="#761left" title='left' data-ref="761left">left</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] = <a class="local col9 ref" href="#759here" title='here' data-ref="759here">here</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>];</td></tr>
<tr><th id="585">585</th><td>                <a class="local col0 ref" href="#760upper" title='upper' data-ref="760upper">upper</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] = *<a class="local col8 ref" href="#758prev" title='prev' data-ref="758prev">prev</a>;</td></tr>
<tr><th id="586">586</th><td>                <a class="local col9 ref" href="#759here" title='here' data-ref="759here">here</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] = (<em>int</em>)(<a class="local col6 ref" href="#756pix32" title='pix32' data-ref="756pix32">pix32</a> &gt;&gt; <a class="local col7 ref" href="#757shift" title='shift' data-ref="757shift">shift</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] &amp; <var>0xFF</var>);</td></tr>
<tr><th id="587">587</th><td>                *<a class="local col8 ref" href="#758prev" title='prev' data-ref="758prev">prev</a>++ = <a class="local col9 ref" href="#759here" title='here' data-ref="759here">here</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>];</td></tr>
<tr><th id="588">588</th><td></td></tr>
<tr><th id="589">589</th><td>                <a class="local col3 ref" href="#763prediction" title='prediction' data-ref="763prediction">prediction</a> = <a class="local col1 ref" href="#761left" title='left' data-ref="761left">left</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] + <a class="local col0 ref" href="#760upper" title='upper' data-ref="760upper">upper</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] - <a class="local col2 ref" href="#762upperleft" title='upperleft' data-ref="762upperleft">upperleft</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>];</td></tr>
<tr><th id="590">590</th><td>                <b>if</b> (<a class="local col3 ref" href="#763prediction" title='prediction' data-ref="763prediction">prediction</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="591">591</th><td>                    <a class="local col3 ref" href="#763prediction" title='prediction' data-ref="763prediction">prediction</a> = <var>0</var>;</td></tr>
<tr><th id="592">592</th><td>                } <b>else</b> <b>if</b> (<a class="local col3 ref" href="#763prediction" title='prediction' data-ref="763prediction">prediction</a> &gt; <var>0xFF</var>) {</td></tr>
<tr><th id="593">593</th><td>                    <a class="local col3 ref" href="#763prediction" title='prediction' data-ref="763prediction">prediction</a> = <var>0xFF</var>;</td></tr>
<tr><th id="594">594</th><td>                }</td></tr>
<tr><th id="595">595</th><td>                *<a class="local col2 ref" href="#752buf" title='buf' data-ref="752buf">buf</a>++ = (<em>char</em>)(<a class="local col9 ref" href="#759here" title='here' data-ref="759here">here</a>[<a class="local col6 ref" href="#766c" title='c' data-ref="766c">c</a>] - <a class="local col3 ref" href="#763prediction" title='prediction' data-ref="763prediction">prediction</a>);</td></tr>
<tr><th id="596">596</th><td>            }</td></tr>
<tr><th id="597">597</th><td>        }</td></tr>
<tr><th id="598">598</th><td>    }</td></tr>
<tr><th id="599">599</th><td>}</td></tr>
<tr><th id="600">600</th><td></td></tr>
<tr><th id="601">601</th><td></td></tr>
<tr><th id="602">602</th><td><i>/*</i></td></tr>
<tr><th id="603">603</th><td><i> * ``Gradient'' filter for other color depths.</i></td></tr>
<tr><th id="604">604</th><td><i> */</i></td></tr>
<tr><th id="605">605</th><td></td></tr>
<tr><th id="606">606</th><td><u>#define <dfn class="macro" id="_M/DEFINE_GRADIENT_FILTER_FUNCTION" data-ref="_M/DEFINE_GRADIENT_FILTER_FUNCTION">DEFINE_GRADIENT_FILTER_FUNCTION</dfn>(bpp)                            \</u></td></tr>
<tr><th id="607">607</th><td><u>                                                                        \</u></td></tr>
<tr><th id="608">608</th><td><u>    static void                                                         \</u></td></tr>
<tr><th id="609">609</th><td><u>    tight_filter_gradient##bpp(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col7 decl" id="767vs" title='vs' data-type='VncState *' data-ref="767vs"><dfn class="local col5 decl" id="785vs" title='vs' data-type='VncState *' data-ref="785vs">vs</dfn></dfn>, uint##bpp##_t *<dfn class="local col8 decl" id="768buf" title='buf' data-type='uint16_t *' data-ref="768buf"><dfn class="local col6 decl" id="786buf" title='buf' data-type='uint32_t *' data-ref="786buf">buf</dfn></dfn>,        \</u></td></tr>
<tr><th id="610">610</th><td><u>                               int <dfn class="local col9 decl" id="769w" title='w' data-type='int' data-ref="769w"><dfn class="local col7 decl" id="787w" title='w' data-type='int' data-ref="787w">w</dfn></dfn>, int <dfn class="local col0 decl" id="770h" title='h' data-type='int' data-ref="770h"><dfn class="local col8 decl" id="788h" title='h' data-type='int' data-ref="788h">h</dfn></dfn>) {                          \</u></td></tr>
<tr><th id="611">611</th><td><u>        uint##bpp##_t <dfn class="local col1 decl" id="771pix" title='pix' data-type='uint16_t' data-ref="771pix"><dfn class="local col9 decl" id="789pix" title='pix' data-type='uint32_t' data-ref="789pix">pix</dfn></dfn>, <dfn class="local col2 decl" id="772diff" title='diff' data-type='uint16_t' data-ref="772diff"><dfn class="local col0 decl" id="790diff" title='diff' data-type='uint32_t' data-ref="790diff">diff</dfn></dfn>;                                        \</u></td></tr>
<tr><th id="612">612</th><td><u>        bool <dfn class="local col3 decl" id="773endian" title='endian' data-type='_Bool' data-ref="773endian"><dfn class="local col1 decl" id="791endian" title='endian' data-type='_Bool' data-ref="791endian">endian</dfn></dfn>;                                                    \</u></td></tr>
<tr><th id="613">613</th><td><u>        int *<dfn class="local col4 decl" id="774prev" title='prev' data-type='int *' data-ref="774prev"><dfn class="local col2 decl" id="792prev" title='prev' data-type='int *' data-ref="792prev">prev</dfn></dfn>;                                                      \</u></td></tr>
<tr><th id="614">614</th><td><u>        int <dfn class="local col5 decl" id="775max" title='max' data-type='int [3]' data-ref="775max"><dfn class="local col3 decl" id="793max" title='max' data-type='int [3]' data-ref="793max">max</dfn></dfn>[3], <dfn class="local col6 decl" id="776shift" title='shift' data-type='int [3]' data-ref="776shift"><dfn class="local col4 decl" id="794shift" title='shift' data-type='int [3]' data-ref="794shift">shift</dfn></dfn>[3];                                           \</u></td></tr>
<tr><th id="615">615</th><td><u>        int <dfn class="local col7 decl" id="777here" title='here' data-type='int [3]' data-ref="777here"><dfn class="local col5 decl" id="795here" title='here' data-type='int [3]' data-ref="795here">here</dfn></dfn>[3], <dfn class="local col8 decl" id="778upper" title='upper' data-type='int [3]' data-ref="778upper"><dfn class="local col6 decl" id="796upper" title='upper' data-type='int [3]' data-ref="796upper">upper</dfn></dfn>[3], <dfn class="local col9 decl" id="779left" title='left' data-type='int [3]' data-ref="779left"><dfn class="local col7 decl" id="797left" title='left' data-type='int [3]' data-ref="797left">left</dfn></dfn>[3], <dfn class="local col0 decl" id="780upperleft" title='upperleft' data-type='int [3]' data-ref="780upperleft"><dfn class="local col8 decl" id="798upperleft" title='upperleft' data-type='int [3]' data-ref="798upperleft">upperleft</dfn></dfn>[3];                   \</u></td></tr>
<tr><th id="616">616</th><td><u>        int <dfn class="local col1 decl" id="781prediction" title='prediction' data-type='int' data-ref="781prediction"><dfn class="local col9 decl" id="799prediction" title='prediction' data-type='int' data-ref="799prediction">prediction</dfn></dfn>;                                                 \</u></td></tr>
<tr><th id="617">617</th><td><u>        int <dfn class="local col2 decl" id="782x" title='x' data-type='int' data-ref="782x"><dfn class="local col0 decl" id="800x" title='x' data-type='int' data-ref="800x">x</dfn></dfn>, <dfn class="local col3 decl" id="783y" title='y' data-type='int' data-ref="783y"><dfn class="local col1 decl" id="801y" title='y' data-type='int' data-ref="801y">y</dfn></dfn>, <dfn class="local col4 decl" id="784c" title='c' data-type='int' data-ref="784c"><dfn class="local col2 decl" id="802c" title='c' data-type='int' data-ref="802c">c</dfn></dfn>;                                                    \</u></td></tr>
<tr><th id="618">618</th><td><u>                                                                        \</u></td></tr>
<tr><th id="619">619</th><td><u>        <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a> (<a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, 0, <a class="local col9 ref" href="#666" title='w' data-ref="769w"><a class="local col7 ref" href="#667" title='w' data-ref="787w">w</a></a> * 3 * sizeof(int));     \</u></td></tr>
<tr><th id="620">620</th><td><u>                                                                        \</u></td></tr>
<tr><th id="621">621</th><td><u>        <a class="local col3 ref" href="#666" title='endian' data-ref="773endian"><a class="local col1 ref" href="#667" title='endian' data-ref="791endian">endian</a></a> = 0; /* FIXME */                                         \</u></td></tr>
<tr><th id="622">622</th><td><u>                                                                        \</u></td></tr>
<tr><th id="623">623</th><td><u>        <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[0] = <a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a>;                                    \</u></td></tr>
<tr><th id="624">624</th><td><u>        <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[1] = <a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a>;                                    \</u></td></tr>
<tr><th id="625">625</th><td><u>        <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[2] = <a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a>;                                    \</u></td></tr>
<tr><th id="626">626</th><td><u>        <a class="local col6 ref" href="#666" title='shift' data-ref="776shift"><a class="local col4 ref" href="#667" title='shift' data-ref="794shift">shift</a></a>[0] = <a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>;                                \</u></td></tr>
<tr><th id="627">627</th><td><u>        <a class="local col6 ref" href="#666" title='shift' data-ref="776shift"><a class="local col4 ref" href="#667" title='shift' data-ref="794shift">shift</a></a>[1] = <a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>;                                \</u></td></tr>
<tr><th id="628">628</th><td><u>        <a class="local col6 ref" href="#666" title='shift' data-ref="776shift"><a class="local col4 ref" href="#667" title='shift' data-ref="794shift">shift</a></a>[2] = <a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>;                                \</u></td></tr>
<tr><th id="629">629</th><td><u>                                                                        \</u></td></tr>
<tr><th id="630">630</th><td><u>        for (<a class="local col3 ref" href="#666" title='y' data-ref="783y"><a class="local col1 ref" href="#667" title='y' data-ref="801y">y</a></a> = 0; <a class="local col3 ref" href="#666" title='y' data-ref="783y"><a class="local col1 ref" href="#667" title='y' data-ref="801y">y</a></a> &lt; <a class="local col0 ref" href="#666" title='h' data-ref="770h"><a class="local col8 ref" href="#667" title='h' data-ref="788h">h</a></a>; <a class="local col3 ref" href="#666" title='y' data-ref="783y"><a class="local col1 ref" href="#667" title='y' data-ref="801y">y</a></a>++) {                                       \</u></td></tr>
<tr><th id="631">631</th><td><u>            for (<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a> = 0; <a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a> &lt; 3; <a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>++) {                                   \</u></td></tr>
<tr><th id="632">632</th><td><u>                <a class="local col8 ref" href="#666" title='upper' data-ref="778upper"><a class="local col6 ref" href="#667" title='upper' data-ref="796upper">upper</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] = 0;                                           \</u></td></tr>
<tr><th id="633">633</th><td><u>                <a class="local col7 ref" href="#666" title='here' data-ref="777here"><a class="local col5 ref" href="#667" title='here' data-ref="795here">here</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] = 0;                                            \</u></td></tr>
<tr><th id="634">634</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="635">635</th><td><u>            <a class="local col4 ref" href="#666" title='prev' data-ref="774prev"><a class="local col2 ref" href="#667" title='prev' data-ref="792prev">prev</a></a> = (int *)<a class="local col7 ref" href="#666" title='vs' data-ref="767vs"><a class="local col5 ref" href="#667" title='vs' data-ref="785vs">vs</a></a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>;                    \</u></td></tr>
<tr><th id="636">636</th><td><u>            for (<a class="local col2 ref" href="#666" title='x' data-ref="782x"><a class="local col0 ref" href="#667" title='x' data-ref="800x">x</a></a> = 0; <a class="local col2 ref" href="#666" title='x' data-ref="782x"><a class="local col0 ref" href="#667" title='x' data-ref="800x">x</a></a> &lt; <a class="local col9 ref" href="#666" title='w' data-ref="769w"><a class="local col7 ref" href="#667" title='w' data-ref="787w">w</a></a>; <a class="local col2 ref" href="#666" title='x' data-ref="782x"><a class="local col0 ref" href="#667" title='x' data-ref="800x">x</a></a>++) {                                   \</u></td></tr>
<tr><th id="637">637</th><td><u>                <a class="local col1 ref" href="#666" title='pix' data-ref="771pix"><a class="local col9 ref" href="#667" title='pix' data-ref="789pix">pix</a></a> = *<a class="local col8 ref" href="#666" title='buf' data-ref="768buf"><a class="local col6 ref" href="#667" title='buf' data-ref="786buf">buf</a></a>;                                             \</u></td></tr>
<tr><th id="638">638</th><td><u>                if (<a class="local col3 ref" href="#666" title='endian' data-ref="773endian"><a class="local col1 ref" href="#667" title='endian' data-ref="791endian">endian</a></a>) {                                           \</u></td></tr>
<tr><th id="639">639</th><td><u>                    <a class="local col1 ref" href="#666" title='pix' data-ref="771pix"><a class="local col9 ref" href="#667" title='pix' data-ref="789pix">pix</a></a> = bswap##bpp(<a class="local col1 ref" href="#666" title='pix' data-ref="771pix"><a class="local col9 ref" href="#667" title='pix' data-ref="789pix">pix</a></a>);                              \</u></td></tr>
<tr><th id="640">640</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="641">641</th><td><u>                <a class="local col2 ref" href="#666" title='diff' data-ref="772diff"><a class="local col0 ref" href="#667" title='diff' data-ref="790diff">diff</a></a> = 0;                                               \</u></td></tr>
<tr><th id="642">642</th><td><u>                for (<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a> = 0; <a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a> &lt; 3; <a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>++) {                               \</u></td></tr>
<tr><th id="643">643</th><td><u>                    <a class="local col0 ref" href="#666" title='upperleft' data-ref="780upperleft"><a class="local col8 ref" href="#667" title='upperleft' data-ref="798upperleft">upperleft</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] = <a class="local col8 ref" href="#666" title='upper' data-ref="778upper"><a class="local col6 ref" href="#667" title='upper' data-ref="796upper">upper</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>];                            \</u></td></tr>
<tr><th id="644">644</th><td><u>                    <a class="local col9 ref" href="#666" title='left' data-ref="779left"><a class="local col7 ref" href="#667" title='left' data-ref="797left">left</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] = <a class="local col7 ref" href="#666" title='here' data-ref="777here"><a class="local col5 ref" href="#667" title='here' data-ref="795here">here</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>];                                  \</u></td></tr>
<tr><th id="645">645</th><td><u>                    <a class="local col8 ref" href="#666" title='upper' data-ref="778upper"><a class="local col6 ref" href="#667" title='upper' data-ref="796upper">upper</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] = *<a class="local col4 ref" href="#666" title='prev' data-ref="774prev"><a class="local col2 ref" href="#667" title='prev' data-ref="792prev">prev</a></a>;                                   \</u></td></tr>
<tr><th id="646">646</th><td><u>                    <a class="local col7 ref" href="#666" title='here' data-ref="777here"><a class="local col5 ref" href="#667" title='here' data-ref="795here">here</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] = (int)(<a class="local col1 ref" href="#666" title='pix' data-ref="771pix"><a class="local col9 ref" href="#667" title='pix' data-ref="789pix">pix</a></a> &gt;&gt; <a class="local col6 ref" href="#666" title='shift' data-ref="776shift"><a class="local col4 ref" href="#667" title='shift' data-ref="794shift">shift</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] &amp; <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>]);          \</u></td></tr>
<tr><th id="647">647</th><td><u>                    *<a class="local col4 ref" href="#666" title='prev' data-ref="774prev"><a class="local col2 ref" href="#667" title='prev' data-ref="792prev">prev</a></a>++ = <a class="local col7 ref" href="#666" title='here' data-ref="777here"><a class="local col5 ref" href="#667" title='here' data-ref="795here">here</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>];                                  \</u></td></tr>
<tr><th id="648">648</th><td><u>                                                                        \</u></td></tr>
<tr><th id="649">649</th><td><u>                    <a class="local col1 ref" href="#666" title='prediction' data-ref="781prediction"><a class="local col9 ref" href="#667" title='prediction' data-ref="799prediction">prediction</a></a> = <a class="local col9 ref" href="#666" title='left' data-ref="779left"><a class="local col7 ref" href="#667" title='left' data-ref="797left">left</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] + <a class="local col8 ref" href="#666" title='upper' data-ref="778upper"><a class="local col6 ref" href="#667" title='upper' data-ref="796upper">upper</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] - <a class="local col0 ref" href="#666" title='upperleft' data-ref="780upperleft"><a class="local col8 ref" href="#667" title='upperleft' data-ref="798upperleft">upperleft</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>];     \</u></td></tr>
<tr><th id="650">650</th><td><u>                    if (<a class="local col1 ref" href="#666" title='prediction' data-ref="781prediction"><a class="local col9 ref" href="#667" title='prediction' data-ref="799prediction">prediction</a></a> &lt; 0) {                               \</u></td></tr>
<tr><th id="651">651</th><td><u>                        <a class="local col1 ref" href="#666" title='prediction' data-ref="781prediction"><a class="local col9 ref" href="#667" title='prediction' data-ref="799prediction">prediction</a></a> = 0;                                 \</u></td></tr>
<tr><th id="652">652</th><td><u>                    } else if (<a class="local col1 ref" href="#666" title='prediction' data-ref="781prediction"><a class="local col9 ref" href="#667" title='prediction' data-ref="799prediction">prediction</a></a> &gt; <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>]) {                   \</u></td></tr>
<tr><th id="653">653</th><td><u>                        <a class="local col1 ref" href="#666" title='prediction' data-ref="781prediction"><a class="local col9 ref" href="#667" title='prediction' data-ref="799prediction">prediction</a></a> = <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>];                            \</u></td></tr>
<tr><th id="654">654</th><td><u>                    }                                                   \</u></td></tr>
<tr><th id="655">655</th><td><u>                    <a class="local col2 ref" href="#666" title='diff' data-ref="772diff"><a class="local col0 ref" href="#667" title='diff' data-ref="790diff">diff</a></a> |= ((<a class="local col7 ref" href="#666" title='here' data-ref="777here"><a class="local col5 ref" href="#667" title='here' data-ref="795here">here</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>] - <a class="local col1 ref" href="#666" title='prediction' data-ref="781prediction"><a class="local col9 ref" href="#667" title='prediction' data-ref="799prediction">prediction</a></a>) &amp; <a class="local col5 ref" href="#666" title='max' data-ref="775max"><a class="local col3 ref" href="#667" title='max' data-ref="793max">max</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>])           \</u></td></tr>
<tr><th id="656">656</th><td><u>                        &lt;&lt; <a class="local col6 ref" href="#666" title='shift' data-ref="776shift"><a class="local col4 ref" href="#667" title='shift' data-ref="794shift">shift</a></a>[<a class="local col4 ref" href="#666" title='c' data-ref="784c"><a class="local col2 ref" href="#667" title='c' data-ref="802c">c</a></a>];                                    \</u></td></tr>
<tr><th id="657">657</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="658">658</th><td><u>                if (<a class="local col3 ref" href="#666" title='endian' data-ref="773endian"><a class="local col1 ref" href="#667" title='endian' data-ref="791endian">endian</a></a>) {                                           \</u></td></tr>
<tr><th id="659">659</th><td><u>                    <a class="local col2 ref" href="#666" title='diff' data-ref="772diff"><a class="local col0 ref" href="#667" title='diff' data-ref="790diff">diff</a></a> = bswap##bpp(<a class="local col2 ref" href="#666" title='diff' data-ref="772diff"><a class="local col0 ref" href="#667" title='diff' data-ref="790diff">diff</a></a>);                            \</u></td></tr>
<tr><th id="660">660</th><td><u>                }                                                       \</u></td></tr>
<tr><th id="661">661</th><td><u>                *<a class="local col8 ref" href="#666" title='buf' data-ref="768buf"><a class="local col6 ref" href="#667" title='buf' data-ref="786buf">buf</a></a>++ = <a class="local col2 ref" href="#666" title='diff' data-ref="772diff"><a class="local col0 ref" href="#667" title='diff' data-ref="790diff">diff</a></a>;                                          \</u></td></tr>
<tr><th id="662">662</th><td><u>            }                                                           \</u></td></tr>
<tr><th id="663">663</th><td><u>        }                                                               \</u></td></tr>
<tr><th id="664">664</th><td><u>    }</u></td></tr>
<tr><th id="665">665</th><td></td></tr>
<tr><th id="666">666</th><td><a class="macro" href="#606" title="static void tight_filter_gradient16(VncState *vs, uint16_t *buf, int w, int h) { uint16_t pix, diff; _Bool endian; int *prev; int max[3], shift[3]; int here[3], upper[3], left[3], upperleft[3]; int prediction; int x, y, c; memset (vs-&gt;tight.gradient.buffer, 0, w * 3 * sizeof(int)); endian = 0; max[0] = vs-&gt;client_pf.rmax; max[1] = vs-&gt;client_pf.gmax; max[2] = vs-&gt;client_pf.bmax; shift[0] = vs-&gt;client_pf.rshift; shift[1] = vs-&gt;client_pf.gshift; shift[2] = vs-&gt;client_pf.bshift; for (y = 0; y &lt; h; y++) { for (c = 0; c &lt; 3; c++) { upper[c] = 0; here[c] = 0; } prev = (int *)vs-&gt;tight.gradient.buffer; for (x = 0; x &lt; w; x++) { pix = *buf; if (endian) { pix = bswap16(pix); } diff = 0; for (c = 0; c &lt; 3; c++) { upperleft[c] = upper[c]; left[c] = here[c]; upper[c] = *prev; here[c] = (int)(pix &gt;&gt; shift[c] &amp; max[c]); *prev++ = here[c]; prediction = left[c] + upper[c] - upperleft[c]; if (prediction &lt; 0) { prediction = 0; } else if (prediction &gt; max[c]) { prediction = max[c]; } diff |= ((here[c] - prediction) &amp; max[c]) &lt;&lt; shift[c]; } if (endian) { diff = bswap16(diff); } *buf++ = diff; } } }" data-ref="_M/DEFINE_GRADIENT_FILTER_FUNCTION">DEFINE_GRADIENT_FILTER_FUNCTION</a>(<var>16</var>)</td></tr>
<tr><th id="667">667</th><td><a class="macro" href="#606" title="static void tight_filter_gradient32(VncState *vs, uint32_t *buf, int w, int h) { uint32_t pix, diff; _Bool endian; int *prev; int max[3], shift[3]; int here[3], upper[3], left[3], upperleft[3]; int prediction; int x, y, c; memset (vs-&gt;tight.gradient.buffer, 0, w * 3 * sizeof(int)); endian = 0; max[0] = vs-&gt;client_pf.rmax; max[1] = vs-&gt;client_pf.gmax; max[2] = vs-&gt;client_pf.bmax; shift[0] = vs-&gt;client_pf.rshift; shift[1] = vs-&gt;client_pf.gshift; shift[2] = vs-&gt;client_pf.bshift; for (y = 0; y &lt; h; y++) { for (c = 0; c &lt; 3; c++) { upper[c] = 0; here[c] = 0; } prev = (int *)vs-&gt;tight.gradient.buffer; for (x = 0; x &lt; w; x++) { pix = *buf; if (endian) { pix = bswap32(pix); } diff = 0; for (c = 0; c &lt; 3; c++) { upperleft[c] = upper[c]; left[c] = here[c]; upper[c] = *prev; here[c] = (int)(pix &gt;&gt; shift[c] &amp; max[c]); *prev++ = here[c]; prediction = left[c] + upper[c] - upperleft[c]; if (prediction &lt; 0) { prediction = 0; } else if (prediction &gt; max[c]) { prediction = max[c]; } diff |= ((here[c] - prediction) &amp; max[c]) &lt;&lt; shift[c]; } if (endian) { diff = bswap32(diff); } *buf++ = diff; } } }" data-ref="_M/DEFINE_GRADIENT_FILTER_FUNCTION">DEFINE_GRADIENT_FILTER_FUNCTION</a>(<var>32</var>)</td></tr>
<tr><th id="668">668</th><td></td></tr>
<tr><th id="669">669</th><td><i  data-doc="check_solid_tile32">/*</i></td></tr>
<tr><th id="670">670</th><td><i  data-doc="check_solid_tile32"> * Check if a rectangle is all of the same color. If needSameColor is</i></td></tr>
<tr><th id="671">671</th><td><i  data-doc="check_solid_tile32"> * set to non-zero, then also check that its color equals to the</i></td></tr>
<tr><th id="672">672</th><td><i  data-doc="check_solid_tile32"> * *colorPtr value. The result is 1 if the test is successful, and in</i></td></tr>
<tr><th id="673">673</th><td><i  data-doc="check_solid_tile32"> * that case new color will be stored in *colorPtr.</i></td></tr>
<tr><th id="674">674</th><td><i  data-doc="check_solid_tile32"> */</i></td></tr>
<tr><th id="675">675</th><td></td></tr>
<tr><th id="676">676</th><td><em>static</em> <span class="macro" title="_Bool" data-ref="_M/bool">bool</span></td></tr>
<tr><th id="677">677</th><td><dfn class="tu decl def" id="check_solid_tile32" title='check_solid_tile32' data-type='_Bool check_solid_tile32(VncState * vs, int x, int y, int w, int h, uint32_t * color, _Bool samecolor)' data-ref="check_solid_tile32">check_solid_tile32</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col3 decl" id="803vs" title='vs' data-type='VncState *' data-ref="803vs">vs</dfn>, <em>int</em> <dfn class="local col4 decl" id="804x" title='x' data-type='int' data-ref="804x">x</dfn>, <em>int</em> <dfn class="local col5 decl" id="805y" title='y' data-type='int' data-ref="805y">y</dfn>, <em>int</em> <dfn class="local col6 decl" id="806w" title='w' data-type='int' data-ref="806w">w</dfn>, <em>int</em> <dfn class="local col7 decl" id="807h" title='h' data-type='int' data-ref="807h">h</dfn>,</td></tr>
<tr><th id="678">678</th><td>                   <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col8 decl" id="808color" title='color' data-type='uint32_t *' data-ref="808color">color</dfn>, <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="local col9 decl" id="809samecolor" title='samecolor' data-type='_Bool' data-ref="809samecolor">samecolor</dfn>)</td></tr>
<tr><th id="679">679</th><td>{</td></tr>
<tr><th id="680">680</th><td>    <a class="typedef" href="vnc.h.html#VncDisplay" title='VncDisplay' data-type='struct VncDisplay' data-ref="VncDisplay">VncDisplay</a> *<dfn class="local col0 decl" id="810vd" title='vd' data-type='VncDisplay *' data-ref="810vd">vd</dfn> = <a class="local col3 ref" href="#803vs" title='vs' data-ref="803vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::vd" title='VncState::vd' data-ref="VncState::vd">vd</a>;</td></tr>
<tr><th id="681">681</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col1 decl" id="811fbptr" title='fbptr' data-type='uint32_t *' data-ref="811fbptr">fbptr</dfn>;</td></tr>
<tr><th id="682">682</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="812c" title='c' data-type='uint32_t' data-ref="812c">c</dfn>;</td></tr>
<tr><th id="683">683</th><td>    <em>int</em> <dfn class="local col3 decl" id="813dx" title='dx' data-type='int' data-ref="813dx">dx</dfn>, <dfn class="local col4 decl" id="814dy" title='dy' data-type='int' data-ref="814dy">dy</dfn>;</td></tr>
<tr><th id="684">684</th><td></td></tr>
<tr><th id="685">685</th><td>    <a class="local col1 ref" href="#811fbptr" title='fbptr' data-ref="811fbptr">fbptr</a> = <a class="ref" href="vnc.h.html#vnc_server_fb_ptr" title='vnc_server_fb_ptr' data-ref="vnc_server_fb_ptr">vnc_server_fb_ptr</a>(<a class="local col0 ref" href="#810vd" title='vd' data-ref="810vd">vd</a>, <a class="local col4 ref" href="#804x" title='x' data-ref="804x">x</a>, <a class="local col5 ref" href="#805y" title='y' data-ref="805y">y</a>);</td></tr>
<tr><th id="686">686</th><td></td></tr>
<tr><th id="687">687</th><td>    <a class="local col2 ref" href="#812c" title='c' data-ref="812c">c</a> = *<a class="local col1 ref" href="#811fbptr" title='fbptr' data-ref="811fbptr">fbptr</a>;</td></tr>
<tr><th id="688">688</th><td>    <b>if</b> (<a class="local col9 ref" href="#809samecolor" title='samecolor' data-ref="809samecolor">samecolor</a> &amp;&amp; (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col2 ref" href="#812c" title='c' data-ref="812c">c</a> != *<a class="local col8 ref" href="#808color" title='color' data-ref="808color">color</a>) {</td></tr>
<tr><th id="689">689</th><td>        <b>return</b> <span class="macro" title="0" data-ref="_M/false">false</span>;</td></tr>
<tr><th id="690">690</th><td>    }</td></tr>
<tr><th id="691">691</th><td></td></tr>
<tr><th id="692">692</th><td>    <b>for</b> (<a class="local col4 ref" href="#814dy" title='dy' data-ref="814dy">dy</a> = <var>0</var>; <a class="local col4 ref" href="#814dy" title='dy' data-ref="814dy">dy</a> &lt; <a class="local col7 ref" href="#807h" title='h' data-ref="807h">h</a>; <a class="local col4 ref" href="#814dy" title='dy' data-ref="814dy">dy</a>++) {</td></tr>
<tr><th id="693">693</th><td>        <b>for</b> (<a class="local col3 ref" href="#813dx" title='dx' data-ref="813dx">dx</a> = <var>0</var>; <a class="local col3 ref" href="#813dx" title='dx' data-ref="813dx">dx</a> &lt; <a class="local col6 ref" href="#806w" title='w' data-ref="806w">w</a>; <a class="local col3 ref" href="#813dx" title='dx' data-ref="813dx">dx</a>++) {</td></tr>
<tr><th id="694">694</th><td>            <b>if</b> (<a class="local col2 ref" href="#812c" title='c' data-ref="812c">c</a> != <a class="local col1 ref" href="#811fbptr" title='fbptr' data-ref="811fbptr">fbptr</a>[<a class="local col3 ref" href="#813dx" title='dx' data-ref="813dx">dx</a>]) {</td></tr>
<tr><th id="695">695</th><td>                <b>return</b> <span class="macro" title="0" data-ref="_M/false">false</span>;</td></tr>
<tr><th id="696">696</th><td>            }</td></tr>
<tr><th id="697">697</th><td>        }</td></tr>
<tr><th id="698">698</th><td>        <a class="local col1 ref" href="#811fbptr" title='fbptr' data-ref="811fbptr">fbptr</a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *)</td></tr>
<tr><th id="699">699</th><td>            ((<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *)<a class="local col1 ref" href="#811fbptr" title='fbptr' data-ref="811fbptr">fbptr</a> + <a class="ref" href="vnc.h.html#vnc_server_fb_stride" title='vnc_server_fb_stride' data-ref="vnc_server_fb_stride">vnc_server_fb_stride</a>(<a class="local col0 ref" href="#810vd" title='vd' data-ref="810vd">vd</a>));</td></tr>
<tr><th id="700">700</th><td>    }</td></tr>
<tr><th id="701">701</th><td></td></tr>
<tr><th id="702">702</th><td>    *<a class="local col8 ref" href="#808color" title='color' data-ref="808color">color</a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col2 ref" href="#812c" title='c' data-ref="812c">c</a>;</td></tr>
<tr><th id="703">703</th><td>    <b>return</b> <span class="macro" title="1" data-ref="_M/true">true</span>;</td></tr>
<tr><th id="704">704</th><td>}</td></tr>
<tr><th id="705">705</th><td></td></tr>
<tr><th id="706">706</th><td><em>static</em> <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="tu decl def" id="check_solid_tile" title='check_solid_tile' data-type='_Bool check_solid_tile(VncState * vs, int x, int y, int w, int h, uint32_t * color, _Bool samecolor)' data-ref="check_solid_tile">check_solid_tile</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col5 decl" id="815vs" title='vs' data-type='VncState *' data-ref="815vs">vs</dfn>, <em>int</em> <dfn class="local col6 decl" id="816x" title='x' data-type='int' data-ref="816x">x</dfn>, <em>int</em> <dfn class="local col7 decl" id="817y" title='y' data-type='int' data-ref="817y">y</dfn>, <em>int</em> <dfn class="local col8 decl" id="818w" title='w' data-type='int' data-ref="818w">w</dfn>, <em>int</em> <dfn class="local col9 decl" id="819h" title='h' data-type='int' data-ref="819h">h</dfn>,</td></tr>
<tr><th id="707">707</th><td>                             <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>* <dfn class="local col0 decl" id="820color" title='color' data-type='uint32_t *' data-ref="820color">color</dfn>, <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="local col1 decl" id="821samecolor" title='samecolor' data-type='_Bool' data-ref="821samecolor">samecolor</dfn>)</td></tr>
<tr><th id="708">708</th><td>{</td></tr>
<tr><th id="709">709</th><td>    <a class="macro" href="../include/qemu/compiler.h.html#86" title="_Static_assert(!((((((((((32) &lt;&lt; 24) | ((2) &lt;&lt; 16) | ((0) &lt;&lt; 12) | ((8) &lt;&lt; 8) | ((8) &lt;&lt; 4) | ((8)))) &gt;&gt; 24) ))+7)/8) != 4), &quot;not expecting: &quot; &quot;VNC_SERVER_FB_BYTES != 4&quot;)" data-ref="_M/QEMU_BUILD_BUG_ON">QEMU_BUILD_BUG_ON</a>(<a class="macro" href="vnc.h.html#548" title="(((((((((32) &lt;&lt; 24) | ((2) &lt;&lt; 16) | ((0) &lt;&lt; 12) | ((8) &lt;&lt; 8) | ((8) &lt;&lt; 4) | ((8)))) &gt;&gt; 24) ))+7)/8)" data-ref="_M/VNC_SERVER_FB_BYTES">VNC_SERVER_FB_BYTES</a> != <var>4</var>);</td></tr>
<tr><th id="710">710</th><td>    <b>return</b> <a class="tu ref" href="#check_solid_tile32" title='check_solid_tile32' data-use='c' data-ref="check_solid_tile32">check_solid_tile32</a>(<a class="local col5 ref" href="#815vs" title='vs' data-ref="815vs">vs</a>, <a class="local col6 ref" href="#816x" title='x' data-ref="816x">x</a>, <a class="local col7 ref" href="#817y" title='y' data-ref="817y">y</a>, <a class="local col8 ref" href="#818w" title='w' data-ref="818w">w</a>, <a class="local col9 ref" href="#819h" title='h' data-ref="819h">h</a>, <a class="local col0 ref" href="#820color" title='color' data-ref="820color">color</a>, <a class="local col1 ref" href="#821samecolor" title='samecolor' data-ref="821samecolor">samecolor</a>);</td></tr>
<tr><th id="711">711</th><td>}</td></tr>
<tr><th id="712">712</th><td></td></tr>
<tr><th id="713">713</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="find_best_solid_area" title='find_best_solid_area' data-type='void find_best_solid_area(VncState * vs, int x, int y, int w, int h, uint32_t color, int * w_ptr, int * h_ptr)' data-ref="find_best_solid_area">find_best_solid_area</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col2 decl" id="822vs" title='vs' data-type='VncState *' data-ref="822vs">vs</dfn>, <em>int</em> <dfn class="local col3 decl" id="823x" title='x' data-type='int' data-ref="823x">x</dfn>, <em>int</em> <dfn class="local col4 decl" id="824y" title='y' data-type='int' data-ref="824y">y</dfn>, <em>int</em> <dfn class="local col5 decl" id="825w" title='w' data-type='int' data-ref="825w">w</dfn>, <em>int</em> <dfn class="local col6 decl" id="826h" title='h' data-type='int' data-ref="826h">h</dfn>,</td></tr>
<tr><th id="714">714</th><td>                                 <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="827color" title='color' data-type='uint32_t' data-ref="827color">color</dfn>, <em>int</em> *<dfn class="local col8 decl" id="828w_ptr" title='w_ptr' data-type='int *' data-ref="828w_ptr">w_ptr</dfn>, <em>int</em> *<dfn class="local col9 decl" id="829h_ptr" title='h_ptr' data-type='int *' data-ref="829h_ptr">h_ptr</dfn>)</td></tr>
<tr><th id="715">715</th><td>{</td></tr>
<tr><th id="716">716</th><td>    <em>int</em> <dfn class="local col0 decl" id="830dx" title='dx' data-type='int' data-ref="830dx">dx</dfn>, <dfn class="local col1 decl" id="831dy" title='dy' data-type='int' data-ref="831dy">dy</dfn>, <dfn class="local col2 decl" id="832dw" title='dw' data-type='int' data-ref="832dw">dw</dfn>, <dfn class="local col3 decl" id="833dh" title='dh' data-type='int' data-ref="833dh">dh</dfn>;</td></tr>
<tr><th id="717">717</th><td>    <em>int</em> <dfn class="local col4 decl" id="834w_prev" title='w_prev' data-type='int' data-ref="834w_prev">w_prev</dfn>;</td></tr>
<tr><th id="718">718</th><td>    <em>int</em> <dfn class="local col5 decl" id="835w_best" title='w_best' data-type='int' data-ref="835w_best">w_best</dfn> = <var>0</var>, <dfn class="local col6 decl" id="836h_best" title='h_best' data-type='int' data-ref="836h_best">h_best</dfn> = <var>0</var>;</td></tr>
<tr><th id="719">719</th><td></td></tr>
<tr><th id="720">720</th><td>    <a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a> = <a class="local col5 ref" href="#825w" title='w' data-ref="825w">w</a>;</td></tr>
<tr><th id="721">721</th><td></td></tr>
<tr><th id="722">722</th><td>    <b>for</b> (<a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a> = <a class="local col4 ref" href="#824y" title='y' data-ref="824y">y</a>; <a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a> &lt; <a class="local col4 ref" href="#824y" title='y' data-ref="824y">y</a> + <a class="local col6 ref" href="#826h" title='h' data-ref="826h">h</a>; <a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a> += <a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>) {</td></tr>
<tr><th id="723">723</th><td></td></tr>
<tr><th id="724">724</th><td>        <a class="local col3 ref" href="#833dh" title='dh' data-ref="833dh">dh</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((16) &lt; (y + h - dy)) ? (16) : (y + h - dy))" data-ref="_M/MIN">MIN</a>(<a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>, <a class="local col4 ref" href="#824y" title='y' data-ref="824y">y</a> + <a class="local col6 ref" href="#826h" title='h' data-ref="826h">h</a> - <a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a>);</td></tr>
<tr><th id="725">725</th><td>        <a class="local col2 ref" href="#832dw" title='dw' data-ref="832dw">dw</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((16) &lt; (w_prev)) ? (16) : (w_prev))" data-ref="_M/MIN">MIN</a>(<a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>, <a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a>);</td></tr>
<tr><th id="726">726</th><td></td></tr>
<tr><th id="727">727</th><td>        <b>if</b> (!<a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col2 ref" href="#822vs" title='vs' data-ref="822vs">vs</a>, <a class="local col3 ref" href="#823x" title='x' data-ref="823x">x</a>, <a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a>, <a class="local col2 ref" href="#832dw" title='dw' data-ref="832dw">dw</a>, <a class="local col3 ref" href="#833dh" title='dh' data-ref="833dh">dh</a>, &amp;<a class="local col7 ref" href="#827color" title='color' data-ref="827color">color</a>, <span class="macro" title="1" data-ref="_M/true">true</span>)) {</td></tr>
<tr><th id="728">728</th><td>            <b>break</b>;</td></tr>
<tr><th id="729">729</th><td>        }</td></tr>
<tr><th id="730">730</th><td></td></tr>
<tr><th id="731">731</th><td>        <b>for</b> (<a class="local col0 ref" href="#830dx" title='dx' data-ref="830dx">dx</a> = <a class="local col3 ref" href="#823x" title='x' data-ref="823x">x</a> + <a class="local col2 ref" href="#832dw" title='dw' data-ref="832dw">dw</a>; <a class="local col0 ref" href="#830dx" title='dx' data-ref="830dx">dx</a> &lt; <a class="local col3 ref" href="#823x" title='x' data-ref="823x">x</a> + <a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a>;) {</td></tr>
<tr><th id="732">732</th><td>            <a class="local col2 ref" href="#832dw" title='dw' data-ref="832dw">dw</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((16) &lt; (x + w_prev - dx)) ? (16) : (x + w_prev - dx))" data-ref="_M/MIN">MIN</a>(<a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>, <a class="local col3 ref" href="#823x" title='x' data-ref="823x">x</a> + <a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a> - <a class="local col0 ref" href="#830dx" title='dx' data-ref="830dx">dx</a>);</td></tr>
<tr><th id="733">733</th><td></td></tr>
<tr><th id="734">734</th><td>            <b>if</b> (!<a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col2 ref" href="#822vs" title='vs' data-ref="822vs">vs</a>, <a class="local col0 ref" href="#830dx" title='dx' data-ref="830dx">dx</a>, <a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a>, <a class="local col2 ref" href="#832dw" title='dw' data-ref="832dw">dw</a>, <a class="local col3 ref" href="#833dh" title='dh' data-ref="833dh">dh</a>, &amp;<a class="local col7 ref" href="#827color" title='color' data-ref="827color">color</a>, <span class="macro" title="1" data-ref="_M/true">true</span>)) {</td></tr>
<tr><th id="735">735</th><td>                <b>break</b>;</td></tr>
<tr><th id="736">736</th><td>            }</td></tr>
<tr><th id="737">737</th><td>            <a class="local col0 ref" href="#830dx" title='dx' data-ref="830dx">dx</a> += <a class="local col2 ref" href="#832dw" title='dw' data-ref="832dw">dw</a>;</td></tr>
<tr><th id="738">738</th><td>        }</td></tr>
<tr><th id="739">739</th><td></td></tr>
<tr><th id="740">740</th><td>        <a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a> = <a class="local col0 ref" href="#830dx" title='dx' data-ref="830dx">dx</a> - <a class="local col3 ref" href="#823x" title='x' data-ref="823x">x</a>;</td></tr>
<tr><th id="741">741</th><td>        <b>if</b> (<a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a> * (<a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a> + <a class="local col3 ref" href="#833dh" title='dh' data-ref="833dh">dh</a> - <a class="local col4 ref" href="#824y" title='y' data-ref="824y">y</a>) &gt; <a class="local col5 ref" href="#835w_best" title='w_best' data-ref="835w_best">w_best</a> * <a class="local col6 ref" href="#836h_best" title='h_best' data-ref="836h_best">h_best</a>) {</td></tr>
<tr><th id="742">742</th><td>            <a class="local col5 ref" href="#835w_best" title='w_best' data-ref="835w_best">w_best</a> = <a class="local col4 ref" href="#834w_prev" title='w_prev' data-ref="834w_prev">w_prev</a>;</td></tr>
<tr><th id="743">743</th><td>            <a class="local col6 ref" href="#836h_best" title='h_best' data-ref="836h_best">h_best</a> = <a class="local col1 ref" href="#831dy" title='dy' data-ref="831dy">dy</a> + <a class="local col3 ref" href="#833dh" title='dh' data-ref="833dh">dh</a> - <a class="local col4 ref" href="#824y" title='y' data-ref="824y">y</a>;</td></tr>
<tr><th id="744">744</th><td>        }</td></tr>
<tr><th id="745">745</th><td>    }</td></tr>
<tr><th id="746">746</th><td></td></tr>
<tr><th id="747">747</th><td>    *<a class="local col8 ref" href="#828w_ptr" title='w_ptr' data-ref="828w_ptr">w_ptr</a> = <a class="local col5 ref" href="#835w_best" title='w_best' data-ref="835w_best">w_best</a>;</td></tr>
<tr><th id="748">748</th><td>    *<a class="local col9 ref" href="#829h_ptr" title='h_ptr' data-ref="829h_ptr">h_ptr</a> = <a class="local col6 ref" href="#836h_best" title='h_best' data-ref="836h_best">h_best</a>;</td></tr>
<tr><th id="749">749</th><td>}</td></tr>
<tr><th id="750">750</th><td></td></tr>
<tr><th id="751">751</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="extend_solid_area" title='extend_solid_area' data-type='void extend_solid_area(VncState * vs, int x, int y, int w, int h, uint32_t color, int * x_ptr, int * y_ptr, int * w_ptr, int * h_ptr)' data-ref="extend_solid_area">extend_solid_area</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col7 decl" id="837vs" title='vs' data-type='VncState *' data-ref="837vs">vs</dfn>, <em>int</em> <dfn class="local col8 decl" id="838x" title='x' data-type='int' data-ref="838x">x</dfn>, <em>int</em> <dfn class="local col9 decl" id="839y" title='y' data-type='int' data-ref="839y">y</dfn>, <em>int</em> <dfn class="local col0 decl" id="840w" title='w' data-type='int' data-ref="840w">w</dfn>, <em>int</em> <dfn class="local col1 decl" id="841h" title='h' data-type='int' data-ref="841h">h</dfn>,</td></tr>
<tr><th id="752">752</th><td>                              <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="842color" title='color' data-type='uint32_t' data-ref="842color">color</dfn>, <em>int</em> *<dfn class="local col3 decl" id="843x_ptr" title='x_ptr' data-type='int *' data-ref="843x_ptr">x_ptr</dfn>, <em>int</em> *<dfn class="local col4 decl" id="844y_ptr" title='y_ptr' data-type='int *' data-ref="844y_ptr">y_ptr</dfn>,</td></tr>
<tr><th id="753">753</th><td>                              <em>int</em> *<dfn class="local col5 decl" id="845w_ptr" title='w_ptr' data-type='int *' data-ref="845w_ptr">w_ptr</dfn>, <em>int</em> *<dfn class="local col6 decl" id="846h_ptr" title='h_ptr' data-type='int *' data-ref="846h_ptr">h_ptr</dfn>)</td></tr>
<tr><th id="754">754</th><td>{</td></tr>
<tr><th id="755">755</th><td>    <em>int</em> <dfn class="local col7 decl" id="847cx" title='cx' data-type='int' data-ref="847cx">cx</dfn>, <dfn class="local col8 decl" id="848cy" title='cy' data-type='int' data-ref="848cy">cy</dfn>;</td></tr>
<tr><th id="756">756</th><td></td></tr>
<tr><th id="757">757</th><td>    <i>/* Try to extend the area upwards. */</i></td></tr>
<tr><th id="758">758</th><td>    <b>for</b> ( <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> = *<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a> - <var>1</var>;</td></tr>
<tr><th id="759">759</th><td>          <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> &gt;= <a class="local col9 ref" href="#839y" title='y' data-ref="839y">y</a> &amp;&amp; <a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col7 ref" href="#837vs" title='vs' data-ref="837vs">vs</a>, *<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a>, <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a>, *<a class="local col5 ref" href="#845w_ptr" title='w_ptr' data-ref="845w_ptr">w_ptr</a>, <var>1</var>, &amp;<a class="local col2 ref" href="#842color" title='color' data-ref="842color">color</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="760">760</th><td>          <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a>-- );</td></tr>
<tr><th id="761">761</th><td>    *<a class="local col6 ref" href="#846h_ptr" title='h_ptr' data-ref="846h_ptr">h_ptr</a> += *<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a> - (<a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> + <var>1</var>);</td></tr>
<tr><th id="762">762</th><td>    *<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a> = <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> + <var>1</var>;</td></tr>
<tr><th id="763">763</th><td></td></tr>
<tr><th id="764">764</th><td>    <i>/* ... downwards. */</i></td></tr>
<tr><th id="765">765</th><td>    <b>for</b> ( <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> = *<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a> + *<a class="local col6 ref" href="#846h_ptr" title='h_ptr' data-ref="846h_ptr">h_ptr</a>;</td></tr>
<tr><th id="766">766</th><td>          <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> &lt; <a class="local col9 ref" href="#839y" title='y' data-ref="839y">y</a> + <a class="local col1 ref" href="#841h" title='h' data-ref="841h">h</a> &amp;&amp;</td></tr>
<tr><th id="767">767</th><td>              <a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col7 ref" href="#837vs" title='vs' data-ref="837vs">vs</a>, *<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a>, <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a>, *<a class="local col5 ref" href="#845w_ptr" title='w_ptr' data-ref="845w_ptr">w_ptr</a>, <var>1</var>, &amp;<a class="local col2 ref" href="#842color" title='color' data-ref="842color">color</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="768">768</th><td>          <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a>++ );</td></tr>
<tr><th id="769">769</th><td>    *<a class="local col6 ref" href="#846h_ptr" title='h_ptr' data-ref="846h_ptr">h_ptr</a> += <a class="local col8 ref" href="#848cy" title='cy' data-ref="848cy">cy</a> - (*<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a> + *<a class="local col6 ref" href="#846h_ptr" title='h_ptr' data-ref="846h_ptr">h_ptr</a>);</td></tr>
<tr><th id="770">770</th><td></td></tr>
<tr><th id="771">771</th><td>    <i>/* ... to the left. */</i></td></tr>
<tr><th id="772">772</th><td>    <b>for</b> ( <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> = *<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a> - <var>1</var>;</td></tr>
<tr><th id="773">773</th><td>          <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> &gt;= <a class="local col8 ref" href="#838x" title='x' data-ref="838x">x</a> &amp;&amp; <a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col7 ref" href="#837vs" title='vs' data-ref="837vs">vs</a>, <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a>, *<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a>, <var>1</var>, *<a class="local col6 ref" href="#846h_ptr" title='h_ptr' data-ref="846h_ptr">h_ptr</a>, &amp;<a class="local col2 ref" href="#842color" title='color' data-ref="842color">color</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="774">774</th><td>          <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a>-- );</td></tr>
<tr><th id="775">775</th><td>    *<a class="local col5 ref" href="#845w_ptr" title='w_ptr' data-ref="845w_ptr">w_ptr</a> += *<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a> - (<a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> + <var>1</var>);</td></tr>
<tr><th id="776">776</th><td>    *<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a> = <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> + <var>1</var>;</td></tr>
<tr><th id="777">777</th><td></td></tr>
<tr><th id="778">778</th><td>    <i>/* ... to the right. */</i></td></tr>
<tr><th id="779">779</th><td>    <b>for</b> ( <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> = *<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a> + *<a class="local col5 ref" href="#845w_ptr" title='w_ptr' data-ref="845w_ptr">w_ptr</a>;</td></tr>
<tr><th id="780">780</th><td>          <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> &lt; <a class="local col8 ref" href="#838x" title='x' data-ref="838x">x</a> + <a class="local col0 ref" href="#840w" title='w' data-ref="840w">w</a> &amp;&amp;</td></tr>
<tr><th id="781">781</th><td>              <a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col7 ref" href="#837vs" title='vs' data-ref="837vs">vs</a>, <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a>, *<a class="local col4 ref" href="#844y_ptr" title='y_ptr' data-ref="844y_ptr">y_ptr</a>, <var>1</var>, *<a class="local col6 ref" href="#846h_ptr" title='h_ptr' data-ref="846h_ptr">h_ptr</a>, &amp;<a class="local col2 ref" href="#842color" title='color' data-ref="842color">color</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="782">782</th><td>          <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a>++ );</td></tr>
<tr><th id="783">783</th><td>    *<a class="local col5 ref" href="#845w_ptr" title='w_ptr' data-ref="845w_ptr">w_ptr</a> += <a class="local col7 ref" href="#847cx" title='cx' data-ref="847cx">cx</a> - (*<a class="local col3 ref" href="#843x_ptr" title='x_ptr' data-ref="843x_ptr">x_ptr</a> + *<a class="local col5 ref" href="#845w_ptr" title='w_ptr' data-ref="845w_ptr">w_ptr</a>);</td></tr>
<tr><th id="784">784</th><td>}</td></tr>
<tr><th id="785">785</th><td></td></tr>
<tr><th id="786">786</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="tight_init_stream" title='tight_init_stream' data-type='int tight_init_stream(VncState * vs, int stream_id, int level, int strategy)' data-ref="tight_init_stream">tight_init_stream</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col9 decl" id="849vs" title='vs' data-type='VncState *' data-ref="849vs">vs</dfn>, <em>int</em> <dfn class="local col0 decl" id="850stream_id" title='stream_id' data-type='int' data-ref="850stream_id">stream_id</dfn>,</td></tr>
<tr><th id="787">787</th><td>                             <em>int</em> <dfn class="local col1 decl" id="851level" title='level' data-type='int' data-ref="851level">level</dfn>, <em>int</em> <dfn class="local col2 decl" id="852strategy" title='strategy' data-type='int' data-ref="852strategy">strategy</dfn>)</td></tr>
<tr><th id="788">788</th><td>{</td></tr>
<tr><th id="789">789</th><td>    <a class="typedef" href="../../include/zlib.h.html#z_streamp" title='z_streamp' data-type='z_stream *' data-ref="z_streamp">z_streamp</a> <dfn class="local col3 decl" id="853zstream" title='zstream' data-type='z_streamp' data-ref="853zstream">zstream</dfn> = &amp;<a class="local col9 ref" href="#849vs" title='vs' data-ref="849vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::stream" title='VncTight::stream' data-ref="VncTight::stream">stream</a>[<a class="local col0 ref" href="#850stream_id" title='stream_id' data-ref="850stream_id">stream_id</a>];</td></tr>
<tr><th id="790">790</th><td></td></tr>
<tr><th id="791">791</th><td>    <b>if</b> (<a class="local col3 ref" href="#853zstream" title='zstream' data-ref="853zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::opaque" title='z_stream_s::opaque' data-ref="z_stream_s::opaque">opaque</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="792">792</th><td>        <em>int</em> <dfn class="local col4 decl" id="854err" title='err' data-type='int' data-ref="854err">err</dfn>;</td></tr>
<tr><th id="793">793</th><td></td></tr>
<tr><th id="794">794</th><td>        <a class="macro" href="vnc.h.html#52" title="do { } while (0)" data-ref="_M/VNC_DEBUG">VNC_DEBUG</a>(<q>"VNC: TIGHT: initializing zlib stream %d\n"</q>, stream_id);</td></tr>
<tr><th id="795">795</th><td>        <a class="macro" href="vnc.h.html#52" title="do { } while (0)" data-ref="_M/VNC_DEBUG">VNC_DEBUG</a>(<q>"VNC: TIGHT: opaque = %p | vs = %p\n"</q>, zstream-&gt;opaque, vs);</td></tr>
<tr><th id="796">796</th><td>        <a class="local col3 ref" href="#853zstream" title='zstream' data-ref="853zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::zalloc" title='z_stream_s::zalloc' data-ref="z_stream_s::zalloc">zalloc</a> = <a class="ref" href="vnc.h.html#vnc_zlib_zalloc" title='vnc_zlib_zalloc' data-ref="vnc_zlib_zalloc">vnc_zlib_zalloc</a>;</td></tr>
<tr><th id="797">797</th><td>        <a class="local col3 ref" href="#853zstream" title='zstream' data-ref="853zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::zfree" title='z_stream_s::zfree' data-ref="z_stream_s::zfree">zfree</a> = <a class="ref" href="vnc.h.html#vnc_zlib_zfree" title='vnc_zlib_zfree' data-ref="vnc_zlib_zfree">vnc_zlib_zfree</a>;</td></tr>
<tr><th id="798">798</th><td></td></tr>
<tr><th id="799">799</th><td>        <a class="local col4 ref" href="#854err" title='err' data-ref="854err">err</a> = <a class="macro" href="../../include/zlib.h.html#1651" title="deflateInit2_((zstream),(level),(8),(15),(9), (strategy), &quot;1.2.8&quot;, (int)sizeof(z_stream))" data-ref="_M/deflateInit2">deflateInit2</a>(<a class="local col3 ref" href="#853zstream" title='zstream' data-ref="853zstream">zstream</a>, <a class="local col1 ref" href="#851level" title='level' data-ref="851level">level</a>, <a class="macro" href="../../include/zlib.h.html#205" title="8" data-ref="_M/Z_DEFLATED">Z_DEFLATED</a>, <a class="macro" href="../../include/zconf.h.html#247" title="15" data-ref="_M/MAX_WBITS">MAX_WBITS</a>,</td></tr>
<tr><th id="800">800</th><td>                           <a class="macro" href="../../include/zconf.h.html#237" title="9" data-ref="_M/MAX_MEM_LEVEL">MAX_MEM_LEVEL</a>, <a class="local col2 ref" href="#852strategy" title='strategy' data-ref="852strategy">strategy</a>);</td></tr>
<tr><th id="801">801</th><td></td></tr>
<tr><th id="802">802</th><td>        <b>if</b> (<a class="local col4 ref" href="#854err" title='err' data-ref="854err">err</a> != <a class="macro" href="../../include/zlib.h.html#173" title="0" data-ref="_M/Z_OK">Z_OK</a>) {</td></tr>
<tr><th id="803">803</th><td>            <a class="ref" href="../../include/stdio.h.html#fprintf" title='fprintf' data-ref="fprintf">fprintf</a>(<a class="macro" href="../../include/stdio.h.html#174" title="stderr" data-ref="_M/stderr">stderr</a>, <q>"VNC: error initializing zlib\n"</q>);</td></tr>
<tr><th id="804">804</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="805">805</th><td>        }</td></tr>
<tr><th id="806">806</th><td></td></tr>
<tr><th id="807">807</th><td>        <a class="local col9 ref" href="#849vs" title='vs' data-ref="849vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::levels" title='VncTight::levels' data-ref="VncTight::levels">levels</a>[<a class="local col0 ref" href="#850stream_id" title='stream_id' data-ref="850stream_id">stream_id</a>] = <a class="local col1 ref" href="#851level" title='level' data-ref="851level">level</a>;</td></tr>
<tr><th id="808">808</th><td>        <a class="local col3 ref" href="#853zstream" title='zstream' data-ref="853zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::opaque" title='z_stream_s::opaque' data-ref="z_stream_s::opaque">opaque</a> = <a class="local col9 ref" href="#849vs" title='vs' data-ref="849vs">vs</a>;</td></tr>
<tr><th id="809">809</th><td>    }</td></tr>
<tr><th id="810">810</th><td></td></tr>
<tr><th id="811">811</th><td>    <b>if</b> (<a class="local col9 ref" href="#849vs" title='vs' data-ref="849vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::levels" title='VncTight::levels' data-ref="VncTight::levels">levels</a>[<a class="local col0 ref" href="#850stream_id" title='stream_id' data-ref="850stream_id">stream_id</a>] != <a class="local col1 ref" href="#851level" title='level' data-ref="851level">level</a>) {</td></tr>
<tr><th id="812">812</th><td>        <b>if</b> (<a class="ref" href="../../include/zlib.h.html#deflateParams" title='deflateParams' data-ref="deflateParams">deflateParams</a>(<a class="local col3 ref" href="#853zstream" title='zstream' data-ref="853zstream">zstream</a>, <a class="local col1 ref" href="#851level" title='level' data-ref="851level">level</a>, <a class="local col2 ref" href="#852strategy" title='strategy' data-ref="852strategy">strategy</a>) != <a class="macro" href="../../include/zlib.h.html#173" title="0" data-ref="_M/Z_OK">Z_OK</a>) {</td></tr>
<tr><th id="813">813</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="814">814</th><td>        }</td></tr>
<tr><th id="815">815</th><td>        <a class="local col9 ref" href="#849vs" title='vs' data-ref="849vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::levels" title='VncTight::levels' data-ref="VncTight::levels">levels</a>[<a class="local col0 ref" href="#850stream_id" title='stream_id' data-ref="850stream_id">stream_id</a>] = <a class="local col1 ref" href="#851level" title='level' data-ref="851level">level</a>;</td></tr>
<tr><th id="816">816</th><td>    }</td></tr>
<tr><th id="817">817</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="818">818</th><td>}</td></tr>
<tr><th id="819">819</th><td></td></tr>
<tr><th id="820">820</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="tight_send_compact_size" title='tight_send_compact_size' data-type='void tight_send_compact_size(VncState * vs, size_t len)' data-ref="tight_send_compact_size">tight_send_compact_size</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col5 decl" id="855vs" title='vs' data-type='VncState *' data-ref="855vs">vs</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col6 decl" id="856len" title='len' data-type='size_t' data-ref="856len">len</dfn>)</td></tr>
<tr><th id="821">821</th><td>{</td></tr>
<tr><th id="822">822</th><td>    <em>int</em> <dfn class="local col7 decl" id="857lpc" title='lpc' data-type='int' data-ref="857lpc">lpc</dfn> = <var>0</var>;</td></tr>
<tr><th id="823">823</th><td>    <em>int</em> <dfn class="local col8 decl" id="858bytes" title='bytes' data-type='int' data-ref="858bytes">bytes</dfn> = <var>0</var>;</td></tr>
<tr><th id="824">824</th><td>    <em>char</em> <dfn class="local col9 decl" id="859buf" title='buf' data-type='char [3]' data-ref="859buf">buf</dfn>[<var>3</var>] = {<var>0</var>, <var>0</var>, <var>0</var>};</td></tr>
<tr><th id="825">825</th><td></td></tr>
<tr><th id="826">826</th><td>    <a class="local col9 ref" href="#859buf" title='buf' data-ref="859buf">buf</a>[<a class="local col8 ref" href="#858bytes" title='bytes' data-ref="858bytes">bytes</a>++] = <a class="local col6 ref" href="#856len" title='len' data-ref="856len">len</a> &amp; <var>0x7F</var>;</td></tr>
<tr><th id="827">827</th><td>    <b>if</b> (<a class="local col6 ref" href="#856len" title='len' data-ref="856len">len</a> &gt; <var>0x7F</var>) {</td></tr>
<tr><th id="828">828</th><td>        <a class="local col9 ref" href="#859buf" title='buf' data-ref="859buf">buf</a>[<a class="local col8 ref" href="#858bytes" title='bytes' data-ref="858bytes">bytes</a>-<var>1</var>] |= <var>0x80</var>;</td></tr>
<tr><th id="829">829</th><td>        <a class="local col9 ref" href="#859buf" title='buf' data-ref="859buf">buf</a>[<a class="local col8 ref" href="#858bytes" title='bytes' data-ref="858bytes">bytes</a>++] = (<a class="local col6 ref" href="#856len" title='len' data-ref="856len">len</a> &gt;&gt; <var>7</var>) &amp; <var>0x7F</var>;</td></tr>
<tr><th id="830">830</th><td>        <b>if</b> (<a class="local col6 ref" href="#856len" title='len' data-ref="856len">len</a> &gt; <var>0x3FFF</var>) {</td></tr>
<tr><th id="831">831</th><td>            <a class="local col9 ref" href="#859buf" title='buf' data-ref="859buf">buf</a>[<a class="local col8 ref" href="#858bytes" title='bytes' data-ref="858bytes">bytes</a>-<var>1</var>] |= <var>0x80</var>;</td></tr>
<tr><th id="832">832</th><td>            <a class="local col9 ref" href="#859buf" title='buf' data-ref="859buf">buf</a>[<a class="local col8 ref" href="#858bytes" title='bytes' data-ref="858bytes">bytes</a>++] = (<a class="local col6 ref" href="#856len" title='len' data-ref="856len">len</a> &gt;&gt; <var>14</var>) &amp; <var>0xFF</var>;</td></tr>
<tr><th id="833">833</th><td>        }</td></tr>
<tr><th id="834">834</th><td>    }</td></tr>
<tr><th id="835">835</th><td>    <b>for</b> (<a class="local col7 ref" href="#857lpc" title='lpc' data-ref="857lpc">lpc</a> = <var>0</var>; <a class="local col7 ref" href="#857lpc" title='lpc' data-ref="857lpc">lpc</a> &lt; <a class="local col8 ref" href="#858bytes" title='bytes' data-ref="858bytes">bytes</a>; <a class="local col7 ref" href="#857lpc" title='lpc' data-ref="857lpc">lpc</a>++) {</td></tr>
<tr><th id="836">836</th><td>        <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col5 ref" href="#855vs" title='vs' data-ref="855vs">vs</a>, <a class="local col9 ref" href="#859buf" title='buf' data-ref="859buf">buf</a>[<a class="local col7 ref" href="#857lpc" title='lpc' data-ref="857lpc">lpc</a>]);</td></tr>
<tr><th id="837">837</th><td>    }</td></tr>
<tr><th id="838">838</th><td>}</td></tr>
<tr><th id="839">839</th><td></td></tr>
<tr><th id="840">840</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="tight_compress_data" title='tight_compress_data' data-type='int tight_compress_data(VncState * vs, int stream_id, size_t bytes, int level, int strategy)' data-ref="tight_compress_data">tight_compress_data</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col0 decl" id="860vs" title='vs' data-type='VncState *' data-ref="860vs">vs</dfn>, <em>int</em> <dfn class="local col1 decl" id="861stream_id" title='stream_id' data-type='int' data-ref="861stream_id">stream_id</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col2 decl" id="862bytes" title='bytes' data-type='size_t' data-ref="862bytes">bytes</dfn>,</td></tr>
<tr><th id="841">841</th><td>                               <em>int</em> <dfn class="local col3 decl" id="863level" title='level' data-type='int' data-ref="863level">level</dfn>, <em>int</em> <dfn class="local col4 decl" id="864strategy" title='strategy' data-type='int' data-ref="864strategy">strategy</dfn>)</td></tr>
<tr><th id="842">842</th><td>{</td></tr>
<tr><th id="843">843</th><td>    <a class="typedef" href="../../include/zlib.h.html#z_streamp" title='z_streamp' data-type='z_stream *' data-ref="z_streamp">z_streamp</a> <dfn class="local col5 decl" id="865zstream" title='zstream' data-type='z_streamp' data-ref="865zstream">zstream</dfn> = &amp;<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::stream" title='VncTight::stream' data-ref="VncTight::stream">stream</a>[<a class="local col1 ref" href="#861stream_id" title='stream_id' data-ref="861stream_id">stream_id</a>];</td></tr>
<tr><th id="844">844</th><td>    <em>int</em> <dfn class="local col6 decl" id="866previous_out" title='previous_out' data-type='int' data-ref="866previous_out">previous_out</dfn>;</td></tr>
<tr><th id="845">845</th><td></td></tr>
<tr><th id="846">846</th><td>    <b>if</b> (<a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a> &lt; <a class="macro" href="vnc-enc-tight.h.html#171" title="12" data-ref="_M/VNC_TIGHT_MIN_TO_COMPRESS">VNC_TIGHT_MIN_TO_COMPRESS</a>) {</td></tr>
<tr><th id="847">847</th><td>        <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>, <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>);</td></tr>
<tr><th id="848">848</th><td>        <b>return</b> <a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a>;</td></tr>
<tr><th id="849">849</th><td>    }</td></tr>
<tr><th id="850">850</th><td></td></tr>
<tr><th id="851">851</th><td>    <b>if</b> (<a class="tu ref" href="#tight_init_stream" title='tight_init_stream' data-use='c' data-ref="tight_init_stream">tight_init_stream</a>(<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>, <a class="local col1 ref" href="#861stream_id" title='stream_id' data-ref="861stream_id">stream_id</a>, <a class="local col3 ref" href="#863level" title='level' data-ref="863level">level</a>, <a class="local col4 ref" href="#864strategy" title='strategy' data-ref="864strategy">strategy</a>)) {</td></tr>
<tr><th id="852">852</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="853">853</th><td>    }</td></tr>
<tr><th id="854">854</th><td></td></tr>
<tr><th id="855">855</th><td>    <i>/* reserve memory in output buffer */</i></td></tr>
<tr><th id="856">856</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reserve" title='buffer_reserve' data-ref="buffer_reserve">buffer_reserve</a>(&amp;<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>, <a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a> + <var>64</var>);</td></tr>
<tr><th id="857">857</th><td></td></tr>
<tr><th id="858">858</th><td>    <i>/* set pointers */</i></td></tr>
<tr><th id="859">859</th><td>    <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::next_in" title='z_stream_s::next_in' data-ref="z_stream_s::next_in">next_in</a> = <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>;</td></tr>
<tr><th id="860">860</th><td>    <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::avail_in" title='z_stream_s::avail_in' data-ref="z_stream_s::avail_in">avail_in</a> = <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>;</td></tr>
<tr><th id="861">861</th><td>    <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::next_out" title='z_stream_s::next_out' data-ref="z_stream_s::next_out">next_out</a> = <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a> + <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>;</td></tr>
<tr><th id="862">862</th><td>    <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::avail_out" title='z_stream_s::avail_out' data-ref="z_stream_s::avail_out">avail_out</a> = <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::capacity" title='Buffer::capacity' data-ref="Buffer::capacity">capacity</a> - <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>;</td></tr>
<tr><th id="863">863</th><td>    <a class="local col6 ref" href="#866previous_out" title='previous_out' data-ref="866previous_out">previous_out</a> = <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::avail_out" title='z_stream_s::avail_out' data-ref="z_stream_s::avail_out">avail_out</a>;</td></tr>
<tr><th id="864">864</th><td>    <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::data_type" title='z_stream_s::data_type' data-ref="z_stream_s::data_type">data_type</a> = <a class="macro" href="../../include/zlib.h.html#199" title="0" data-ref="_M/Z_BINARY">Z_BINARY</a>;</td></tr>
<tr><th id="865">865</th><td></td></tr>
<tr><th id="866">866</th><td>    <i>/* start encoding */</i></td></tr>
<tr><th id="867">867</th><td>    <b>if</b> (<a class="ref" href="../../include/zlib.h.html#deflate" title='deflate' data-ref="deflate">deflate</a>(<a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>, <a class="macro" href="../../include/zlib.h.html#166" title="2" data-ref="_M/Z_SYNC_FLUSH">Z_SYNC_FLUSH</a>) != <a class="macro" href="../../include/zlib.h.html#173" title="0" data-ref="_M/Z_OK">Z_OK</a>) {</td></tr>
<tr><th id="868">868</th><td>        <a class="ref" href="../../include/stdio.h.html#fprintf" title='fprintf' data-ref="fprintf">fprintf</a>(<a class="macro" href="../../include/stdio.h.html#174" title="stderr" data-ref="_M/stderr">stderr</a>, <q>"VNC: error during tight compression\n"</q>);</td></tr>
<tr><th id="869">869</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="870">870</th><td>    }</td></tr>
<tr><th id="871">871</th><td></td></tr>
<tr><th id="872">872</th><td>    <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> = <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::capacity" title='Buffer::capacity' data-ref="Buffer::capacity">capacity</a> - <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::avail_out" title='z_stream_s::avail_out' data-ref="z_stream_s::avail_out">avail_out</a>;</td></tr>
<tr><th id="873">873</th><td>    <i>/* ...how much data has actually been produced by deflate() */</i></td></tr>
<tr><th id="874">874</th><td>    <a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a> = <a class="local col6 ref" href="#866previous_out" title='previous_out' data-ref="866previous_out">previous_out</a> - <a class="local col5 ref" href="#865zstream" title='zstream' data-ref="865zstream">zstream</a>-&gt;<a class="ref" href="../../include/zlib.h.html#z_stream_s::avail_out" title='z_stream_s::avail_out' data-ref="z_stream_s::avail_out">avail_out</a>;</td></tr>
<tr><th id="875">875</th><td></td></tr>
<tr><th id="876">876</th><td>    <a class="tu ref" href="#tight_send_compact_size" title='tight_send_compact_size' data-use='c' data-ref="tight_send_compact_size">tight_send_compact_size</a>(<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>, <a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a>);</td></tr>
<tr><th id="877">877</th><td>    <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>, <a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a>);</td></tr>
<tr><th id="878">878</th><td></td></tr>
<tr><th id="879">879</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reset" title='buffer_reset' data-ref="buffer_reset">buffer_reset</a>(&amp;<a class="local col0 ref" href="#860vs" title='vs' data-ref="860vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>);</td></tr>
<tr><th id="880">880</th><td></td></tr>
<tr><th id="881">881</th><td>    <b>return</b> <a class="local col2 ref" href="#862bytes" title='bytes' data-ref="862bytes">bytes</a>;</td></tr>
<tr><th id="882">882</th><td>}</td></tr>
<tr><th id="883">883</th><td></td></tr>
<tr><th id="884">884</th><td><i  data-doc="tight_pack24">/*</i></td></tr>
<tr><th id="885">885</th><td><i  data-doc="tight_pack24"> * Subencoding implementations.</i></td></tr>
<tr><th id="886">886</th><td><i  data-doc="tight_pack24"> */</i></td></tr>
<tr><th id="887">887</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="tight_pack24" title='tight_pack24' data-type='void tight_pack24(VncState * vs, uint8_t * buf, size_t count, size_t * ret)' data-ref="tight_pack24">tight_pack24</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col7 decl" id="867vs" title='vs' data-type='VncState *' data-ref="867vs">vs</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col8 decl" id="868buf" title='buf' data-type='uint8_t *' data-ref="868buf">buf</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col9 decl" id="869count" title='count' data-type='size_t' data-ref="869count">count</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> *<dfn class="local col0 decl" id="870ret" title='ret' data-type='size_t *' data-ref="870ret">ret</dfn>)</td></tr>
<tr><th id="888">888</th><td>{</td></tr>
<tr><th id="889">889</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *<dfn class="local col1 decl" id="871buf32" title='buf32' data-type='uint32_t *' data-ref="871buf32">buf32</dfn>;</td></tr>
<tr><th id="890">890</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="872pix" title='pix' data-type='uint32_t' data-ref="872pix">pix</dfn>;</td></tr>
<tr><th id="891">891</th><td>    <em>int</em> <dfn class="local col3 decl" id="873rshift" title='rshift' data-type='int' data-ref="873rshift">rshift</dfn>, <dfn class="local col4 decl" id="874gshift" title='gshift' data-type='int' data-ref="874gshift">gshift</dfn>, <dfn class="local col5 decl" id="875bshift" title='bshift' data-type='int' data-ref="875bshift">bshift</dfn>;</td></tr>
<tr><th id="892">892</th><td></td></tr>
<tr><th id="893">893</th><td>    <a class="local col1 ref" href="#871buf32" title='buf32' data-ref="871buf32">buf32</a> = (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *)<a class="local col8 ref" href="#868buf" title='buf' data-ref="868buf">buf</a>;</td></tr>
<tr><th id="894">894</th><td></td></tr>
<tr><th id="895">895</th><td>    <b>if</b> (<var>1</var> <i>/* FIXME */</i>) {</td></tr>
<tr><th id="896">896</th><td>        <a class="local col3 ref" href="#873rshift" title='rshift' data-ref="873rshift">rshift</a> = <a class="local col7 ref" href="#867vs" title='vs' data-ref="867vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>;</td></tr>
<tr><th id="897">897</th><td>        <a class="local col4 ref" href="#874gshift" title='gshift' data-ref="874gshift">gshift</a> = <a class="local col7 ref" href="#867vs" title='vs' data-ref="867vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>;</td></tr>
<tr><th id="898">898</th><td>        <a class="local col5 ref" href="#875bshift" title='bshift' data-ref="875bshift">bshift</a> = <a class="local col7 ref" href="#867vs" title='vs' data-ref="867vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>;</td></tr>
<tr><th id="899">899</th><td>    } <b>else</b> {</td></tr>
<tr><th id="900">900</th><td>        <a class="local col3 ref" href="#873rshift" title='rshift' data-ref="873rshift">rshift</a> = <var>24</var> - <a class="local col7 ref" href="#867vs" title='vs' data-ref="867vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>;</td></tr>
<tr><th id="901">901</th><td>        <a class="local col4 ref" href="#874gshift" title='gshift' data-ref="874gshift">gshift</a> = <var>24</var> - <a class="local col7 ref" href="#867vs" title='vs' data-ref="867vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>;</td></tr>
<tr><th id="902">902</th><td>        <a class="local col5 ref" href="#875bshift" title='bshift' data-ref="875bshift">bshift</a> = <var>24</var> - <a class="local col7 ref" href="#867vs" title='vs' data-ref="867vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>;</td></tr>
<tr><th id="903">903</th><td>    }</td></tr>
<tr><th id="904">904</th><td></td></tr>
<tr><th id="905">905</th><td>    <b>if</b> (<a class="local col0 ref" href="#870ret" title='ret' data-ref="870ret">ret</a>) {</td></tr>
<tr><th id="906">906</th><td>        *<a class="local col0 ref" href="#870ret" title='ret' data-ref="870ret">ret</a> = <a class="local col9 ref" href="#869count" title='count' data-ref="869count">count</a> * <var>3</var>;</td></tr>
<tr><th id="907">907</th><td>    }</td></tr>
<tr><th id="908">908</th><td></td></tr>
<tr><th id="909">909</th><td>    <b>while</b> (<a class="local col9 ref" href="#869count" title='count' data-ref="869count">count</a>--) {</td></tr>
<tr><th id="910">910</th><td>        <a class="local col2 ref" href="#872pix" title='pix' data-ref="872pix">pix</a> = *<a class="local col1 ref" href="#871buf32" title='buf32' data-ref="871buf32">buf32</a>++;</td></tr>
<tr><th id="911">911</th><td>        *<a class="local col8 ref" href="#868buf" title='buf' data-ref="868buf">buf</a>++ = (<em>char</em>)(<a class="local col2 ref" href="#872pix" title='pix' data-ref="872pix">pix</a> &gt;&gt; <a class="local col3 ref" href="#873rshift" title='rshift' data-ref="873rshift">rshift</a>);</td></tr>
<tr><th id="912">912</th><td>        *<a class="local col8 ref" href="#868buf" title='buf' data-ref="868buf">buf</a>++ = (<em>char</em>)(<a class="local col2 ref" href="#872pix" title='pix' data-ref="872pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#874gshift" title='gshift' data-ref="874gshift">gshift</a>);</td></tr>
<tr><th id="913">913</th><td>        *<a class="local col8 ref" href="#868buf" title='buf' data-ref="868buf">buf</a>++ = (<em>char</em>)(<a class="local col2 ref" href="#872pix" title='pix' data-ref="872pix">pix</a> &gt;&gt; <a class="local col5 ref" href="#875bshift" title='bshift' data-ref="875bshift">bshift</a>);</td></tr>
<tr><th id="914">914</th><td>    }</td></tr>
<tr><th id="915">915</th><td>}</td></tr>
<tr><th id="916">916</th><td></td></tr>
<tr><th id="917">917</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_full_color_rect" title='send_full_color_rect' data-type='int send_full_color_rect(VncState * vs, int x, int y, int w, int h)' data-ref="send_full_color_rect">send_full_color_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col6 decl" id="876vs" title='vs' data-type='VncState *' data-ref="876vs">vs</dfn>, <em>int</em> <dfn class="local col7 decl" id="877x" title='x' data-type='int' data-ref="877x">x</dfn>, <em>int</em> <dfn class="local col8 decl" id="878y" title='y' data-type='int' data-ref="878y">y</dfn>, <em>int</em> <dfn class="local col9 decl" id="879w" title='w' data-type='int' data-ref="879w">w</dfn>, <em>int</em> <dfn class="local col0 decl" id="880h" title='h' data-type='int' data-ref="880h">h</dfn>)</td></tr>
<tr><th id="918">918</th><td>{</td></tr>
<tr><th id="919">919</th><td>    <em>int</em> <dfn class="local col1 decl" id="881stream" title='stream' data-type='int' data-ref="881stream">stream</dfn> = <var>0</var>;</td></tr>
<tr><th id="920">920</th><td>    <a class="typedef" href="../../include/x86_64-linux-gnu/sys/types.h.html#ssize_t" title='ssize_t' data-type='__ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="local col2 decl" id="882bytes" title='bytes' data-type='ssize_t' data-ref="882bytes">bytes</dfn>;</td></tr>
<tr><th id="921">921</th><td></td></tr>
<tr><th id="922">922</th><td><u>#<span data-ppcond="922">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="923">923</th><td>    <b>if</b> (<a class="tu ref" href="#tight_can_send_png_rect" title='tight_can_send_png_rect' data-use='c' data-ref="tight_can_send_png_rect">tight_can_send_png_rect</a>(<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>, <a class="local col9 ref" href="#879w" title='w' data-ref="879w">w</a>, <a class="local col0 ref" href="#880h" title='h' data-ref="880h">h</a>)) {</td></tr>
<tr><th id="924">924</th><td>        <b>return</b> <a class="tu ref" href="#send_png_rect" title='send_png_rect' data-use='c' data-ref="send_png_rect">send_png_rect</a>(<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>, <a class="local col7 ref" href="#877x" title='x' data-ref="877x">x</a>, <a class="local col8 ref" href="#878y" title='y' data-ref="878y">y</a>, <a class="local col9 ref" href="#879w" title='w' data-ref="879w">w</a>, <a class="local col0 ref" href="#880h" title='h' data-ref="880h">h</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="925">925</th><td>    }</td></tr>
<tr><th id="926">926</th><td><u>#<span data-ppcond="922">endif</span></u></td></tr>
<tr><th id="927">927</th><td></td></tr>
<tr><th id="928">928</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>, <a class="local col1 ref" href="#881stream" title='stream' data-ref="881stream">stream</a> &lt;&lt; <var>4</var>); <i>/* no flushing, no filter */</i></td></tr>
<tr><th id="929">929</th><td></td></tr>
<tr><th id="930">930</th><td>    <b>if</b> (<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>) {</td></tr>
<tr><th id="931">931</th><td>        <a class="tu ref" href="#tight_pack24" title='tight_pack24' data-use='c' data-ref="tight_pack24">tight_pack24</a>(<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>, <a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col9 ref" href="#879w" title='w' data-ref="879w">w</a> * <a class="local col0 ref" href="#880h" title='h' data-ref="880h">h</a>, &amp;<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>);</td></tr>
<tr><th id="932">932</th><td>        <a class="local col2 ref" href="#882bytes" title='bytes' data-ref="882bytes">bytes</a> = <var>3</var>;</td></tr>
<tr><th id="933">933</th><td>    } <b>else</b> {</td></tr>
<tr><th id="934">934</th><td>        <a class="local col2 ref" href="#882bytes" title='bytes' data-ref="882bytes">bytes</a> = <a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a>;</td></tr>
<tr><th id="935">935</th><td>    }</td></tr>
<tr><th id="936">936</th><td></td></tr>
<tr><th id="937">937</th><td>    <a class="local col2 ref" href="#882bytes" title='bytes' data-ref="882bytes">bytes</a> = <a class="tu ref" href="#tight_compress_data" title='tight_compress_data' data-use='c' data-ref="tight_compress_data">tight_compress_data</a>(<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>, <a class="local col1 ref" href="#881stream" title='stream' data-ref="881stream">stream</a>, <a class="local col9 ref" href="#879w" title='w' data-ref="879w">w</a> * <a class="local col0 ref" href="#880h" title='h' data-ref="880h">h</a> * <a class="local col2 ref" href="#882bytes" title='bytes' data-ref="882bytes">bytes</a>,</td></tr>
<tr><th id="938">938</th><td>                                <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col6 ref" href="#876vs" title='vs' data-ref="876vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col3 ref" href="#563raw_zlib_level" title='raw_zlib_level' data-ref="563raw_zlib_level">raw_zlib_level</a>,</td></tr>
<tr><th id="939">939</th><td>                                <a class="macro" href="../../include/zlib.h.html#196" title="0" data-ref="_M/Z_DEFAULT_STRATEGY">Z_DEFAULT_STRATEGY</a>);</td></tr>
<tr><th id="940">940</th><td></td></tr>
<tr><th id="941">941</th><td>    <b>return</b> (<a class="local col2 ref" href="#882bytes" title='bytes' data-ref="882bytes">bytes</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="942">942</th><td>}</td></tr>
<tr><th id="943">943</th><td></td></tr>
<tr><th id="944">944</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_solid_rect" title='send_solid_rect' data-type='int send_solid_rect(VncState * vs)' data-ref="send_solid_rect">send_solid_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col3 decl" id="883vs" title='vs' data-type='VncState *' data-ref="883vs">vs</dfn>)</td></tr>
<tr><th id="945">945</th><td>{</td></tr>
<tr><th id="946">946</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col4 decl" id="884bytes" title='bytes' data-type='size_t' data-ref="884bytes">bytes</dfn>;</td></tr>
<tr><th id="947">947</th><td></td></tr>
<tr><th id="948">948</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>, <a class="macro" href="vnc-enc-tight.h.html#160" title="0x08" data-ref="_M/VNC_TIGHT_FILL">VNC_TIGHT_FILL</a> &lt;&lt; <var>4</var>); <i>/* no flushing, no filter */</i></td></tr>
<tr><th id="949">949</th><td></td></tr>
<tr><th id="950">950</th><td>    <b>if</b> (<a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>) {</td></tr>
<tr><th id="951">951</th><td>        <a class="tu ref" href="#tight_pack24" title='tight_pack24' data-use='c' data-ref="tight_pack24">tight_pack24</a>(<a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>, <a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <var>1</var>, &amp;<a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>);</td></tr>
<tr><th id="952">952</th><td>        <a class="local col4 ref" href="#884bytes" title='bytes' data-ref="884bytes">bytes</a> = <var>3</var>;</td></tr>
<tr><th id="953">953</th><td>    } <b>else</b> {</td></tr>
<tr><th id="954">954</th><td>        <a class="local col4 ref" href="#884bytes" title='bytes' data-ref="884bytes">bytes</a> = <a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a>;</td></tr>
<tr><th id="955">955</th><td>    }</td></tr>
<tr><th id="956">956</th><td></td></tr>
<tr><th id="957">957</th><td>    <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>, <a class="local col3 ref" href="#883vs" title='vs' data-ref="883vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col4 ref" href="#884bytes" title='bytes' data-ref="884bytes">bytes</a>);</td></tr>
<tr><th id="958">958</th><td>    <b>return</b> <var>1</var>;</td></tr>
<tr><th id="959">959</th><td>}</td></tr>
<tr><th id="960">960</th><td></td></tr>
<tr><th id="961">961</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_mono_rect" title='send_mono_rect' data-type='int send_mono_rect(VncState * vs, int x, int y, int w, int h, uint32_t bg, uint32_t fg)' data-ref="send_mono_rect">send_mono_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col5 decl" id="885vs" title='vs' data-type='VncState *' data-ref="885vs">vs</dfn>, <em>int</em> <dfn class="local col6 decl" id="886x" title='x' data-type='int' data-ref="886x">x</dfn>, <em>int</em> <dfn class="local col7 decl" id="887y" title='y' data-type='int' data-ref="887y">y</dfn>,</td></tr>
<tr><th id="962">962</th><td>                          <em>int</em> <dfn class="local col8 decl" id="888w" title='w' data-type='int' data-ref="888w">w</dfn>, <em>int</em> <dfn class="local col9 decl" id="889h" title='h' data-type='int' data-ref="889h">h</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="890bg" title='bg' data-type='uint32_t' data-ref="890bg">bg</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="891fg" title='fg' data-type='uint32_t' data-ref="891fg">fg</dfn>)</td></tr>
<tr><th id="963">963</th><td>{</td></tr>
<tr><th id="964">964</th><td>    <a class="typedef" href="../../include/x86_64-linux-gnu/sys/types.h.html#ssize_t" title='ssize_t' data-type='__ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="local col2 decl" id="892bytes" title='bytes' data-type='ssize_t' data-ref="892bytes">bytes</dfn>;</td></tr>
<tr><th id="965">965</th><td>    <em>int</em> <dfn class="local col3 decl" id="893stream" title='stream' data-type='int' data-ref="893stream">stream</dfn> = <var>1</var>;</td></tr>
<tr><th id="966">966</th><td>    <em>int</em> <dfn class="local col4 decl" id="894level" title='level' data-type='int' data-ref="894level">level</dfn> = <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col2 ref" href="#562mono_zlib_level" title='mono_zlib_level' data-ref="562mono_zlib_level">mono_zlib_level</a>;</td></tr>
<tr><th id="967">967</th><td></td></tr>
<tr><th id="968">968</th><td><u>#<span data-ppcond="968">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="969">969</th><td>    <b>if</b> (<a class="tu ref" href="#tight_can_send_png_rect" title='tight_can_send_png_rect' data-use='c' data-ref="tight_can_send_png_rect">tight_can_send_png_rect</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="local col8 ref" href="#888w" title='w' data-ref="888w">w</a>, <a class="local col9 ref" href="#889h" title='h' data-ref="889h">h</a>)) {</td></tr>
<tr><th id="970">970</th><td>        <em>int</em> <dfn class="local col5 decl" id="895ret" title='ret' data-type='int' data-ref="895ret">ret</dfn>;</td></tr>
<tr><th id="971">971</th><td>        <em>int</em> <dfn class="local col6 decl" id="896bpp" title='bpp' data-type='int' data-ref="896bpp">bpp</dfn> = <a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> * <var>8</var>;</td></tr>
<tr><th id="972">972</th><td>        <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col7 decl" id="897palette" title='palette' data-type='VncPalette *' data-ref="897palette">palette</dfn> = <a class="ref" href="vnc-palette.h.html#palette_new" title='palette_new' data-ref="palette_new">palette_new</a>(<var>2</var>, <a class="local col6 ref" href="#896bpp" title='bpp' data-ref="896bpp">bpp</a>);</td></tr>
<tr><th id="973">973</th><td></td></tr>
<tr><th id="974">974</th><td>        <a class="ref" href="vnc-palette.h.html#palette_put" title='palette_put' data-ref="palette_put">palette_put</a>(<a class="local col7 ref" href="#897palette" title='palette' data-ref="897palette">palette</a>, <a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>);</td></tr>
<tr><th id="975">975</th><td>        <a class="ref" href="vnc-palette.h.html#palette_put" title='palette_put' data-ref="palette_put">palette_put</a>(<a class="local col7 ref" href="#897palette" title='palette' data-ref="897palette">palette</a>, <a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>);</td></tr>
<tr><th id="976">976</th><td>        <a class="local col5 ref" href="#895ret" title='ret' data-ref="895ret">ret</a> = <a class="tu ref" href="#send_png_rect" title='send_png_rect' data-use='c' data-ref="send_png_rect">send_png_rect</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="local col6 ref" href="#886x" title='x' data-ref="886x">x</a>, <a class="local col7 ref" href="#887y" title='y' data-ref="887y">y</a>, <a class="local col8 ref" href="#888w" title='w' data-ref="888w">w</a>, <a class="local col9 ref" href="#889h" title='h' data-ref="889h">h</a>, <a class="local col7 ref" href="#897palette" title='palette' data-ref="897palette">palette</a>);</td></tr>
<tr><th id="977">977</th><td>        <a class="ref" href="vnc-palette.h.html#palette_destroy" title='palette_destroy' data-ref="palette_destroy">palette_destroy</a>(<a class="local col7 ref" href="#897palette" title='palette' data-ref="897palette">palette</a>);</td></tr>
<tr><th id="978">978</th><td>        <b>return</b> <a class="local col5 ref" href="#895ret" title='ret' data-ref="895ret">ret</a>;</td></tr>
<tr><th id="979">979</th><td>    }</td></tr>
<tr><th id="980">980</th><td><u>#<span data-ppcond="968">endif</span></u></td></tr>
<tr><th id="981">981</th><td></td></tr>
<tr><th id="982">982</th><td>    <a class="local col2 ref" href="#892bytes" title='bytes' data-ref="892bytes">bytes</a> = ((<a class="local col8 ref" href="#888w" title='w' data-ref="888w">w</a> + <var>7</var>) / <var>8</var>) * <a class="local col9 ref" href="#889h" title='h' data-ref="889h">h</a>;</td></tr>
<tr><th id="983">983</th><td></td></tr>
<tr><th id="984">984</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, (<a class="local col3 ref" href="#893stream" title='stream' data-ref="893stream">stream</a> | <a class="macro" href="vnc-enc-tight.h.html#159" title="0x04" data-ref="_M/VNC_TIGHT_EXPLICIT_FILTER">VNC_TIGHT_EXPLICIT_FILTER</a>) &lt;&lt; <var>4</var>);</td></tr>
<tr><th id="985">985</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="macro" href="vnc-enc-tight.h.html#167" title="0x01" data-ref="_M/VNC_TIGHT_FILTER_PALETTE">VNC_TIGHT_FILTER_PALETTE</a>);</td></tr>
<tr><th id="986">986</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <var>1</var>);</td></tr>
<tr><th id="987">987</th><td></td></tr>
<tr><th id="988">988</th><td>    <b>switch</b> (<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a>) {</td></tr>
<tr><th id="989">989</th><td>    <b>case</b> <var>4</var>:</td></tr>
<tr><th id="990">990</th><td>    {</td></tr>
<tr><th id="991">991</th><td>        <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="898buf" title='buf' data-type='uint32_t [2]' data-ref="898buf">buf</dfn>[<var>2</var>] = {<a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>, <a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>};</td></tr>
<tr><th id="992">992</th><td>        <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col9 decl" id="899ret" title='ret' data-type='size_t' data-ref="899ret">ret</dfn> = <b>sizeof</b> (<a class="local col8 ref" href="#898buf" title='buf' data-ref="898buf">buf</a>);</td></tr>
<tr><th id="993">993</th><td></td></tr>
<tr><th id="994">994</th><td>        <b>if</b> (<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>) {</td></tr>
<tr><th id="995">995</th><td>            <a class="tu ref" href="#tight_pack24" title='tight_pack24' data-use='c' data-ref="tight_pack24">tight_pack24</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, (<em>unsigned</em> <em>char</em>*)<a class="local col8 ref" href="#898buf" title='buf' data-ref="898buf">buf</a>, <var>2</var>, &amp;<a class="local col9 ref" href="#899ret" title='ret' data-ref="899ret">ret</a>);</td></tr>
<tr><th id="996">996</th><td>        }</td></tr>
<tr><th id="997">997</th><td>        <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="local col8 ref" href="#898buf" title='buf' data-ref="898buf">buf</a>, <a class="local col9 ref" href="#899ret" title='ret' data-ref="899ret">ret</a>);</td></tr>
<tr><th id="998">998</th><td></td></tr>
<tr><th id="999">999</th><td>        <a class="tu ref" href="#542" title='tight_encode_mono_rect32' data-use='c' data-ref="tight_encode_mono_rect32">tight_encode_mono_rect32</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col8 ref" href="#888w" title='w' data-ref="888w">w</a>, <a class="local col9 ref" href="#889h" title='h' data-ref="889h">h</a>, <a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>, <a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>);</td></tr>
<tr><th id="1000">1000</th><td>        <b>break</b>;</td></tr>
<tr><th id="1001">1001</th><td>    }</td></tr>
<tr><th id="1002">1002</th><td>    <b>case</b> <var>2</var>:</td></tr>
<tr><th id="1003">1003</th><td>        <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, &amp;<a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>, <var>2</var>);</td></tr>
<tr><th id="1004">1004</th><td>        <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, &amp;<a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>, <var>2</var>);</td></tr>
<tr><th id="1005">1005</th><td>        <a class="tu ref" href="#541" title='tight_encode_mono_rect16' data-use='c' data-ref="tight_encode_mono_rect16">tight_encode_mono_rect16</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col8 ref" href="#888w" title='w' data-ref="888w">w</a>, <a class="local col9 ref" href="#889h" title='h' data-ref="889h">h</a>, <a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>, <a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>);</td></tr>
<tr><th id="1006">1006</th><td>        <b>break</b>;</td></tr>
<tr><th id="1007">1007</th><td>    <b>default</b>:</td></tr>
<tr><th id="1008">1008</th><td>        <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>);</td></tr>
<tr><th id="1009">1009</th><td>        <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>);</td></tr>
<tr><th id="1010">1010</th><td>        <a class="tu ref" href="#540" title='tight_encode_mono_rect8' data-use='c' data-ref="tight_encode_mono_rect8">tight_encode_mono_rect8</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col8 ref" href="#888w" title='w' data-ref="888w">w</a>, <a class="local col9 ref" href="#889h" title='h' data-ref="889h">h</a>, <a class="local col0 ref" href="#890bg" title='bg' data-ref="890bg">bg</a>, <a class="local col1 ref" href="#891fg" title='fg' data-ref="891fg">fg</a>);</td></tr>
<tr><th id="1011">1011</th><td>        <b>break</b>;</td></tr>
<tr><th id="1012">1012</th><td>    }</td></tr>
<tr><th id="1013">1013</th><td>    <a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> = <a class="local col2 ref" href="#892bytes" title='bytes' data-ref="892bytes">bytes</a>;</td></tr>
<tr><th id="1014">1014</th><td></td></tr>
<tr><th id="1015">1015</th><td>    <a class="local col2 ref" href="#892bytes" title='bytes' data-ref="892bytes">bytes</a> = <a class="tu ref" href="#tight_compress_data" title='tight_compress_data' data-use='c' data-ref="tight_compress_data">tight_compress_data</a>(<a class="local col5 ref" href="#885vs" title='vs' data-ref="885vs">vs</a>, <a class="local col3 ref" href="#893stream" title='stream' data-ref="893stream">stream</a>, <a class="local col2 ref" href="#892bytes" title='bytes' data-ref="892bytes">bytes</a>, <a class="local col4 ref" href="#894level" title='level' data-ref="894level">level</a>, <a class="macro" href="../../include/zlib.h.html#196" title="0" data-ref="_M/Z_DEFAULT_STRATEGY">Z_DEFAULT_STRATEGY</a>);</td></tr>
<tr><th id="1016">1016</th><td>    <b>return</b> (<a class="local col2 ref" href="#892bytes" title='bytes' data-ref="892bytes">bytes</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="1017">1017</th><td>}</td></tr>
<tr><th id="1018">1018</th><td></td></tr>
<tr><th id="1019">1019</th><td><b>struct</b> <dfn class="type def" id="palette_cb_priv" title='palette_cb_priv' data-ref="palette_cb_priv">palette_cb_priv</dfn> {</td></tr>
<tr><th id="1020">1020</th><td>    <a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="tu decl" id="palette_cb_priv::vs" title='palette_cb_priv::vs' data-type='VncState *' data-ref="palette_cb_priv::vs">vs</dfn>;</td></tr>
<tr><th id="1021">1021</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="tu decl" id="palette_cb_priv::header" title='palette_cb_priv::header' data-type='uint8_t *' data-ref="palette_cb_priv::header">header</dfn>;</td></tr>
<tr><th id="1022">1022</th><td><u>#<span data-ppcond="1022">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="1023">1023</th><td>    <a class="typedef" href="../../include/libpng12/png.h.html#png_colorp" title='png_colorp' data-type='png_color *' data-ref="png_colorp">png_colorp</a> <dfn class="tu decl" id="palette_cb_priv::png_palette" title='palette_cb_priv::png_palette' data-type='png_colorp' data-ref="palette_cb_priv::png_palette">png_palette</dfn>;</td></tr>
<tr><th id="1024">1024</th><td><u>#<span data-ppcond="1022">endif</span></u></td></tr>
<tr><th id="1025">1025</th><td>};</td></tr>
<tr><th id="1026">1026</th><td></td></tr>
<tr><th id="1027">1027</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="write_palette" title='write_palette' data-type='void write_palette(int idx, uint32_t color, void * opaque)' data-ref="write_palette">write_palette</dfn>(<em>int</em> <dfn class="local col0 decl" id="900idx" title='idx' data-type='int' data-ref="900idx">idx</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="901color" title='color' data-type='uint32_t' data-ref="901color">color</dfn>, <em>void</em> *<dfn class="local col2 decl" id="902opaque" title='opaque' data-type='void *' data-ref="902opaque">opaque</dfn>)</td></tr>
<tr><th id="1028">1028</th><td>{</td></tr>
<tr><th id="1029">1029</th><td>    <b>struct</b> <a class="type" href="#palette_cb_priv" title='palette_cb_priv' data-ref="palette_cb_priv">palette_cb_priv</a> *<dfn class="local col3 decl" id="903priv" title='priv' data-type='struct palette_cb_priv *' data-ref="903priv">priv</dfn> = <a class="local col2 ref" href="#902opaque" title='opaque' data-ref="902opaque">opaque</a>;</td></tr>
<tr><th id="1030">1030</th><td>    <a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col4 decl" id="904vs" title='vs' data-type='VncState *' data-ref="904vs">vs</dfn> = <a class="local col3 ref" href="#903priv" title='priv' data-ref="903priv">priv</a>-&gt;<a class="tu ref" href="#palette_cb_priv::vs" title='palette_cb_priv::vs' data-use='r' data-ref="palette_cb_priv::vs">vs</a>;</td></tr>
<tr><th id="1031">1031</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col5 decl" id="905bytes" title='bytes' data-type='uint32_t' data-ref="905bytes">bytes</dfn> = <a class="local col4 ref" href="#904vs" title='vs' data-ref="904vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a>;</td></tr>
<tr><th id="1032">1032</th><td></td></tr>
<tr><th id="1033">1033</th><td>    <b>if</b> (<a class="local col5 ref" href="#905bytes" title='bytes' data-ref="905bytes">bytes</a> == <var>4</var>) {</td></tr>
<tr><th id="1034">1034</th><td>        ((<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>*)<a class="local col3 ref" href="#903priv" title='priv' data-ref="903priv">priv</a>-&gt;<a class="tu ref" href="#palette_cb_priv::header" title='palette_cb_priv::header' data-use='r' data-ref="palette_cb_priv::header">header</a>)[<a class="local col0 ref" href="#900idx" title='idx' data-ref="900idx">idx</a>] = <a class="local col1 ref" href="#901color" title='color' data-ref="901color">color</a>;</td></tr>
<tr><th id="1035">1035</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1036">1036</th><td>        ((<a class="typedef" href="../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a>*)<a class="local col3 ref" href="#903priv" title='priv' data-ref="903priv">priv</a>-&gt;<a class="tu ref" href="#palette_cb_priv::header" title='palette_cb_priv::header' data-use='r' data-ref="palette_cb_priv::header">header</a>)[<a class="local col0 ref" href="#900idx" title='idx' data-ref="900idx">idx</a>] = <a class="local col1 ref" href="#901color" title='color' data-ref="901color">color</a>;</td></tr>
<tr><th id="1037">1037</th><td>    }</td></tr>
<tr><th id="1038">1038</th><td>}</td></tr>
<tr><th id="1039">1039</th><td></td></tr>
<tr><th id="1040">1040</th><td><em>static</em> <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="tu decl def" id="send_gradient_rect" title='send_gradient_rect' data-type='_Bool send_gradient_rect(VncState * vs, int x, int y, int w, int h)' data-ref="send_gradient_rect">send_gradient_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col6 decl" id="906vs" title='vs' data-type='VncState *' data-ref="906vs">vs</dfn>, <em>int</em> <dfn class="local col7 decl" id="907x" title='x' data-type='int' data-ref="907x">x</dfn>, <em>int</em> <dfn class="local col8 decl" id="908y" title='y' data-type='int' data-ref="908y">y</dfn>, <em>int</em> <dfn class="local col9 decl" id="909w" title='w' data-type='int' data-ref="909w">w</dfn>, <em>int</em> <dfn class="local col0 decl" id="910h" title='h' data-type='int' data-ref="910h">h</dfn>)</td></tr>
<tr><th id="1041">1041</th><td>{</td></tr>
<tr><th id="1042">1042</th><td>    <em>int</em> <dfn class="local col1 decl" id="911stream" title='stream' data-type='int' data-ref="911stream">stream</dfn> = <var>3</var>;</td></tr>
<tr><th id="1043">1043</th><td>    <em>int</em> <dfn class="local col2 decl" id="912level" title='level' data-type='int' data-ref="912level">level</dfn> = <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col4 ref" href="#564gradient_zlib_level" title='gradient_zlib_level' data-ref="564gradient_zlib_level">gradient_zlib_level</a>;</td></tr>
<tr><th id="1044">1044</th><td>    <a class="typedef" href="../../include/x86_64-linux-gnu/sys/types.h.html#ssize_t" title='ssize_t' data-type='__ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="local col3 decl" id="913bytes" title='bytes' data-type='ssize_t' data-ref="913bytes">bytes</dfn>;</td></tr>
<tr><th id="1045">1045</th><td></td></tr>
<tr><th id="1046">1046</th><td>    <b>if</b> (<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>1</var>) {</td></tr>
<tr><th id="1047">1047</th><td>        <b>return</b> <a class="tu ref" href="#send_full_color_rect" title='send_full_color_rect' data-use='c' data-ref="send_full_color_rect">send_full_color_rect</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, <a class="local col7 ref" href="#907x" title='x' data-ref="907x">x</a>, <a class="local col8 ref" href="#908y" title='y' data-ref="908y">y</a>, <a class="local col9 ref" href="#909w" title='w' data-ref="909w">w</a>, <a class="local col0 ref" href="#910h" title='h' data-ref="910h">h</a>);</td></tr>
<tr><th id="1048">1048</th><td>    }</td></tr>
<tr><th id="1049">1049</th><td></td></tr>
<tr><th id="1050">1050</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, (<a class="local col1 ref" href="#911stream" title='stream' data-ref="911stream">stream</a> | <a class="macro" href="vnc-enc-tight.h.html#159" title="0x04" data-ref="_M/VNC_TIGHT_EXPLICIT_FILTER">VNC_TIGHT_EXPLICIT_FILTER</a>) &lt;&lt; <var>4</var>);</td></tr>
<tr><th id="1051">1051</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, <a class="macro" href="vnc-enc-tight.h.html#168" title="0x02" data-ref="_M/VNC_TIGHT_FILTER_GRADIENT">VNC_TIGHT_FILTER_GRADIENT</a>);</td></tr>
<tr><th id="1052">1052</th><td></td></tr>
<tr><th id="1053">1053</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reserve" title='buffer_reserve' data-ref="buffer_reserve">buffer_reserve</a>(&amp;<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>, <a class="local col9 ref" href="#909w" title='w' data-ref="909w">w</a> * <var>3</var> * <b>sizeof</b> (<em>int</em>));</td></tr>
<tr><th id="1054">1054</th><td></td></tr>
<tr><th id="1055">1055</th><td>    <b>if</b> (<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>) {</td></tr>
<tr><th id="1056">1056</th><td>        <a class="tu ref" href="#tight_filter_gradient24" title='tight_filter_gradient24' data-use='c' data-ref="tight_filter_gradient24">tight_filter_gradient24</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, <a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col9 ref" href="#909w" title='w' data-ref="909w">w</a>, <a class="local col0 ref" href="#910h" title='h' data-ref="910h">h</a>);</td></tr>
<tr><th id="1057">1057</th><td>        <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a> = <var>3</var>;</td></tr>
<tr><th id="1058">1058</th><td>    } <b>else</b> <b>if</b> (<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>4</var>) {</td></tr>
<tr><th id="1059">1059</th><td>        <a class="tu ref" href="#667" title='tight_filter_gradient32' data-use='c' data-ref="tight_filter_gradient32">tight_filter_gradient32</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, (<a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> *)<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col9 ref" href="#909w" title='w' data-ref="909w">w</a>, <a class="local col0 ref" href="#910h" title='h' data-ref="910h">h</a>);</td></tr>
<tr><th id="1060">1060</th><td>        <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a> = <var>4</var>;</td></tr>
<tr><th id="1061">1061</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1062">1062</th><td>        <a class="tu ref" href="#666" title='tight_filter_gradient16' data-use='c' data-ref="tight_filter_gradient16">tight_filter_gradient16</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, (<a class="typedef" href="../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> *)<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col9 ref" href="#909w" title='w' data-ref="909w">w</a>, <a class="local col0 ref" href="#910h" title='h' data-ref="910h">h</a>);</td></tr>
<tr><th id="1063">1063</th><td>        <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a> = <var>2</var>;</td></tr>
<tr><th id="1064">1064</th><td>    }</td></tr>
<tr><th id="1065">1065</th><td></td></tr>
<tr><th id="1066">1066</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reset" title='buffer_reset' data-ref="buffer_reset">buffer_reset</a>(&amp;<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>);</td></tr>
<tr><th id="1067">1067</th><td></td></tr>
<tr><th id="1068">1068</th><td>    <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a> = <a class="local col9 ref" href="#909w" title='w' data-ref="909w">w</a> * <a class="local col0 ref" href="#910h" title='h' data-ref="910h">h</a> * <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a>;</td></tr>
<tr><th id="1069">1069</th><td>    <a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> = <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a>;</td></tr>
<tr><th id="1070">1070</th><td></td></tr>
<tr><th id="1071">1071</th><td>    <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a> = <a class="tu ref" href="#tight_compress_data" title='tight_compress_data' data-use='c' data-ref="tight_compress_data">tight_compress_data</a>(<a class="local col6 ref" href="#906vs" title='vs' data-ref="906vs">vs</a>, <a class="local col1 ref" href="#911stream" title='stream' data-ref="911stream">stream</a>, <a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a>,</td></tr>
<tr><th id="1072">1072</th><td>                                <a class="local col2 ref" href="#912level" title='level' data-ref="912level">level</a>, <a class="macro" href="../../include/zlib.h.html#192" title="1" data-ref="_M/Z_FILTERED">Z_FILTERED</a>);</td></tr>
<tr><th id="1073">1073</th><td>    <b>return</b> (<a class="local col3 ref" href="#913bytes" title='bytes' data-ref="913bytes">bytes</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="1074">1074</th><td>}</td></tr>
<tr><th id="1075">1075</th><td></td></tr>
<tr><th id="1076">1076</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_palette_rect" title='send_palette_rect' data-type='int send_palette_rect(VncState * vs, int x, int y, int w, int h, VncPalette * palette)' data-ref="send_palette_rect">send_palette_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col4 decl" id="914vs" title='vs' data-type='VncState *' data-ref="914vs">vs</dfn>, <em>int</em> <dfn class="local col5 decl" id="915x" title='x' data-type='int' data-ref="915x">x</dfn>, <em>int</em> <dfn class="local col6 decl" id="916y" title='y' data-type='int' data-ref="916y">y</dfn>,</td></tr>
<tr><th id="1077">1077</th><td>                             <em>int</em> <dfn class="local col7 decl" id="917w" title='w' data-type='int' data-ref="917w">w</dfn>, <em>int</em> <dfn class="local col8 decl" id="918h" title='h' data-type='int' data-ref="918h">h</dfn>, <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col9 decl" id="919palette" title='palette' data-type='VncPalette *' data-ref="919palette">palette</dfn>)</td></tr>
<tr><th id="1078">1078</th><td>{</td></tr>
<tr><th id="1079">1079</th><td>    <em>int</em> <dfn class="local col0 decl" id="920stream" title='stream' data-type='int' data-ref="920stream">stream</dfn> = <var>2</var>;</td></tr>
<tr><th id="1080">1080</th><td>    <em>int</em> <dfn class="local col1 decl" id="921level" title='level' data-type='int' data-ref="921level">level</dfn> = <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col1 ref" href="#561idx_zlib_level" title='idx_zlib_level' data-ref="561idx_zlib_level">idx_zlib_level</a>;</td></tr>
<tr><th id="1081">1081</th><td>    <em>int</em> <dfn class="local col2 decl" id="922colors" title='colors' data-type='int' data-ref="922colors">colors</dfn>;</td></tr>
<tr><th id="1082">1082</th><td>    <a class="typedef" href="../../include/x86_64-linux-gnu/sys/types.h.html#ssize_t" title='ssize_t' data-type='__ssize_t' data-ref="ssize_t">ssize_t</a> <dfn class="local col3 decl" id="923bytes" title='bytes' data-type='ssize_t' data-ref="923bytes">bytes</dfn>;</td></tr>
<tr><th id="1083">1083</th><td></td></tr>
<tr><th id="1084">1084</th><td><u>#<span data-ppcond="1084">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="1085">1085</th><td>    <b>if</b> (<a class="tu ref" href="#tight_can_send_png_rect" title='tight_can_send_png_rect' data-use='c' data-ref="tight_can_send_png_rect">tight_can_send_png_rect</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col7 ref" href="#917w" title='w' data-ref="917w">w</a>, <a class="local col8 ref" href="#918h" title='h' data-ref="918h">h</a>)) {</td></tr>
<tr><th id="1086">1086</th><td>        <b>return</b> <a class="tu ref" href="#send_png_rect" title='send_png_rect' data-use='c' data-ref="send_png_rect">send_png_rect</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col5 ref" href="#915x" title='x' data-ref="915x">x</a>, <a class="local col6 ref" href="#916y" title='y' data-ref="916y">y</a>, <a class="local col7 ref" href="#917w" title='w' data-ref="917w">w</a>, <a class="local col8 ref" href="#918h" title='h' data-ref="918h">h</a>, <a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>);</td></tr>
<tr><th id="1087">1087</th><td>    }</td></tr>
<tr><th id="1088">1088</th><td><u>#<span data-ppcond="1084">endif</span></u></td></tr>
<tr><th id="1089">1089</th><td></td></tr>
<tr><th id="1090">1090</th><td>    <a class="local col2 ref" href="#922colors" title='colors' data-ref="922colors">colors</a> = <a class="ref" href="vnc-palette.h.html#palette_size" title='palette_size' data-ref="palette_size">palette_size</a>(<a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>);</td></tr>
<tr><th id="1091">1091</th><td></td></tr>
<tr><th id="1092">1092</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, (<a class="local col0 ref" href="#920stream" title='stream' data-ref="920stream">stream</a> | <a class="macro" href="vnc-enc-tight.h.html#159" title="0x04" data-ref="_M/VNC_TIGHT_EXPLICIT_FILTER">VNC_TIGHT_EXPLICIT_FILTER</a>) &lt;&lt; <var>4</var>);</td></tr>
<tr><th id="1093">1093</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="macro" href="vnc-enc-tight.h.html#167" title="0x01" data-ref="_M/VNC_TIGHT_FILTER_PALETTE">VNC_TIGHT_FILTER_PALETTE</a>);</td></tr>
<tr><th id="1094">1094</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col2 ref" href="#922colors" title='colors' data-ref="922colors">colors</a> - <var>1</var>);</td></tr>
<tr><th id="1095">1095</th><td></td></tr>
<tr><th id="1096">1096</th><td>    <b>switch</b> (<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a>) {</td></tr>
<tr><th id="1097">1097</th><td>    <b>case</b> <var>4</var>:</td></tr>
<tr><th id="1098">1098</th><td>    {</td></tr>
<tr><th id="1099">1099</th><td>        <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col4 decl" id="924old_offset" title='old_offset' data-type='size_t' data-ref="924old_offset">old_offset</dfn>, <dfn class="local col5 decl" id="925offset" title='offset' data-type='size_t' data-ref="925offset">offset</dfn>;</td></tr>
<tr><th id="1100">1100</th><td>        <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="926header" title='header' data-type='uint32_t [palette_size(palette)]' data-ref="926header">header</dfn>[<a class="ref" href="vnc-palette.h.html#palette_size" title='palette_size' data-ref="palette_size">palette_size</a>(<a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>)];</td></tr>
<tr><th id="1101">1101</th><td>        <b>struct</b> <a class="type" href="#palette_cb_priv" title='palette_cb_priv' data-ref="palette_cb_priv">palette_cb_priv</a> <dfn class="local col7 decl" id="927priv" title='priv' data-type='struct palette_cb_priv' data-ref="927priv">priv</dfn> = { <a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *)<a class="local col6 ref" href="#926header" title='header' data-ref="926header">header</a> };</td></tr>
<tr><th id="1102">1102</th><td></td></tr>
<tr><th id="1103">1103</th><td>        <a class="local col4 ref" href="#924old_offset" title='old_offset' data-ref="924old_offset">old_offset</a> = <a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>;</td></tr>
<tr><th id="1104">1104</th><td>        <a class="ref" href="vnc-palette.h.html#palette_iter" title='palette_iter' data-ref="palette_iter">palette_iter</a>(<a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>, <a class="tu ref" href="#write_palette" title='write_palette' data-use='r' data-ref="write_palette">write_palette</a>, &amp;<a class="local col7 ref" href="#927priv" title='priv' data-ref="927priv">priv</a>);</td></tr>
<tr><th id="1105">1105</th><td>        <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col6 ref" href="#926header" title='header' data-ref="926header">header</a>, <b>sizeof</b>(<a class="local col6 ref" href="#926header" title='header' data-ref="926header">header</a>));</td></tr>
<tr><th id="1106">1106</th><td></td></tr>
<tr><th id="1107">1107</th><td>        <b>if</b> (<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>) {</td></tr>
<tr><th id="1108">1108</th><td>            <a class="tu ref" href="#tight_pack24" title='tight_pack24' data-use='c' data-ref="tight_pack24">tight_pack24</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a> + <a class="local col4 ref" href="#924old_offset" title='old_offset' data-ref="924old_offset">old_offset</a>, <a class="local col2 ref" href="#922colors" title='colors' data-ref="922colors">colors</a>, &amp;<a class="local col5 ref" href="#925offset" title='offset' data-ref="925offset">offset</a>);</td></tr>
<tr><th id="1109">1109</th><td>            <a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> = <a class="local col4 ref" href="#924old_offset" title='old_offset' data-ref="924old_offset">old_offset</a> + <a class="local col5 ref" href="#925offset" title='offset' data-ref="925offset">offset</a>;</td></tr>
<tr><th id="1110">1110</th><td>        }</td></tr>
<tr><th id="1111">1111</th><td></td></tr>
<tr><th id="1112">1112</th><td>        <a class="tu ref" href="#487" title='tight_encode_indexed_rect32' data-use='c' data-ref="tight_encode_indexed_rect32">tight_encode_indexed_rect32</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col7 ref" href="#917w" title='w' data-ref="917w">w</a> * <a class="local col8 ref" href="#918h" title='h' data-ref="918h">h</a>, <a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>);</td></tr>
<tr><th id="1113">1113</th><td>        <b>break</b>;</td></tr>
<tr><th id="1114">1114</th><td>    }</td></tr>
<tr><th id="1115">1115</th><td>    <b>case</b> <var>2</var>:</td></tr>
<tr><th id="1116">1116</th><td>    {</td></tr>
<tr><th id="1117">1117</th><td>        <a class="typedef" href="../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col8 decl" id="928header" title='header' data-type='uint16_t [palette_size(palette)]' data-ref="928header">header</dfn>[<a class="ref" href="vnc-palette.h.html#palette_size" title='palette_size' data-ref="palette_size">palette_size</a>(<a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>)];</td></tr>
<tr><th id="1118">1118</th><td>        <b>struct</b> <a class="type" href="#palette_cb_priv" title='palette_cb_priv' data-ref="palette_cb_priv">palette_cb_priv</a> <dfn class="local col9 decl" id="929priv" title='priv' data-type='struct palette_cb_priv' data-ref="929priv">priv</dfn> = { <a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *)<a class="local col8 ref" href="#928header" title='header' data-ref="928header">header</a> };</td></tr>
<tr><th id="1119">1119</th><td></td></tr>
<tr><th id="1120">1120</th><td>        <a class="ref" href="vnc-palette.h.html#palette_iter" title='palette_iter' data-ref="palette_iter">palette_iter</a>(<a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>, <a class="tu ref" href="#write_palette" title='write_palette' data-use='r' data-ref="write_palette">write_palette</a>, &amp;<a class="local col9 ref" href="#929priv" title='priv' data-ref="929priv">priv</a>);</td></tr>
<tr><th id="1121">1121</th><td>        <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col8 ref" href="#928header" title='header' data-ref="928header">header</a>, <b>sizeof</b>(<a class="local col8 ref" href="#928header" title='header' data-ref="928header">header</a>));</td></tr>
<tr><th id="1122">1122</th><td>        <a class="tu ref" href="#486" title='tight_encode_indexed_rect16' data-use='c' data-ref="tight_encode_indexed_rect16">tight_encode_indexed_rect16</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col7 ref" href="#917w" title='w' data-ref="917w">w</a> * <a class="local col8 ref" href="#918h" title='h' data-ref="918h">h</a>, <a class="local col9 ref" href="#919palette" title='palette' data-ref="919palette">palette</a>);</td></tr>
<tr><th id="1123">1123</th><td>        <b>break</b>;</td></tr>
<tr><th id="1124">1124</th><td>    }</td></tr>
<tr><th id="1125">1125</th><td>    <b>default</b>:</td></tr>
<tr><th id="1126">1126</th><td>        <b>return</b> -<var>1</var>; <i>/* No palette for 8bits colors */</i></td></tr>
<tr><th id="1127">1127</th><td>        <b>break</b>;</td></tr>
<tr><th id="1128">1128</th><td>    }</td></tr>
<tr><th id="1129">1129</th><td>    <a class="local col3 ref" href="#923bytes" title='bytes' data-ref="923bytes">bytes</a> = <a class="local col7 ref" href="#917w" title='w' data-ref="917w">w</a> * <a class="local col8 ref" href="#918h" title='h' data-ref="918h">h</a>;</td></tr>
<tr><th id="1130">1130</th><td>    <a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> = <a class="local col3 ref" href="#923bytes" title='bytes' data-ref="923bytes">bytes</a>;</td></tr>
<tr><th id="1131">1131</th><td></td></tr>
<tr><th id="1132">1132</th><td>    <a class="local col3 ref" href="#923bytes" title='bytes' data-ref="923bytes">bytes</a> = <a class="tu ref" href="#tight_compress_data" title='tight_compress_data' data-use='c' data-ref="tight_compress_data">tight_compress_data</a>(<a class="local col4 ref" href="#914vs" title='vs' data-ref="914vs">vs</a>, <a class="local col0 ref" href="#920stream" title='stream' data-ref="920stream">stream</a>, <a class="local col3 ref" href="#923bytes" title='bytes' data-ref="923bytes">bytes</a>,</td></tr>
<tr><th id="1133">1133</th><td>                                <a class="local col1 ref" href="#921level" title='level' data-ref="921level">level</a>, <a class="macro" href="../../include/zlib.h.html#196" title="0" data-ref="_M/Z_DEFAULT_STRATEGY">Z_DEFAULT_STRATEGY</a>);</td></tr>
<tr><th id="1134">1134</th><td>    <b>return</b> (<a class="local col3 ref" href="#923bytes" title='bytes' data-ref="923bytes">bytes</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="1135">1135</th><td>}</td></tr>
<tr><th id="1136">1136</th><td></td></tr>
<tr><th id="1137">1137</th><td><i>/*</i></td></tr>
<tr><th id="1138">1138</th><td><i> * JPEG compression stuff.</i></td></tr>
<tr><th id="1139">1139</th><td><i> */</i></td></tr>
<tr><th id="1140">1140</th><td><u>#<span data-ppcond="1140">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1141">1141</th><td><i>/*</i></td></tr>
<tr><th id="1142">1142</th><td><i> * Destination manager implementation for JPEG library.</i></td></tr>
<tr><th id="1143">1143</th><td><i> */</i></td></tr>
<tr><th id="1144">1144</th><td></td></tr>
<tr><th id="1145">1145</th><td><i>/* This is called once per encoding */</i></td></tr>
<tr><th id="1146">1146</th><td><em>static</em> <em>void</em> jpeg_init_destination(j_compress_ptr cinfo)</td></tr>
<tr><th id="1147">1147</th><td>{</td></tr>
<tr><th id="1148">1148</th><td>    VncState *vs = cinfo-&gt;client_data;</td></tr>
<tr><th id="1149">1149</th><td>    Buffer *buffer = &amp;vs-&gt;tight.jpeg;</td></tr>
<tr><th id="1150">1150</th><td></td></tr>
<tr><th id="1151">1151</th><td>    cinfo-&gt;dest-&gt;next_output_byte = (JOCTET *)buffer-&gt;buffer + buffer-&gt;offset;</td></tr>
<tr><th id="1152">1152</th><td>    cinfo-&gt;dest-&gt;free_in_buffer = (size_t)(buffer-&gt;capacity - buffer-&gt;offset);</td></tr>
<tr><th id="1153">1153</th><td>}</td></tr>
<tr><th id="1154">1154</th><td></td></tr>
<tr><th id="1155">1155</th><td><i>/* This is called when we ran out of buffer (shouldn't happen!) */</i></td></tr>
<tr><th id="1156">1156</th><td><em>static</em> boolean jpeg_empty_output_buffer(j_compress_ptr cinfo)</td></tr>
<tr><th id="1157">1157</th><td>{</td></tr>
<tr><th id="1158">1158</th><td>    VncState *vs = cinfo-&gt;client_data;</td></tr>
<tr><th id="1159">1159</th><td>    Buffer *buffer = &amp;vs-&gt;tight.jpeg;</td></tr>
<tr><th id="1160">1160</th><td></td></tr>
<tr><th id="1161">1161</th><td>    buffer-&gt;offset = buffer-&gt;capacity;</td></tr>
<tr><th id="1162">1162</th><td>    buffer_reserve(buffer, <var>2048</var>);</td></tr>
<tr><th id="1163">1163</th><td>    jpeg_init_destination(cinfo);</td></tr>
<tr><th id="1164">1164</th><td>    <b>return</b> TRUE;</td></tr>
<tr><th id="1165">1165</th><td>}</td></tr>
<tr><th id="1166">1166</th><td></td></tr>
<tr><th id="1167">1167</th><td><i>/* This is called when we are done processing data */</i></td></tr>
<tr><th id="1168">1168</th><td><em>static</em> <em>void</em> jpeg_term_destination(j_compress_ptr cinfo)</td></tr>
<tr><th id="1169">1169</th><td>{</td></tr>
<tr><th id="1170">1170</th><td>    VncState *vs = cinfo-&gt;client_data;</td></tr>
<tr><th id="1171">1171</th><td>    Buffer *buffer = &amp;vs-&gt;tight.jpeg;</td></tr>
<tr><th id="1172">1172</th><td></td></tr>
<tr><th id="1173">1173</th><td>    buffer-&gt;offset = buffer-&gt;capacity - cinfo-&gt;dest-&gt;free_in_buffer;</td></tr>
<tr><th id="1174">1174</th><td>}</td></tr>
<tr><th id="1175">1175</th><td></td></tr>
<tr><th id="1176">1176</th><td><em>static</em> <em>int</em> send_jpeg_rect(VncState *vs, <em>int</em> x, <em>int</em> y, <em>int</em> w, <em>int</em> h, <em>int</em> quality)</td></tr>
<tr><th id="1177">1177</th><td>{</td></tr>
<tr><th id="1178">1178</th><td>    <b>struct</b> jpeg_compress_struct cinfo;</td></tr>
<tr><th id="1179">1179</th><td>    <b>struct</b> jpeg_error_mgr jerr;</td></tr>
<tr><th id="1180">1180</th><td>    <b>struct</b> jpeg_destination_mgr manager;</td></tr>
<tr><th id="1181">1181</th><td>    pixman_image_t *linebuf;</td></tr>
<tr><th id="1182">1182</th><td>    JSAMPROW row[<var>1</var>];</td></tr>
<tr><th id="1183">1183</th><td>    uint8_t *buf;</td></tr>
<tr><th id="1184">1184</th><td>    <em>int</em> dy;</td></tr>
<tr><th id="1185">1185</th><td></td></tr>
<tr><th id="1186">1186</th><td>    <b>if</b> (surface_bytes_per_pixel(vs-&gt;vd-&gt;ds) == <var>1</var>) {</td></tr>
<tr><th id="1187">1187</th><td>        <b>return</b> send_full_color_rect(vs, x, y, w, h);</td></tr>
<tr><th id="1188">1188</th><td>    }</td></tr>
<tr><th id="1189">1189</th><td></td></tr>
<tr><th id="1190">1190</th><td>    buffer_reserve(&amp;vs-&gt;tight.jpeg, <var>2048</var>);</td></tr>
<tr><th id="1191">1191</th><td></td></tr>
<tr><th id="1192">1192</th><td>    cinfo.err = jpeg_std_error(&amp;jerr);</td></tr>
<tr><th id="1193">1193</th><td>    jpeg_create_compress(&amp;cinfo);</td></tr>
<tr><th id="1194">1194</th><td></td></tr>
<tr><th id="1195">1195</th><td>    cinfo.client_data = vs;</td></tr>
<tr><th id="1196">1196</th><td>    cinfo.image_width = w;</td></tr>
<tr><th id="1197">1197</th><td>    cinfo.image_height = h;</td></tr>
<tr><th id="1198">1198</th><td>    cinfo.input_components = <var>3</var>;</td></tr>
<tr><th id="1199">1199</th><td>    cinfo.in_color_space = JCS_RGB;</td></tr>
<tr><th id="1200">1200</th><td></td></tr>
<tr><th id="1201">1201</th><td>    jpeg_set_defaults(&amp;cinfo);</td></tr>
<tr><th id="1202">1202</th><td>    jpeg_set_quality(&amp;cinfo, quality, true);</td></tr>
<tr><th id="1203">1203</th><td></td></tr>
<tr><th id="1204">1204</th><td>    manager.init_destination = jpeg_init_destination;</td></tr>
<tr><th id="1205">1205</th><td>    manager.empty_output_buffer = jpeg_empty_output_buffer;</td></tr>
<tr><th id="1206">1206</th><td>    manager.term_destination = jpeg_term_destination;</td></tr>
<tr><th id="1207">1207</th><td>    cinfo.dest = &amp;manager;</td></tr>
<tr><th id="1208">1208</th><td></td></tr>
<tr><th id="1209">1209</th><td>    jpeg_start_compress(&amp;cinfo, true);</td></tr>
<tr><th id="1210">1210</th><td></td></tr>
<tr><th id="1211">1211</th><td>    linebuf = qemu_pixman_linebuf_create(PIXMAN_BE_r8g8b8, w);</td></tr>
<tr><th id="1212">1212</th><td>    buf = (uint8_t *)pixman_image_get_data(linebuf);</td></tr>
<tr><th id="1213">1213</th><td>    row[<var>0</var>] = buf;</td></tr>
<tr><th id="1214">1214</th><td>    <b>for</b> (dy = <var>0</var>; dy &lt; h; dy++) {</td></tr>
<tr><th id="1215">1215</th><td>        qemu_pixman_linebuf_fill(linebuf, vs-&gt;vd-&gt;server, w, x, y + dy);</td></tr>
<tr><th id="1216">1216</th><td>        jpeg_write_scanlines(&amp;cinfo, row, <var>1</var>);</td></tr>
<tr><th id="1217">1217</th><td>    }</td></tr>
<tr><th id="1218">1218</th><td>    qemu_pixman_image_unref(linebuf);</td></tr>
<tr><th id="1219">1219</th><td></td></tr>
<tr><th id="1220">1220</th><td>    jpeg_finish_compress(&amp;cinfo);</td></tr>
<tr><th id="1221">1221</th><td>    jpeg_destroy_compress(&amp;cinfo);</td></tr>
<tr><th id="1222">1222</th><td></td></tr>
<tr><th id="1223">1223</th><td>    vnc_write_u8(vs, VNC_TIGHT_JPEG &lt;&lt; <var>4</var>);</td></tr>
<tr><th id="1224">1224</th><td></td></tr>
<tr><th id="1225">1225</th><td>    tight_send_compact_size(vs, vs-&gt;tight.jpeg.offset);</td></tr>
<tr><th id="1226">1226</th><td>    vnc_write(vs, vs-&gt;tight.jpeg.buffer, vs-&gt;tight.jpeg.offset);</td></tr>
<tr><th id="1227">1227</th><td>    buffer_reset(&amp;vs-&gt;tight.jpeg);</td></tr>
<tr><th id="1228">1228</th><td></td></tr>
<tr><th id="1229">1229</th><td>    <b>return</b> <var>1</var>;</td></tr>
<tr><th id="1230">1230</th><td>}</td></tr>
<tr><th id="1231">1231</th><td><u>#<span data-ppcond="1140">endif</span> /* CONFIG_VNC_JPEG */</u></td></tr>
<tr><th id="1232">1232</th><td></td></tr>
<tr><th id="1233">1233</th><td><i>/*</i></td></tr>
<tr><th id="1234">1234</th><td><i> * PNG compression stuff.</i></td></tr>
<tr><th id="1235">1235</th><td><i> */</i></td></tr>
<tr><th id="1236">1236</th><td><u>#<span data-ppcond="1236">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="1237">1237</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="write_png_palette" title='write_png_palette' data-type='void write_png_palette(int idx, uint32_t pix, void * opaque)' data-ref="write_png_palette">write_png_palette</dfn>(<em>int</em> <dfn class="local col0 decl" id="930idx" title='idx' data-type='int' data-ref="930idx">idx</dfn>, <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="931pix" title='pix' data-type='uint32_t' data-ref="931pix">pix</dfn>, <em>void</em> *<dfn class="local col2 decl" id="932opaque" title='opaque' data-type='void *' data-ref="932opaque">opaque</dfn>)</td></tr>
<tr><th id="1238">1238</th><td>{</td></tr>
<tr><th id="1239">1239</th><td>    <b>struct</b> <a class="type" href="#palette_cb_priv" title='palette_cb_priv' data-ref="palette_cb_priv">palette_cb_priv</a> *<dfn class="local col3 decl" id="933priv" title='priv' data-type='struct palette_cb_priv *' data-ref="933priv">priv</dfn> = <a class="local col2 ref" href="#932opaque" title='opaque' data-ref="932opaque">opaque</a>;</td></tr>
<tr><th id="1240">1240</th><td>    <a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col4 decl" id="934vs" title='vs' data-type='VncState *' data-ref="934vs">vs</dfn> = <a class="local col3 ref" href="#933priv" title='priv' data-ref="933priv">priv</a>-&gt;<a class="tu ref" href="#palette_cb_priv::vs" title='palette_cb_priv::vs' data-use='r' data-ref="palette_cb_priv::vs">vs</a>;</td></tr>
<tr><th id="1241">1241</th><td>    <a class="typedef" href="../../include/libpng12/png.h.html#png_colorp" title='png_colorp' data-type='png_color *' data-ref="png_colorp">png_colorp</a> <dfn class="local col5 decl" id="935color" title='color' data-type='png_colorp' data-ref="935color">color</dfn> = &amp;<a class="local col3 ref" href="#933priv" title='priv' data-ref="933priv">priv</a>-&gt;<a class="tu ref" href="#palette_cb_priv::png_palette" title='palette_cb_priv::png_palette' data-use='r' data-ref="palette_cb_priv::png_palette">png_palette</a>[<a class="local col0 ref" href="#930idx" title='idx' data-ref="930idx">idx</a>];</td></tr>
<tr><th id="1242">1242</th><td></td></tr>
<tr><th id="1243">1243</th><td>    <b>if</b> (<a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a>)</td></tr>
<tr><th id="1244">1244</th><td>    {</td></tr>
<tr><th id="1245">1245</th><td>        <a class="local col5 ref" href="#935color" title='color' data-ref="935color">color</a>-&gt;<a class="ref" href="../../include/libpng12/png.h.html#png_color_struct::red" title='png_color_struct::red' data-ref="png_color_struct::red">red</a> = (<a class="local col1 ref" href="#931pix" title='pix' data-ref="931pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>) &amp; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a>;</td></tr>
<tr><th id="1246">1246</th><td>        <a class="local col5 ref" href="#935color" title='color' data-ref="935color">color</a>-&gt;<a class="ref" href="../../include/libpng12/png.h.html#png_color_struct::green" title='png_color_struct::green' data-ref="png_color_struct::green">green</a> = (<a class="local col1 ref" href="#931pix" title='pix' data-ref="931pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>) &amp; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a>;</td></tr>
<tr><th id="1247">1247</th><td>        <a class="local col5 ref" href="#935color" title='color' data-ref="935color">color</a>-&gt;<a class="ref" href="../../include/libpng12/png.h.html#png_color_struct::blue" title='png_color_struct::blue' data-ref="png_color_struct::blue">blue</a> = (<a class="local col1 ref" href="#931pix" title='pix' data-ref="931pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>) &amp; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a>;</td></tr>
<tr><th id="1248">1248</th><td>    }</td></tr>
<tr><th id="1249">1249</th><td>    <b>else</b></td></tr>
<tr><th id="1250">1250</th><td>    {</td></tr>
<tr><th id="1251">1251</th><td>        <em>int</em> <dfn class="local col6 decl" id="936red" title='red' data-type='int' data-ref="936red">red</dfn>, <dfn class="local col7 decl" id="937green" title='green' data-type='int' data-ref="937green">green</dfn>, <dfn class="local col8 decl" id="938blue" title='blue' data-type='int' data-ref="938blue">blue</dfn>;</td></tr>
<tr><th id="1252">1252</th><td></td></tr>
<tr><th id="1253">1253</th><td>        <a class="local col6 ref" href="#936red" title='red' data-ref="936red">red</a> = (<a class="local col1 ref" href="#931pix" title='pix' data-ref="931pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rshift" title='PixelFormat::rshift' data-ref="PixelFormat::rshift">rshift</a>) &amp; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a>;</td></tr>
<tr><th id="1254">1254</th><td>        <a class="local col7 ref" href="#937green" title='green' data-ref="937green">green</a> = (<a class="local col1 ref" href="#931pix" title='pix' data-ref="931pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gshift" title='PixelFormat::gshift' data-ref="PixelFormat::gshift">gshift</a>) &amp; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a>;</td></tr>
<tr><th id="1255">1255</th><td>        <a class="local col8 ref" href="#938blue" title='blue' data-ref="938blue">blue</a> = (<a class="local col1 ref" href="#931pix" title='pix' data-ref="931pix">pix</a> &gt;&gt; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bshift" title='PixelFormat::bshift' data-ref="PixelFormat::bshift">bshift</a>) &amp; <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a>;</td></tr>
<tr><th id="1256">1256</th><td>        <a class="local col5 ref" href="#935color" title='color' data-ref="935color">color</a>-&gt;<a class="ref" href="../../include/libpng12/png.h.html#png_color_struct::red" title='png_color_struct::red' data-ref="png_color_struct::red">red</a> = ((<a class="local col6 ref" href="#936red" title='red' data-ref="936red">red</a> * <var>255</var> + <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a> / <var>2</var>) /</td></tr>
<tr><th id="1257">1257</th><td>                      <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a>);</td></tr>
<tr><th id="1258">1258</th><td>        <a class="local col5 ref" href="#935color" title='color' data-ref="935color">color</a>-&gt;<a class="ref" href="../../include/libpng12/png.h.html#png_color_struct::green" title='png_color_struct::green' data-ref="png_color_struct::green">green</a> = ((<a class="local col7 ref" href="#937green" title='green' data-ref="937green">green</a> * <var>255</var> + <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a> / <var>2</var>) /</td></tr>
<tr><th id="1259">1259</th><td>                        <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a>);</td></tr>
<tr><th id="1260">1260</th><td>        <a class="local col5 ref" href="#935color" title='color' data-ref="935color">color</a>-&gt;<a class="ref" href="../../include/libpng12/png.h.html#png_color_struct::blue" title='png_color_struct::blue' data-ref="png_color_struct::blue">blue</a> = ((<a class="local col8 ref" href="#938blue" title='blue' data-ref="938blue">blue</a> * <var>255</var> + <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a> / <var>2</var>) /</td></tr>
<tr><th id="1261">1261</th><td>                       <a class="local col4 ref" href="#934vs" title='vs' data-ref="934vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a>);</td></tr>
<tr><th id="1262">1262</th><td>    }</td></tr>
<tr><th id="1263">1263</th><td>}</td></tr>
<tr><th id="1264">1264</th><td></td></tr>
<tr><th id="1265">1265</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="png_write_data" title='png_write_data' data-type='void png_write_data(png_structp png_ptr, png_bytep data, png_size_t length)' data-ref="png_write_data">png_write_data</dfn>(<a class="typedef" href="../../include/libpng12/png.h.html#png_structp" title='png_structp' data-type='png_struct *' data-ref="png_structp">png_structp</a> <dfn class="local col9 decl" id="939png_ptr" title='png_ptr' data-type='png_structp' data-ref="939png_ptr">png_ptr</dfn>, <a class="typedef" href="../../include/libpng12/pngconf.h.html#png_bytep" title='png_bytep' data-type='png_byte *' data-ref="png_bytep">png_bytep</a> <dfn class="local col0 decl" id="940data" title='data' data-type='png_bytep' data-ref="940data">data</dfn>,</td></tr>
<tr><th id="1266">1266</th><td>                           <a class="typedef" href="../../include/libpng12/pngconf.h.html#png_size_t" title='png_size_t' data-type='size_t' data-ref="png_size_t">png_size_t</a> <dfn class="local col1 decl" id="941length" title='length' data-type='png_size_t' data-ref="941length">length</dfn>)</td></tr>
<tr><th id="1267">1267</th><td>{</td></tr>
<tr><th id="1268">1268</th><td>    <a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col2 decl" id="942vs" title='vs' data-type='VncState *' data-ref="942vs">vs</dfn> = <a class="ref" href="../../include/libpng12/png.h.html#1826" title='png_get_io_ptr' data-ref="png_get_io_ptr">png_get_io_ptr</a>(<a class="local col9 ref" href="#939png_ptr" title='png_ptr' data-ref="939png_ptr">png_ptr</a>);</td></tr>
<tr><th id="1269">1269</th><td></td></tr>
<tr><th id="1270">1270</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reserve" title='buffer_reserve' data-ref="buffer_reserve">buffer_reserve</a>(&amp;<a class="local col2 ref" href="#942vs" title='vs' data-ref="942vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>, <a class="local col2 ref" href="#942vs" title='vs' data-ref="942vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> + <a class="local col1 ref" href="#941length" title='length' data-ref="941length">length</a>);</td></tr>
<tr><th id="1271">1271</th><td>    <a class="ref" href="../../include/string.h.html#memcpy" title='memcpy' data-ref="memcpy">memcpy</a>(<a class="local col2 ref" href="#942vs" title='vs' data-ref="942vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a> + <a class="local col2 ref" href="#942vs" title='vs' data-ref="942vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>, <a class="local col0 ref" href="#940data" title='data' data-ref="940data">data</a>, <a class="local col1 ref" href="#941length" title='length' data-ref="941length">length</a>);</td></tr>
<tr><th id="1272">1272</th><td></td></tr>
<tr><th id="1273">1273</th><td>    <a class="local col2 ref" href="#942vs" title='vs' data-ref="942vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a> += <a class="local col1 ref" href="#941length" title='length' data-ref="941length">length</a>;</td></tr>
<tr><th id="1274">1274</th><td>}</td></tr>
<tr><th id="1275">1275</th><td></td></tr>
<tr><th id="1276">1276</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="png_flush_data" title='png_flush_data' data-type='void png_flush_data(png_structp png_ptr)' data-ref="png_flush_data">png_flush_data</dfn>(<a class="typedef" href="../../include/libpng12/png.h.html#png_structp" title='png_structp' data-type='png_struct *' data-ref="png_structp">png_structp</a> <dfn class="local col3 decl" id="943png_ptr" title='png_ptr' data-type='png_structp' data-ref="943png_ptr">png_ptr</dfn>)</td></tr>
<tr><th id="1277">1277</th><td>{</td></tr>
<tr><th id="1278">1278</th><td>}</td></tr>
<tr><th id="1279">1279</th><td></td></tr>
<tr><th id="1280">1280</th><td><em>static</em> <em>void</em> *<dfn class="tu decl def" id="vnc_png_malloc" title='vnc_png_malloc' data-type='void * vnc_png_malloc(png_structp png_ptr, png_size_t size)' data-ref="vnc_png_malloc">vnc_png_malloc</dfn>(<a class="typedef" href="../../include/libpng12/png.h.html#png_structp" title='png_structp' data-type='png_struct *' data-ref="png_structp">png_structp</a> <dfn class="local col4 decl" id="944png_ptr" title='png_ptr' data-type='png_structp' data-ref="944png_ptr">png_ptr</dfn>, <a class="typedef" href="../../include/libpng12/pngconf.h.html#png_size_t" title='png_size_t' data-type='size_t' data-ref="png_size_t">png_size_t</a> <dfn class="local col5 decl" id="945size" title='size' data-type='png_size_t' data-ref="945size">size</dfn>)</td></tr>
<tr><th id="1281">1281</th><td>{</td></tr>
<tr><th id="1282">1282</th><td>    <b>return</b> <a class="ref" href="../../include/glib-2.0/glib/gmem.h.html#g_malloc" title='g_malloc' data-ref="g_malloc">g_malloc</a>(<a class="local col5 ref" href="#945size" title='size' data-ref="945size">size</a>);</td></tr>
<tr><th id="1283">1283</th><td>}</td></tr>
<tr><th id="1284">1284</th><td></td></tr>
<tr><th id="1285">1285</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="vnc_png_free" title='vnc_png_free' data-type='void vnc_png_free(png_structp png_ptr, png_voidp ptr)' data-ref="vnc_png_free">vnc_png_free</dfn>(<a class="typedef" href="../../include/libpng12/png.h.html#png_structp" title='png_structp' data-type='png_struct *' data-ref="png_structp">png_structp</a> <dfn class="local col6 decl" id="946png_ptr" title='png_ptr' data-type='png_structp' data-ref="946png_ptr">png_ptr</dfn>, <a class="typedef" href="../../include/libpng12/pngconf.h.html#png_voidp" title='png_voidp' data-type='void *' data-ref="png_voidp">png_voidp</a> <dfn class="local col7 decl" id="947ptr" title='ptr' data-type='png_voidp' data-ref="947ptr">ptr</dfn>)</td></tr>
<tr><th id="1286">1286</th><td>{</td></tr>
<tr><th id="1287">1287</th><td>    <a class="ref" href="../../include/glib-2.0/glib/gmem.h.html#g_free" title='g_free' data-ref="g_free">g_free</a>(<a class="local col7 ref" href="#947ptr" title='ptr' data-ref="947ptr">ptr</a>);</td></tr>
<tr><th id="1288">1288</th><td>}</td></tr>
<tr><th id="1289">1289</th><td></td></tr>
<tr><th id="1290">1290</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_png_rect" title='send_png_rect' data-type='int send_png_rect(VncState * vs, int x, int y, int w, int h, VncPalette * palette)' data-ref="send_png_rect">send_png_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col8 decl" id="948vs" title='vs' data-type='VncState *' data-ref="948vs">vs</dfn>, <em>int</em> <dfn class="local col9 decl" id="949x" title='x' data-type='int' data-ref="949x">x</dfn>, <em>int</em> <dfn class="local col0 decl" id="950y" title='y' data-type='int' data-ref="950y">y</dfn>, <em>int</em> <dfn class="local col1 decl" id="951w" title='w' data-type='int' data-ref="951w">w</dfn>, <em>int</em> <dfn class="local col2 decl" id="952h" title='h' data-type='int' data-ref="952h">h</dfn>,</td></tr>
<tr><th id="1291">1291</th><td>                         <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col3 decl" id="953palette" title='palette' data-type='VncPalette *' data-ref="953palette">palette</dfn>)</td></tr>
<tr><th id="1292">1292</th><td>{</td></tr>
<tr><th id="1293">1293</th><td>    <a class="typedef" href="../../include/libpng12/pngconf.h.html#png_byte" title='png_byte' data-type='unsigned char' data-ref="png_byte">png_byte</a> <dfn class="local col4 decl" id="954color_type" title='color_type' data-type='png_byte' data-ref="954color_type">color_type</dfn>;</td></tr>
<tr><th id="1294">1294</th><td>    <a class="typedef" href="../../include/libpng12/png.h.html#png_structp" title='png_structp' data-type='png_struct *' data-ref="png_structp">png_structp</a> <dfn class="local col5 decl" id="955png_ptr" title='png_ptr' data-type='png_structp' data-ref="955png_ptr">png_ptr</dfn>;</td></tr>
<tr><th id="1295">1295</th><td>    <a class="typedef" href="../../include/libpng12/png.h.html#png_infop" title='png_infop' data-type='png_info *' data-ref="png_infop">png_infop</a> <dfn class="local col6 decl" id="956info_ptr" title='info_ptr' data-type='png_infop' data-ref="956info_ptr">info_ptr</dfn>;</td></tr>
<tr><th id="1296">1296</th><td>    <a class="typedef" href="../../include/libpng12/png.h.html#png_colorp" title='png_colorp' data-type='png_color *' data-ref="png_colorp">png_colorp</a> <dfn class="local col7 decl" id="957png_palette" title='png_palette' data-type='png_colorp' data-ref="957png_palette">png_palette</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="1297">1297</th><td>    <a class="typedef" href="../../include/pixman-1/pixman.h.html#pixman_image_t" title='pixman_image_t' data-type='union pixman_image' data-ref="pixman_image_t">pixman_image_t</a> *<dfn class="local col8 decl" id="958linebuf" title='linebuf' data-type='pixman_image_t *' data-ref="958linebuf">linebuf</dfn>;</td></tr>
<tr><th id="1298">1298</th><td>    <em>int</em> <dfn class="local col9 decl" id="959level" title='level' data-type='int' data-ref="959level">level</dfn> = <a class="tu ref" href="#tight_png_conf" title='tight_png_conf' data-use='m' data-ref="tight_png_conf">tight_png_conf</a>[<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col6 ref" href="#576png_zlib_level" title='png_zlib_level' data-ref="576png_zlib_level">png_zlib_level</a>;</td></tr>
<tr><th id="1299">1299</th><td>    <em>int</em> <dfn class="local col0 decl" id="960filters" title='filters' data-type='int' data-ref="960filters">filters</dfn> = <a class="tu ref" href="#tight_png_conf" title='tight_png_conf' data-use='m' data-ref="tight_png_conf">tight_png_conf</a>[<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col7 ref" href="#577png_filters" title='png_filters' data-ref="577png_filters">png_filters</a>;</td></tr>
<tr><th id="1300">1300</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col1 decl" id="961buf" title='buf' data-type='uint8_t *' data-ref="961buf">buf</dfn>;</td></tr>
<tr><th id="1301">1301</th><td>    <em>int</em> <dfn class="local col2 decl" id="962dy" title='dy' data-type='int' data-ref="962dy">dy</dfn>;</td></tr>
<tr><th id="1302">1302</th><td></td></tr>
<tr><th id="1303">1303</th><td>    <a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a> = <a class="ref" href="../../include/libpng12/png.h.html#1404" title='png_create_write_struct_2' data-ref="png_create_write_struct_2">png_create_write_struct_2</a>(<a class="macro" href="../../include/libpng12/png.h.html#273" title="&quot;1.2.54&quot;" data-ref="_M/PNG_LIBPNG_VER_STRING">PNG_LIBPNG_VER_STRING</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="1304">1304</th><td>                                        <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <a class="tu ref" href="#vnc_png_malloc" title='vnc_png_malloc' data-use='r' data-ref="vnc_png_malloc">vnc_png_malloc</a>, <a class="tu ref" href="#vnc_png_free" title='vnc_png_free' data-use='r' data-ref="vnc_png_free">vnc_png_free</a>);</td></tr>
<tr><th id="1305">1305</th><td></td></tr>
<tr><th id="1306">1306</th><td>    <b>if</b> (<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="1307">1307</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="1308">1308</th><td></td></tr>
<tr><th id="1309">1309</th><td>    <a class="local col6 ref" href="#956info_ptr" title='info_ptr' data-ref="956info_ptr">info_ptr</a> = <a class="ref" href="../../include/libpng12/png.h.html#1426" title='png_create_info_struct' data-ref="png_create_info_struct">png_create_info_struct</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>);</td></tr>
<tr><th id="1310">1310</th><td></td></tr>
<tr><th id="1311">1311</th><td>    <b>if</b> (<a class="local col6 ref" href="#956info_ptr" title='info_ptr' data-ref="956info_ptr">info_ptr</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="1312">1312</th><td>        <a class="ref" href="../../include/libpng12/png.h.html#1680" title='png_destroy_write_struct' data-ref="png_destroy_write_struct">png_destroy_write_struct</a>(&amp;<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="1313">1313</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="1314">1314</th><td>    }</td></tr>
<tr><th id="1315">1315</th><td></td></tr>
<tr><th id="1316">1316</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#1818" title='png_set_write_fn' data-ref="png_set_write_fn">png_set_write_fn</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, (<em>void</em> *) <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>, <a class="tu ref" href="#png_write_data" title='png_write_data' data-use='r' data-ref="png_write_data">png_write_data</a>, <a class="tu ref" href="#png_flush_data" title='png_flush_data' data-use='r' data-ref="png_flush_data">png_flush_data</a>);</td></tr>
<tr><th id="1317">1317</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#1765" title='png_set_compression_level' data-ref="png_set_compression_level">png_set_compression_level</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="local col9 ref" href="#959level" title='level' data-ref="959level">level</a>);</td></tr>
<tr><th id="1318">1318</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#1717" title='png_set_filter' data-ref="png_set_filter">png_set_filter</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="macro" href="../../include/libpng12/png.h.html#884" title="0" data-ref="_M/PNG_FILTER_TYPE_DEFAULT">PNG_FILTER_TYPE_DEFAULT</a>, <a class="local col0 ref" href="#960filters" title='filters' data-ref="960filters">filters</a>);</td></tr>
<tr><th id="1319">1319</th><td></td></tr>
<tr><th id="1320">1320</th><td>    <b>if</b> (<a class="local col3 ref" href="#953palette" title='palette' data-ref="953palette">palette</a>) {</td></tr>
<tr><th id="1321">1321</th><td>        <a class="local col4 ref" href="#954color_type" title='color_type' data-ref="954color_type">color_type</a> = <a class="macro" href="../../include/libpng12/png.h.html#869" title="(2 | 1)" data-ref="_M/PNG_COLOR_TYPE_PALETTE">PNG_COLOR_TYPE_PALETTE</a>;</td></tr>
<tr><th id="1322">1322</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1323">1323</th><td>        <a class="local col4 ref" href="#954color_type" title='color_type' data-ref="954color_type">color_type</a> = <a class="macro" href="../../include/libpng12/png.h.html#870" title="(2)" data-ref="_M/PNG_COLOR_TYPE_RGB">PNG_COLOR_TYPE_RGB</a>;</td></tr>
<tr><th id="1324">1324</th><td>    }</td></tr>
<tr><th id="1325">1325</th><td></td></tr>
<tr><th id="1326">1326</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#2161" title='png_set_IHDR' data-ref="png_set_IHDR">png_set_IHDR</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="local col6 ref" href="#956info_ptr" title='info_ptr' data-ref="956info_ptr">info_ptr</a>, <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a>, <a class="local col2 ref" href="#952h" title='h' data-ref="952h">h</a>,</td></tr>
<tr><th id="1327">1327</th><td>                 <var>8</var>, <a class="local col4 ref" href="#954color_type" title='color_type' data-ref="954color_type">color_type</a>, <a class="macro" href="../../include/libpng12/png.h.html#887" title="0" data-ref="_M/PNG_INTERLACE_NONE">PNG_INTERLACE_NONE</a>,</td></tr>
<tr><th id="1328">1328</th><td>                 <a class="macro" href="../../include/libpng12/png.h.html#879" title="0" data-ref="_M/PNG_COMPRESSION_TYPE_DEFAULT">PNG_COMPRESSION_TYPE_DEFAULT</a>, <a class="macro" href="../../include/libpng12/png.h.html#884" title="0" data-ref="_M/PNG_FILTER_TYPE_DEFAULT">PNG_FILTER_TYPE_DEFAULT</a>);</td></tr>
<tr><th id="1329">1329</th><td></td></tr>
<tr><th id="1330">1330</th><td>    <b>if</b> (<a class="local col4 ref" href="#954color_type" title='color_type' data-ref="954color_type">color_type</a> == <a class="macro" href="../../include/libpng12/png.h.html#869" title="(2 | 1)" data-ref="_M/PNG_COLOR_TYPE_PALETTE">PNG_COLOR_TYPE_PALETTE</a>) {</td></tr>
<tr><th id="1331">1331</th><td>        <b>struct</b> <a class="type" href="#palette_cb_priv" title='palette_cb_priv' data-ref="palette_cb_priv">palette_cb_priv</a> <dfn class="local col3 decl" id="963priv" title='priv' data-type='struct palette_cb_priv' data-ref="963priv">priv</dfn>;</td></tr>
<tr><th id="1332">1332</th><td></td></tr>
<tr><th id="1333">1333</th><td>        <a class="local col7 ref" href="#957png_palette" title='png_palette' data-ref="957png_palette">png_palette</a> = <a class="ref" href="../../include/libpng12/png.h.html#1896" title='png_malloc' data-ref="png_malloc">png_malloc</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <b>sizeof</b>(*<a class="local col7 ref" href="#957png_palette" title='png_palette' data-ref="957png_palette">png_palette</a>) *</td></tr>
<tr><th id="1334">1334</th><td>                                 <a class="ref" href="vnc-palette.h.html#palette_size" title='palette_size' data-ref="palette_size">palette_size</a>(<a class="local col3 ref" href="#953palette" title='palette' data-ref="953palette">palette</a>));</td></tr>
<tr><th id="1335">1335</th><td></td></tr>
<tr><th id="1336">1336</th><td>        <a class="local col3 ref" href="#963priv" title='priv' data-ref="963priv">priv</a>.<a class="tu ref" href="#palette_cb_priv::vs" title='palette_cb_priv::vs' data-use='w' data-ref="palette_cb_priv::vs">vs</a> = <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>;</td></tr>
<tr><th id="1337">1337</th><td>        <a class="local col3 ref" href="#963priv" title='priv' data-ref="963priv">priv</a>.<a class="tu ref" href="#palette_cb_priv::png_palette" title='palette_cb_priv::png_palette' data-use='w' data-ref="palette_cb_priv::png_palette">png_palette</a> = <a class="local col7 ref" href="#957png_palette" title='png_palette' data-ref="957png_palette">png_palette</a>;</td></tr>
<tr><th id="1338">1338</th><td>        <a class="ref" href="vnc-palette.h.html#palette_iter" title='palette_iter' data-ref="palette_iter">palette_iter</a>(<a class="local col3 ref" href="#953palette" title='palette' data-ref="953palette">palette</a>, <a class="tu ref" href="#write_png_palette" title='write_png_palette' data-use='r' data-ref="write_png_palette">write_png_palette</a>, &amp;<a class="local col3 ref" href="#963priv" title='priv' data-ref="963priv">priv</a>);</td></tr>
<tr><th id="1339">1339</th><td></td></tr>
<tr><th id="1340">1340</th><td>        <a class="ref" href="../../include/libpng12/png.h.html#2203" title='png_set_PLTE' data-ref="png_set_PLTE">png_set_PLTE</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="local col6 ref" href="#956info_ptr" title='info_ptr' data-ref="956info_ptr">info_ptr</a>, <a class="local col7 ref" href="#957png_palette" title='png_palette' data-ref="957png_palette">png_palette</a>, <a class="ref" href="vnc-palette.h.html#palette_size" title='palette_size' data-ref="palette_size">palette_size</a>(<a class="local col3 ref" href="#953palette" title='palette' data-ref="953palette">palette</a>));</td></tr>
<tr><th id="1341">1341</th><td></td></tr>
<tr><th id="1342">1342</th><td>        <b>if</b> (<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>4</var>) {</td></tr>
<tr><th id="1343">1343</th><td>            <a class="tu ref" href="#487" title='tight_encode_indexed_rect32' data-use='c' data-ref="tight_encode_indexed_rect32">tight_encode_indexed_rect32</a>(<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a> * <a class="local col2 ref" href="#952h" title='h' data-ref="952h">h</a>, <a class="local col3 ref" href="#953palette" title='palette' data-ref="953palette">palette</a>);</td></tr>
<tr><th id="1344">1344</th><td>        } <b>else</b> {</td></tr>
<tr><th id="1345">1345</th><td>            <a class="tu ref" href="#486" title='tight_encode_indexed_rect16' data-use='c' data-ref="tight_encode_indexed_rect16">tight_encode_indexed_rect16</a>(<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a> * <a class="local col2 ref" href="#952h" title='h' data-ref="952h">h</a>, <a class="local col3 ref" href="#953palette" title='palette' data-ref="953palette">palette</a>);</td></tr>
<tr><th id="1346">1346</th><td>        }</td></tr>
<tr><th id="1347">1347</th><td>    }</td></tr>
<tr><th id="1348">1348</th><td></td></tr>
<tr><th id="1349">1349</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#1444" title='png_write_info' data-ref="png_write_info">png_write_info</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="local col6 ref" href="#956info_ptr" title='info_ptr' data-ref="956info_ptr">info_ptr</a>);</td></tr>
<tr><th id="1350">1350</th><td></td></tr>
<tr><th id="1351">1351</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reserve" title='buffer_reserve' data-ref="buffer_reserve">buffer_reserve</a>(&amp;<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>, <var>2048</var>);</td></tr>
<tr><th id="1352">1352</th><td>    <a class="local col8 ref" href="#958linebuf" title='linebuf' data-ref="958linebuf">linebuf</a> = <a class="ref" href="../include/ui/qemu-pixman.h.html#qemu_pixman_linebuf_create" title='qemu_pixman_linebuf_create' data-ref="qemu_pixman_linebuf_create">qemu_pixman_linebuf_create</a>(<a class="macro" href="../include/ui/qemu-pixman.h.html#38" title="PIXMAN_b8g8r8" data-ref="_M/PIXMAN_BE_r8g8b8">PIXMAN_BE_r8g8b8</a>, <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a>);</td></tr>
<tr><th id="1353">1353</th><td>    <a class="local col1 ref" href="#961buf" title='buf' data-ref="961buf">buf</a> = (<a class="typedef" href="../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *)<a class="ref" href="../../include/pixman-1/pixman.h.html#pixman_image_get_data" title='pixman_image_get_data' data-ref="pixman_image_get_data">pixman_image_get_data</a>(<a class="local col8 ref" href="#958linebuf" title='linebuf' data-ref="958linebuf">linebuf</a>);</td></tr>
<tr><th id="1354">1354</th><td>    <b>for</b> (<a class="local col2 ref" href="#962dy" title='dy' data-ref="962dy">dy</a> = <var>0</var>; <a class="local col2 ref" href="#962dy" title='dy' data-ref="962dy">dy</a> &lt; <a class="local col2 ref" href="#952h" title='h' data-ref="952h">h</a>; <a class="local col2 ref" href="#962dy" title='dy' data-ref="962dy">dy</a>++)</td></tr>
<tr><th id="1355">1355</th><td>    {</td></tr>
<tr><th id="1356">1356</th><td>        <b>if</b> (<a class="local col4 ref" href="#954color_type" title='color_type' data-ref="954color_type">color_type</a> == <a class="macro" href="../../include/libpng12/png.h.html#869" title="(2 | 1)" data-ref="_M/PNG_COLOR_TYPE_PALETTE">PNG_COLOR_TYPE_PALETTE</a>) {</td></tr>
<tr><th id="1357">1357</th><td>            <a class="ref" href="../../include/string.h.html#memcpy" title='memcpy' data-ref="memcpy">memcpy</a>(<a class="local col1 ref" href="#961buf" title='buf' data-ref="961buf">buf</a>, <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a> + (<a class="local col2 ref" href="#962dy" title='dy' data-ref="962dy">dy</a> * <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a>), <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a>);</td></tr>
<tr><th id="1358">1358</th><td>        } <b>else</b> {</td></tr>
<tr><th id="1359">1359</th><td>            <a class="ref" href="../include/ui/qemu-pixman.h.html#qemu_pixman_linebuf_fill" title='qemu_pixman_linebuf_fill' data-ref="qemu_pixman_linebuf_fill">qemu_pixman_linebuf_fill</a>(<a class="local col8 ref" href="#958linebuf" title='linebuf' data-ref="958linebuf">linebuf</a>, <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::vd" title='VncState::vd' data-ref="VncState::vd">vd</a>-&gt;<a class="ref" href="vnc.h.html#VncDisplay::server" title='VncDisplay::server' data-ref="VncDisplay::server">server</a>, <a class="local col1 ref" href="#951w" title='w' data-ref="951w">w</a>, <a class="local col9 ref" href="#949x" title='x' data-ref="949x">x</a>, <a class="local col0 ref" href="#950y" title='y' data-ref="950y">y</a> + <a class="local col2 ref" href="#962dy" title='dy' data-ref="962dy">dy</a>);</td></tr>
<tr><th id="1360">1360</th><td>        }</td></tr>
<tr><th id="1361">1361</th><td>        <a class="ref" href="../../include/libpng12/png.h.html#1646" title='png_write_row' data-ref="png_write_row">png_write_row</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="local col1 ref" href="#961buf" title='buf' data-ref="961buf">buf</a>);</td></tr>
<tr><th id="1362">1362</th><td>    }</td></tr>
<tr><th id="1363">1363</th><td>    <a class="ref" href="../include/ui/qemu-pixman.h.html#qemu_pixman_image_unref" title='qemu_pixman_image_unref' data-ref="qemu_pixman_image_unref">qemu_pixman_image_unref</a>(<a class="local col8 ref" href="#958linebuf" title='linebuf' data-ref="958linebuf">linebuf</a>);</td></tr>
<tr><th id="1364">1364</th><td></td></tr>
<tr><th id="1365">1365</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#1658" title='png_write_end' data-ref="png_write_end">png_write_end</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="1366">1366</th><td></td></tr>
<tr><th id="1367">1367</th><td>    <b>if</b> (<a class="local col4 ref" href="#954color_type" title='color_type' data-ref="954color_type">color_type</a> == <a class="macro" href="../../include/libpng12/png.h.html#869" title="(2 | 1)" data-ref="_M/PNG_COLOR_TYPE_PALETTE">PNG_COLOR_TYPE_PALETTE</a>) {</td></tr>
<tr><th id="1368">1368</th><td>        <a class="ref" href="../../include/libpng12/png.h.html#1908" title='png_free' data-ref="png_free">png_free</a>(<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, <a class="local col7 ref" href="#957png_palette" title='png_palette' data-ref="957png_palette">png_palette</a>);</td></tr>
<tr><th id="1369">1369</th><td>    }</td></tr>
<tr><th id="1370">1370</th><td></td></tr>
<tr><th id="1371">1371</th><td>    <a class="ref" href="../../include/libpng12/png.h.html#1680" title='png_destroy_write_struct' data-ref="png_destroy_write_struct">png_destroy_write_struct</a>(&amp;<a class="local col5 ref" href="#955png_ptr" title='png_ptr' data-ref="955png_ptr">png_ptr</a>, &amp;<a class="local col6 ref" href="#956info_ptr" title='info_ptr' data-ref="956info_ptr">info_ptr</a>);</td></tr>
<tr><th id="1372">1372</th><td></td></tr>
<tr><th id="1373">1373</th><td>    <a class="ref" href="vnc.h.html#vnc_write_u8" title='vnc_write_u8' data-ref="vnc_write_u8">vnc_write_u8</a>(<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>, <a class="macro" href="vnc-enc-tight.h.html#162" title="0x0A" data-ref="_M/VNC_TIGHT_PNG">VNC_TIGHT_PNG</a> &lt;&lt; <var>4</var>);</td></tr>
<tr><th id="1374">1374</th><td></td></tr>
<tr><th id="1375">1375</th><td>    <a class="tu ref" href="#tight_send_compact_size" title='tight_send_compact_size' data-use='c' data-ref="tight_send_compact_size">tight_send_compact_size</a>(<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>, <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>);</td></tr>
<tr><th id="1376">1376</th><td>    <a class="ref" href="vnc.h.html#vnc_write" title='vnc_write' data-ref="vnc_write">vnc_write</a>(<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>, <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::buffer" title='Buffer::buffer' data-ref="Buffer::buffer">buffer</a>, <a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>.<a class="ref" href="../include/qemu/buffer.h.html#Buffer::offset" title='Buffer::offset' data-ref="Buffer::offset">offset</a>);</td></tr>
<tr><th id="1377">1377</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reset" title='buffer_reset' data-ref="buffer_reset">buffer_reset</a>(&amp;<a class="local col8 ref" href="#948vs" title='vs' data-ref="948vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>);</td></tr>
<tr><th id="1378">1378</th><td>    <b>return</b> <var>1</var>;</td></tr>
<tr><th id="1379">1379</th><td>}</td></tr>
<tr><th id="1380">1380</th><td><u>#<span data-ppcond="1236">endif</span> /* CONFIG_VNC_PNG */</u></td></tr>
<tr><th id="1381">1381</th><td></td></tr>
<tr><th id="1382">1382</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="vnc_tight_start" title='vnc_tight_start' data-type='void vnc_tight_start(VncState * vs)' data-ref="vnc_tight_start">vnc_tight_start</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col4 decl" id="964vs" title='vs' data-type='VncState *' data-ref="964vs">vs</dfn>)</td></tr>
<tr><th id="1383">1383</th><td>{</td></tr>
<tr><th id="1384">1384</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_reset" title='buffer_reset' data-ref="buffer_reset">buffer_reset</a>(&amp;<a class="local col4 ref" href="#964vs" title='vs' data-ref="964vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>);</td></tr>
<tr><th id="1385">1385</th><td></td></tr>
<tr><th id="1386">1386</th><td>    <i>// make the output buffer be the zlib buffer, so we can compress it later</i></td></tr>
<tr><th id="1387">1387</th><td>    <a class="local col4 ref" href="#964vs" title='vs' data-ref="964vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tmp" title='VncTight::tmp' data-ref="VncTight::tmp">tmp</a> = <a class="local col4 ref" href="#964vs" title='vs' data-ref="964vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a>;</td></tr>
<tr><th id="1388">1388</th><td>    <a class="local col4 ref" href="#964vs" title='vs' data-ref="964vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a> = <a class="local col4 ref" href="#964vs" title='vs' data-ref="964vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>;</td></tr>
<tr><th id="1389">1389</th><td>}</td></tr>
<tr><th id="1390">1390</th><td></td></tr>
<tr><th id="1391">1391</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="vnc_tight_stop" title='vnc_tight_stop' data-type='void vnc_tight_stop(VncState * vs)' data-ref="vnc_tight_stop">vnc_tight_stop</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col5 decl" id="965vs" title='vs' data-type='VncState *' data-ref="965vs">vs</dfn>)</td></tr>
<tr><th id="1392">1392</th><td>{</td></tr>
<tr><th id="1393">1393</th><td>    <i>// switch back to normal output/zlib buffers</i></td></tr>
<tr><th id="1394">1394</th><td>    <a class="local col5 ref" href="#965vs" title='vs' data-ref="965vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a> = <a class="local col5 ref" href="#965vs" title='vs' data-ref="965vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a>;</td></tr>
<tr><th id="1395">1395</th><td>    <a class="local col5 ref" href="#965vs" title='vs' data-ref="965vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::output" title='VncState::output' data-ref="VncState::output">output</a> = <a class="local col5 ref" href="#965vs" title='vs' data-ref="965vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tmp" title='VncTight::tmp' data-ref="VncTight::tmp">tmp</a>;</td></tr>
<tr><th id="1396">1396</th><td>}</td></tr>
<tr><th id="1397">1397</th><td></td></tr>
<tr><th id="1398">1398</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_sub_rect_nojpeg" title='send_sub_rect_nojpeg' data-type='int send_sub_rect_nojpeg(VncState * vs, int x, int y, int w, int h, int bg, int fg, int colors, VncPalette * palette)' data-ref="send_sub_rect_nojpeg">send_sub_rect_nojpeg</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col6 decl" id="966vs" title='vs' data-type='VncState *' data-ref="966vs">vs</dfn>, <em>int</em> <dfn class="local col7 decl" id="967x" title='x' data-type='int' data-ref="967x">x</dfn>, <em>int</em> <dfn class="local col8 decl" id="968y" title='y' data-type='int' data-ref="968y">y</dfn>, <em>int</em> <dfn class="local col9 decl" id="969w" title='w' data-type='int' data-ref="969w">w</dfn>, <em>int</em> <dfn class="local col0 decl" id="970h" title='h' data-type='int' data-ref="970h">h</dfn>,</td></tr>
<tr><th id="1399">1399</th><td>                                <em>int</em> <dfn class="local col1 decl" id="971bg" title='bg' data-type='int' data-ref="971bg">bg</dfn>, <em>int</em> <dfn class="local col2 decl" id="972fg" title='fg' data-type='int' data-ref="972fg">fg</dfn>, <em>int</em> <dfn class="local col3 decl" id="973colors" title='colors' data-type='int' data-ref="973colors">colors</dfn>, <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="local col4 decl" id="974palette" title='palette' data-type='VncPalette *' data-ref="974palette">palette</dfn>)</td></tr>
<tr><th id="1400">1400</th><td>{</td></tr>
<tr><th id="1401">1401</th><td>    <em>int</em> <dfn class="local col5 decl" id="975ret" title='ret' data-type='int' data-ref="975ret">ret</dfn>;</td></tr>
<tr><th id="1402">1402</th><td></td></tr>
<tr><th id="1403">1403</th><td>    <b>if</b> (<a class="local col3 ref" href="#973colors" title='colors' data-ref="973colors">colors</a> == <var>0</var>) {</td></tr>
<tr><th id="1404">1404</th><td>        <b>if</b> (<a class="tu ref" href="#tight_detect_smooth_image" title='tight_detect_smooth_image' data-use='c' data-ref="tight_detect_smooth_image">tight_detect_smooth_image</a>(<a class="local col6 ref" href="#966vs" title='vs' data-ref="966vs">vs</a>, <a class="local col9 ref" href="#969w" title='w' data-ref="969w">w</a>, <a class="local col0 ref" href="#970h" title='h' data-ref="970h">h</a>)) {</td></tr>
<tr><th id="1405">1405</th><td>            <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a> = <a class="tu ref" href="#send_gradient_rect" title='send_gradient_rect' data-use='c' data-ref="send_gradient_rect">send_gradient_rect</a>(<a class="local col6 ref" href="#966vs" title='vs' data-ref="966vs">vs</a>, <a class="local col7 ref" href="#967x" title='x' data-ref="967x">x</a>, <a class="local col8 ref" href="#968y" title='y' data-ref="968y">y</a>, <a class="local col9 ref" href="#969w" title='w' data-ref="969w">w</a>, <a class="local col0 ref" href="#970h" title='h' data-ref="970h">h</a>);</td></tr>
<tr><th id="1406">1406</th><td>        } <b>else</b> {</td></tr>
<tr><th id="1407">1407</th><td>            <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a> = <a class="tu ref" href="#send_full_color_rect" title='send_full_color_rect' data-use='c' data-ref="send_full_color_rect">send_full_color_rect</a>(<a class="local col6 ref" href="#966vs" title='vs' data-ref="966vs">vs</a>, <a class="local col7 ref" href="#967x" title='x' data-ref="967x">x</a>, <a class="local col8 ref" href="#968y" title='y' data-ref="968y">y</a>, <a class="local col9 ref" href="#969w" title='w' data-ref="969w">w</a>, <a class="local col0 ref" href="#970h" title='h' data-ref="970h">h</a>);</td></tr>
<tr><th id="1408">1408</th><td>        }</td></tr>
<tr><th id="1409">1409</th><td>    } <b>else</b> <b>if</b> (<a class="local col3 ref" href="#973colors" title='colors' data-ref="973colors">colors</a> == <var>1</var>) {</td></tr>
<tr><th id="1410">1410</th><td>        <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a> = <a class="tu ref" href="#send_solid_rect" title='send_solid_rect' data-use='c' data-ref="send_solid_rect">send_solid_rect</a>(<a class="local col6 ref" href="#966vs" title='vs' data-ref="966vs">vs</a>);</td></tr>
<tr><th id="1411">1411</th><td>    } <b>else</b> <b>if</b> (<a class="local col3 ref" href="#973colors" title='colors' data-ref="973colors">colors</a> == <var>2</var>) {</td></tr>
<tr><th id="1412">1412</th><td>        <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a> = <a class="tu ref" href="#send_mono_rect" title='send_mono_rect' data-use='c' data-ref="send_mono_rect">send_mono_rect</a>(<a class="local col6 ref" href="#966vs" title='vs' data-ref="966vs">vs</a>, <a class="local col7 ref" href="#967x" title='x' data-ref="967x">x</a>, <a class="local col8 ref" href="#968y" title='y' data-ref="968y">y</a>, <a class="local col9 ref" href="#969w" title='w' data-ref="969w">w</a>, <a class="local col0 ref" href="#970h" title='h' data-ref="970h">h</a>, <a class="local col1 ref" href="#971bg" title='bg' data-ref="971bg">bg</a>, <a class="local col2 ref" href="#972fg" title='fg' data-ref="972fg">fg</a>);</td></tr>
<tr><th id="1413">1413</th><td>    } <b>else</b> <b>if</b> (<a class="local col3 ref" href="#973colors" title='colors' data-ref="973colors">colors</a> &lt;= <var>256</var>) {</td></tr>
<tr><th id="1414">1414</th><td>        <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a> = <a class="tu ref" href="#send_palette_rect" title='send_palette_rect' data-use='c' data-ref="send_palette_rect">send_palette_rect</a>(<a class="local col6 ref" href="#966vs" title='vs' data-ref="966vs">vs</a>, <a class="local col7 ref" href="#967x" title='x' data-ref="967x">x</a>, <a class="local col8 ref" href="#968y" title='y' data-ref="968y">y</a>, <a class="local col9 ref" href="#969w" title='w' data-ref="969w">w</a>, <a class="local col0 ref" href="#970h" title='h' data-ref="970h">h</a>, <a class="local col4 ref" href="#974palette" title='palette' data-ref="974palette">palette</a>);</td></tr>
<tr><th id="1415">1415</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1416">1416</th><td>        <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a> = <var>0</var>;</td></tr>
<tr><th id="1417">1417</th><td>    }</td></tr>
<tr><th id="1418">1418</th><td>    <b>return</b> <a class="local col5 ref" href="#975ret" title='ret' data-ref="975ret">ret</a>;</td></tr>
<tr><th id="1419">1419</th><td>}</td></tr>
<tr><th id="1420">1420</th><td></td></tr>
<tr><th id="1421">1421</th><td><u>#<span data-ppcond="1421">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1422">1422</th><td><em>static</em> <em>int</em> send_sub_rect_jpeg(VncState *vs, <em>int</em> x, <em>int</em> y, <em>int</em> w, <em>int</em> h,</td></tr>
<tr><th id="1423">1423</th><td>                              <em>int</em> bg, <em>int</em> fg, <em>int</em> colors,</td></tr>
<tr><th id="1424">1424</th><td>                              VncPalette *palette, bool force)</td></tr>
<tr><th id="1425">1425</th><td>{</td></tr>
<tr><th id="1426">1426</th><td>    <em>int</em> ret;</td></tr>
<tr><th id="1427">1427</th><td></td></tr>
<tr><th id="1428">1428</th><td>    <b>if</b> (colors == <var>0</var>) {</td></tr>
<tr><th id="1429">1429</th><td>        <b>if</b> (force || (tight_jpeg_conf[vs-&gt;tight.quality].jpeg_full &amp;&amp;</td></tr>
<tr><th id="1430">1430</th><td>                      tight_detect_smooth_image(vs, w, h))) {</td></tr>
<tr><th id="1431">1431</th><td>            <em>int</em> quality = tight_conf[vs-&gt;tight.quality].jpeg_quality;</td></tr>
<tr><th id="1432">1432</th><td></td></tr>
<tr><th id="1433">1433</th><td>            ret = send_jpeg_rect(vs, x, y, w, h, quality);</td></tr>
<tr><th id="1434">1434</th><td>        } <b>else</b> {</td></tr>
<tr><th id="1435">1435</th><td>            ret = send_full_color_rect(vs, x, y, w, h);</td></tr>
<tr><th id="1436">1436</th><td>        }</td></tr>
<tr><th id="1437">1437</th><td>    } <b>else</b> <b>if</b> (colors == <var>1</var>) {</td></tr>
<tr><th id="1438">1438</th><td>        ret = send_solid_rect(vs);</td></tr>
<tr><th id="1439">1439</th><td>    } <b>else</b> <b>if</b> (colors == <var>2</var>) {</td></tr>
<tr><th id="1440">1440</th><td>        ret = send_mono_rect(vs, x, y, w, h, bg, fg);</td></tr>
<tr><th id="1441">1441</th><td>    } <b>else</b> <b>if</b> (colors &lt;= <var>256</var>) {</td></tr>
<tr><th id="1442">1442</th><td>        <b>if</b> (force || (colors &gt; <var>96</var> &amp;&amp;</td></tr>
<tr><th id="1443">1443</th><td>                      tight_jpeg_conf[vs-&gt;tight.quality].jpeg_idx &amp;&amp;</td></tr>
<tr><th id="1444">1444</th><td>                      tight_detect_smooth_image(vs, w, h))) {</td></tr>
<tr><th id="1445">1445</th><td>            <em>int</em> quality = tight_conf[vs-&gt;tight.quality].jpeg_quality;</td></tr>
<tr><th id="1446">1446</th><td></td></tr>
<tr><th id="1447">1447</th><td>            ret = send_jpeg_rect(vs, x, y, w, h, quality);</td></tr>
<tr><th id="1448">1448</th><td>        } <b>else</b> {</td></tr>
<tr><th id="1449">1449</th><td>            ret = send_palette_rect(vs, x, y, w, h, palette);</td></tr>
<tr><th id="1450">1450</th><td>        }</td></tr>
<tr><th id="1451">1451</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1452">1452</th><td>        ret = <var>0</var>;</td></tr>
<tr><th id="1453">1453</th><td>    }</td></tr>
<tr><th id="1454">1454</th><td>    <b>return</b> ret;</td></tr>
<tr><th id="1455">1455</th><td>}</td></tr>
<tr><th id="1456">1456</th><td><u>#<span data-ppcond="1421">endif</span></u></td></tr>
<tr><th id="1457">1457</th><td></td></tr>
<tr><th id="1458">1458</th><td><em>static</em> <b>__thread</b> <a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a> *<dfn class="tu decl def" id="color_count_palette" title='color_count_palette' data-type='VncPalette *' data-ref="color_count_palette">color_count_palette</dfn>;</td></tr>
<tr><th id="1459">1459</th><td><em>static</em> <b>__thread</b> <a class="typedef" href="../include/qemu/notify.h.html#Notifier" title='Notifier' data-type='struct Notifier' data-ref="Notifier">Notifier</a> <dfn class="tu decl def" id="vnc_tight_cleanup_notifier" title='vnc_tight_cleanup_notifier' data-type='Notifier' data-ref="vnc_tight_cleanup_notifier">vnc_tight_cleanup_notifier</dfn>;</td></tr>
<tr><th id="1460">1460</th><td></td></tr>
<tr><th id="1461">1461</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="vnc_tight_cleanup" title='vnc_tight_cleanup' data-type='void vnc_tight_cleanup(Notifier * n, void * value)' data-ref="vnc_tight_cleanup">vnc_tight_cleanup</dfn>(<a class="typedef" href="../include/qemu/notify.h.html#Notifier" title='Notifier' data-type='struct Notifier' data-ref="Notifier">Notifier</a> *<dfn class="local col6 decl" id="976n" title='n' data-type='Notifier *' data-ref="976n">n</dfn>, <em>void</em> *<dfn class="local col7 decl" id="977value" title='value' data-type='void *' data-ref="977value">value</dfn>)</td></tr>
<tr><th id="1462">1462</th><td>{</td></tr>
<tr><th id="1463">1463</th><td>    <a class="ref" href="../../include/glib-2.0/glib/gmem.h.html#g_free" title='g_free' data-ref="g_free">g_free</a>(<a class="tu ref" href="#color_count_palette" title='color_count_palette' data-use='r' data-ref="color_count_palette">color_count_palette</a>);</td></tr>
<tr><th id="1464">1464</th><td>    <a class="tu ref" href="#color_count_palette" title='color_count_palette' data-use='w' data-ref="color_count_palette">color_count_palette</a> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="1465">1465</th><td>}</td></tr>
<tr><th id="1466">1466</th><td></td></tr>
<tr><th id="1467">1467</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_sub_rect" title='send_sub_rect' data-type='int send_sub_rect(VncState * vs, int x, int y, int w, int h)' data-ref="send_sub_rect">send_sub_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col8 decl" id="978vs" title='vs' data-type='VncState *' data-ref="978vs">vs</dfn>, <em>int</em> <dfn class="local col9 decl" id="979x" title='x' data-type='int' data-ref="979x">x</dfn>, <em>int</em> <dfn class="local col0 decl" id="980y" title='y' data-type='int' data-ref="980y">y</dfn>, <em>int</em> <dfn class="local col1 decl" id="981w" title='w' data-type='int' data-ref="981w">w</dfn>, <em>int</em> <dfn class="local col2 decl" id="982h" title='h' data-type='int' data-ref="982h">h</dfn>)</td></tr>
<tr><th id="1468">1468</th><td>{</td></tr>
<tr><th id="1469">1469</th><td>    <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="983bg" title='bg' data-type='uint32_t' data-ref="983bg">bg</dfn> = <var>0</var>, <dfn class="local col4 decl" id="984fg" title='fg' data-type='uint32_t' data-ref="984fg">fg</dfn> = <var>0</var>;</td></tr>
<tr><th id="1470">1470</th><td>    <em>int</em> <dfn class="local col5 decl" id="985colors" title='colors' data-type='int' data-ref="985colors">colors</dfn>;</td></tr>
<tr><th id="1471">1471</th><td>    <em>int</em> <dfn class="local col6 decl" id="986ret" title='ret' data-type='int' data-ref="986ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="1472">1472</th><td><u>#<span data-ppcond="1472">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1473">1473</th><td>    bool force_jpeg = false;</td></tr>
<tr><th id="1474">1474</th><td>    bool allow_jpeg = true;</td></tr>
<tr><th id="1475">1475</th><td><u>#<span data-ppcond="1472">endif</span></u></td></tr>
<tr><th id="1476">1476</th><td></td></tr>
<tr><th id="1477">1477</th><td>    <b>if</b> (!<a class="tu ref" href="#color_count_palette" title='color_count_palette' data-use='r' data-ref="color_count_palette">color_count_palette</a>) {</td></tr>
<tr><th id="1478">1478</th><td>        <a class="tu ref" href="#color_count_palette" title='color_count_palette' data-use='w' data-ref="color_count_palette">color_count_palette</a> = <a class="ref" href="../../include/glib-2.0/glib/gmem.h.html#g_malloc" title='g_malloc' data-ref="g_malloc">g_malloc</a>(<b>sizeof</b>(<a class="typedef" href="vnc-palette.h.html#VncPalette" title='VncPalette' data-type='struct VncPalette' data-ref="VncPalette">VncPalette</a>));</td></tr>
<tr><th id="1479">1479</th><td>        <a class="tu ref" href="#vnc_tight_cleanup_notifier" title='vnc_tight_cleanup_notifier' data-use='m' data-ref="vnc_tight_cleanup_notifier">vnc_tight_cleanup_notifier</a>.<a class="ref" href="../include/qemu/notify.h.html#Notifier::notify" title='Notifier::notify' data-ref="Notifier::notify">notify</a> = <a class="tu ref" href="#vnc_tight_cleanup" title='vnc_tight_cleanup' data-use='r' data-ref="vnc_tight_cleanup">vnc_tight_cleanup</a>;</td></tr>
<tr><th id="1480">1480</th><td>        <a class="ref" href="../include/qemu/thread.h.html#qemu_thread_atexit_add" title='qemu_thread_atexit_add' data-ref="qemu_thread_atexit_add">qemu_thread_atexit_add</a>(&amp;<a class="tu ref" href="#vnc_tight_cleanup_notifier" title='vnc_tight_cleanup_notifier' data-use='a' data-ref="vnc_tight_cleanup_notifier">vnc_tight_cleanup_notifier</a>);</td></tr>
<tr><th id="1481">1481</th><td>    }</td></tr>
<tr><th id="1482">1482</th><td></td></tr>
<tr><th id="1483">1483</th><td>    <a class="ref" href="vnc.h.html#vnc_framebuffer_update" title='vnc_framebuffer_update' data-ref="vnc_framebuffer_update">vnc_framebuffer_update</a>(<a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>, <a class="local col9 ref" href="#979x" title='x' data-ref="979x">x</a>, <a class="local col0 ref" href="#980y" title='y' data-ref="980y">y</a>, <a class="local col1 ref" href="#981w" title='w' data-ref="981w">w</a>, <a class="local col2 ref" href="#982h" title='h' data-ref="982h">h</a>, <a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::type" title='VncTight::type' data-ref="VncTight::type">type</a>);</td></tr>
<tr><th id="1484">1484</th><td></td></tr>
<tr><th id="1485">1485</th><td>    <a class="tu ref" href="#vnc_tight_start" title='vnc_tight_start' data-use='c' data-ref="vnc_tight_start">vnc_tight_start</a>(<a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>);</td></tr>
<tr><th id="1486">1486</th><td>    <a class="ref" href="vnc.h.html#vnc_raw_send_framebuffer_update" title='vnc_raw_send_framebuffer_update' data-ref="vnc_raw_send_framebuffer_update">vnc_raw_send_framebuffer_update</a>(<a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>, <a class="local col9 ref" href="#979x" title='x' data-ref="979x">x</a>, <a class="local col0 ref" href="#980y" title='y' data-ref="980y">y</a>, <a class="local col1 ref" href="#981w" title='w' data-ref="981w">w</a>, <a class="local col2 ref" href="#982h" title='h' data-ref="982h">h</a>);</td></tr>
<tr><th id="1487">1487</th><td>    <a class="tu ref" href="#vnc_tight_stop" title='vnc_tight_stop' data-use='c' data-ref="vnc_tight_stop">vnc_tight_stop</a>(<a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>);</td></tr>
<tr><th id="1488">1488</th><td></td></tr>
<tr><th id="1489">1489</th><td><u>#<span data-ppcond="1489">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1490">1490</th><td>    <b>if</b> (!vs-&gt;vd-&gt;non_adaptive &amp;&amp; vs-&gt;tight.quality != (uint8_t)-<var>1</var>) {</td></tr>
<tr><th id="1491">1491</th><td>        <em>double</em> freq = vnc_update_freq(vs, x, y, w, h);</td></tr>
<tr><th id="1492">1492</th><td></td></tr>
<tr><th id="1493">1493</th><td>        <b>if</b> (freq &lt; tight_jpeg_conf[vs-&gt;tight.quality].jpeg_freq_min) {</td></tr>
<tr><th id="1494">1494</th><td>            allow_jpeg = false;</td></tr>
<tr><th id="1495">1495</th><td>        }</td></tr>
<tr><th id="1496">1496</th><td>        <b>if</b> (freq &gt;= tight_jpeg_conf[vs-&gt;tight.quality].jpeg_freq_threshold) {</td></tr>
<tr><th id="1497">1497</th><td>            force_jpeg = true;</td></tr>
<tr><th id="1498">1498</th><td>            vnc_sent_lossy_rect(vs, x, y, w, h);</td></tr>
<tr><th id="1499">1499</th><td>        }</td></tr>
<tr><th id="1500">1500</th><td>    }</td></tr>
<tr><th id="1501">1501</th><td><u>#<span data-ppcond="1489">endif</span></u></td></tr>
<tr><th id="1502">1502</th><td></td></tr>
<tr><th id="1503">1503</th><td>    <a class="local col5 ref" href="#985colors" title='colors' data-ref="985colors">colors</a> = <a class="tu ref" href="#tight_fill_palette" title='tight_fill_palette' data-use='c' data-ref="tight_fill_palette">tight_fill_palette</a>(<a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>, <a class="local col9 ref" href="#979x" title='x' data-ref="979x">x</a>, <a class="local col0 ref" href="#980y" title='y' data-ref="980y">y</a>, <a class="local col1 ref" href="#981w" title='w' data-ref="981w">w</a> * <a class="local col2 ref" href="#982h" title='h' data-ref="982h">h</a>, &amp;<a class="local col3 ref" href="#983bg" title='bg' data-ref="983bg">bg</a>, &amp;<a class="local col4 ref" href="#984fg" title='fg' data-ref="984fg">fg</a>, <a class="tu ref" href="#color_count_palette" title='color_count_palette' data-use='r' data-ref="color_count_palette">color_count_palette</a>);</td></tr>
<tr><th id="1504">1504</th><td></td></tr>
<tr><th id="1505">1505</th><td><u>#<span data-ppcond="1505">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1506">1506</th><td>    <b>if</b> (allow_jpeg &amp;&amp; vs-&gt;tight.quality != (uint8_t)-<var>1</var>) {</td></tr>
<tr><th id="1507">1507</th><td>        ret = send_sub_rect_jpeg(vs, x, y, w, h, bg, fg, colors,</td></tr>
<tr><th id="1508">1508</th><td>                                 color_count_palette, force_jpeg);</td></tr>
<tr><th id="1509">1509</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1510">1510</th><td>        ret = send_sub_rect_nojpeg(vs, x, y, w, h, bg, fg, colors,</td></tr>
<tr><th id="1511">1511</th><td>                                   color_count_palette);</td></tr>
<tr><th id="1512">1512</th><td>    }</td></tr>
<tr><th id="1513">1513</th><td><u>#<span data-ppcond="1505">else</span></u></td></tr>
<tr><th id="1514">1514</th><td>    <a class="local col6 ref" href="#986ret" title='ret' data-ref="986ret">ret</a> = <a class="tu ref" href="#send_sub_rect_nojpeg" title='send_sub_rect_nojpeg' data-use='c' data-ref="send_sub_rect_nojpeg">send_sub_rect_nojpeg</a>(<a class="local col8 ref" href="#978vs" title='vs' data-ref="978vs">vs</a>, <a class="local col9 ref" href="#979x" title='x' data-ref="979x">x</a>, <a class="local col0 ref" href="#980y" title='y' data-ref="980y">y</a>, <a class="local col1 ref" href="#981w" title='w' data-ref="981w">w</a>, <a class="local col2 ref" href="#982h" title='h' data-ref="982h">h</a>, <a class="local col3 ref" href="#983bg" title='bg' data-ref="983bg">bg</a>, <a class="local col4 ref" href="#984fg" title='fg' data-ref="984fg">fg</a>, <a class="local col5 ref" href="#985colors" title='colors' data-ref="985colors">colors</a>,</td></tr>
<tr><th id="1515">1515</th><td>                               <a class="tu ref" href="#color_count_palette" title='color_count_palette' data-use='r' data-ref="color_count_palette">color_count_palette</a>);</td></tr>
<tr><th id="1516">1516</th><td><u>#<span data-ppcond="1505">endif</span></u></td></tr>
<tr><th id="1517">1517</th><td></td></tr>
<tr><th id="1518">1518</th><td>    <b>return</b> <a class="local col6 ref" href="#986ret" title='ret' data-ref="986ret">ret</a>;</td></tr>
<tr><th id="1519">1519</th><td>}</td></tr>
<tr><th id="1520">1520</th><td></td></tr>
<tr><th id="1521">1521</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_sub_rect_solid" title='send_sub_rect_solid' data-type='int send_sub_rect_solid(VncState * vs, int x, int y, int w, int h)' data-ref="send_sub_rect_solid">send_sub_rect_solid</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col7 decl" id="987vs" title='vs' data-type='VncState *' data-ref="987vs">vs</dfn>, <em>int</em> <dfn class="local col8 decl" id="988x" title='x' data-type='int' data-ref="988x">x</dfn>, <em>int</em> <dfn class="local col9 decl" id="989y" title='y' data-type='int' data-ref="989y">y</dfn>, <em>int</em> <dfn class="local col0 decl" id="990w" title='w' data-type='int' data-ref="990w">w</dfn>, <em>int</em> <dfn class="local col1 decl" id="991h" title='h' data-type='int' data-ref="991h">h</dfn>)</td></tr>
<tr><th id="1522">1522</th><td>{</td></tr>
<tr><th id="1523">1523</th><td>    <a class="ref" href="vnc.h.html#vnc_framebuffer_update" title='vnc_framebuffer_update' data-ref="vnc_framebuffer_update">vnc_framebuffer_update</a>(<a class="local col7 ref" href="#987vs" title='vs' data-ref="987vs">vs</a>, <a class="local col8 ref" href="#988x" title='x' data-ref="988x">x</a>, <a class="local col9 ref" href="#989y" title='y' data-ref="989y">y</a>, <a class="local col0 ref" href="#990w" title='w' data-ref="990w">w</a>, <a class="local col1 ref" href="#991h" title='h' data-ref="991h">h</a>, <a class="local col7 ref" href="#987vs" title='vs' data-ref="987vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::type" title='VncTight::type' data-ref="VncTight::type">type</a>);</td></tr>
<tr><th id="1524">1524</th><td></td></tr>
<tr><th id="1525">1525</th><td>    <a class="tu ref" href="#vnc_tight_start" title='vnc_tight_start' data-use='c' data-ref="vnc_tight_start">vnc_tight_start</a>(<a class="local col7 ref" href="#987vs" title='vs' data-ref="987vs">vs</a>);</td></tr>
<tr><th id="1526">1526</th><td>    <a class="ref" href="vnc.h.html#vnc_raw_send_framebuffer_update" title='vnc_raw_send_framebuffer_update' data-ref="vnc_raw_send_framebuffer_update">vnc_raw_send_framebuffer_update</a>(<a class="local col7 ref" href="#987vs" title='vs' data-ref="987vs">vs</a>, <a class="local col8 ref" href="#988x" title='x' data-ref="988x">x</a>, <a class="local col9 ref" href="#989y" title='y' data-ref="989y">y</a>, <a class="local col0 ref" href="#990w" title='w' data-ref="990w">w</a>, <a class="local col1 ref" href="#991h" title='h' data-ref="991h">h</a>);</td></tr>
<tr><th id="1527">1527</th><td>    <a class="tu ref" href="#vnc_tight_stop" title='vnc_tight_stop' data-use='c' data-ref="vnc_tight_stop">vnc_tight_stop</a>(<a class="local col7 ref" href="#987vs" title='vs' data-ref="987vs">vs</a>);</td></tr>
<tr><th id="1528">1528</th><td></td></tr>
<tr><th id="1529">1529</th><td>    <b>return</b> <a class="tu ref" href="#send_solid_rect" title='send_solid_rect' data-use='c' data-ref="send_solid_rect">send_solid_rect</a>(<a class="local col7 ref" href="#987vs" title='vs' data-ref="987vs">vs</a>);</td></tr>
<tr><th id="1530">1530</th><td>}</td></tr>
<tr><th id="1531">1531</th><td></td></tr>
<tr><th id="1532">1532</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="send_rect_simple" title='send_rect_simple' data-type='int send_rect_simple(VncState * vs, int x, int y, int w, int h, _Bool split)' data-ref="send_rect_simple">send_rect_simple</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col2 decl" id="992vs" title='vs' data-type='VncState *' data-ref="992vs">vs</dfn>, <em>int</em> <dfn class="local col3 decl" id="993x" title='x' data-type='int' data-ref="993x">x</dfn>, <em>int</em> <dfn class="local col4 decl" id="994y" title='y' data-type='int' data-ref="994y">y</dfn>, <em>int</em> <dfn class="local col5 decl" id="995w" title='w' data-type='int' data-ref="995w">w</dfn>, <em>int</em> <dfn class="local col6 decl" id="996h" title='h' data-type='int' data-ref="996h">h</dfn>,</td></tr>
<tr><th id="1533">1533</th><td>                            <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="local col7 decl" id="997split" title='split' data-type='_Bool' data-ref="997split">split</dfn>)</td></tr>
<tr><th id="1534">1534</th><td>{</td></tr>
<tr><th id="1535">1535</th><td>    <em>int</em> <dfn class="local col8 decl" id="998max_size" title='max_size' data-type='int' data-ref="998max_size">max_size</dfn>, <dfn class="local col9 decl" id="999max_width" title='max_width' data-type='int' data-ref="999max_width">max_width</dfn>;</td></tr>
<tr><th id="1536">1536</th><td>    <em>int</em> <dfn class="local col0 decl" id="1000max_sub_width" title='max_sub_width' data-type='int' data-ref="1000max_sub_width">max_sub_width</dfn>, <dfn class="local col1 decl" id="1001max_sub_height" title='max_sub_height' data-type='int' data-ref="1001max_sub_height">max_sub_height</dfn>;</td></tr>
<tr><th id="1537">1537</th><td>    <em>int</em> <dfn class="local col2 decl" id="1002dx" title='dx' data-type='int' data-ref="1002dx">dx</dfn>, <dfn class="local col3 decl" id="1003dy" title='dy' data-type='int' data-ref="1003dy">dy</dfn>;</td></tr>
<tr><th id="1538">1538</th><td>    <em>int</em> <dfn class="local col4 decl" id="1004rw" title='rw' data-type='int' data-ref="1004rw">rw</dfn>, <dfn class="local col5 decl" id="1005rh" title='rh' data-type='int' data-ref="1005rh">rh</dfn>;</td></tr>
<tr><th id="1539">1539</th><td>    <em>int</em> <dfn class="local col6 decl" id="1006n" title='n' data-type='int' data-ref="1006n">n</dfn> = <var>0</var>;</td></tr>
<tr><th id="1540">1540</th><td></td></tr>
<tr><th id="1541">1541</th><td>    <a class="local col8 ref" href="#998max_size" title='max_size' data-ref="998max_size">max_size</a> = <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col2 ref" href="#992vs" title='vs' data-ref="992vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col7 ref" href="#557max_rect_size" title='max_rect_size' data-ref="557max_rect_size">max_rect_size</a>;</td></tr>
<tr><th id="1542">1542</th><td>    <a class="local col9 ref" href="#999max_width" title='max_width' data-ref="999max_width">max_width</a> = <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col2 ref" href="#992vs" title='vs' data-ref="992vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col8 ref" href="#558max_rect_width" title='max_rect_width' data-ref="558max_rect_width">max_rect_width</a>;</td></tr>
<tr><th id="1543">1543</th><td></td></tr>
<tr><th id="1544">1544</th><td>    <b>if</b> (<a class="local col7 ref" href="#997split" title='split' data-ref="997split">split</a> &amp;&amp; (<a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a> &gt; <a class="local col9 ref" href="#999max_width" title='max_width' data-ref="999max_width">max_width</a> || <a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a> * <a class="local col6 ref" href="#996h" title='h' data-ref="996h">h</a> &gt; <a class="local col8 ref" href="#998max_size" title='max_size' data-ref="998max_size">max_size</a>)) {</td></tr>
<tr><th id="1545">1545</th><td>        <a class="local col0 ref" href="#1000max_sub_width" title='max_sub_width' data-ref="1000max_sub_width">max_sub_width</a> = (<a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a> &gt; <a class="local col9 ref" href="#999max_width" title='max_width' data-ref="999max_width">max_width</a>) ? <a class="local col9 ref" href="#999max_width" title='max_width' data-ref="999max_width">max_width</a> : <a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a>;</td></tr>
<tr><th id="1546">1546</th><td>        <a class="local col1 ref" href="#1001max_sub_height" title='max_sub_height' data-ref="1001max_sub_height">max_sub_height</a> = <a class="local col8 ref" href="#998max_size" title='max_size' data-ref="998max_size">max_size</a> / <a class="local col0 ref" href="#1000max_sub_width" title='max_sub_width' data-ref="1000max_sub_width">max_sub_width</a>;</td></tr>
<tr><th id="1547">1547</th><td></td></tr>
<tr><th id="1548">1548</th><td>        <b>for</b> (<a class="local col3 ref" href="#1003dy" title='dy' data-ref="1003dy">dy</a> = <var>0</var>; <a class="local col3 ref" href="#1003dy" title='dy' data-ref="1003dy">dy</a> &lt; <a class="local col6 ref" href="#996h" title='h' data-ref="996h">h</a>; <a class="local col3 ref" href="#1003dy" title='dy' data-ref="1003dy">dy</a> += <a class="local col1 ref" href="#1001max_sub_height" title='max_sub_height' data-ref="1001max_sub_height">max_sub_height</a>) {</td></tr>
<tr><th id="1549">1549</th><td>            <b>for</b> (<a class="local col2 ref" href="#1002dx" title='dx' data-ref="1002dx">dx</a> = <var>0</var>; <a class="local col2 ref" href="#1002dx" title='dx' data-ref="1002dx">dx</a> &lt; <a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a>; <a class="local col2 ref" href="#1002dx" title='dx' data-ref="1002dx">dx</a> += <a class="local col9 ref" href="#999max_width" title='max_width' data-ref="999max_width">max_width</a>) {</td></tr>
<tr><th id="1550">1550</th><td>                <a class="local col4 ref" href="#1004rw" title='rw' data-ref="1004rw">rw</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((max_sub_width) &lt; (w - dx)) ? (max_sub_width) : (w - dx))" data-ref="_M/MIN">MIN</a>(<a class="local col0 ref" href="#1000max_sub_width" title='max_sub_width' data-ref="1000max_sub_width">max_sub_width</a>, <a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a> - <a class="local col2 ref" href="#1002dx" title='dx' data-ref="1002dx">dx</a>);</td></tr>
<tr><th id="1551">1551</th><td>                <a class="local col5 ref" href="#1005rh" title='rh' data-ref="1005rh">rh</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((max_sub_height) &lt; (h - dy)) ? (max_sub_height) : (h - dy))" data-ref="_M/MIN">MIN</a>(<a class="local col1 ref" href="#1001max_sub_height" title='max_sub_height' data-ref="1001max_sub_height">max_sub_height</a>, <a class="local col6 ref" href="#996h" title='h' data-ref="996h">h</a> - <a class="local col3 ref" href="#1003dy" title='dy' data-ref="1003dy">dy</a>);</td></tr>
<tr><th id="1552">1552</th><td>                <a class="local col6 ref" href="#1006n" title='n' data-ref="1006n">n</a> += <a class="tu ref" href="#send_sub_rect" title='send_sub_rect' data-use='c' data-ref="send_sub_rect">send_sub_rect</a>(<a class="local col2 ref" href="#992vs" title='vs' data-ref="992vs">vs</a>, <a class="local col3 ref" href="#993x" title='x' data-ref="993x">x</a>+<a class="local col2 ref" href="#1002dx" title='dx' data-ref="1002dx">dx</a>, <a class="local col4 ref" href="#994y" title='y' data-ref="994y">y</a>+<a class="local col3 ref" href="#1003dy" title='dy' data-ref="1003dy">dy</a>, <a class="local col4 ref" href="#1004rw" title='rw' data-ref="1004rw">rw</a>, <a class="local col5 ref" href="#1005rh" title='rh' data-ref="1005rh">rh</a>);</td></tr>
<tr><th id="1553">1553</th><td>            }</td></tr>
<tr><th id="1554">1554</th><td>        }</td></tr>
<tr><th id="1555">1555</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1556">1556</th><td>        <a class="local col6 ref" href="#1006n" title='n' data-ref="1006n">n</a> += <a class="tu ref" href="#send_sub_rect" title='send_sub_rect' data-use='c' data-ref="send_sub_rect">send_sub_rect</a>(<a class="local col2 ref" href="#992vs" title='vs' data-ref="992vs">vs</a>, <a class="local col3 ref" href="#993x" title='x' data-ref="993x">x</a>, <a class="local col4 ref" href="#994y" title='y' data-ref="994y">y</a>, <a class="local col5 ref" href="#995w" title='w' data-ref="995w">w</a>, <a class="local col6 ref" href="#996h" title='h' data-ref="996h">h</a>);</td></tr>
<tr><th id="1557">1557</th><td>    }</td></tr>
<tr><th id="1558">1558</th><td></td></tr>
<tr><th id="1559">1559</th><td>    <b>return</b> <a class="local col6 ref" href="#1006n" title='n' data-ref="1006n">n</a>;</td></tr>
<tr><th id="1560">1560</th><td>}</td></tr>
<tr><th id="1561">1561</th><td></td></tr>
<tr><th id="1562">1562</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="find_large_solid_color_rect" title='find_large_solid_color_rect' data-type='int find_large_solid_color_rect(VncState * vs, int x, int y, int w, int h, int max_rows)' data-ref="find_large_solid_color_rect">find_large_solid_color_rect</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col7 decl" id="1007vs" title='vs' data-type='VncState *' data-ref="1007vs">vs</dfn>, <em>int</em> <dfn class="local col8 decl" id="1008x" title='x' data-type='int' data-ref="1008x">x</dfn>, <em>int</em> <dfn class="local col9 decl" id="1009y" title='y' data-type='int' data-ref="1009y">y</dfn>,</td></tr>
<tr><th id="1563">1563</th><td>                                       <em>int</em> <dfn class="local col0 decl" id="1010w" title='w' data-type='int' data-ref="1010w">w</dfn>, <em>int</em> <dfn class="local col1 decl" id="1011h" title='h' data-type='int' data-ref="1011h">h</dfn>, <em>int</em> <dfn class="local col2 decl" id="1012max_rows" title='max_rows' data-type='int' data-ref="1012max_rows">max_rows</dfn>)</td></tr>
<tr><th id="1564">1564</th><td>{</td></tr>
<tr><th id="1565">1565</th><td>    <em>int</em> <dfn class="local col3 decl" id="1013dx" title='dx' data-type='int' data-ref="1013dx">dx</dfn>, <dfn class="local col4 decl" id="1014dy" title='dy' data-type='int' data-ref="1014dy">dy</dfn>, <dfn class="local col5 decl" id="1015dw" title='dw' data-type='int' data-ref="1015dw">dw</dfn>, <dfn class="local col6 decl" id="1016dh" title='dh' data-type='int' data-ref="1016dh">dh</dfn>;</td></tr>
<tr><th id="1566">1566</th><td>    <em>int</em> <dfn class="local col7 decl" id="1017n" title='n' data-type='int' data-ref="1017n">n</dfn> = <var>0</var>;</td></tr>
<tr><th id="1567">1567</th><td></td></tr>
<tr><th id="1568">1568</th><td>    <i>/* Try to find large solid-color areas and send them separately. */</i></td></tr>
<tr><th id="1569">1569</th><td></td></tr>
<tr><th id="1570">1570</th><td>    <b>for</b> (<a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a> = <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>; <a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a> &lt; <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a> + <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a>; <a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a> += <a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>) {</td></tr>
<tr><th id="1571">1571</th><td></td></tr>
<tr><th id="1572">1572</th><td>        <i>/* If a rectangle becomes too large, send its upper part now. */</i></td></tr>
<tr><th id="1573">1573</th><td></td></tr>
<tr><th id="1574">1574</th><td>        <b>if</b> (<a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a> - <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a> &gt;= <a class="local col2 ref" href="#1012max_rows" title='max_rows' data-ref="1012max_rows">max_rows</a>) {</td></tr>
<tr><th id="1575">1575</th><td>            <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> += <a class="tu ref" href="#send_rect_simple" title='send_rect_simple' data-use='c' data-ref="send_rect_simple">send_rect_simple</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>, <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>, <a class="local col2 ref" href="#1012max_rows" title='max_rows' data-ref="1012max_rows">max_rows</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="1576">1576</th><td>            <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a> += <a class="local col2 ref" href="#1012max_rows" title='max_rows' data-ref="1012max_rows">max_rows</a>;</td></tr>
<tr><th id="1577">1577</th><td>            <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a> -= <a class="local col2 ref" href="#1012max_rows" title='max_rows' data-ref="1012max_rows">max_rows</a>;</td></tr>
<tr><th id="1578">1578</th><td>        }</td></tr>
<tr><th id="1579">1579</th><td></td></tr>
<tr><th id="1580">1580</th><td>        <a class="local col6 ref" href="#1016dh" title='dh' data-ref="1016dh">dh</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((16) &lt; ((y + h - dy))) ? (16) : ((y + h - dy)))" data-ref="_M/MIN">MIN</a>(<a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>, (<a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a> + <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a> - <a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a>));</td></tr>
<tr><th id="1581">1581</th><td></td></tr>
<tr><th id="1582">1582</th><td>        <b>for</b> (<a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a> = <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>; <a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a> &lt; <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a> + <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>; <a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a> += <a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>) {</td></tr>
<tr><th id="1583">1583</th><td>            <a class="typedef" href="../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="1018color_value" title='color_value' data-type='uint32_t' data-ref="1018color_value">color_value</dfn>;</td></tr>
<tr><th id="1584">1584</th><td>            <em>int</em> <dfn class="local col9 decl" id="1019x_best" title='x_best' data-type='int' data-ref="1019x_best">x_best</dfn>, <dfn class="local col0 decl" id="1020y_best" title='y_best' data-type='int' data-ref="1020y_best">y_best</dfn>, <dfn class="local col1 decl" id="1021w_best" title='w_best' data-type='int' data-ref="1021w_best">w_best</dfn>, <dfn class="local col2 decl" id="1022h_best" title='h_best' data-type='int' data-ref="1022h_best">h_best</dfn>;</td></tr>
<tr><th id="1585">1585</th><td></td></tr>
<tr><th id="1586">1586</th><td>            <a class="local col5 ref" href="#1015dw" title='dw' data-ref="1015dw">dw</a> = <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((16) &lt; ((x + w - dx))) ? (16) : ((x + w - dx)))" data-ref="_M/MIN">MIN</a>(<a class="macro" href="vnc-enc-tight.h.html#176" title="16" data-ref="_M/VNC_TIGHT_MAX_SPLIT_TILE_SIZE">VNC_TIGHT_MAX_SPLIT_TILE_SIZE</a>, (<a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a> + <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a> - <a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a>));</td></tr>
<tr><th id="1587">1587</th><td></td></tr>
<tr><th id="1588">1588</th><td>            <b>if</b> (!<a class="tu ref" href="#check_solid_tile" title='check_solid_tile' data-use='c' data-ref="check_solid_tile">check_solid_tile</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a>, <a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a>, <a class="local col5 ref" href="#1015dw" title='dw' data-ref="1015dw">dw</a>, <a class="local col6 ref" href="#1016dh" title='dh' data-ref="1016dh">dh</a>, &amp;<a class="local col8 ref" href="#1018color_value" title='color_value' data-ref="1018color_value">color_value</a>, <span class="macro" title="0" data-ref="_M/false">false</span>)) {</td></tr>
<tr><th id="1589">1589</th><td>                <b>continue</b> ;</td></tr>
<tr><th id="1590">1590</th><td>            }</td></tr>
<tr><th id="1591">1591</th><td></td></tr>
<tr><th id="1592">1592</th><td>            <i>/* Get dimensions of solid-color area. */</i></td></tr>
<tr><th id="1593">1593</th><td></td></tr>
<tr><th id="1594">1594</th><td>            <a class="tu ref" href="#find_best_solid_area" title='find_best_solid_area' data-use='c' data-ref="find_best_solid_area">find_best_solid_area</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a>, <a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a>, <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a> - (<a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a> - <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>), <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a> - (<a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a> - <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>),</td></tr>
<tr><th id="1595">1595</th><td>                                 <a class="local col8 ref" href="#1018color_value" title='color_value' data-ref="1018color_value">color_value</a>, &amp;<a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a>, &amp;<a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>);</td></tr>
<tr><th id="1596">1596</th><td></td></tr>
<tr><th id="1597">1597</th><td>            <i>/* Make sure a solid rectangle is large enough</i></td></tr>
<tr><th id="1598">1598</th><td><i>               (or the whole rectangle is of the same color). */</i></td></tr>
<tr><th id="1599">1599</th><td></td></tr>
<tr><th id="1600">1600</th><td>            <b>if</b> (<a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a> * <a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a> != <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a> * <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a> &amp;&amp;</td></tr>
<tr><th id="1601">1601</th><td>                <a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a> * <a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a> &lt; <a class="macro" href="vnc-enc-tight.h.html#175" title="2048" data-ref="_M/VNC_TIGHT_MIN_SOLID_SUBRECT_SIZE">VNC_TIGHT_MIN_SOLID_SUBRECT_SIZE</a>) {</td></tr>
<tr><th id="1602">1602</th><td>                <b>continue</b>;</td></tr>
<tr><th id="1603">1603</th><td>            }</td></tr>
<tr><th id="1604">1604</th><td></td></tr>
<tr><th id="1605">1605</th><td>            <i>/* Try to extend solid rectangle to maximum size. */</i></td></tr>
<tr><th id="1606">1606</th><td></td></tr>
<tr><th id="1607">1607</th><td>            <a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a> = <a class="local col3 ref" href="#1013dx" title='dx' data-ref="1013dx">dx</a>; <a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a> = <a class="local col4 ref" href="#1014dy" title='dy' data-ref="1014dy">dy</a>;</td></tr>
<tr><th id="1608">1608</th><td>            <a class="tu ref" href="#extend_solid_area" title='extend_solid_area' data-use='c' data-ref="extend_solid_area">extend_solid_area</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>, <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>, <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a>, <a class="local col8 ref" href="#1018color_value" title='color_value' data-ref="1018color_value">color_value</a>,</td></tr>
<tr><th id="1609">1609</th><td>                              &amp;<a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a>, &amp;<a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>, &amp;<a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a>, &amp;<a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>);</td></tr>
<tr><th id="1610">1610</th><td></td></tr>
<tr><th id="1611">1611</th><td>            <i>/* Send rectangles at top and left to solid-color area. */</i></td></tr>
<tr><th id="1612">1612</th><td></td></tr>
<tr><th id="1613">1613</th><td>            <b>if</b> (<a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a> != <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>) {</td></tr>
<tr><th id="1614">1614</th><td>                <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> += <a class="tu ref" href="#send_rect_simple" title='send_rect_simple' data-use='c' data-ref="send_rect_simple">send_rect_simple</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>, <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>, <a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>-<a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="1615">1615</th><td>            }</td></tr>
<tr><th id="1616">1616</th><td>            <b>if</b> (<a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a> != <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>) {</td></tr>
<tr><th id="1617">1617</th><td>                <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> += <a class="tu ref" href="#tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-use='c' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>,</td></tr>
<tr><th id="1618">1618</th><td>                                                   <a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a>-<a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>);</td></tr>
<tr><th id="1619">1619</th><td>            }</td></tr>
<tr><th id="1620">1620</th><td></td></tr>
<tr><th id="1621">1621</th><td>            <i>/* Send solid-color rectangle. */</i></td></tr>
<tr><th id="1622">1622</th><td>            <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> += <a class="tu ref" href="#send_sub_rect_solid" title='send_sub_rect_solid' data-use='c' data-ref="send_sub_rect_solid">send_sub_rect_solid</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a>, <a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>, <a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a>, <a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>);</td></tr>
<tr><th id="1623">1623</th><td></td></tr>
<tr><th id="1624">1624</th><td>            <i>/* Send remaining rectangles (at right and bottom). */</i></td></tr>
<tr><th id="1625">1625</th><td></td></tr>
<tr><th id="1626">1626</th><td>            <b>if</b> (<a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a> + <a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a> != <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a> + <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>) {</td></tr>
<tr><th id="1627">1627</th><td>                <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> += <a class="tu ref" href="#tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-use='c' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a>+<a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a>,</td></tr>
<tr><th id="1628">1628</th><td>                                                   <a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>,</td></tr>
<tr><th id="1629">1629</th><td>                                                   <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>-(<a class="local col9 ref" href="#1019x_best" title='x_best' data-ref="1019x_best">x_best</a>-<a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>)-<a class="local col1 ref" href="#1021w_best" title='w_best' data-ref="1021w_best">w_best</a>,</td></tr>
<tr><th id="1630">1630</th><td>                                                   <a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>);</td></tr>
<tr><th id="1631">1631</th><td>            }</td></tr>
<tr><th id="1632">1632</th><td>            <b>if</b> (<a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a> + <a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a> != <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a> + <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a>) {</td></tr>
<tr><th id="1633">1633</th><td>                <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> += <a class="tu ref" href="#tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-use='c' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>+<a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>,</td></tr>
<tr><th id="1634">1634</th><td>                                                   <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>, <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a>-(<a class="local col0 ref" href="#1020y_best" title='y_best' data-ref="1020y_best">y_best</a>-<a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>)-<a class="local col2 ref" href="#1022h_best" title='h_best' data-ref="1022h_best">h_best</a>);</td></tr>
<tr><th id="1635">1635</th><td>            }</td></tr>
<tr><th id="1636">1636</th><td></td></tr>
<tr><th id="1637">1637</th><td>            <i>/* Return after all recursive calls are done. */</i></td></tr>
<tr><th id="1638">1638</th><td>            <b>return</b> <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a>;</td></tr>
<tr><th id="1639">1639</th><td>        }</td></tr>
<tr><th id="1640">1640</th><td>    }</td></tr>
<tr><th id="1641">1641</th><td>    <b>return</b> <a class="local col7 ref" href="#1017n" title='n' data-ref="1017n">n</a> + <a class="tu ref" href="#send_rect_simple" title='send_rect_simple' data-use='c' data-ref="send_rect_simple">send_rect_simple</a>(<a class="local col7 ref" href="#1007vs" title='vs' data-ref="1007vs">vs</a>, <a class="local col8 ref" href="#1008x" title='x' data-ref="1008x">x</a>, <a class="local col9 ref" href="#1009y" title='y' data-ref="1009y">y</a>, <a class="local col0 ref" href="#1010w" title='w' data-ref="1010w">w</a>, <a class="local col1 ref" href="#1011h" title='h' data-ref="1011h">h</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="1642">1642</th><td>}</td></tr>
<tr><th id="1643">1643</th><td></td></tr>
<tr><th id="1644">1644</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-type='int tight_send_framebuffer_update(VncState * vs, int x, int y, int w, int h)' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col3 decl" id="1023vs" title='vs' data-type='VncState *' data-ref="1023vs">vs</dfn>, <em>int</em> <dfn class="local col4 decl" id="1024x" title='x' data-type='int' data-ref="1024x">x</dfn>, <em>int</em> <dfn class="local col5 decl" id="1025y" title='y' data-type='int' data-ref="1025y">y</dfn>,</td></tr>
<tr><th id="1645">1645</th><td>                                         <em>int</em> <dfn class="local col6 decl" id="1026w" title='w' data-type='int' data-ref="1026w">w</dfn>, <em>int</em> <dfn class="local col7 decl" id="1027h" title='h' data-type='int' data-ref="1027h">h</dfn>)</td></tr>
<tr><th id="1646">1646</th><td>{</td></tr>
<tr><th id="1647">1647</th><td>    <em>int</em> <dfn class="local col8 decl" id="1028max_rows" title='max_rows' data-type='int' data-ref="1028max_rows">max_rows</dfn>;</td></tr>
<tr><th id="1648">1648</th><td></td></tr>
<tr><th id="1649">1649</th><td>    <b>if</b> (<a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bytes_per_pixel" title='PixelFormat::bytes_per_pixel' data-ref="PixelFormat::bytes_per_pixel">bytes_per_pixel</a> == <var>4</var> &amp;&amp; <a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::rmax" title='PixelFormat::rmax' data-ref="PixelFormat::rmax">rmax</a> == <var>0xFF</var> &amp;&amp;</td></tr>
<tr><th id="1650">1650</th><td>        <a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::bmax" title='PixelFormat::bmax' data-ref="PixelFormat::bmax">bmax</a> == <var>0xFF</var> &amp;&amp; <a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::client_pf" title='VncState::client_pf' data-ref="VncState::client_pf">client_pf</a>.<a class="ref" href="../include/ui/console.h.html#PixelFormat::gmax" title='PixelFormat::gmax' data-ref="PixelFormat::gmax">gmax</a> == <var>0xFF</var>) {</td></tr>
<tr><th id="1651">1651</th><td>        <a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a> = <span class="macro" title="1" data-ref="_M/true">true</span>;</td></tr>
<tr><th id="1652">1652</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1653">1653</th><td>        <a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::pixel24" title='VncTight::pixel24' data-ref="VncTight::pixel24">pixel24</a> = <span class="macro" title="0" data-ref="_M/false">false</span>;</td></tr>
<tr><th id="1654">1654</th><td>    }</td></tr>
<tr><th id="1655">1655</th><td></td></tr>
<tr><th id="1656">1656</th><td><u>#<span data-ppcond="1656">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1657">1657</th><td>    <b>if</b> (vs-&gt;tight.quality != (uint8_t)-<var>1</var>) {</td></tr>
<tr><th id="1658">1658</th><td>        <em>double</em> freq = vnc_update_freq(vs, x, y, w, h);</td></tr>
<tr><th id="1659">1659</th><td></td></tr>
<tr><th id="1660">1660</th><td>        <b>if</b> (freq &gt; tight_jpeg_conf[vs-&gt;tight.quality].jpeg_freq_threshold) {</td></tr>
<tr><th id="1661">1661</th><td>            <b>return</b> send_rect_simple(vs, x, y, w, h, false);</td></tr>
<tr><th id="1662">1662</th><td>        }</td></tr>
<tr><th id="1663">1663</th><td>    }</td></tr>
<tr><th id="1664">1664</th><td><u>#<span data-ppcond="1656">endif</span></u></td></tr>
<tr><th id="1665">1665</th><td></td></tr>
<tr><th id="1666">1666</th><td>    <b>if</b> (<a class="local col6 ref" href="#1026w" title='w' data-ref="1026w">w</a> * <a class="local col7 ref" href="#1027h" title='h' data-ref="1027h">h</a> &lt; <a class="macro" href="vnc-enc-tight.h.html#174" title="4096" data-ref="_M/VNC_TIGHT_MIN_SPLIT_RECT_SIZE">VNC_TIGHT_MIN_SPLIT_RECT_SIZE</a>) {</td></tr>
<tr><th id="1667">1667</th><td>        <b>return</b> <a class="tu ref" href="#send_rect_simple" title='send_rect_simple' data-use='c' data-ref="send_rect_simple">send_rect_simple</a>(<a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>, <a class="local col4 ref" href="#1024x" title='x' data-ref="1024x">x</a>, <a class="local col5 ref" href="#1025y" title='y' data-ref="1025y">y</a>, <a class="local col6 ref" href="#1026w" title='w' data-ref="1026w">w</a>, <a class="local col7 ref" href="#1027h" title='h' data-ref="1027h">h</a>, <span class="macro" title="1" data-ref="_M/true">true</span>);</td></tr>
<tr><th id="1668">1668</th><td>    }</td></tr>
<tr><th id="1669">1669</th><td></td></tr>
<tr><th id="1670">1670</th><td>    <i>/* Calculate maximum number of rows in one non-solid rectangle. */</i></td></tr>
<tr><th id="1671">1671</th><td></td></tr>
<tr><th id="1672">1672</th><td>    <a class="local col8 ref" href="#1028max_rows" title='max_rows' data-ref="1028max_rows">max_rows</a> = <a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col7 ref" href="#557max_rect_size" title='max_rect_size' data-ref="557max_rect_size">max_rect_size</a>;</td></tr>
<tr><th id="1673">1673</th><td>    <a class="local col8 ref" href="#1028max_rows" title='max_rows' data-ref="1028max_rows">max_rows</a> /= <a class="macro" href="../../include/glib-2.0/glib/gmacros.h.html#291" title="(((tight_conf[vs-&gt;tight.compression].max_rect_width) &lt; (w)) ? (tight_conf[vs-&gt;tight.compression].max_rect_width) : (w))" data-ref="_M/MIN">MIN</a>(<a class="tu ref" href="#tight_conf" title='tight_conf' data-use='m' data-ref="tight_conf">tight_conf</a>[<a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::compression" title='VncTight::compression' data-ref="VncTight::compression">compression</a>].<a class="local col8 ref" href="#558max_rect_width" title='max_rect_width' data-ref="558max_rect_width">max_rect_width</a>, <a class="local col6 ref" href="#1026w" title='w' data-ref="1026w">w</a>);</td></tr>
<tr><th id="1674">1674</th><td></td></tr>
<tr><th id="1675">1675</th><td>    <b>return</b> <a class="tu ref" href="#find_large_solid_color_rect" title='find_large_solid_color_rect' data-use='c' data-ref="find_large_solid_color_rect">find_large_solid_color_rect</a>(<a class="local col3 ref" href="#1023vs" title='vs' data-ref="1023vs">vs</a>, <a class="local col4 ref" href="#1024x" title='x' data-ref="1024x">x</a>, <a class="local col5 ref" href="#1025y" title='y' data-ref="1025y">y</a>, <a class="local col6 ref" href="#1026w" title='w' data-ref="1026w">w</a>, <a class="local col7 ref" href="#1027h" title='h' data-ref="1027h">h</a>, <a class="local col8 ref" href="#1028max_rows" title='max_rows' data-ref="1028max_rows">max_rows</a>);</td></tr>
<tr><th id="1676">1676</th><td>}</td></tr>
<tr><th id="1677">1677</th><td></td></tr>
<tr><th id="1678">1678</th><td><em>int</em> <dfn class="decl def" id="vnc_tight_send_framebuffer_update" title='vnc_tight_send_framebuffer_update' data-ref="vnc_tight_send_framebuffer_update">vnc_tight_send_framebuffer_update</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col9 decl" id="1029vs" title='vs' data-type='VncState *' data-ref="1029vs">vs</dfn>, <em>int</em> <dfn class="local col0 decl" id="1030x" title='x' data-type='int' data-ref="1030x">x</dfn>, <em>int</em> <dfn class="local col1 decl" id="1031y" title='y' data-type='int' data-ref="1031y">y</dfn>,</td></tr>
<tr><th id="1679">1679</th><td>                                      <em>int</em> <dfn class="local col2 decl" id="1032w" title='w' data-type='int' data-ref="1032w">w</dfn>, <em>int</em> <dfn class="local col3 decl" id="1033h" title='h' data-type='int' data-ref="1033h">h</dfn>)</td></tr>
<tr><th id="1680">1680</th><td>{</td></tr>
<tr><th id="1681">1681</th><td>    <a class="local col9 ref" href="#1029vs" title='vs' data-ref="1029vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::type" title='VncTight::type' data-ref="VncTight::type">type</a> = <a class="macro" href="vnc.h.html#376" title="0x00000007" data-ref="_M/VNC_ENCODING_TIGHT">VNC_ENCODING_TIGHT</a>;</td></tr>
<tr><th id="1682">1682</th><td>    <b>return</b> <a class="tu ref" href="#tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-use='c' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</a>(<a class="local col9 ref" href="#1029vs" title='vs' data-ref="1029vs">vs</a>, <a class="local col0 ref" href="#1030x" title='x' data-ref="1030x">x</a>, <a class="local col1 ref" href="#1031y" title='y' data-ref="1031y">y</a>, <a class="local col2 ref" href="#1032w" title='w' data-ref="1032w">w</a>, <a class="local col3 ref" href="#1033h" title='h' data-ref="1033h">h</a>);</td></tr>
<tr><th id="1683">1683</th><td>}</td></tr>
<tr><th id="1684">1684</th><td></td></tr>
<tr><th id="1685">1685</th><td><em>int</em> <dfn class="decl def" id="vnc_tight_png_send_framebuffer_update" title='vnc_tight_png_send_framebuffer_update' data-ref="vnc_tight_png_send_framebuffer_update">vnc_tight_png_send_framebuffer_update</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col4 decl" id="1034vs" title='vs' data-type='VncState *' data-ref="1034vs">vs</dfn>, <em>int</em> <dfn class="local col5 decl" id="1035x" title='x' data-type='int' data-ref="1035x">x</dfn>, <em>int</em> <dfn class="local col6 decl" id="1036y" title='y' data-type='int' data-ref="1036y">y</dfn>,</td></tr>
<tr><th id="1686">1686</th><td>                                          <em>int</em> <dfn class="local col7 decl" id="1037w" title='w' data-type='int' data-ref="1037w">w</dfn>, <em>int</em> <dfn class="local col8 decl" id="1038h" title='h' data-type='int' data-ref="1038h">h</dfn>)</td></tr>
<tr><th id="1687">1687</th><td>{</td></tr>
<tr><th id="1688">1688</th><td>    <a class="local col4 ref" href="#1034vs" title='vs' data-ref="1034vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::type" title='VncTight::type' data-ref="VncTight::type">type</a> = <a class="macro" href="vnc.h.html#391" title="0xFFFFFEFC" data-ref="_M/VNC_ENCODING_TIGHT_PNG">VNC_ENCODING_TIGHT_PNG</a>;</td></tr>
<tr><th id="1689">1689</th><td>    <b>return</b> <a class="tu ref" href="#tight_send_framebuffer_update" title='tight_send_framebuffer_update' data-use='c' data-ref="tight_send_framebuffer_update">tight_send_framebuffer_update</a>(<a class="local col4 ref" href="#1034vs" title='vs' data-ref="1034vs">vs</a>, <a class="local col5 ref" href="#1035x" title='x' data-ref="1035x">x</a>, <a class="local col6 ref" href="#1036y" title='y' data-ref="1036y">y</a>, <a class="local col7 ref" href="#1037w" title='w' data-ref="1037w">w</a>, <a class="local col8 ref" href="#1038h" title='h' data-ref="1038h">h</a>);</td></tr>
<tr><th id="1690">1690</th><td>}</td></tr>
<tr><th id="1691">1691</th><td></td></tr>
<tr><th id="1692">1692</th><td><em>void</em> <dfn class="decl def" id="vnc_tight_clear" title='vnc_tight_clear' data-ref="vnc_tight_clear">vnc_tight_clear</dfn>(<a class="typedef" href="vnc.h.html#VncState" title='VncState' data-type='struct VncState' data-ref="VncState">VncState</a> *<dfn class="local col9 decl" id="1039vs" title='vs' data-type='VncState *' data-ref="1039vs">vs</dfn>)</td></tr>
<tr><th id="1693">1693</th><td>{</td></tr>
<tr><th id="1694">1694</th><td>    <em>int</em> <dfn class="local col0 decl" id="1040i" title='i' data-type='int' data-ref="1040i">i</dfn>;</td></tr>
<tr><th id="1695">1695</th><td>    <b>for</b> (<a class="local col0 ref" href="#1040i" title='i' data-ref="1040i">i</a>=<var>0</var>; <a class="local col0 ref" href="#1040i" title='i' data-ref="1040i">i</a>&lt;<a class="macro" href="../include/qemu/osdep.h.html#208" title="((sizeof(vs-&gt;tight.stream) / sizeof((vs-&gt;tight.stream)[0])) + (sizeof(struct { int:(!(!__builtin_types_compatible_p(typeof(vs-&gt;tight.stream), typeof(&amp;(vs-&gt;tight.stream)[0])))) ? -1 : 1; }) - sizeof(struct { int:(!(!__builtin_types_compatible_p(typeof(vs-&gt;tight.stream), typeof(&amp;(vs-&gt;tight.stream)[0])))) ? -1 : 1; })))" data-ref="_M/ARRAY_SIZE">ARRAY_SIZE</a>(<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::stream" title='VncTight::stream' data-ref="VncTight::stream">stream</a>); <a class="local col0 ref" href="#1040i" title='i' data-ref="1040i">i</a>++) {</td></tr>
<tr><th id="1696">1696</th><td>        <b>if</b> (<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::stream" title='VncTight::stream' data-ref="VncTight::stream">stream</a>[<a class="local col0 ref" href="#1040i" title='i' data-ref="1040i">i</a>].<a class="ref" href="../../include/zlib.h.html#z_stream_s::opaque" title='z_stream_s::opaque' data-ref="z_stream_s::opaque">opaque</a>) {</td></tr>
<tr><th id="1697">1697</th><td>            <a class="ref" href="../../include/zlib.h.html#deflateEnd" title='deflateEnd' data-ref="deflateEnd">deflateEnd</a>(&amp;<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::stream" title='VncTight::stream' data-ref="VncTight::stream">stream</a>[<a class="local col0 ref" href="#1040i" title='i' data-ref="1040i">i</a>]);</td></tr>
<tr><th id="1698">1698</th><td>        }</td></tr>
<tr><th id="1699">1699</th><td>    }</td></tr>
<tr><th id="1700">1700</th><td></td></tr>
<tr><th id="1701">1701</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_free" title='buffer_free' data-ref="buffer_free">buffer_free</a>(&amp;<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::tight" title='VncTight::tight' data-ref="VncTight::tight">tight</a>);</td></tr>
<tr><th id="1702">1702</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_free" title='buffer_free' data-ref="buffer_free">buffer_free</a>(&amp;<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::zlib" title='VncTight::zlib' data-ref="VncTight::zlib">zlib</a>);</td></tr>
<tr><th id="1703">1703</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_free" title='buffer_free' data-ref="buffer_free">buffer_free</a>(&amp;<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::gradient" title='VncTight::gradient' data-ref="VncTight::gradient">gradient</a>);</td></tr>
<tr><th id="1704">1704</th><td><u>#<span data-ppcond="1704">ifdef</span> <span class="macro" data-ref="_M/CONFIG_VNC_JPEG">CONFIG_VNC_JPEG</span></u></td></tr>
<tr><th id="1705">1705</th><td>    buffer_free(&amp;vs-&gt;tight.jpeg);</td></tr>
<tr><th id="1706">1706</th><td><u>#<span data-ppcond="1704">endif</span></u></td></tr>
<tr><th id="1707">1707</th><td><u>#<span data-ppcond="1707">ifdef</span> <a class="macro" href="../config-host.h.html#25" data-ref="_M/CONFIG_VNC_PNG">CONFIG_VNC_PNG</a></u></td></tr>
<tr><th id="1708">1708</th><td>    <a class="ref" href="../include/qemu/buffer.h.html#buffer_free" title='buffer_free' data-ref="buffer_free">buffer_free</a>(&amp;<a class="local col9 ref" href="#1039vs" title='vs' data-ref="1039vs">vs</a>-&gt;<a class="ref" href="vnc.h.html#VncState::tight" title='VncState::tight' data-ref="VncState::tight">tight</a>.<a class="ref" href="vnc.h.html#VncTight::png" title='VncTight::png' data-ref="VncTight::png">png</a>);</td></tr>
<tr><th id="1709">1709</th><td><u>#<span data-ppcond="1707">endif</span></u></td></tr>
<tr><th id="1710">1710</th><td>}</td></tr>
<tr><th id="1711">1711</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2017-Aug-28</em> from project codebrowser revision <em>v2.10.0-rc0-7-g6be37cc</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>

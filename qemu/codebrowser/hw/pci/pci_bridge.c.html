<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>pci_bridge.c source code [codebrowser/hw/pci/pci_bridge.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/hw/pci/pci_bridge.c'; var root_path = '../../..'; var data_path = '../../../../data';</script>
<script src='../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../..'>codebrowser</a>/<a href='..'>hw</a>/<a href='./'>pci</a>/<a href='pci_bridge.c.html'>pci_bridge.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * QEMU PCI bus manager</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright (c) 2004 Fabrice Bellard</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * Permission is hereby granted, free of charge, to any person obtaining a copy</i></td></tr>
<tr><th id="7">7</th><td><i> * of this software and associated documentation files (the "Software"), to dea</i></td></tr>
<tr><th id="8">8</th><td><i></i></td></tr>
<tr><th id="9">9</th><td><i> * in the Software without restriction, including without limitation the rights</i></td></tr>
<tr><th id="10">10</th><td><i> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</i></td></tr>
<tr><th id="11">11</th><td><i> * copies of the Software, and to permit persons to whom the Software is</i></td></tr>
<tr><th id="12">12</th><td><i> * furnished to do so, subject to the following conditions:</i></td></tr>
<tr><th id="13">13</th><td><i> *</i></td></tr>
<tr><th id="14">14</th><td><i> * The above copyright notice and this permission notice shall be included in</i></td></tr>
<tr><th id="15">15</th><td><i> * all copies or substantial portions of the Software.</i></td></tr>
<tr><th id="16">16</th><td><i> *</i></td></tr>
<tr><th id="17">17</th><td><i> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</i></td></tr>
<tr><th id="18">18</th><td><i> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</i></td></tr>
<tr><th id="19">19</th><td><i> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</i></td></tr>
<tr><th id="20">20</th><td><i> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</i></td></tr>
<tr><th id="21">21</th><td><i> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM</i></td></tr>
<tr><th id="22">22</th><td><i></i></td></tr>
<tr><th id="23">23</th><td><i> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</i></td></tr>
<tr><th id="24">24</th><td><i> * THE SOFTWARE.</i></td></tr>
<tr><th id="25">25</th><td><i> */</i></td></tr>
<tr><th id="26">26</th><td><i>/*</i></td></tr>
<tr><th id="27">27</th><td><i> * split out from pci.c</i></td></tr>
<tr><th id="28">28</th><td><i> * Copyright (c) 2010 Isaku Yamahata &lt;yamahata at valinux co jp&gt;</i></td></tr>
<tr><th id="29">29</th><td><i> *                    VA Linux Systems Japan K.K.</i></td></tr>
<tr><th id="30">30</th><td><i> */</i></td></tr>
<tr><th id="31">31</th><td></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../../include/qemu/osdep.h.html">"qemu/osdep.h"</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../include/hw/pci/pci_bridge.h.html">"hw/pci/pci_bridge.h"</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../../include/hw/pci/pci_bus.h.html">"hw/pci/pci_bus.h"</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="../../include/qemu/range.h.html">"qemu/range.h"</a></u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="../../include/qapi/error.h.html">"qapi/error.h"</a></u></td></tr>
<tr><th id="37">37</th><td></td></tr>
<tr><th id="38">38</th><td><i>/* PCI bridge subsystem vendor ID helper functions */</i></td></tr>
<tr><th id="39">39</th><td><u>#define <dfn class="macro" id="_M/PCI_SSVID_SIZEOF" data-ref="_M/PCI_SSVID_SIZEOF">PCI_SSVID_SIZEOF</dfn>        8</u></td></tr>
<tr><th id="40">40</th><td><u>#define <dfn class="macro" id="_M/PCI_SSVID_SVID" data-ref="_M/PCI_SSVID_SVID">PCI_SSVID_SVID</dfn>          4</u></td></tr>
<tr><th id="41">41</th><td><u>#define <dfn class="macro" id="_M/PCI_SSVID_SSID" data-ref="_M/PCI_SSVID_SSID">PCI_SSVID_SSID</dfn>          6</u></td></tr>
<tr><th id="42">42</th><td></td></tr>
<tr><th id="43">43</th><td><em>int</em> <dfn class="decl def" id="pci_bridge_ssvid_init" title='pci_bridge_ssvid_init' data-ref="pci_bridge_ssvid_init">pci_bridge_ssvid_init</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col1 decl" id="1dev" title='dev' data-type='PCIDevice *' data-ref="1dev">dev</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> <dfn class="local col2 decl" id="2offset" title='offset' data-type='uint8_t' data-ref="2offset">offset</dfn>,</td></tr>
<tr><th id="44">44</th><td>                          <a class="typedef" href="../../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col3 decl" id="3svid" title='svid' data-type='uint16_t' data-ref="3svid">svid</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col4 decl" id="4ssid" title='ssid' data-type='uint16_t' data-ref="4ssid">ssid</dfn>,</td></tr>
<tr><th id="45">45</th><td>                          <a class="typedef" href="../../include/qemu/typedefs.h.html#Error" title='Error' data-type='struct Error' data-ref="Error">Error</a> **<dfn class="local col5 decl" id="5errp" title='errp' data-type='Error **' data-ref="5errp">errp</dfn>)</td></tr>
<tr><th id="46">46</th><td>{</td></tr>
<tr><th id="47">47</th><td>    <em>int</em> <dfn class="local col6 decl" id="6pos" title='pos' data-type='int' data-ref="6pos">pos</dfn>;</td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td>    <a class="local col6 ref" href="#6pos" title='pos' data-ref="6pos">pos</a> = <a class="ref" href="../../include/hw/pci/pci.h.html#pci_add_capability" title='pci_add_capability' data-ref="pci_add_capability">pci_add_capability</a>(<a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#220" title="0x0D" data-ref="_M/PCI_CAP_ID_SSVID">PCI_CAP_ID_SSVID</a>, <a class="local col2 ref" href="#2offset" title='offset' data-ref="2offset">offset</a>,</td></tr>
<tr><th id="50">50</th><td>                             <a class="macro" href="#39" title="8" data-ref="_M/PCI_SSVID_SIZEOF">PCI_SSVID_SIZEOF</a>, <a class="local col5 ref" href="#5errp" title='errp' data-ref="5errp">errp</a>);</td></tr>
<tr><th id="51">51</th><td>    <b>if</b> (<a class="local col6 ref" href="#6pos" title='pos' data-ref="6pos">pos</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="52">52</th><td>        <b>return</b> <a class="local col6 ref" href="#6pos" title='pos' data-ref="6pos">pos</a>;</td></tr>
<tr><th id="53">53</th><td>    }</td></tr>
<tr><th id="54">54</th><td></td></tr>
<tr><th id="55">55</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_word" title='pci_set_word' data-ref="pci_set_word">pci_set_word</a>(<a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="local col6 ref" href="#6pos" title='pos' data-ref="6pos">pos</a> + <a class="macro" href="#40" title="4" data-ref="_M/PCI_SSVID_SVID">PCI_SSVID_SVID</a>, <a class="local col3 ref" href="#3svid" title='svid' data-ref="3svid">svid</a>);</td></tr>
<tr><th id="56">56</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_word" title='pci_set_word' data-ref="pci_set_word">pci_set_word</a>(<a class="local col1 ref" href="#1dev" title='dev' data-ref="1dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="local col6 ref" href="#6pos" title='pos' data-ref="6pos">pos</a> + <a class="macro" href="#41" title="6" data-ref="_M/PCI_SSVID_SSID">PCI_SSVID_SSID</a>, <a class="local col4 ref" href="#4ssid" title='ssid' data-ref="4ssid">ssid</a>);</td></tr>
<tr><th id="57">57</th><td>    <b>return</b> <a class="local col6 ref" href="#6pos" title='pos' data-ref="6pos">pos</a>;</td></tr>
<tr><th id="58">58</th><td>}</td></tr>
<tr><th id="59">59</th><td></td></tr>
<tr><th id="60">60</th><td><i>/* Accessor function to get parent bridge device from pci bus. */</i></td></tr>
<tr><th id="61">61</th><td><a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="decl def" id="pci_bridge_get_device" title='pci_bridge_get_device' data-ref="pci_bridge_get_device">pci_bridge_get_device</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="local col7 decl" id="7bus" title='bus' data-type='PCIBus *' data-ref="7bus">bus</dfn>)</td></tr>
<tr><th id="62">62</th><td>{</td></tr>
<tr><th id="63">63</th><td>    <b>return</b> <a class="local col7 ref" href="#7bus" title='bus' data-ref="7bus">bus</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::parent_dev" title='PCIBus::parent_dev' data-ref="PCIBus::parent_dev">parent_dev</a>;</td></tr>
<tr><th id="64">64</th><td>}</td></tr>
<tr><th id="65">65</th><td></td></tr>
<tr><th id="66">66</th><td><i>/* Accessor function to get secondary bus from pci-to-pci bridge device */</i></td></tr>
<tr><th id="67">67</th><td><a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="decl def" id="pci_bridge_get_sec_bus" title='pci_bridge_get_sec_bus' data-ref="pci_bridge_get_sec_bus">pci_bridge_get_sec_bus</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col8 decl" id="8br" title='br' data-type='PCIBridge *' data-ref="8br">br</dfn>)</td></tr>
<tr><th id="68">68</th><td>{</td></tr>
<tr><th id="69">69</th><td>    <b>return</b> &amp;<a class="local col8 ref" href="#8br" title='br' data-ref="8br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::sec_bus" title='PCIBridge::sec_bus' data-ref="PCIBridge::sec_bus">sec_bus</a>;</td></tr>
<tr><th id="70">70</th><td>}</td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td><em>static</em> <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="tu decl def" id="pci_config_get_io_base" title='pci_config_get_io_base' data-type='uint32_t pci_config_get_io_base(const PCIDevice * d, uint32_t base, uint32_t base_upper16)' data-ref="pci_config_get_io_base">pci_config_get_io_base</dfn>(<em>const</em> <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col9 decl" id="9d" title='d' data-type='const PCIDevice *' data-ref="9d">d</dfn>,</td></tr>
<tr><th id="73">73</th><td>                                       <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="10base" title='base' data-type='uint32_t' data-ref="10base">base</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="11base_upper16" title='base_upper16' data-type='uint32_t' data-ref="11base_upper16">base_upper16</dfn>)</td></tr>
<tr><th id="74">74</th><td>{</td></tr>
<tr><th id="75">75</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="12val" title='val' data-type='uint32_t' data-ref="12val">val</dfn>;</td></tr>
<tr><th id="76">76</th><td></td></tr>
<tr><th id="77">77</th><td>    <a class="local col2 ref" href="#12val" title='val' data-ref="12val">val</a> = ((<a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="local col9 ref" href="#9d" title='d' data-ref="9d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>[<a class="local col0 ref" href="#10base" title='base' data-ref="10base">base</a>] &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#137" title="(~0x0fUL)" data-ref="_M/PCI_IO_RANGE_MASK">PCI_IO_RANGE_MASK</a>) &lt;&lt; <var>8</var>;</td></tr>
<tr><th id="78">78</th><td>    <b>if</b> (<a class="local col9 ref" href="#9d" title='d' data-ref="9d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>[<a class="local col0 ref" href="#10base" title='base' data-ref="10base">base</a>] &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#136" title="0x01" data-ref="_M/PCI_IO_RANGE_TYPE_32">PCI_IO_RANGE_TYPE_32</a>) {</td></tr>
<tr><th id="79">79</th><td>        <a class="local col2 ref" href="#12val" title='val' data-ref="12val">val</a> |= (<a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a>)<a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col9 ref" href="#9d" title='d' data-ref="9d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="local col1 ref" href="#11base_upper16" title='base_upper16' data-ref="11base_upper16">base_upper16</a>) &lt;&lt; <var>16</var>;</td></tr>
<tr><th id="80">80</th><td>    }</td></tr>
<tr><th id="81">81</th><td>    <b>return</b> <a class="local col2 ref" href="#12val" title='val' data-ref="12val">val</a>;</td></tr>
<tr><th id="82">82</th><td>}</td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td><em>static</em> <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="tu decl def" id="pci_config_get_memory_base" title='pci_config_get_memory_base' data-type='pcibus_t pci_config_get_memory_base(const PCIDevice * d, uint32_t base)' data-ref="pci_config_get_memory_base">pci_config_get_memory_base</dfn>(<em>const</em> <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col3 decl" id="13d" title='d' data-type='const PCIDevice *' data-ref="13d">d</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col4 decl" id="14base" title='base' data-type='uint32_t' data-ref="14base">base</dfn>)</td></tr>
<tr><th id="85">85</th><td>{</td></tr>
<tr><th id="86">86</th><td>    <b>return</b> ((<a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a>)<a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col3 ref" href="#13d" title='d' data-ref="13d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="local col4 ref" href="#14base" title='base' data-ref="14base">base</a>) &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#143" title="(~0x0fUL)" data-ref="_M/PCI_MEMORY_RANGE_MASK">PCI_MEMORY_RANGE_MASK</a>)</td></tr>
<tr><th id="87">87</th><td>        &lt;&lt; <var>16</var>;</td></tr>
<tr><th id="88">88</th><td>}</td></tr>
<tr><th id="89">89</th><td></td></tr>
<tr><th id="90">90</th><td><em>static</em> <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="tu decl def" id="pci_config_get_pref_base" title='pci_config_get_pref_base' data-type='pcibus_t pci_config_get_pref_base(const PCIDevice * d, uint32_t base, uint32_t upper)' data-ref="pci_config_get_pref_base">pci_config_get_pref_base</dfn>(<em>const</em> <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col5 decl" id="15d" title='d' data-type='const PCIDevice *' data-ref="15d">d</dfn>,</td></tr>
<tr><th id="91">91</th><td>                                         <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="16base" title='base' data-type='uint32_t' data-ref="16base">base</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="17upper" title='upper' data-type='uint32_t' data-ref="17upper">upper</dfn>)</td></tr>
<tr><th id="92">92</th><td>{</td></tr>
<tr><th id="93">93</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col8 decl" id="18tmp" title='tmp' data-type='pcibus_t' data-ref="18tmp">tmp</dfn>;</td></tr>
<tr><th id="94">94</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col9 decl" id="19val" title='val' data-type='pcibus_t' data-ref="19val">val</dfn>;</td></tr>
<tr><th id="95">95</th><td></td></tr>
<tr><th id="96">96</th><td>    <a class="local col8 ref" href="#18tmp" title='tmp' data-ref="18tmp">tmp</a> = (<a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a>)<a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col5 ref" href="#15d" title='d' data-ref="15d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="local col6 ref" href="#16base" title='base' data-ref="16base">base</a>);</td></tr>
<tr><th id="97">97</th><td>    <a class="local col9 ref" href="#19val" title='val' data-ref="19val">val</a> = (<a class="local col8 ref" href="#18tmp" title='tmp' data-ref="18tmp">tmp</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#149" title="(~0x0fUL)" data-ref="_M/PCI_PREF_RANGE_MASK">PCI_PREF_RANGE_MASK</a>) &lt;&lt; <var>16</var>;</td></tr>
<tr><th id="98">98</th><td>    <b>if</b> (<a class="local col8 ref" href="#18tmp" title='tmp' data-ref="18tmp">tmp</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#148" title="0x01" data-ref="_M/PCI_PREF_RANGE_TYPE_64">PCI_PREF_RANGE_TYPE_64</a>) {</td></tr>
<tr><th id="99">99</th><td>        <a class="local col9 ref" href="#19val" title='val' data-ref="19val">val</a> |= (<a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a>)<a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_long" title='pci_get_long' data-ref="pci_get_long">pci_get_long</a>(<a class="local col5 ref" href="#15d" title='d' data-ref="15d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="local col7 ref" href="#17upper" title='upper' data-ref="17upper">upper</a>) &lt;&lt; <var>32</var>;</td></tr>
<tr><th id="100">100</th><td>    }</td></tr>
<tr><th id="101">101</th><td>    <b>return</b> <a class="local col9 ref" href="#19val" title='val' data-ref="19val">val</a>;</td></tr>
<tr><th id="102">102</th><td>}</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td><i>/* accessor function to get bridge filtering base address */</i></td></tr>
<tr><th id="105">105</th><td><a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="decl def" id="pci_bridge_get_base" title='pci_bridge_get_base' data-ref="pci_bridge_get_base">pci_bridge_get_base</dfn>(<em>const</em> <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col0 decl" id="20bridge" title='bridge' data-type='const PCIDevice *' data-ref="20bridge">bridge</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> <dfn class="local col1 decl" id="21type" title='type' data-type='uint8_t' data-ref="21type">type</dfn>)</td></tr>
<tr><th id="106">106</th><td>{</td></tr>
<tr><th id="107">107</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col2 decl" id="22base" title='base' data-type='pcibus_t' data-ref="22base">base</dfn>;</td></tr>
<tr><th id="108">108</th><td>    <b>if</b> (<a class="local col1 ref" href="#21type" title='type' data-ref="21type">type</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#100" title="0x01" data-ref="_M/PCI_BASE_ADDRESS_SPACE_IO">PCI_BASE_ADDRESS_SPACE_IO</a>) {</td></tr>
<tr><th id="109">109</th><td>        <a class="local col2 ref" href="#22base" title='base' data-ref="22base">base</a> = <a class="tu ref" href="#pci_config_get_io_base" title='pci_config_get_io_base' data-use='c' data-ref="pci_config_get_io_base">pci_config_get_io_base</a>(<a class="local col0 ref" href="#20bridge" title='bridge' data-ref="20bridge">bridge</a>,</td></tr>
<tr><th id="110">110</th><td>                                      <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#132" title="0x1c" data-ref="_M/PCI_IO_BASE">PCI_IO_BASE</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#152" title="0x30" data-ref="_M/PCI_IO_BASE_UPPER16">PCI_IO_BASE_UPPER16</a>);</td></tr>
<tr><th id="111">111</th><td>    } <b>else</b> {</td></tr>
<tr><th id="112">112</th><td>        <b>if</b> (<a class="local col1 ref" href="#21type" title='type' data-ref="21type">type</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#106" title="0x08" data-ref="_M/PCI_BASE_ADDRESS_MEM_PREFETCH">PCI_BASE_ADDRESS_MEM_PREFETCH</a>) {</td></tr>
<tr><th id="113">113</th><td>            <a class="local col2 ref" href="#22base" title='base' data-ref="22base">base</a> = <a class="tu ref" href="#pci_config_get_pref_base" title='pci_config_get_pref_base' data-use='c' data-ref="pci_config_get_pref_base">pci_config_get_pref_base</a>(</td></tr>
<tr><th id="114">114</th><td>                <a class="local col0 ref" href="#20bridge" title='bridge' data-ref="20bridge">bridge</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#144" title="0x24" data-ref="_M/PCI_PREF_MEMORY_BASE">PCI_PREF_MEMORY_BASE</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#150" title="0x28" data-ref="_M/PCI_PREF_BASE_UPPER32">PCI_PREF_BASE_UPPER32</a>);</td></tr>
<tr><th id="115">115</th><td>        } <b>else</b> {</td></tr>
<tr><th id="116">116</th><td>            <a class="local col2 ref" href="#22base" title='base' data-ref="22base">base</a> = <a class="tu ref" href="#pci_config_get_memory_base" title='pci_config_get_memory_base' data-use='c' data-ref="pci_config_get_memory_base">pci_config_get_memory_base</a>(<a class="local col0 ref" href="#20bridge" title='bridge' data-ref="20bridge">bridge</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#140" title="0x20" data-ref="_M/PCI_MEMORY_BASE">PCI_MEMORY_BASE</a>);</td></tr>
<tr><th id="117">117</th><td>        }</td></tr>
<tr><th id="118">118</th><td>    }</td></tr>
<tr><th id="119">119</th><td></td></tr>
<tr><th id="120">120</th><td>    <b>return</b> <a class="local col2 ref" href="#22base" title='base' data-ref="22base">base</a>;</td></tr>
<tr><th id="121">121</th><td>}</td></tr>
<tr><th id="122">122</th><td></td></tr>
<tr><th id="123">123</th><td><i>/* accessor function to get bridge filtering limit */</i></td></tr>
<tr><th id="124">124</th><td><a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="decl def" id="pci_bridge_get_limit" title='pci_bridge_get_limit' data-ref="pci_bridge_get_limit">pci_bridge_get_limit</dfn>(<em>const</em> <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col3 decl" id="23bridge" title='bridge' data-type='const PCIDevice *' data-ref="23bridge">bridge</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> <dfn class="local col4 decl" id="24type" title='type' data-type='uint8_t' data-ref="24type">type</dfn>)</td></tr>
<tr><th id="125">125</th><td>{</td></tr>
<tr><th id="126">126</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col5 decl" id="25limit" title='limit' data-type='pcibus_t' data-ref="25limit">limit</dfn>;</td></tr>
<tr><th id="127">127</th><td>    <b>if</b> (<a class="local col4 ref" href="#24type" title='type' data-ref="24type">type</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#100" title="0x01" data-ref="_M/PCI_BASE_ADDRESS_SPACE_IO">PCI_BASE_ADDRESS_SPACE_IO</a>) {</td></tr>
<tr><th id="128">128</th><td>        <a class="local col5 ref" href="#25limit" title='limit' data-ref="25limit">limit</a> = <a class="tu ref" href="#pci_config_get_io_base" title='pci_config_get_io_base' data-use='c' data-ref="pci_config_get_io_base">pci_config_get_io_base</a>(<a class="local col3 ref" href="#23bridge" title='bridge' data-ref="23bridge">bridge</a>,</td></tr>
<tr><th id="129">129</th><td>                                      <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#133" title="0x1d" data-ref="_M/PCI_IO_LIMIT">PCI_IO_LIMIT</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#153" title="0x32" data-ref="_M/PCI_IO_LIMIT_UPPER16">PCI_IO_LIMIT_UPPER16</a>);</td></tr>
<tr><th id="130">130</th><td>        <a class="local col5 ref" href="#25limit" title='limit' data-ref="25limit">limit</a> |= <var>0xfff</var>;         <i>/* PCI bridge spec 3.2.5.6. */</i></td></tr>
<tr><th id="131">131</th><td>    } <b>else</b> {</td></tr>
<tr><th id="132">132</th><td>        <b>if</b> (<a class="local col4 ref" href="#24type" title='type' data-ref="24type">type</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#106" title="0x08" data-ref="_M/PCI_BASE_ADDRESS_MEM_PREFETCH">PCI_BASE_ADDRESS_MEM_PREFETCH</a>) {</td></tr>
<tr><th id="133">133</th><td>            <a class="local col5 ref" href="#25limit" title='limit' data-ref="25limit">limit</a> = <a class="tu ref" href="#pci_config_get_pref_base" title='pci_config_get_pref_base' data-use='c' data-ref="pci_config_get_pref_base">pci_config_get_pref_base</a>(</td></tr>
<tr><th id="134">134</th><td>                <a class="local col3 ref" href="#23bridge" title='bridge' data-ref="23bridge">bridge</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#145" title="0x26" data-ref="_M/PCI_PREF_MEMORY_LIMIT">PCI_PREF_MEMORY_LIMIT</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#151" title="0x2c" data-ref="_M/PCI_PREF_LIMIT_UPPER32">PCI_PREF_LIMIT_UPPER32</a>);</td></tr>
<tr><th id="135">135</th><td>        } <b>else</b> {</td></tr>
<tr><th id="136">136</th><td>            <a class="local col5 ref" href="#25limit" title='limit' data-ref="25limit">limit</a> = <a class="tu ref" href="#pci_config_get_memory_base" title='pci_config_get_memory_base' data-use='c' data-ref="pci_config_get_memory_base">pci_config_get_memory_base</a>(<a class="local col3 ref" href="#23bridge" title='bridge' data-ref="23bridge">bridge</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#141" title="0x22" data-ref="_M/PCI_MEMORY_LIMIT">PCI_MEMORY_LIMIT</a>);</td></tr>
<tr><th id="137">137</th><td>        }</td></tr>
<tr><th id="138">138</th><td>        <a class="local col5 ref" href="#25limit" title='limit' data-ref="25limit">limit</a> |= <var>0xfffff</var>;       <i>/* PCI bridge spec 3.2.5.{1, 8}. */</i></td></tr>
<tr><th id="139">139</th><td>    }</td></tr>
<tr><th id="140">140</th><td>    <b>return</b> <a class="local col5 ref" href="#25limit" title='limit' data-ref="25limit">limit</a>;</td></tr>
<tr><th id="141">141</th><td>}</td></tr>
<tr><th id="142">142</th><td></td></tr>
<tr><th id="143">143</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="pci_bridge_init_alias" title='pci_bridge_init_alias' data-type='void pci_bridge_init_alias(PCIBridge * bridge, MemoryRegion * alias, uint8_t type, const char * name, MemoryRegion * space, MemoryRegion * parent_space, _Bool enabled)' data-ref="pci_bridge_init_alias">pci_bridge_init_alias</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col6 decl" id="26bridge" title='bridge' data-type='PCIBridge *' data-ref="26bridge">bridge</dfn>, <a class="typedef" href="../../include/qemu/typedefs.h.html#MemoryRegion" title='MemoryRegion' data-type='struct MemoryRegion' data-ref="MemoryRegion">MemoryRegion</a> *<dfn class="local col7 decl" id="27alias" title='alias' data-type='MemoryRegion *' data-ref="27alias">alias</dfn>,</td></tr>
<tr><th id="144">144</th><td>                                  <a class="typedef" href="../../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> <dfn class="local col8 decl" id="28type" title='type' data-type='uint8_t' data-ref="28type">type</dfn>, <em>const</em> <em>char</em> *<dfn class="local col9 decl" id="29name" title='name' data-type='const char *' data-ref="29name">name</dfn>,</td></tr>
<tr><th id="145">145</th><td>                                  <a class="typedef" href="../../include/qemu/typedefs.h.html#MemoryRegion" title='MemoryRegion' data-type='struct MemoryRegion' data-ref="MemoryRegion">MemoryRegion</a> *<dfn class="local col0 decl" id="30space" title='space' data-type='MemoryRegion *' data-ref="30space">space</dfn>,</td></tr>
<tr><th id="146">146</th><td>                                  <a class="typedef" href="../../include/qemu/typedefs.h.html#MemoryRegion" title='MemoryRegion' data-type='struct MemoryRegion' data-ref="MemoryRegion">MemoryRegion</a> *<dfn class="local col1 decl" id="31parent_space" title='parent_space' data-type='MemoryRegion *' data-ref="31parent_space">parent_space</dfn>,</td></tr>
<tr><th id="147">147</th><td>                                  <span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="local col2 decl" id="32enabled" title='enabled' data-type='_Bool' data-ref="32enabled">enabled</dfn>)</td></tr>
<tr><th id="148">148</th><td>{</td></tr>
<tr><th id="149">149</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col3 decl" id="33bridge_dev" title='bridge_dev' data-type='PCIDevice *' data-ref="33bridge_dev">bridge_dev</dfn> = <a class="macro" href="../../include/hw/pci/pci.h.html#191" title="((PCIDevice *)object_dynamic_cast_assert(((Object *)((bridge))), (&quot;pci-device&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 149, __func__))" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="local col6 ref" href="#26bridge" title='bridge' data-ref="26bridge">bridge</a>);</td></tr>
<tr><th id="150">150</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col4 decl" id="34base" title='base' data-type='pcibus_t' data-ref="34base">base</dfn> = <a class="ref" href="#pci_bridge_get_base" title='pci_bridge_get_base' data-ref="pci_bridge_get_base">pci_bridge_get_base</a>(<a class="local col3 ref" href="#33bridge_dev" title='bridge_dev' data-ref="33bridge_dev">bridge_dev</a>, <a class="local col8 ref" href="#28type" title='type' data-ref="28type">type</a>);</td></tr>
<tr><th id="151">151</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col5 decl" id="35limit" title='limit' data-type='pcibus_t' data-ref="35limit">limit</dfn> = <a class="ref" href="#pci_bridge_get_limit" title='pci_bridge_get_limit' data-ref="pci_bridge_get_limit">pci_bridge_get_limit</a>(<a class="local col3 ref" href="#33bridge_dev" title='bridge_dev' data-ref="33bridge_dev">bridge_dev</a>, <a class="local col8 ref" href="#28type" title='type' data-ref="28type">type</a>);</td></tr>
<tr><th id="152">152</th><td>    <i>/* TODO: this doesn't handle base = 0 limit = 2^64 - 1 correctly.</i></td></tr>
<tr><th id="153">153</th><td><i>     * Apparently no way to do this with existing memory APIs. */</i></td></tr>
<tr><th id="154">154</th><td>    <a class="typedef" href="../../include/hw/pci/pci.h.html#pcibus_t" title='pcibus_t' data-type='uint64_t' data-ref="pcibus_t">pcibus_t</a> <dfn class="local col6 decl" id="36size" title='size' data-type='pcibus_t' data-ref="36size">size</dfn> = <a class="local col2 ref" href="#32enabled" title='enabled' data-ref="32enabled">enabled</a> &amp;&amp; <a class="local col5 ref" href="#35limit" title='limit' data-ref="35limit">limit</a> &gt;= <a class="local col4 ref" href="#34base" title='base' data-ref="34base">base</a> ? <a class="local col5 ref" href="#35limit" title='limit' data-ref="35limit">limit</a> + <var>1</var> - <a class="local col4 ref" href="#34base" title='base' data-ref="34base">base</a> : <var>0</var>;</td></tr>
<tr><th id="155">155</th><td></td></tr>
<tr><th id="156">156</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_init_alias" title='memory_region_init_alias' data-ref="memory_region_init_alias">memory_region_init_alias</a>(<a class="local col7 ref" href="#27alias" title='alias' data-ref="27alias">alias</a>, <a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(bridge))" data-ref="_M/OBJECT">OBJECT</a>(<a class="local col6 ref" href="#26bridge" title='bridge' data-ref="26bridge">bridge</a>), <a class="local col9 ref" href="#29name" title='name' data-ref="29name">name</a>, <a class="local col0 ref" href="#30space" title='space' data-ref="30space">space</a>, <a class="local col4 ref" href="#34base" title='base' data-ref="34base">base</a>, <a class="local col6 ref" href="#36size" title='size' data-ref="36size">size</a>);</td></tr>
<tr><th id="157">157</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_add_subregion_overlap" title='memory_region_add_subregion_overlap' data-ref="memory_region_add_subregion_overlap">memory_region_add_subregion_overlap</a>(<a class="local col1 ref" href="#31parent_space" title='parent_space' data-ref="31parent_space">parent_space</a>, <a class="local col4 ref" href="#34base" title='base' data-ref="34base">base</a>, <a class="local col7 ref" href="#27alias" title='alias' data-ref="27alias">alias</a>, <var>1</var>);</td></tr>
<tr><th id="158">158</th><td>}</td></tr>
<tr><th id="159">159</th><td></td></tr>
<tr><th id="160">160</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="pci_bridge_init_vga_aliases" title='pci_bridge_init_vga_aliases' data-type='void pci_bridge_init_vga_aliases(PCIBridge * br, PCIBus * parent, MemoryRegion * alias_vga)' data-ref="pci_bridge_init_vga_aliases">pci_bridge_init_vga_aliases</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col7 decl" id="37br" title='br' data-type='PCIBridge *' data-ref="37br">br</dfn>, <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="local col8 decl" id="38parent" title='parent' data-type='PCIBus *' data-ref="38parent">parent</dfn>,</td></tr>
<tr><th id="161">161</th><td>                                        <a class="typedef" href="../../include/qemu/typedefs.h.html#MemoryRegion" title='MemoryRegion' data-type='struct MemoryRegion' data-ref="MemoryRegion">MemoryRegion</a> *<dfn class="local col9 decl" id="39alias_vga" title='alias_vga' data-type='MemoryRegion *' data-ref="39alias_vga">alias_vga</dfn>)</td></tr>
<tr><th id="162">162</th><td>{</td></tr>
<tr><th id="163">163</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col0 decl" id="40pd" title='pd' data-type='PCIDevice *' data-ref="40pd">pd</dfn> = <a class="macro" href="../../include/hw/pci/pci.h.html#191" title="((PCIDevice *)object_dynamic_cast_assert(((Object *)((br))), (&quot;pci-device&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 163, __func__))" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>);</td></tr>
<tr><th id="164">164</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col1 decl" id="41brctl" title='brctl' data-type='uint16_t' data-ref="41brctl">brctl</dfn> = <a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col0 ref" href="#40pd" title='pd' data-ref="40pd">pd</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#158" title="0x3e" data-ref="_M/PCI_BRIDGE_CONTROL">PCI_BRIDGE_CONTROL</a>);</td></tr>
<tr><th id="165">165</th><td></td></tr>
<tr><th id="166">166</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_init_alias" title='memory_region_init_alias' data-ref="memory_region_init_alias">memory_region_init_alias</a>(&amp;<a class="local col9 ref" href="#39alias_vga" title='alias_vga' data-ref="39alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_IO_LO" title='QEMU_PCI_VGA_IO_LO' data-ref="QEMU_PCI_VGA_IO_LO">QEMU_PCI_VGA_IO_LO</a>], <a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(br))" data-ref="_M/OBJECT">OBJECT</a>(<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>),</td></tr>
<tr><th id="167">167</th><td>                             <q>"pci_bridge_vga_io_lo"</q>, &amp;<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_io" title='PCIBridge::address_space_io' data-ref="PCIBridge::address_space_io">address_space_io</a>,</td></tr>
<tr><th id="168">168</th><td>                             <a class="macro" href="../../include/hw/pci/pci.h.html#143" title="0x3b0" data-ref="_M/QEMU_PCI_VGA_IO_LO_BASE">QEMU_PCI_VGA_IO_LO_BASE</a>, <a class="macro" href="../../include/hw/pci/pci.h.html#144" title="0xc" data-ref="_M/QEMU_PCI_VGA_IO_LO_SIZE">QEMU_PCI_VGA_IO_LO_SIZE</a>);</td></tr>
<tr><th id="169">169</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_init_alias" title='memory_region_init_alias' data-ref="memory_region_init_alias">memory_region_init_alias</a>(&amp;<a class="local col9 ref" href="#39alias_vga" title='alias_vga' data-ref="39alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_IO_HI" title='QEMU_PCI_VGA_IO_HI' data-ref="QEMU_PCI_VGA_IO_HI">QEMU_PCI_VGA_IO_HI</a>], <a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(br))" data-ref="_M/OBJECT">OBJECT</a>(<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>),</td></tr>
<tr><th id="170">170</th><td>                             <q>"pci_bridge_vga_io_hi"</q>, &amp;<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_io" title='PCIBridge::address_space_io' data-ref="PCIBridge::address_space_io">address_space_io</a>,</td></tr>
<tr><th id="171">171</th><td>                             <a class="macro" href="../../include/hw/pci/pci.h.html#145" title="0x3c0" data-ref="_M/QEMU_PCI_VGA_IO_HI_BASE">QEMU_PCI_VGA_IO_HI_BASE</a>, <a class="macro" href="../../include/hw/pci/pci.h.html#146" title="0x20" data-ref="_M/QEMU_PCI_VGA_IO_HI_SIZE">QEMU_PCI_VGA_IO_HI_SIZE</a>);</td></tr>
<tr><th id="172">172</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_init_alias" title='memory_region_init_alias' data-ref="memory_region_init_alias">memory_region_init_alias</a>(&amp;<a class="local col9 ref" href="#39alias_vga" title='alias_vga' data-ref="39alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_MEM" title='QEMU_PCI_VGA_MEM' data-ref="QEMU_PCI_VGA_MEM">QEMU_PCI_VGA_MEM</a>], <a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(br))" data-ref="_M/OBJECT">OBJECT</a>(<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>),</td></tr>
<tr><th id="173">173</th><td>                             <q>"pci_bridge_vga_mem"</q>, &amp;<a class="local col7 ref" href="#37br" title='br' data-ref="37br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_mem" title='PCIBridge::address_space_mem' data-ref="PCIBridge::address_space_mem">address_space_mem</a>,</td></tr>
<tr><th id="174">174</th><td>                             <a class="macro" href="../../include/hw/pci/pci.h.html#141" title="0xa0000" data-ref="_M/QEMU_PCI_VGA_MEM_BASE">QEMU_PCI_VGA_MEM_BASE</a>, <a class="macro" href="../../include/hw/pci/pci.h.html#142" title="0x20000" data-ref="_M/QEMU_PCI_VGA_MEM_SIZE">QEMU_PCI_VGA_MEM_SIZE</a>);</td></tr>
<tr><th id="175">175</th><td></td></tr>
<tr><th id="176">176</th><td>    <b>if</b> (<a class="local col1 ref" href="#41brctl" title='brctl' data-ref="41brctl">brctl</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#162" title="0x08" data-ref="_M/PCI_BRIDGE_CTL_VGA">PCI_BRIDGE_CTL_VGA</a>) {</td></tr>
<tr><th id="177">177</th><td>        <a class="ref" href="../../include/hw/pci/pci.h.html#pci_register_vga" title='pci_register_vga' data-ref="pci_register_vga">pci_register_vga</a>(<a class="local col0 ref" href="#40pd" title='pd' data-ref="40pd">pd</a>, &amp;<a class="local col9 ref" href="#39alias_vga" title='alias_vga' data-ref="39alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_MEM" title='QEMU_PCI_VGA_MEM' data-ref="QEMU_PCI_VGA_MEM">QEMU_PCI_VGA_MEM</a>],</td></tr>
<tr><th id="178">178</th><td>                         &amp;<a class="local col9 ref" href="#39alias_vga" title='alias_vga' data-ref="39alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_IO_LO" title='QEMU_PCI_VGA_IO_LO' data-ref="QEMU_PCI_VGA_IO_LO">QEMU_PCI_VGA_IO_LO</a>],</td></tr>
<tr><th id="179">179</th><td>                         &amp;<a class="local col9 ref" href="#39alias_vga" title='alias_vga' data-ref="39alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_IO_HI" title='QEMU_PCI_VGA_IO_HI' data-ref="QEMU_PCI_VGA_IO_HI">QEMU_PCI_VGA_IO_HI</a>]);</td></tr>
<tr><th id="180">180</th><td>    }</td></tr>
<tr><th id="181">181</th><td>}</td></tr>
<tr><th id="182">182</th><td></td></tr>
<tr><th id="183">183</th><td><em>static</em> <a class="typedef" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows" title='PCIBridgeWindows' data-type='struct PCIBridgeWindows' data-ref="PCIBridgeWindows">PCIBridgeWindows</a> *<dfn class="tu decl def" id="pci_bridge_region_init" title='pci_bridge_region_init' data-type='PCIBridgeWindows * pci_bridge_region_init(PCIBridge * br)' data-ref="pci_bridge_region_init">pci_bridge_region_init</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col2 decl" id="42br" title='br' data-type='PCIBridge *' data-ref="42br">br</dfn>)</td></tr>
<tr><th id="184">184</th><td>{</td></tr>
<tr><th id="185">185</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col3 decl" id="43pd" title='pd' data-type='PCIDevice *' data-ref="43pd">pd</dfn> = <a class="macro" href="../../include/hw/pci/pci.h.html#191" title="((PCIDevice *)object_dynamic_cast_assert(((Object *)((br))), (&quot;pci-device&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 185, __func__))" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>);</td></tr>
<tr><th id="186">186</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="local col4 decl" id="44parent" title='parent' data-type='PCIBus *' data-ref="44parent">parent</dfn> = <a class="local col3 ref" href="#43pd" title='pd' data-ref="43pd">pd</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::bus" title='PCIDevice::bus' data-ref="PCIDevice::bus">bus</a>;</td></tr>
<tr><th id="187">187</th><td>    <a class="typedef" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows" title='PCIBridgeWindows' data-type='struct PCIBridgeWindows' data-ref="PCIBridgeWindows">PCIBridgeWindows</a> *<dfn class="local col5 decl" id="45w" title='w' data-type='PCIBridgeWindows *' data-ref="45w">w</dfn> = <a class="macro" href="../../../include/glib-2.0/glib/gmem.h.html#261" title="((PCIBridgeWindows *) g_malloc_n ((1), sizeof (PCIBridgeWindows)))" data-ref="_M/g_new">g_new</a>(<a class="typedef" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows" title='PCIBridgeWindows' data-type='struct PCIBridgeWindows' data-ref="PCIBridgeWindows">PCIBridgeWindows</a>, <var>1</var>);</td></tr>
<tr><th id="188">188</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col6 decl" id="46cmd" title='cmd' data-type='uint16_t' data-ref="46cmd">cmd</dfn> = <a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col3 ref" href="#43pd" title='pd' data-ref="43pd">pd</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#40" title="0x04" data-ref="_M/PCI_COMMAND">PCI_COMMAND</a>);</td></tr>
<tr><th id="189">189</th><td></td></tr>
<tr><th id="190">190</th><td>    <a class="tu ref" href="#pci_bridge_init_alias" title='pci_bridge_init_alias' data-use='c' data-ref="pci_bridge_init_alias">pci_bridge_init_alias</a>(<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>, &amp;<a class="local col5 ref" href="#45w" title='w' data-ref="45w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_pref_mem" title='PCIBridgeWindows::alias_pref_mem' data-ref="PCIBridgeWindows::alias_pref_mem">alias_pref_mem</a>,</td></tr>
<tr><th id="191">191</th><td>                          <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#106" title="0x08" data-ref="_M/PCI_BASE_ADDRESS_MEM_PREFETCH">PCI_BASE_ADDRESS_MEM_PREFETCH</a>,</td></tr>
<tr><th id="192">192</th><td>                          <q>"pci_bridge_pref_mem"</q>,</td></tr>
<tr><th id="193">193</th><td>                          &amp;<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_mem" title='PCIBridge::address_space_mem' data-ref="PCIBridge::address_space_mem">address_space_mem</a>,</td></tr>
<tr><th id="194">194</th><td>                          <a class="local col4 ref" href="#44parent" title='parent' data-ref="44parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_mem" title='PCIBus::address_space_mem' data-ref="PCIBus::address_space_mem">address_space_mem</a>,</td></tr>
<tr><th id="195">195</th><td>                          <a class="local col6 ref" href="#46cmd" title='cmd' data-ref="46cmd">cmd</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#42" title="0x2" data-ref="_M/PCI_COMMAND_MEMORY">PCI_COMMAND_MEMORY</a>);</td></tr>
<tr><th id="196">196</th><td>    <a class="tu ref" href="#pci_bridge_init_alias" title='pci_bridge_init_alias' data-use='c' data-ref="pci_bridge_init_alias">pci_bridge_init_alias</a>(<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>, &amp;<a class="local col5 ref" href="#45w" title='w' data-ref="45w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_mem" title='PCIBridgeWindows::alias_mem' data-ref="PCIBridgeWindows::alias_mem">alias_mem</a>,</td></tr>
<tr><th id="197">197</th><td>                          <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#101" title="0x00" data-ref="_M/PCI_BASE_ADDRESS_SPACE_MEMORY">PCI_BASE_ADDRESS_SPACE_MEMORY</a>,</td></tr>
<tr><th id="198">198</th><td>                          <q>"pci_bridge_mem"</q>,</td></tr>
<tr><th id="199">199</th><td>                          &amp;<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_mem" title='PCIBridge::address_space_mem' data-ref="PCIBridge::address_space_mem">address_space_mem</a>,</td></tr>
<tr><th id="200">200</th><td>                          <a class="local col4 ref" href="#44parent" title='parent' data-ref="44parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_mem" title='PCIBus::address_space_mem' data-ref="PCIBus::address_space_mem">address_space_mem</a>,</td></tr>
<tr><th id="201">201</th><td>                          <a class="local col6 ref" href="#46cmd" title='cmd' data-ref="46cmd">cmd</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#42" title="0x2" data-ref="_M/PCI_COMMAND_MEMORY">PCI_COMMAND_MEMORY</a>);</td></tr>
<tr><th id="202">202</th><td>    <a class="tu ref" href="#pci_bridge_init_alias" title='pci_bridge_init_alias' data-use='c' data-ref="pci_bridge_init_alias">pci_bridge_init_alias</a>(<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>, &amp;<a class="local col5 ref" href="#45w" title='w' data-ref="45w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_io" title='PCIBridgeWindows::alias_io' data-ref="PCIBridgeWindows::alias_io">alias_io</a>,</td></tr>
<tr><th id="203">203</th><td>                          <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#100" title="0x01" data-ref="_M/PCI_BASE_ADDRESS_SPACE_IO">PCI_BASE_ADDRESS_SPACE_IO</a>,</td></tr>
<tr><th id="204">204</th><td>                          <q>"pci_bridge_io"</q>,</td></tr>
<tr><th id="205">205</th><td>                          &amp;<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_io" title='PCIBridge::address_space_io' data-ref="PCIBridge::address_space_io">address_space_io</a>,</td></tr>
<tr><th id="206">206</th><td>                          <a class="local col4 ref" href="#44parent" title='parent' data-ref="44parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_io" title='PCIBus::address_space_io' data-ref="PCIBus::address_space_io">address_space_io</a>,</td></tr>
<tr><th id="207">207</th><td>                          <a class="local col6 ref" href="#46cmd" title='cmd' data-ref="46cmd">cmd</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#41" title="0x1" data-ref="_M/PCI_COMMAND_IO">PCI_COMMAND_IO</a>);</td></tr>
<tr><th id="208">208</th><td></td></tr>
<tr><th id="209">209</th><td>    <a class="tu ref" href="#pci_bridge_init_vga_aliases" title='pci_bridge_init_vga_aliases' data-use='c' data-ref="pci_bridge_init_vga_aliases">pci_bridge_init_vga_aliases</a>(<a class="local col2 ref" href="#42br" title='br' data-ref="42br">br</a>, <a class="local col4 ref" href="#44parent" title='parent' data-ref="44parent">parent</a>, <a class="local col5 ref" href="#45w" title='w' data-ref="45w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_vga" title='PCIBridgeWindows::alias_vga' data-ref="PCIBridgeWindows::alias_vga">alias_vga</a>);</td></tr>
<tr><th id="210">210</th><td></td></tr>
<tr><th id="211">211</th><td>    <b>return</b> <a class="local col5 ref" href="#45w" title='w' data-ref="45w">w</a>;</td></tr>
<tr><th id="212">212</th><td>}</td></tr>
<tr><th id="213">213</th><td></td></tr>
<tr><th id="214">214</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="pci_bridge_region_del" title='pci_bridge_region_del' data-type='void pci_bridge_region_del(PCIBridge * br, PCIBridgeWindows * w)' data-ref="pci_bridge_region_del">pci_bridge_region_del</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col7 decl" id="47br" title='br' data-type='PCIBridge *' data-ref="47br">br</dfn>, <a class="typedef" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows" title='PCIBridgeWindows' data-type='struct PCIBridgeWindows' data-ref="PCIBridgeWindows">PCIBridgeWindows</a> *<dfn class="local col8 decl" id="48w" title='w' data-type='PCIBridgeWindows *' data-ref="48w">w</dfn>)</td></tr>
<tr><th id="215">215</th><td>{</td></tr>
<tr><th id="216">216</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col9 decl" id="49pd" title='pd' data-type='PCIDevice *' data-ref="49pd">pd</dfn> = <a class="macro" href="../../include/hw/pci/pci.h.html#191" title="((PCIDevice *)object_dynamic_cast_assert(((Object *)((br))), (&quot;pci-device&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 216, __func__))" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="local col7 ref" href="#47br" title='br' data-ref="47br">br</a>);</td></tr>
<tr><th id="217">217</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="local col0 decl" id="50parent" title='parent' data-type='PCIBus *' data-ref="50parent">parent</dfn> = <a class="local col9 ref" href="#49pd" title='pd' data-ref="49pd">pd</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::bus" title='PCIDevice::bus' data-ref="PCIDevice::bus">bus</a>;</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_del_subregion" title='memory_region_del_subregion' data-ref="memory_region_del_subregion">memory_region_del_subregion</a>(<a class="local col0 ref" href="#50parent" title='parent' data-ref="50parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_io" title='PCIBus::address_space_io' data-ref="PCIBus::address_space_io">address_space_io</a>, &amp;<a class="local col8 ref" href="#48w" title='w' data-ref="48w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_io" title='PCIBridgeWindows::alias_io' data-ref="PCIBridgeWindows::alias_io">alias_io</a>);</td></tr>
<tr><th id="220">220</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_del_subregion" title='memory_region_del_subregion' data-ref="memory_region_del_subregion">memory_region_del_subregion</a>(<a class="local col0 ref" href="#50parent" title='parent' data-ref="50parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_mem" title='PCIBus::address_space_mem' data-ref="PCIBus::address_space_mem">address_space_mem</a>, &amp;<a class="local col8 ref" href="#48w" title='w' data-ref="48w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_mem" title='PCIBridgeWindows::alias_mem' data-ref="PCIBridgeWindows::alias_mem">alias_mem</a>);</td></tr>
<tr><th id="221">221</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_del_subregion" title='memory_region_del_subregion' data-ref="memory_region_del_subregion">memory_region_del_subregion</a>(<a class="local col0 ref" href="#50parent" title='parent' data-ref="50parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_mem" title='PCIBus::address_space_mem' data-ref="PCIBus::address_space_mem">address_space_mem</a>, &amp;<a class="local col8 ref" href="#48w" title='w' data-ref="48w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_pref_mem" title='PCIBridgeWindows::alias_pref_mem' data-ref="PCIBridgeWindows::alias_pref_mem">alias_pref_mem</a>);</td></tr>
<tr><th id="222">222</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_unregister_vga" title='pci_unregister_vga' data-ref="pci_unregister_vga">pci_unregister_vga</a>(<a class="local col9 ref" href="#49pd" title='pd' data-ref="49pd">pd</a>);</td></tr>
<tr><th id="223">223</th><td>}</td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="pci_bridge_region_cleanup" title='pci_bridge_region_cleanup' data-type='void pci_bridge_region_cleanup(PCIBridge * br, PCIBridgeWindows * w)' data-ref="pci_bridge_region_cleanup">pci_bridge_region_cleanup</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col1 decl" id="51br" title='br' data-type='PCIBridge *' data-ref="51br">br</dfn>, <a class="typedef" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows" title='PCIBridgeWindows' data-type='struct PCIBridgeWindows' data-ref="PCIBridgeWindows">PCIBridgeWindows</a> *<dfn class="local col2 decl" id="52w" title='w' data-type='PCIBridgeWindows *' data-ref="52w">w</dfn>)</td></tr>
<tr><th id="226">226</th><td>{</td></tr>
<tr><th id="227">227</th><td>    <a class="ref" href="../../include/qom/object.h.html#object_unparent" title='object_unparent' data-ref="object_unparent">object_unparent</a>(<a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(&amp;w-&gt;alias_io))" data-ref="_M/OBJECT">OBJECT</a>(&amp;<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_io" title='PCIBridgeWindows::alias_io' data-ref="PCIBridgeWindows::alias_io">alias_io</a>));</td></tr>
<tr><th id="228">228</th><td>    <a class="ref" href="../../include/qom/object.h.html#object_unparent" title='object_unparent' data-ref="object_unparent">object_unparent</a>(<a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(&amp;w-&gt;alias_mem))" data-ref="_M/OBJECT">OBJECT</a>(&amp;<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_mem" title='PCIBridgeWindows::alias_mem' data-ref="PCIBridgeWindows::alias_mem">alias_mem</a>));</td></tr>
<tr><th id="229">229</th><td>    <a class="ref" href="../../include/qom/object.h.html#object_unparent" title='object_unparent' data-ref="object_unparent">object_unparent</a>(<a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(&amp;w-&gt;alias_pref_mem))" data-ref="_M/OBJECT">OBJECT</a>(&amp;<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_pref_mem" title='PCIBridgeWindows::alias_pref_mem' data-ref="PCIBridgeWindows::alias_pref_mem">alias_pref_mem</a>));</td></tr>
<tr><th id="230">230</th><td>    <a class="ref" href="../../include/qom/object.h.html#object_unparent" title='object_unparent' data-ref="object_unparent">object_unparent</a>(<a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(&amp;w-&gt;alias_vga[QEMU_PCI_VGA_IO_LO]))" data-ref="_M/OBJECT">OBJECT</a>(&amp;<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_vga" title='PCIBridgeWindows::alias_vga' data-ref="PCIBridgeWindows::alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_IO_LO" title='QEMU_PCI_VGA_IO_LO' data-ref="QEMU_PCI_VGA_IO_LO">QEMU_PCI_VGA_IO_LO</a>]));</td></tr>
<tr><th id="231">231</th><td>    <a class="ref" href="../../include/qom/object.h.html#object_unparent" title='object_unparent' data-ref="object_unparent">object_unparent</a>(<a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(&amp;w-&gt;alias_vga[QEMU_PCI_VGA_IO_HI]))" data-ref="_M/OBJECT">OBJECT</a>(&amp;<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_vga" title='PCIBridgeWindows::alias_vga' data-ref="PCIBridgeWindows::alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_IO_HI" title='QEMU_PCI_VGA_IO_HI' data-ref="QEMU_PCI_VGA_IO_HI">QEMU_PCI_VGA_IO_HI</a>]));</td></tr>
<tr><th id="232">232</th><td>    <a class="ref" href="../../include/qom/object.h.html#object_unparent" title='object_unparent' data-ref="object_unparent">object_unparent</a>(<a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(&amp;w-&gt;alias_vga[QEMU_PCI_VGA_MEM]))" data-ref="_M/OBJECT">OBJECT</a>(&amp;<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows::alias_vga" title='PCIBridgeWindows::alias_vga' data-ref="PCIBridgeWindows::alias_vga">alias_vga</a>[<a class="enum" href="../../include/hw/pci/pci.h.html#QEMU_PCI_VGA_MEM" title='QEMU_PCI_VGA_MEM' data-ref="QEMU_PCI_VGA_MEM">QEMU_PCI_VGA_MEM</a>]));</td></tr>
<tr><th id="233">233</th><td>    <a class="ref" href="../../../include/glib-2.0/glib/gmem.h.html#g_free" title='g_free' data-ref="g_free">g_free</a>(<a class="local col2 ref" href="#52w" title='w' data-ref="52w">w</a>);</td></tr>
<tr><th id="234">234</th><td>}</td></tr>
<tr><th id="235">235</th><td></td></tr>
<tr><th id="236">236</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_update_mappings" title='pci_bridge_update_mappings' data-ref="pci_bridge_update_mappings">pci_bridge_update_mappings</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col3 decl" id="53br" title='br' data-type='PCIBridge *' data-ref="53br">br</dfn>)</td></tr>
<tr><th id="237">237</th><td>{</td></tr>
<tr><th id="238">238</th><td>    <a class="typedef" href="../../include/hw/pci/pci_bus.h.html#PCIBridgeWindows" title='PCIBridgeWindows' data-type='struct PCIBridgeWindows' data-ref="PCIBridgeWindows">PCIBridgeWindows</a> *<dfn class="local col4 decl" id="54w" title='w' data-type='PCIBridgeWindows *' data-ref="54w">w</dfn> = <a class="local col3 ref" href="#53br" title='br' data-ref="53br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::windows" title='PCIBridge::windows' data-ref="PCIBridge::windows">windows</a>;</td></tr>
<tr><th id="239">239</th><td></td></tr>
<tr><th id="240">240</th><td>    <i>/* Make updates atomic to: handle the case of one VCPU updating the bridge</i></td></tr>
<tr><th id="241">241</th><td><i>     * while another accesses an unaffected region. */</i></td></tr>
<tr><th id="242">242</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_transaction_begin" title='memory_region_transaction_begin' data-ref="memory_region_transaction_begin">memory_region_transaction_begin</a>();</td></tr>
<tr><th id="243">243</th><td>    <a class="tu ref" href="#pci_bridge_region_del" title='pci_bridge_region_del' data-use='c' data-ref="pci_bridge_region_del">pci_bridge_region_del</a>(<a class="local col3 ref" href="#53br" title='br' data-ref="53br">br</a>, <a class="local col3 ref" href="#53br" title='br' data-ref="53br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::windows" title='PCIBridge::windows' data-ref="PCIBridge::windows">windows</a>);</td></tr>
<tr><th id="244">244</th><td>    <a class="local col3 ref" href="#53br" title='br' data-ref="53br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::windows" title='PCIBridge::windows' data-ref="PCIBridge::windows">windows</a> = <a class="tu ref" href="#pci_bridge_region_init" title='pci_bridge_region_init' data-use='c' data-ref="pci_bridge_region_init">pci_bridge_region_init</a>(<a class="local col3 ref" href="#53br" title='br' data-ref="53br">br</a>);</td></tr>
<tr><th id="245">245</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_transaction_commit" title='memory_region_transaction_commit' data-ref="memory_region_transaction_commit">memory_region_transaction_commit</a>();</td></tr>
<tr><th id="246">246</th><td>    <a class="tu ref" href="#pci_bridge_region_cleanup" title='pci_bridge_region_cleanup' data-use='c' data-ref="pci_bridge_region_cleanup">pci_bridge_region_cleanup</a>(<a class="local col3 ref" href="#53br" title='br' data-ref="53br">br</a>, <a class="local col4 ref" href="#54w" title='w' data-ref="54w">w</a>);</td></tr>
<tr><th id="247">247</th><td>}</td></tr>
<tr><th id="248">248</th><td></td></tr>
<tr><th id="249">249</th><td><i>/* default write_config function for PCI-to-PCI bridge */</i></td></tr>
<tr><th id="250">250</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_write_config" title='pci_bridge_write_config' data-ref="pci_bridge_write_config">pci_bridge_write_config</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col5 decl" id="55d" title='d' data-type='PCIDevice *' data-ref="55d">d</dfn>,</td></tr>
<tr><th id="251">251</th><td>                             <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="56address" title='address' data-type='uint32_t' data-ref="56address">address</dfn>, <a class="typedef" href="../../../include/stdint.h.html#uint32_t" title='uint32_t' data-type='unsigned int' data-ref="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="57val" title='val' data-type='uint32_t' data-ref="57val">val</dfn>, <em>int</em> <dfn class="local col8 decl" id="58len" title='len' data-type='int' data-ref="58len">len</dfn>)</td></tr>
<tr><th id="252">252</th><td>{</td></tr>
<tr><th id="253">253</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col9 decl" id="59s" title='s' data-type='PCIBridge *' data-ref="59s">s</dfn> = <a class="macro" href="../../include/hw/pci/pci_bus.h.html#67" title="((PCIBridge *)object_dynamic_cast_assert(((Object *)((d))), (&quot;base-pci-bridge&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 253, __func__))" data-ref="_M/PCI_BRIDGE">PCI_BRIDGE</a>(<a class="local col5 ref" href="#55d" title='d' data-ref="55d">d</a>);</td></tr>
<tr><th id="254">254</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col0 decl" id="60oldctl" title='oldctl' data-type='uint16_t' data-ref="60oldctl">oldctl</dfn> = <a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col5 ref" href="#55d" title='d' data-ref="55d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#158" title="0x3e" data-ref="_M/PCI_BRIDGE_CONTROL">PCI_BRIDGE_CONTROL</a>);</td></tr>
<tr><th id="255">255</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint16_t" title='uint16_t' data-type='unsigned short' data-ref="uint16_t">uint16_t</a> <dfn class="local col1 decl" id="61newctl" title='newctl' data-type='uint16_t' data-ref="61newctl">newctl</dfn>;</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_default_write_config" title='pci_default_write_config' data-ref="pci_default_write_config">pci_default_write_config</a>(<a class="local col5 ref" href="#55d" title='d' data-ref="55d">d</a>, <a class="local col6 ref" href="#56address" title='address' data-ref="56address">address</a>, <a class="local col7 ref" href="#57val" title='val' data-ref="57val">val</a>, <a class="local col8 ref" href="#58len" title='len' data-ref="58len">len</a>);</td></tr>
<tr><th id="258">258</th><td></td></tr>
<tr><th id="259">259</th><td>    <b>if</b> (<a class="ref" href="../../include/qemu/range.h.html#ranges_overlap" title='ranges_overlap' data-ref="ranges_overlap">ranges_overlap</a>(<a class="local col6 ref" href="#56address" title='address' data-ref="56address">address</a>, <a class="local col8 ref" href="#58len" title='len' data-ref="58len">len</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#40" title="0x04" data-ref="_M/PCI_COMMAND">PCI_COMMAND</a>, <var>2</var>) ||</td></tr>
<tr><th id="260">260</th><td></td></tr>
<tr><th id="261">261</th><td>        <i>/* io base/limit */</i></td></tr>
<tr><th id="262">262</th><td>        <a class="ref" href="../../include/qemu/range.h.html#ranges_overlap" title='ranges_overlap' data-ref="ranges_overlap">ranges_overlap</a>(<a class="local col6 ref" href="#56address" title='address' data-ref="56address">address</a>, <a class="local col8 ref" href="#58len" title='len' data-ref="58len">len</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#132" title="0x1c" data-ref="_M/PCI_IO_BASE">PCI_IO_BASE</a>, <var>2</var>) ||</td></tr>
<tr><th id="263">263</th><td></td></tr>
<tr><th id="264">264</th><td>        <i>/* memory base/limit, prefetchable base/limit and</i></td></tr>
<tr><th id="265">265</th><td><i>           io base/limit upper 16 */</i></td></tr>
<tr><th id="266">266</th><td>        <a class="ref" href="../../include/qemu/range.h.html#ranges_overlap" title='ranges_overlap' data-ref="ranges_overlap">ranges_overlap</a>(<a class="local col6 ref" href="#56address" title='address' data-ref="56address">address</a>, <a class="local col8 ref" href="#58len" title='len' data-ref="58len">len</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#140" title="0x20" data-ref="_M/PCI_MEMORY_BASE">PCI_MEMORY_BASE</a>, <var>20</var>) ||</td></tr>
<tr><th id="267">267</th><td></td></tr>
<tr><th id="268">268</th><td>        <i>/* vga enable */</i></td></tr>
<tr><th id="269">269</th><td>        <a class="ref" href="../../include/qemu/range.h.html#ranges_overlap" title='ranges_overlap' data-ref="ranges_overlap">ranges_overlap</a>(<a class="local col6 ref" href="#56address" title='address' data-ref="56address">address</a>, <a class="local col8 ref" href="#58len" title='len' data-ref="58len">len</a>, <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#158" title="0x3e" data-ref="_M/PCI_BRIDGE_CONTROL">PCI_BRIDGE_CONTROL</a>, <var>2</var>)) {</td></tr>
<tr><th id="270">270</th><td>        <a class="ref" href="#pci_bridge_update_mappings" title='pci_bridge_update_mappings' data-ref="pci_bridge_update_mappings">pci_bridge_update_mappings</a>(<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>);</td></tr>
<tr><th id="271">271</th><td>    }</td></tr>
<tr><th id="272">272</th><td></td></tr>
<tr><th id="273">273</th><td>    <a class="local col1 ref" href="#61newctl" title='newctl' data-ref="61newctl">newctl</a> = <a class="ref" href="../../include/hw/pci/pci.h.html#pci_get_word" title='pci_get_word' data-ref="pci_get_word">pci_get_word</a>(<a class="local col5 ref" href="#55d" title='d' data-ref="55d">d</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#158" title="0x3e" data-ref="_M/PCI_BRIDGE_CONTROL">PCI_BRIDGE_CONTROL</a>);</td></tr>
<tr><th id="274">274</th><td>    <b>if</b> (~<a class="local col0 ref" href="#60oldctl" title='oldctl' data-ref="60oldctl">oldctl</a> &amp; <a class="local col1 ref" href="#61newctl" title='newctl' data-ref="61newctl">newctl</a> &amp; <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#164" title="0x40" data-ref="_M/PCI_BRIDGE_CTL_BUS_RESET">PCI_BRIDGE_CTL_BUS_RESET</a>) {</td></tr>
<tr><th id="275">275</th><td>        <i>/* Trigger hot reset on 0-&gt;1 transition. */</i></td></tr>
<tr><th id="276">276</th><td>        <a class="ref" href="../../include/hw/qdev-core.h.html#qbus_reset_all" title='qbus_reset_all' data-ref="qbus_reset_all">qbus_reset_all</a>(&amp;<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::sec_bus" title='PCIBridge::sec_bus' data-ref="PCIBridge::sec_bus">sec_bus</a>.<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::qbus" title='PCIBus::qbus' data-ref="PCIBus::qbus">qbus</a>);</td></tr>
<tr><th id="277">277</th><td>    }</td></tr>
<tr><th id="278">278</th><td>}</td></tr>
<tr><th id="279">279</th><td></td></tr>
<tr><th id="280">280</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_disable_base_limit" title='pci_bridge_disable_base_limit' data-ref="pci_bridge_disable_base_limit">pci_bridge_disable_base_limit</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col2 decl" id="62dev" title='dev' data-type='PCIDevice *' data-ref="62dev">dev</dfn>)</td></tr>
<tr><th id="281">281</th><td>{</td></tr>
<tr><th id="282">282</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col3 decl" id="63conf" title='conf' data-type='uint8_t *' data-ref="63conf">conf</dfn> = <a class="local col2 ref" href="#62dev" title='dev' data-ref="62dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>;</td></tr>
<tr><th id="283">283</th><td></td></tr>
<tr><th id="284">284</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_byte_test_and_set_mask" title='pci_byte_test_and_set_mask' data-ref="pci_byte_test_and_set_mask">pci_byte_test_and_set_mask</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#132" title="0x1c" data-ref="_M/PCI_IO_BASE">PCI_IO_BASE</a>,</td></tr>
<tr><th id="285">285</th><td>                               <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#137" title="(~0x0fUL)" data-ref="_M/PCI_IO_RANGE_MASK">PCI_IO_RANGE_MASK</a> &amp; <var>0xff</var>);</td></tr>
<tr><th id="286">286</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_byte_test_and_clear_mask" title='pci_byte_test_and_clear_mask' data-ref="pci_byte_test_and_clear_mask">pci_byte_test_and_clear_mask</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#133" title="0x1d" data-ref="_M/PCI_IO_LIMIT">PCI_IO_LIMIT</a>,</td></tr>
<tr><th id="287">287</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#137" title="(~0x0fUL)" data-ref="_M/PCI_IO_RANGE_MASK">PCI_IO_RANGE_MASK</a> &amp; <var>0xff</var>);</td></tr>
<tr><th id="288">288</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_set_mask" title='pci_word_test_and_set_mask' data-ref="pci_word_test_and_set_mask">pci_word_test_and_set_mask</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#140" title="0x20" data-ref="_M/PCI_MEMORY_BASE">PCI_MEMORY_BASE</a>,</td></tr>
<tr><th id="289">289</th><td>                               <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#143" title="(~0x0fUL)" data-ref="_M/PCI_MEMORY_RANGE_MASK">PCI_MEMORY_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="290">290</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_clear_mask" title='pci_word_test_and_clear_mask' data-ref="pci_word_test_and_clear_mask">pci_word_test_and_clear_mask</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#141" title="0x22" data-ref="_M/PCI_MEMORY_LIMIT">PCI_MEMORY_LIMIT</a>,</td></tr>
<tr><th id="291">291</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#143" title="(~0x0fUL)" data-ref="_M/PCI_MEMORY_RANGE_MASK">PCI_MEMORY_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="292">292</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_set_mask" title='pci_word_test_and_set_mask' data-ref="pci_word_test_and_set_mask">pci_word_test_and_set_mask</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#144" title="0x24" data-ref="_M/PCI_PREF_MEMORY_BASE">PCI_PREF_MEMORY_BASE</a>,</td></tr>
<tr><th id="293">293</th><td>                               <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#149" title="(~0x0fUL)" data-ref="_M/PCI_PREF_RANGE_MASK">PCI_PREF_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="294">294</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_clear_mask" title='pci_word_test_and_clear_mask' data-ref="pci_word_test_and_clear_mask">pci_word_test_and_clear_mask</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#145" title="0x26" data-ref="_M/PCI_PREF_MEMORY_LIMIT">PCI_PREF_MEMORY_LIMIT</a>,</td></tr>
<tr><th id="295">295</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#149" title="(~0x0fUL)" data-ref="_M/PCI_PREF_RANGE_MASK">PCI_PREF_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="296">296</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_long" title='pci_set_long' data-ref="pci_set_long">pci_set_long</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#150" title="0x28" data-ref="_M/PCI_PREF_BASE_UPPER32">PCI_PREF_BASE_UPPER32</a>, <var>0</var>);</td></tr>
<tr><th id="297">297</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_long" title='pci_set_long' data-ref="pci_set_long">pci_set_long</a>(<a class="local col3 ref" href="#63conf" title='conf' data-ref="63conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#151" title="0x2c" data-ref="_M/PCI_PREF_LIMIT_UPPER32">PCI_PREF_LIMIT_UPPER32</a>, <var>0</var>);</td></tr>
<tr><th id="298">298</th><td>}</td></tr>
<tr><th id="299">299</th><td></td></tr>
<tr><th id="300">300</th><td><i>/* reset bridge specific configuration registers */</i></td></tr>
<tr><th id="301">301</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_reset" title='pci_bridge_reset' data-ref="pci_bridge_reset">pci_bridge_reset</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#DeviceState" title='DeviceState' data-type='struct DeviceState' data-ref="DeviceState">DeviceState</a> *<dfn class="local col4 decl" id="64qdev" title='qdev' data-type='DeviceState *' data-ref="64qdev">qdev</dfn>)</td></tr>
<tr><th id="302">302</th><td>{</td></tr>
<tr><th id="303">303</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col5 decl" id="65dev" title='dev' data-type='PCIDevice *' data-ref="65dev">dev</dfn> = <a class="macro" href="../../include/hw/pci/pci.h.html#191" title="((PCIDevice *)object_dynamic_cast_assert(((Object *)((qdev))), (&quot;pci-device&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 303, __func__))" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="local col4 ref" href="#64qdev" title='qdev' data-ref="64qdev">qdev</a>);</td></tr>
<tr><th id="304">304</th><td>    <a class="typedef" href="../../../include/stdint.h.html#uint8_t" title='uint8_t' data-type='unsigned char' data-ref="uint8_t">uint8_t</a> *<dfn class="local col6 decl" id="66conf" title='conf' data-type='uint8_t *' data-ref="66conf">conf</dfn> = <a class="local col5 ref" href="#65dev" title='dev' data-ref="65dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>;</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td>    <a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a>[<a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#128" title="0x18" data-ref="_M/PCI_PRIMARY_BUS">PCI_PRIMARY_BUS</a>] = <var>0</var>;</td></tr>
<tr><th id="307">307</th><td>    <a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a>[<a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#129" title="0x19" data-ref="_M/PCI_SECONDARY_BUS">PCI_SECONDARY_BUS</a>] = <var>0</var>;</td></tr>
<tr><th id="308">308</th><td>    <a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a>[<a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#130" title="0x1a" data-ref="_M/PCI_SUBORDINATE_BUS">PCI_SUBORDINATE_BUS</a>] = <var>0</var>;</td></tr>
<tr><th id="309">309</th><td>    <a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a>[<a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#131" title="0x1b" data-ref="_M/PCI_SEC_LATENCY_TIMER">PCI_SEC_LATENCY_TIMER</a>] = <var>0</var>;</td></tr>
<tr><th id="310">310</th><td></td></tr>
<tr><th id="311">311</th><td>    <i>/*</i></td></tr>
<tr><th id="312">312</th><td><i>     * the default values for base/limit registers aren't specified</i></td></tr>
<tr><th id="313">313</th><td><i>     * in the PCI-to-PCI-bridge spec. So we don't thouch them here.</i></td></tr>
<tr><th id="314">314</th><td><i>     * Each implementation can override it.</i></td></tr>
<tr><th id="315">315</th><td><i>     * typical implementation does</i></td></tr>
<tr><th id="316">316</th><td><i>     * zero base/limit registers or</i></td></tr>
<tr><th id="317">317</th><td><i>     * disable forwarding: pci_bridge_disable_base_limit()</i></td></tr>
<tr><th id="318">318</th><td><i>     * If disable forwarding is wanted, call pci_bridge_disable_base_limit()</i></td></tr>
<tr><th id="319">319</th><td><i>     * after this function.</i></td></tr>
<tr><th id="320">320</th><td><i>     */</i></td></tr>
<tr><th id="321">321</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_byte_test_and_clear_mask" title='pci_byte_test_and_clear_mask' data-ref="pci_byte_test_and_clear_mask">pci_byte_test_and_clear_mask</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#132" title="0x1c" data-ref="_M/PCI_IO_BASE">PCI_IO_BASE</a>,</td></tr>
<tr><th id="322">322</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#137" title="(~0x0fUL)" data-ref="_M/PCI_IO_RANGE_MASK">PCI_IO_RANGE_MASK</a> &amp; <var>0xff</var>);</td></tr>
<tr><th id="323">323</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_byte_test_and_clear_mask" title='pci_byte_test_and_clear_mask' data-ref="pci_byte_test_and_clear_mask">pci_byte_test_and_clear_mask</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#133" title="0x1d" data-ref="_M/PCI_IO_LIMIT">PCI_IO_LIMIT</a>,</td></tr>
<tr><th id="324">324</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#137" title="(~0x0fUL)" data-ref="_M/PCI_IO_RANGE_MASK">PCI_IO_RANGE_MASK</a> &amp; <var>0xff</var>);</td></tr>
<tr><th id="325">325</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_clear_mask" title='pci_word_test_and_clear_mask' data-ref="pci_word_test_and_clear_mask">pci_word_test_and_clear_mask</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#140" title="0x20" data-ref="_M/PCI_MEMORY_BASE">PCI_MEMORY_BASE</a>,</td></tr>
<tr><th id="326">326</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#143" title="(~0x0fUL)" data-ref="_M/PCI_MEMORY_RANGE_MASK">PCI_MEMORY_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="327">327</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_clear_mask" title='pci_word_test_and_clear_mask' data-ref="pci_word_test_and_clear_mask">pci_word_test_and_clear_mask</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#141" title="0x22" data-ref="_M/PCI_MEMORY_LIMIT">PCI_MEMORY_LIMIT</a>,</td></tr>
<tr><th id="328">328</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#143" title="(~0x0fUL)" data-ref="_M/PCI_MEMORY_RANGE_MASK">PCI_MEMORY_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="329">329</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_clear_mask" title='pci_word_test_and_clear_mask' data-ref="pci_word_test_and_clear_mask">pci_word_test_and_clear_mask</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#144" title="0x24" data-ref="_M/PCI_PREF_MEMORY_BASE">PCI_PREF_MEMORY_BASE</a>,</td></tr>
<tr><th id="330">330</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#149" title="(~0x0fUL)" data-ref="_M/PCI_PREF_RANGE_MASK">PCI_PREF_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="331">331</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_clear_mask" title='pci_word_test_and_clear_mask' data-ref="pci_word_test_and_clear_mask">pci_word_test_and_clear_mask</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#145" title="0x26" data-ref="_M/PCI_PREF_MEMORY_LIMIT">PCI_PREF_MEMORY_LIMIT</a>,</td></tr>
<tr><th id="332">332</th><td>                                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#149" title="(~0x0fUL)" data-ref="_M/PCI_PREF_RANGE_MASK">PCI_PREF_RANGE_MASK</a> &amp; <var>0xffff</var>);</td></tr>
<tr><th id="333">333</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_long" title='pci_set_long' data-ref="pci_set_long">pci_set_long</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#150" title="0x28" data-ref="_M/PCI_PREF_BASE_UPPER32">PCI_PREF_BASE_UPPER32</a>, <var>0</var>);</td></tr>
<tr><th id="334">334</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_long" title='pci_set_long' data-ref="pci_set_long">pci_set_long</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#151" title="0x2c" data-ref="_M/PCI_PREF_LIMIT_UPPER32">PCI_PREF_LIMIT_UPPER32</a>, <var>0</var>);</td></tr>
<tr><th id="335">335</th><td></td></tr>
<tr><th id="336">336</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_word" title='pci_set_word' data-ref="pci_set_word">pci_set_word</a>(<a class="local col6 ref" href="#66conf" title='conf' data-ref="66conf">conf</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#158" title="0x3e" data-ref="_M/PCI_BRIDGE_CONTROL">PCI_BRIDGE_CONTROL</a>, <var>0</var>);</td></tr>
<tr><th id="337">337</th><td>}</td></tr>
<tr><th id="338">338</th><td></td></tr>
<tr><th id="339">339</th><td><i>/* default qdev initialization function for PCI-to-PCI bridge */</i></td></tr>
<tr><th id="340">340</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_initfn" title='pci_bridge_initfn' data-ref="pci_bridge_initfn">pci_bridge_initfn</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col7 decl" id="67dev" title='dev' data-type='PCIDevice *' data-ref="67dev">dev</dfn>, <em>const</em> <em>char</em> *<dfn class="local col8 decl" id="68typename" title='typename' data-type='const char *' data-ref="68typename">typename</dfn>)</td></tr>
<tr><th id="341">341</th><td>{</td></tr>
<tr><th id="342">342</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="local col9 decl" id="69parent" title='parent' data-type='PCIBus *' data-ref="69parent">parent</dfn> = <a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::bus" title='PCIDevice::bus' data-ref="PCIDevice::bus">bus</a>;</td></tr>
<tr><th id="343">343</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col0 decl" id="70br" title='br' data-type='PCIBridge *' data-ref="70br">br</dfn> = <a class="macro" href="../../include/hw/pci/pci_bus.h.html#67" title="((PCIBridge *)object_dynamic_cast_assert(((Object *)((dev))), (&quot;base-pci-bridge&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 343, __func__))" data-ref="_M/PCI_BRIDGE">PCI_BRIDGE</a>(<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>);</td></tr>
<tr><th id="344">344</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBus" title='PCIBus' data-type='struct PCIBus' data-ref="PCIBus">PCIBus</a> *<dfn class="local col1 decl" id="71sec_bus" title='sec_bus' data-type='PCIBus *' data-ref="71sec_bus">sec_bus</dfn> = &amp;<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::sec_bus" title='PCIBridge::sec_bus' data-ref="PCIBridge::sec_bus">sec_bus</a>;</td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_word_test_and_set_mask" title='pci_word_test_and_set_mask' data-ref="pci_word_test_and_set_mask">pci_word_test_and_set_mask</a>(<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#53" title="0x06" data-ref="_M/PCI_STATUS">PCI_STATUS</a>,</td></tr>
<tr><th id="347">347</th><td>                               <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#56" title="0x20" data-ref="_M/PCI_STATUS_66MHZ">PCI_STATUS_66MHZ</a> | <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#58" title="0x80" data-ref="_M/PCI_STATUS_FAST_BACK">PCI_STATUS_FAST_BACK</a>);</td></tr>
<tr><th id="348">348</th><td></td></tr>
<tr><th id="349">349</th><td>    <i>/*</i></td></tr>
<tr><th id="350">350</th><td><i>     * TODO: We implement VGA Enable in the Bridge Control Register</i></td></tr>
<tr><th id="351">351</th><td><i>     * therefore per the PCI to PCI bridge spec we must also implement</i></td></tr>
<tr><th id="352">352</th><td><i>     * VGA Palette Snooping.  When done, set this bit writable:</i></td></tr>
<tr><th id="353">353</th><td><i>     *</i></td></tr>
<tr><th id="354">354</th><td><i>     * pci_word_test_and_set_mask(dev-&gt;wmask + PCI_COMMAND,</i></td></tr>
<tr><th id="355">355</th><td><i>     *                            PCI_COMMAND_VGA_PALETTE);</i></td></tr>
<tr><th id="356">356</th><td><i>     */</i></td></tr>
<tr><th id="357">357</th><td></td></tr>
<tr><th id="358">358</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_config_set_class" title='pci_config_set_class' data-ref="pci_config_set_class">pci_config_set_class</a>(<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>, <a class="macro" href="../../include/hw/pci/pci_ids.h.html#63" title="0x0604" data-ref="_M/PCI_CLASS_BRIDGE_PCI">PCI_CLASS_BRIDGE_PCI</a>);</td></tr>
<tr><th id="359">359</th><td>    <a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>[<a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#77" title="0x0e" data-ref="_M/PCI_HEADER_TYPE">PCI_HEADER_TYPE</a>] =</td></tr>
<tr><th id="360">360</th><td>        (<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a>[<a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#77" title="0x0e" data-ref="_M/PCI_HEADER_TYPE">PCI_HEADER_TYPE</a>] &amp; <a class="macro" href="../../include/hw/pci/pci.h.html#151" title="0x80" data-ref="_M/PCI_HEADER_TYPE_MULTI_FUNCTION">PCI_HEADER_TYPE_MULTI_FUNCTION</a>) |</td></tr>
<tr><th id="361">361</th><td>        <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#79" title="1" data-ref="_M/PCI_HEADER_TYPE_BRIDGE">PCI_HEADER_TYPE_BRIDGE</a>;</td></tr>
<tr><th id="362">362</th><td>    <a class="ref" href="../../include/hw/pci/pci.h.html#pci_set_word" title='pci_set_word' data-ref="pci_set_word">pci_set_word</a>(<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::config" title='PCIDevice::config' data-ref="PCIDevice::config">config</a> + <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#139" title="0x1e" data-ref="_M/PCI_SEC_STATUS">PCI_SEC_STATUS</a>,</td></tr>
<tr><th id="363">363</th><td>                 <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#56" title="0x20" data-ref="_M/PCI_STATUS_66MHZ">PCI_STATUS_66MHZ</a> | <a class="macro" href="../../include/standard-headers/linux/pci_regs.h.html#58" title="0x80" data-ref="_M/PCI_STATUS_FAST_BACK">PCI_STATUS_FAST_BACK</a>);</td></tr>
<tr><th id="364">364</th><td></td></tr>
<tr><th id="365">365</th><td>    <i>/*</i></td></tr>
<tr><th id="366">366</th><td><i>     * If we don't specify the name, the bus will be addressed as &lt;id&gt;.0, where</i></td></tr>
<tr><th id="367">367</th><td><i>     * id is the device id.</i></td></tr>
<tr><th id="368">368</th><td><i>     * Since PCI Bridge devices have a single bus each, we don't need the index:</i></td></tr>
<tr><th id="369">369</th><td><i>     * let users address the bus using the device name.</i></td></tr>
<tr><th id="370">370</th><td><i>     */</i></td></tr>
<tr><th id="371">371</th><td>    <b>if</b> (!<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::bus_name" title='PCIBridge::bus_name' data-ref="PCIBridge::bus_name">bus_name</a> &amp;&amp; <a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::qdev" title='PCIDevice::qdev' data-ref="PCIDevice::qdev">qdev</a>.<a class="ref" href="../../include/hw/qdev-core.h.html#DeviceState::id" title='DeviceState::id' data-ref="DeviceState::id">id</a> &amp;&amp; *<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::qdev" title='PCIDevice::qdev' data-ref="PCIDevice::qdev">qdev</a>.<a class="ref" href="../../include/hw/qdev-core.h.html#DeviceState::id" title='DeviceState::id' data-ref="DeviceState::id">id</a>) {</td></tr>
<tr><th id="372">372</th><td>	    <a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::bus_name" title='PCIBridge::bus_name' data-ref="PCIBridge::bus_name">bus_name</a> = <a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>-&gt;<a class="ref" href="../../include/hw/pci/pci.h.html#PCIDevice::qdev" title='PCIDevice::qdev' data-ref="PCIDevice::qdev">qdev</a>.<a class="ref" href="../../include/hw/qdev-core.h.html#DeviceState::id" title='DeviceState::id' data-ref="DeviceState::id">id</a>;</td></tr>
<tr><th id="373">373</th><td>    }</td></tr>
<tr><th id="374">374</th><td></td></tr>
<tr><th id="375">375</th><td>    <a class="ref" href="../../include/hw/qdev-core.h.html#qbus_create_inplace" title='qbus_create_inplace' data-ref="qbus_create_inplace">qbus_create_inplace</a>(<a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>, <b>sizeof</b>(<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::sec_bus" title='PCIBridge::sec_bus' data-ref="PCIBridge::sec_bus">sec_bus</a>), <a class="local col8 ref" href="#68typename" title='typename' data-ref="68typename">typename</a>, <a class="macro" href="../../include/hw/qdev-core.h.html#16" title="((DeviceState *)object_dynamic_cast_assert(((Object *)((dev))), (&quot;device&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 375, __func__))" data-ref="_M/DEVICE">DEVICE</a>(<a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>),</td></tr>
<tr><th id="376">376</th><td>                        <a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::bus_name" title='PCIBridge::bus_name' data-ref="PCIBridge::bus_name">bus_name</a>);</td></tr>
<tr><th id="377">377</th><td>    <a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::parent_dev" title='PCIBus::parent_dev' data-ref="PCIBus::parent_dev">parent_dev</a> = <a class="local col7 ref" href="#67dev" title='dev' data-ref="67dev">dev</a>;</td></tr>
<tr><th id="378">378</th><td>    <a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::map_irq" title='PCIBus::map_irq' data-ref="PCIBus::map_irq">map_irq</a> = <a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::map_irq" title='PCIBridge::map_irq' data-ref="PCIBridge::map_irq">map_irq</a> ? <a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::map_irq" title='PCIBridge::map_irq' data-ref="PCIBridge::map_irq">map_irq</a> : <a class="ref" href="../../include/hw/pci/pci.h.html#pci_swizzle_map_irq_fn" title='pci_swizzle_map_irq_fn' data-ref="pci_swizzle_map_irq_fn">pci_swizzle_map_irq_fn</a>;</td></tr>
<tr><th id="379">379</th><td>    <a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_mem" title='PCIBus::address_space_mem' data-ref="PCIBus::address_space_mem">address_space_mem</a> = &amp;<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_mem" title='PCIBridge::address_space_mem' data-ref="PCIBridge::address_space_mem">address_space_mem</a>;</td></tr>
<tr><th id="380">380</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_init" title='memory_region_init' data-ref="memory_region_init">memory_region_init</a>(&amp;<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_mem" title='PCIBridge::address_space_mem' data-ref="PCIBridge::address_space_mem">address_space_mem</a>, <a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(br))" data-ref="_M/OBJECT">OBJECT</a>(<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>), <q>"pci_bridge_pci"</q>, <a class="macro" href="../../../include/stdint.h.html#169" title="(18446744073709551615UL)" data-ref="_M/UINT64_MAX">UINT64_MAX</a>);</td></tr>
<tr><th id="381">381</th><td>    <a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::address_space_io" title='PCIBus::address_space_io' data-ref="PCIBus::address_space_io">address_space_io</a> = &amp;<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_io" title='PCIBridge::address_space_io' data-ref="PCIBridge::address_space_io">address_space_io</a>;</td></tr>
<tr><th id="382">382</th><td>    <a class="ref" href="../../include/exec/memory.h.html#memory_region_init" title='memory_region_init' data-ref="memory_region_init">memory_region_init</a>(&amp;<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::address_space_io" title='PCIBridge::address_space_io' data-ref="PCIBridge::address_space_io">address_space_io</a>, <a class="macro" href="../../include/qom/object.h.html#473" title="((Object *)(br))" data-ref="_M/OBJECT">OBJECT</a>(<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>), <q>"pci_bridge_io"</q>, <var>65536</var>);</td></tr>
<tr><th id="383">383</th><td>    <a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::windows" title='PCIBridge::windows' data-ref="PCIBridge::windows">windows</a> = <a class="tu ref" href="#pci_bridge_region_init" title='pci_bridge_region_init' data-use='c' data-ref="pci_bridge_region_init">pci_bridge_region_init</a>(<a class="local col0 ref" href="#70br" title='br' data-ref="70br">br</a>);</td></tr>
<tr><th id="384">384</th><td>    <a class="macro" href="../../include/qemu/queue.h.html#103" title="do { (&amp;sec_bus-&gt;child)-&gt;lh_first = ((void*)0); } while ( 0)" data-ref="_M/QLIST_INIT">QLIST_INIT</a>(&amp;<a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::child" title='PCIBus::child' data-ref="PCIBus::child">child</a>);</td></tr>
<tr><th id="385">385</th><td>    <a class="macro" href="../../include/qemu/queue.h.html#135" title="do { if (((sec_bus)-&gt;sibling.le_next = (&amp;parent-&gt;child)-&gt;lh_first) != ((void*)0)) (&amp;parent-&gt;child)-&gt;lh_first-&gt;sibling.le_prev = &amp;(sec_bus)-&gt;sibling.le_next; (&amp;parent-&gt;child)-&gt;lh_first = (sec_bus); (sec_bus)-&gt;sibling.le_prev = &amp;(&amp;parent-&gt;child)-&gt;lh_first; } while ( 0)" data-ref="_M/QLIST_INSERT_HEAD">QLIST_INSERT_HEAD</a>(&amp;<a class="local col9 ref" href="#69parent" title='parent' data-ref="69parent">parent</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::child" title='PCIBus::child' data-ref="PCIBus::child">child</a>, <a class="local col1 ref" href="#71sec_bus" title='sec_bus' data-ref="71sec_bus">sec_bus</a>, <a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::sibling" title='PCIBus::sibling' data-ref="PCIBus::sibling">sibling</a>);</td></tr>
<tr><th id="386">386</th><td>}</td></tr>
<tr><th id="387">387</th><td></td></tr>
<tr><th id="388">388</th><td><i>/* default qdev clean up function for PCI-to-PCI bridge */</i></td></tr>
<tr><th id="389">389</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_exitfn" title='pci_bridge_exitfn' data-ref="pci_bridge_exitfn">pci_bridge_exitfn</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIDevice" title='PCIDevice' data-type='struct PCIDevice' data-ref="PCIDevice">PCIDevice</a> *<dfn class="local col2 decl" id="72pci_dev" title='pci_dev' data-type='PCIDevice *' data-ref="72pci_dev">pci_dev</dfn>)</td></tr>
<tr><th id="390">390</th><td>{</td></tr>
<tr><th id="391">391</th><td>    <a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col3 decl" id="73s" title='s' data-type='PCIBridge *' data-ref="73s">s</dfn> = <a class="macro" href="../../include/hw/pci/pci_bus.h.html#67" title="((PCIBridge *)object_dynamic_cast_assert(((Object *)((pci_dev))), (&quot;base-pci-bridge&quot;), &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 391, __func__))" data-ref="_M/PCI_BRIDGE">PCI_BRIDGE</a>(<a class="local col2 ref" href="#72pci_dev" title='pci_dev' data-ref="72pci_dev">pci_dev</a>);</td></tr>
<tr><th id="392">392</th><td>    <a class="macro" href="../../../include/assert.h.html#88" title="((((&amp;s-&gt;sec_bus.child)-&gt;lh_first == ((void*)0))) ? (void) (0) : __assert_fail (&quot;QLIST_EMPTY(&amp;s-&gt;sec_bus.child)&quot;, &quot;/home/jon/workspace/qemu/hw/pci/pci_bridge.c&quot;, 392, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(<a class="macro" href="../../include/qemu/queue.h.html#162" title="((&amp;s-&gt;sec_bus.child)-&gt;lh_first == ((void*)0))" data-ref="_M/QLIST_EMPTY">QLIST_EMPTY</a>(&amp;<a class="local col3 ref" href="#73s" title='s' data-ref="73s">s</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::sec_bus" title='PCIBridge::sec_bus' data-ref="PCIBridge::sec_bus">sec_bus</a>.<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::child" title='PCIBus::child' data-ref="PCIBus::child">child</a>));</td></tr>
<tr><th id="393">393</th><td>    <a class="macro" href="../../include/qemu/queue.h.html#142" title="do { if ((&amp;s-&gt;sec_bus)-&gt;sibling.le_next != ((void*)0)) (&amp;s-&gt;sec_bus)-&gt;sibling.le_next-&gt;sibling.le_prev = (&amp;s-&gt;sec_bus)-&gt;sibling.le_prev; *(&amp;s-&gt;sec_bus)-&gt;sibling.le_prev = (&amp;s-&gt;sec_bus)-&gt;sibling.le_next; } while ( 0)" data-ref="_M/QLIST_REMOVE">QLIST_REMOVE</a>(&amp;<a class="local col3 ref" href="#73s" title='s' data-ref="73s">s</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::sec_bus" title='PCIBridge::sec_bus' data-ref="PCIBridge::sec_bus">sec_bus</a>, <a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBus::sibling" title='PCIBus::sibling' data-ref="PCIBus::sibling">sibling</a>);</td></tr>
<tr><th id="394">394</th><td>    <a class="tu ref" href="#pci_bridge_region_del" title='pci_bridge_region_del' data-use='c' data-ref="pci_bridge_region_del">pci_bridge_region_del</a>(<a class="local col3 ref" href="#73s" title='s' data-ref="73s">s</a>, <a class="local col3 ref" href="#73s" title='s' data-ref="73s">s</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::windows" title='PCIBridge::windows' data-ref="PCIBridge::windows">windows</a>);</td></tr>
<tr><th id="395">395</th><td>    <a class="tu ref" href="#pci_bridge_region_cleanup" title='pci_bridge_region_cleanup' data-use='c' data-ref="pci_bridge_region_cleanup">pci_bridge_region_cleanup</a>(<a class="local col3 ref" href="#73s" title='s' data-ref="73s">s</a>, <a class="local col3 ref" href="#73s" title='s' data-ref="73s">s</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::windows" title='PCIBridge::windows' data-ref="PCIBridge::windows">windows</a>);</td></tr>
<tr><th id="396">396</th><td>    <i>/* object_unparent() is called automatically during device deletion */</i></td></tr>
<tr><th id="397">397</th><td>}</td></tr>
<tr><th id="398">398</th><td></td></tr>
<tr><th id="399">399</th><td><i>/*</i></td></tr>
<tr><th id="400">400</th><td><i> * before qdev initialization(qdev_init()), this function sets bus_name and</i></td></tr>
<tr><th id="401">401</th><td><i> * map_irq callback which are necessry for pci_bridge_initfn() to</i></td></tr>
<tr><th id="402">402</th><td><i> * initialize bus.</i></td></tr>
<tr><th id="403">403</th><td><i> */</i></td></tr>
<tr><th id="404">404</th><td><em>void</em> <dfn class="decl def" id="pci_bridge_map_irq" title='pci_bridge_map_irq' data-ref="pci_bridge_map_irq">pci_bridge_map_irq</dfn>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a> *<dfn class="local col4 decl" id="74br" title='br' data-type='PCIBridge *' data-ref="74br">br</dfn>, <em>const</em> <em>char</em>* <dfn class="local col5 decl" id="75bus_name" title='bus_name' data-type='const char *' data-ref="75bus_name">bus_name</dfn>,</td></tr>
<tr><th id="405">405</th><td>                        <a class="typedef" href="../../include/hw/pci/pci.h.html#pci_map_irq_fn" title='pci_map_irq_fn' data-type='int (*)(PCIDevice *, int)' data-ref="pci_map_irq_fn">pci_map_irq_fn</a> <dfn class="local col6 decl" id="76map_irq" title='map_irq' data-type='pci_map_irq_fn' data-ref="76map_irq">map_irq</dfn>)</td></tr>
<tr><th id="406">406</th><td>{</td></tr>
<tr><th id="407">407</th><td>    <a class="local col4 ref" href="#74br" title='br' data-ref="74br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::map_irq" title='PCIBridge::map_irq' data-ref="PCIBridge::map_irq">map_irq</a> = <a class="local col6 ref" href="#76map_irq" title='map_irq' data-ref="76map_irq">map_irq</a>;</td></tr>
<tr><th id="408">408</th><td>    <a class="local col4 ref" href="#74br" title='br' data-ref="74br">br</a>-&gt;<a class="ref" href="../../include/hw/pci/pci_bus.h.html#PCIBridge::bus_name" title='PCIBridge::bus_name' data-ref="PCIBridge::bus_name">bus_name</a> = <a class="local col5 ref" href="#75bus_name" title='bus_name' data-ref="75bus_name">bus_name</a>;</td></tr>
<tr><th id="409">409</th><td>}</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td><em>static</em> <em>const</em> <a class="typedef" href="../../include/qom/object.h.html#TypeInfo" title='TypeInfo' data-type='struct TypeInfo' data-ref="TypeInfo">TypeInfo</a> <dfn class="tu decl def" id="pci_bridge_type_info" title='pci_bridge_type_info' data-type='const TypeInfo' data-ref="pci_bridge_type_info">pci_bridge_type_info</dfn> = {</td></tr>
<tr><th id="412">412</th><td>    .<a class="ref" href="../../include/qom/object.h.html#TypeInfo::name" title='TypeInfo::name' data-ref="TypeInfo::name">name</a> = <a class="macro" href="../../include/hw/pci/pci_bus.h.html#66" title="&quot;base-pci-bridge&quot;" data-ref="_M/TYPE_PCI_BRIDGE">TYPE_PCI_BRIDGE</a>,</td></tr>
<tr><th id="413">413</th><td>    .<a class="ref" href="../../include/qom/object.h.html#TypeInfo::parent" title='TypeInfo::parent' data-ref="TypeInfo::parent">parent</a> = <a class="macro" href="../../include/hw/pci/pci.h.html#190" title="&quot;pci-device&quot;" data-ref="_M/TYPE_PCI_DEVICE">TYPE_PCI_DEVICE</a>,</td></tr>
<tr><th id="414">414</th><td>    .<a class="ref" href="../../include/qom/object.h.html#TypeInfo::instance_size" title='TypeInfo::instance_size' data-ref="TypeInfo::instance_size">instance_size</a> = <b>sizeof</b>(<a class="typedef" href="../../include/qemu/typedefs.h.html#PCIBridge" title='PCIBridge' data-type='struct PCIBridge' data-ref="PCIBridge">PCIBridge</a>),</td></tr>
<tr><th id="415">415</th><td>    .<a class="ref" href="../../include/qom/object.h.html#TypeInfo::abstract" title='TypeInfo::abstract' data-ref="TypeInfo::abstract">abstract</a> = <span class="macro" title="1" data-ref="_M/true">true</span>,</td></tr>
<tr><th id="416">416</th><td>};</td></tr>
<tr><th id="417">417</th><td></td></tr>
<tr><th id="418">418</th><td><em>static</em> <em>void</em> <dfn class="tu decl def" id="pci_bridge_register_types" title='pci_bridge_register_types' data-type='void pci_bridge_register_types()' data-ref="pci_bridge_register_types">pci_bridge_register_types</dfn>(<em>void</em>)</td></tr>
<tr><th id="419">419</th><td>{</td></tr>
<tr><th id="420">420</th><td>    <a class="ref" href="../../include/qom/object.h.html#type_register_static" title='type_register_static' data-ref="type_register_static">type_register_static</a>(&amp;<a class="tu ref" href="#pci_bridge_type_info" title='pci_bridge_type_info' data-use='a' data-ref="pci_bridge_type_info">pci_bridge_type_info</a>);</td></tr>
<tr><th id="421">421</th><td>}</td></tr>
<tr><th id="422">422</th><td></td></tr>
<tr><th id="423">423</th><td><a class="macro" href="../../include/qemu/module.h.html#52" title="static void __attribute__((constructor)) do_qemu_init_pci_bridge_register_types(void) { register_module_init(pci_bridge_register_types, MODULE_INIT_QOM); }" data-ref="_M/type_init">type_init</a>(<a class="tu ref" href="#pci_bridge_register_types" title='pci_bridge_register_types' data-use='r' data-ref="pci_bridge_register_types">pci_bridge_register_types</a>)</td></tr>
<tr><th id="424">424</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2017-Aug-28</em> from project codebrowser revision <em>v2.10.0-rc0-7-g6be37cc</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
